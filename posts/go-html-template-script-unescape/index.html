<!doctype html><html lang=en><head prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#"><meta charset=utf-8><meta name=generator content="Hugo 0.94.2"><meta name=theme-color content="#fff"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=format-detection content="telephone=no, date=no, address=no, email=no"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><title>Unescape values in html templates using golang | ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š</title><link rel=stylesheet href=/css/meme.min.1e9569075b65b67543e6b3e64e8b022a28b68a824c57a27b815d031e42a4c5a4.css><script src=/js/meme.min.92ba19525abb1512330a8077ec783eb791c1d9b4d593c81df5b4a00ba9485d6a.js></script><meta name=author content="h1z3y3"><meta name=description content="While using values in a html template, my colleague faced a problem that the values in <script> tags were all escaped. So the template developer can not use the values in javascript. It just looks like this:
// ... <script type=&#34;text/json&#34; id=&#34;channel&#34; ch=&#34;recommend&#34; tk=&#34;&#34;> [&amp;#34;news&amp;#34;,&amp;#34;comedy&amp;#34;,&amp;#34;cartoon&amp;#34;,&amp;#34;tech&amp;#34;,&amp;#34;travelling&amp;#34;,&amp;#34;fashion&amp;#34;,&amp;#34;photograph&amp;#34;,&amp;#34;household&amp;#34;,&amp;#34;movies&amp;#34;,&amp;#34;foods&amp;#34;,&amp;#34;military&amp;#34;,&amp;#34;health&amp;#34;,&amp;#34;test&amp;#34;] </script> // ... I tried to find out the reason. So I copied the template values in other HTML tags, like <div>, rather than in <script>. It rendered correctly, and was not escaped:
// ... <div> [&#34;news&#34;,&#34;comedy&#34;,&#34;cartoon&#34;,&#34;tech&#34;,&#34;travelling&#34;,&#34;fashion&#34;,&#34;photograph&#34;,&#34;household&#34;,&#34;movies&#34;,&#34;foods&#34;,&#34;military&#34;,&#34;health&#34;,&#34;test&#34;] <div> // ... I start google the reason. At first, I thought it was because the values given template is wrong, it had already been escaped before the page rendering."><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=mask-icon href=/icons/safari-pinned-tab.svg color=#2a6df4><link rel=apple-touch-icon sizes=180x180 href=/icons/apple-touch-icon.png><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-title content="ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š"><meta name=apple-mobile-web-app-status-bar-style content="black"><meta name=mobile-web-app-capable content="yes"><meta name=application-name content="ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š"><meta name=msapplication-starturl content="../../"><meta name=msapplication-TileColor content="#fff"><meta name=msapplication-TileImage content="../../icons/mstile-150x150.png"><link rel=manifest href=/manifest.json><script src=http://use.edgefonts.net/merriweather:n3,n4,n7,n9.js></script>
<link rel=canonical href=https://h1z3y3.me/posts/go-html-template-script-unescape/><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","datePublished":"2021-05-25T21:56:44+00:00","dateModified":"2021-05-25T21:56:44+00:00","url":"https://h1z3y3.me/posts/go-html-template-script-unescape/","headline":"Unescape values in html templates using golang","description":"While using values in a html template, my colleague faced a problem that the values in \u003cscript\u003e tags were all escaped. So the template developer can not use the values in javascript. It just looks like this:\n// ... \u003cscript type=\"text/json\" id=\"channel\" ch=\"recommend\" tk=\"\"\u003e [\u0026#34;news\u0026#34;,\u0026#34;comedy\u0026#34;,\u0026#34;cartoon\u0026#34;,\u0026#34;tech\u0026#34;,\u0026#34;travelling\u0026#34;,\u0026#34;fashion\u0026#34;,\u0026#34;photograph\u0026#34;,\u0026#34;household\u0026#34;,\u0026#34;movies\u0026#34;,\u0026#34;foods\u0026#34;,\u0026#34;military\u0026#34;,\u0026#34;health\u0026#34;,\u0026#34;test\u0026#34;] \u003c/script\u003e // ... I tried to find out the reason. So I copied the template values in other HTML tags, like \u003cdiv\u003e, rather than in \u003cscript\u003e. It rendered correctly, and was not escaped:\n// ... \u003cdiv\u003e [\"news\",\"comedy\",\"cartoon\",\"tech\",\"travelling\",\"fashion\",\"photograph\",\"household\",\"movies\",\"foods\",\"military\",\"health\",\"test\"] \u003cdiv\u003e // ... I start google the reason. At first, I thought it was because the values given template is wrong, it had already been escaped before the page rendering.","inLanguage":"en","articleSection":"posts","wordCount":514,"image":"https://h1z3y3.me/icons/apple-touch-icon.png","author":{"@type":"Person","description":"æˆä¹‹ä»¥é±¼ä¸å¦‚æˆä¹‹ä»¥æ¸”","email":"gmzhaoyang@gmail.com","image":"https://h1z3y3.me/icons/apple-touch-icon.png","url":"https://h1z3y3.me/","name":"h1z3y3"},"license":"[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)","publisher":{"@type":"Organization","name":"ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š","logo":{"@type":"ImageObject","url":"https://h1z3y3.me/icons/apple-touch-icon.png"},"url":"https://h1z3y3.me/"},"mainEntityOfPage":{"@type":"WebSite","@id":"https://h1z3y3.me/"}}</script><meta name=twitter:card content="summary"><meta name=twitter:site content="@h1z3y3"><meta name=twitter:creator content="@h1z3y3"><meta property="og:title" content="Unescape values in html templates using golang"><meta property="og:description" content="While using values in a html template, my colleague faced a problem that the values in <script> tags were all escaped. So the template developer can not use the values in javascript. It just looks like this:
// ... <script type=&#34;text/json&#34; id=&#34;channel&#34; ch=&#34;recommend&#34; tk=&#34;&#34;> [&amp;#34;news&amp;#34;,&amp;#34;comedy&amp;#34;,&amp;#34;cartoon&amp;#34;,&amp;#34;tech&amp;#34;,&amp;#34;travelling&amp;#34;,&amp;#34;fashion&amp;#34;,&amp;#34;photograph&amp;#34;,&amp;#34;household&amp;#34;,&amp;#34;movies&amp;#34;,&amp;#34;foods&amp;#34;,&amp;#34;military&amp;#34;,&amp;#34;health&amp;#34;,&amp;#34;test&amp;#34;] </script> // ... I tried to find out the reason. So I copied the template values in other HTML tags, like <div>, rather than in <script>. It rendered correctly, and was not escaped:
// ... <div> [&#34;news&#34;,&#34;comedy&#34;,&#34;cartoon&#34;,&#34;tech&#34;,&#34;travelling&#34;,&#34;fashion&#34;,&#34;photograph&#34;,&#34;household&#34;,&#34;movies&#34;,&#34;foods&#34;,&#34;military&#34;,&#34;health&#34;,&#34;test&#34;] <div> // ... I start google the reason. At first, I thought it was because the values given template is wrong, it had already been escaped before the page rendering."><meta property="og:url" content="https://h1z3y3.me/posts/go-html-template-script-unescape/"><meta property="og:site_name" content="ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š"><meta property="og:locale" content="zh"><meta property="og:image" content="https://h1z3y3.me/icons/apple-touch-icon.png"><meta property="og:type" content="article"><meta property="article:published_time" content="2021-05-25T21:56:44+00:00"><meta property="article:modified_time" content="2021-05-25T21:56:44+00:00"><meta property="article:section" content="posts"><link rel=preconnect href=https://www.google-analytics.com crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=UA-139983727-1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","UA-139983727-1")</script></head><body><div class=container><header class=header><div class=header-wrapper><div class="header-inner single"><div class=site-brand><a href=/ class=brand>ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š</a></div><nav class=nav><ul class=menu id=menu><li class=menu-item><a href=/posts/><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon archive"><path d="M32 448c0 17.7 14.3 32 32 32h384c17.7.0 32-14.3 32-32V160H32v288zm160-212c0-6.6 5.4-12 12-12h104c6.6.0 12 5.4 12 12v8c0 6.6-5.4 12-12 12H204c-6.6.0-12-5.4-12-12v-8zM480 32H32C14.3 32 0 46.3.0 64v48c0 8.8 7.2 16 16 16h480c8.8.0 16-7.2 16-16V64c0-17.7-14.3-32-32-32z"/></svg><span class=menu-item-name>Posts</span></a></li><li class=menu-item><a href=https://github.com/h1z3y3 target=_blank rel="external noopener"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon github"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg><span class=menu-item-name>Github</span></a></li><li class=menu-item><a href=/rss.xml><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon rss"><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg><span class=menu-item-name>RSS</span></a></li><li class=menu-item><a id=theme-switcher href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-light"><path d="M193.2 104.5 242 7a18 18 0 0128 0l48.8 97.5L422.2 70A18 18 0 01442 89.8l-34.5 103.4L505 242a18 18 0 010 28l-97.5 48.8L442 422.2A18 18 0 01422.2 442l-103.4-34.5L270 505a18 18 0 01-28 0l-48.8-97.5L89.8 442A18 18 0 0170 422.2l34.5-103.4-97.5-48.8a18 18 0 010-28l97.5-48.8L70 89.8A18 18 0 0189.8 70zM256 128a128 128 0 10.01.0M256 160a96 96 0 10.01.0"/></svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon theme-icon-dark"><path d="M27 412A256 256 0 10181 5a11.5 11.5.0 00-5 20A201.5 201.5.0 0142 399a11.5 11.5.0 00-15 13"/></svg></a></li></ul></nav></div></div><input type=checkbox id=nav-toggle aria-hidden=true>
<label for=nav-toggle class=nav-toggle></label>
<label for=nav-toggle class=nav-curtain></label></header><main class="main single" id=main><div class=main-inner><article class="content post h-entry" data-align=default data-type=posts data-toc-num=true><h1 class="post-title p-name">Unescape values in html templates using golang</h1><div class=post-meta><time datetime=2021-05-25T21:56:44+00:00 class="post-meta-item published dt-published"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon post-meta-icon"><path d="M148 288h-40c-6.6.0-12-5.4-12-12v-40c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v40c0 6.6-5.4 12-12 12zm108-12v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 96v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm-96 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm192 0v-40c0-6.6-5.4-12-12-12h-40c-6.6.0-12 5.4-12 12v40c0 6.6 5.4 12 12 12h40c6.6.0 12-5.4 12-12zm96-260v352c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V112c0-26.5 21.5-48 48-48h48V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h128V12c0-6.6 5.4-12 12-12h40c6.6.0 12 5.4 12 12v52h48c26.5.0 48 21.5 48 48zm-48 346V160H48v298c0 3.3 2.7 6 6 6h340c3.3.0 6-2.7 6-6z"/></svg>&nbsp;2021.5.25</time>
<span class="post-meta-item wordcount"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3.0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9.0l60.1 60.1c18.8 18.7 18.8 49.1.0 67.9zM284.2 99.8 21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3.0-17l-111-111c-4.8-4.7-12.4-4.7-17.1.0zM124.1 339.9c-5.5-5.5-5.5-14.3.0-19.8l154-154c5.5-5.5 14.3-5.5 19.8.0s5.5 14.3.0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8.0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"/></svg>&nbsp;514</span>
<span class="post-meta-item reading-time"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon post-meta-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm0 448c-110.5.0-2e2-89.5-2e2-2e2S145.5 56 256 56s2e2 89.5 2e2 2e2-89.5 2e2-2e2 2e2zm61.8-104.4-84.9-61.7c-3.1-2.3-4.9-5.9-4.9-9.7V116c0-6.6 5.4-12 12-12h32c6.6.0 12 5.4 12 12v141.7l66.8 48.6c5.4 3.9 6.5 11.4 2.6 16.8L334.6 349c-3.9 5.3-11.4 6.5-16.8 2.6z"/></svg>&nbsp;3&nbsp;åˆ†é’Ÿ</span></div><div class="post-body e-content"><p>While using values in a html template, my colleague faced a problem that the values in <code>&lt;script></code> tags were all escaped.
So the template developer can not use the values in javascript. It just looks like this:</p><pre tabindex=0><code>// ... 

&lt;script type=&#34;text/json&#34; id=&#34;channel&#34; ch=&#34;recommend&#34; tk=&#34;&#34;&gt;
   [&amp;#34;news&amp;#34;,&amp;#34;comedy&amp;#34;,&amp;#34;cartoon&amp;#34;,&amp;#34;tech&amp;#34;,&amp;#34;travelling&amp;#34;,&amp;#34;fashion&amp;#34;,&amp;#34;photograph&amp;#34;,&amp;#34;household&amp;#34;,&amp;#34;movies&amp;#34;,&amp;#34;foods&amp;#34;,&amp;#34;military&amp;#34;,&amp;#34;health&amp;#34;,&amp;#34;test&amp;#34;]
&lt;/script&gt;

// ...
</code></pre><p>I tried to find out the reason. So I copied the template values in other HTML tags, like <code>&lt;div></code>, rather than in <code>&lt;script></code>.
It rendered correctly, and was not escaped:</p><pre tabindex=0><code>// ...

&lt;div&gt;
  [&#34;news&#34;,&#34;comedy&#34;,&#34;cartoon&#34;,&#34;tech&#34;,&#34;travelling&#34;,&#34;fashion&#34;,&#34;photograph&#34;,&#34;household&#34;,&#34;movies&#34;,&#34;foods&#34;,&#34;military&#34;,&#34;health&#34;,&#34;test&#34;]
&lt;div&gt;

// ...
</code></pre><p>I start google the reason. At first, I thought it was because the values given template is wrong,
it had already been escaped before the page rendering.
I found some reasons in google, they said using <code>json.NewEncoder()</code> instead of using <code>json.Marshal()</code>.
So it can <code>SetEscapeHTML(false)</code> before encode the data. This is the example code:</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=nf>toRawJson</span><span class=p>(</span><span class=nx>v</span> <span class=kd>interface</span><span class=p>{})</span> <span class=p>(</span><span class=kt>string</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>buf</span> <span class=o>:=</span> <span class=nb>new</span><span class=p>(</span><span class=nx>bytes</span><span class=p>.</span><span class=nx>Buffer</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>enc</span> <span class=o>:=</span> <span class=nx>json</span><span class=p>.</span><span class=nf>NewEncoder</span><span class=p>(</span><span class=nx>buf</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>enc</span><span class=p>.</span><span class=nf>SetEscapeHTML</span><span class=p>(</span><span class=kc>false</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>enc</span><span class=p>.</span><span class=nf>Encode</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=s>&#34;&#34;</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>TrimSuffix</span><span class=p>(</span><span class=nx>buf</span><span class=p>.</span><span class=nf>String</span><span class=p>(),</span> <span class=s>&#34;\n&#34;</span><span class=p>),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div></div><p>I tried it, but didn&rsquo;t work either.</p><p>Now, let&rsquo;s think about for a moment. Only <code>&lt;script></code> has the problem, but other html tags did not.
So if I could say the value is actually correct, but the template rendered in wrong ?</p><p>I started google the problems about template render but not the wrong value.</p><p>Then I found the <code>html/template</code> official document:</p><p>Let&rsquo;s see its introduction: <code>html/template</code> <a href=https://golang.org/pkg/html/template/#hdr-Introduction target=_blank rel=noopener>introduction</a>:</p><blockquote><p>This package wraps package text/template so you can share its template API
to parse and execute HTML templates safely.</p><pre tabindex=0><code>tmpl, err := template.New(&#34;name&#34;).Parse(...)
// Error checking elided
err = tmpl.Execute(out, data)
</code></pre><p>If successful, tmpl will now be injection-safe. Otherwise,
err is an error defined in the docs for ErrorCode.</p><p>HTML templates treat data values as plain text which should be encoded so they
can be safely embedded in an HTML document.
The escaping is contextual, so actions can appear within JavaScript, CSS, and URI contexts.
The security model used by this package assumes that template authors are trusted,
while Execute&rsquo;s data parameter is not. More details are provided below.</p><p>Example</p><pre tabindex=0><code>import &#34;text/template&#34;
...
t, err := template.New(&#34;foo&#34;).Parse(`{{define &#34;T&#34;}}Hello, {{.}}!{{end}}`)
err = t.ExecuteTemplate(out, &#34;T&#34;, &#34;&lt;script&gt;alert(&#39;you have been pwned&#39;)&lt;/script&gt;&#34;)
</code></pre><p>produces</p><pre tabindex=0><code>Hello, &lt;script&gt;alert(&#39;you have been pwned&#39;)&lt;/script&gt;!
</code></pre><p>but the contextual autoescaping in html/template</p><pre tabindex=0><code>import &#34;html/template&#34;
...
t, err := template.New(&#34;foo&#34;).Parse(`{{define &#34;T&#34;}}Hello, {{.}}!{{end}}`)
err = t.ExecuteTemplate(out, &#34;T&#34;, &#34;&lt;script&gt;alert(&#39;you have been pwned&#39;)&lt;/script&gt;&#34;)
</code></pre><p>produces safe, escaped HTML output</p><pre tabindex=0><code>Hello, &amp;lt;script&amp;gt;alert(&amp;#39;you have been pwned&amp;#39;)&amp;lt;/script&amp;gt;!
</code></pre></blockquote><p>ğŸ¥³ğŸ¥³ğŸ¥³ Now we find out the reason, but how we solve this problem?</p><p>Maybe I could provide a function to unescape the value in templates.</p><div class=highlight><div class=chroma><div class=table-container><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>r</span> <span class=o>:=</span> <span class=nx>gin</span><span class=p>.</span><span class=nf>Default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>funcMap</span><span class=p>[</span><span class=s>&#34;unescapeHTML&#34;</span><span class=p>]</span> <span class=p>=</span> <span class=kd>func</span><span class=p>(</span><span class=nx>s</span> <span class=kt>string</span><span class=p>)</span> <span class=nx>template</span><span class=p>.</span><span class=nx>HTML</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>template</span><span class=p>.</span><span class=nf>HTML</span><span class=p>(</span><span class=nx>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>	<span class=nx>r</span><span class=p>.</span><span class=nf>SetFuncMap</span><span class=p>(</span><span class=nx>funcMap</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div></div><p>Then you can use it in templates as below:</p><pre tabindex=0><code>// ...
&lt;script type=&#34;text/json&#34; id=&#34;channel&#34; ch=&#34;recommend&#34; tk=&#34;&#34;&gt;
    {{ .channel_data | unescapeHTML }}
&lt;/script&gt;
// ...
</code></pre><p>Finally, it works.
When the template is loaded, the value won&rsquo;t be escaped!</p><pre tabindex=0><code>// ... 

&lt;script type=&#34;text/json&#34; id=&#34;channel&#34; ch=&#34;recommend&#34; tk=&#34;&#34;&gt;
   [&#34;news&#34;,&#34;comedy&#34;,&#34;cartoon&#34;,&#34;tech&#34;,&#34;travelling&#34;,&#34;fashion&#34;,&#34;photograph&#34;,&#34;household&#34;,&#34;movies&#34;,&#34;foods&#34;,&#34;military&#34;,&#34;health&#34;,&#34;test&#34;]
&lt;/script&gt;

// ...
</code></pre><p><strong>Hope this helps you!! Thanks for reading :)</strong></p></div><ul class=post-copyright><li class="copyright-item author"><span class=copyright-item-text>ä½œè€…</span>ï¼š<a href=https://h1z3y3.me/ class="p-author h-card" target=_blank rel=noopener>h1z3y3</a></li><li class="copyright-item link"><span class=copyright-item-text>é“¾æ¥</span>ï¼š<a href=/posts/go-html-template-script-unescape/ target=_blank rel=noopener>https://h1z3y3.me/posts/go-html-template-script-unescape/</a></li><li class="copyright-item license"><span class=copyright-item-text>è®¸å¯</span>ï¼š<a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en target=_blank rel=noopener>CC BY-NC-SA 4.0</a></li></ul></article><div class=updated-badge-container><span title="Updated @ 2021-05-25 21:56:44 UTC" style=cursor:help><svg xmlns="http://www.w3.org/2000/svg" width="130" height="20" class="updated-badge"><linearGradient id="b" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><clipPath id="a"><rect width="130" height="20" rx="3" fill="#fff"/></clipPath><g clip-path="url(#a)"><path class="updated-badge-left" d="M0 0h55v20H0z"/><path class="updated-badge-right" d="M55 0h75v20H55z"/><path fill="url(#b)" d="M0 0h130v20H0z"/></g><g fill="#fff" text-anchor="middle" font-size="110"><text x="285" y="150" fill="#010101" fill-opacity=".3" textLength="450" transform="scale(.1)">updated</text><text x="285" y="140" textLength="450" transform="scale(.1)">updated</text><text x="915" y="150" fill="#010101" fill-opacity=".3" textLength="650" transform="scale(.1)">2021-05-25</text><text x="915" y="140" textLength="650" transform="scale(.1)">2021-05-25</text></g></svg></span></div><div class=related-posts><h2 class=related-title>ç›¸å…³æ–‡ç« ï¼š<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon related-icon"><path d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm144 276c0 6.6-5.4 12-12 12h-92v92c0 6.6-5.4 12-12 12h-56c-6.6.0-12-5.4-12-12v-92h-92c-6.6.0-12-5.4-12-12v-56c0-6.6 5.4-12 12-12h92v-92c0-6.6 5.4-12 12-12h56c6.6.0 12 5.4 12 12v92h92c6.6.0 12 5.4 12 12v56z"/></svg></h2><ul class=related-list><li class=related-item><a href=/posts/gophercon-china-2021/ class=related-link>2021 åŒ—äº¬ Gopher å¤§ä¼š</a></li><li class=related-item><a href=/posts/simple-and-powerful-reverse-proxy-in-golang/ class=related-link>Go ç®€å•è€Œå¼ºå¤§çš„åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰</a></li><li class=related-item><a href=/posts/go-private-git-repository/ class=related-link>go module ä½¿ç”¨ gitlab ç§æœ‰ä»“åº“</a></li><li class=related-item><a href=/posts/how-i-structure-services-in-go/ class=related-link>å¦‚ä½•åœ¨ Go ä¸­ç»„ç»‡é¡¹ç›®ç»“æ„</a></li><li class=related-item><a href=/posts/golang-escape-analysis/ class=related-link>Golang é€ƒé€¸åˆ†æ</a></li></ul></div><div class=post-tags><a href=/tags/golang/ rel=tag class=post-tags-link><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon tag-icon"><path d="M0 252.118V48C0 21.49 21.49.0 48 0h204.118a48 48 0 0133.941 14.059l211.882 211.882c18.745 18.745 18.745 49.137.0 67.882L293.823 497.941c-18.745 18.745-49.137 18.745-67.882.0L14.059 286.059A48 48 0 010 252.118zM112 64c-26.51.0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"/></svg>Golang</a></div><ul class=post-nav><li class=post-nav-prev><a href=/posts/simple-and-powerful-reverse-proxy-in-golang/ rel=prev>&lt; Go ç®€å•è€Œå¼ºå¤§çš„åå‘ä»£ç†ï¼ˆReverse Proxyï¼‰</a></li><li class=post-nav-next><a href=/posts/go-private-git-repository/ rel=next>go module ä½¿ç”¨ gitlab ç§æœ‰ä»“åº“ ></a></li></ul><div id=gitalk-container></div></div></main><div id=back-to-top class=back-to-top><a href=#><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" class="icon arrow-up"><path d="M34.9 289.5l-22.2-22.2c-9.4-9.4-9.4-24.6.0-33.9L207 39c9.4-9.4 24.6-9.4 33.9.0l194.3 194.3c9.4 9.4 9.4 24.6.0 33.9L413 289.4c-9.5 9.5-25 9.3-34.3-.4L264 168.6V456c0 13.3-10.7 24-24 24h-32c-13.3.0-24-10.7-24-24V168.6L69.2 289.1c-9.3 9.8-24.8 10-34.3.4z"/></svg></a></div><footer id=footer class=footer><div class=footer-inner><div class=site-info>Â©&nbsp;2015â€“2022&nbsp;<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon footer-icon"><path d="M462.3 62.6C407.5 15.9 326 24.3 275.7 76.2L256 96.5l-19.7-20.3C186.1 24.3 104.5 15.9 49.7 62.6c-62.8 53.6-66.1 149.8-9.9 207.9l193.5 199.8c12.5 12.9 32.8 12.9 45.3.0l193.5-199.8c56.3-58.1 53-154.3-9.8-207.9z"/></svg>&nbsp;h1z3y3</div><div class=site-copyright><a href=https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en target=_blank rel=noopener>CC BY-NC-SA 4.0</a></div><ul class=socials><li class=socials-item><a href=/rss.xml target=_blank rel="external noopener" title=RSS><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M19.199 24C19.199 13.467 10.533 4.8.0 4.8V0c13.165.0 24 10.835 24 24h-4.801zM3.291 17.415c1.814.0 3.293 1.479 3.293 3.295.0 1.813-1.485 3.29-3.301 3.29C1.47 24 0 22.526.0 20.71s1.475-3.294 3.291-3.295zM15.909 24h-4.665c0-6.169-5.075-11.245-11.244-11.245V8.09c8.727.0 15.909 7.184 15.909 15.91z"/></svg></a></li><li class=socials-item><a href=mailto:gmazhaoyang@gmail.com target=_blank rel="external noopener" title=Email><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" class="icon social-icon"><path d="M464 64H48C21.49 64 0 85.49.0 112v288c0 26.51 21.49 48 48 48h416c26.51.0 48-21.49 48-48V112c0-26.51-21.49-48-48-48zm0 48v40.805c-22.422 18.259-58.168 46.651-134.587 106.49-16.841 13.247-50.201 45.072-73.413 44.701-23.208.375-56.579-31.459-73.413-44.701C106.18 199.465 70.425 171.067 48 152.805V112h416zM48 4e2V214.398c22.914 18.251 55.409 43.862 104.938 82.646 21.857 17.205 60.134 55.186 103.062 54.955 42.717.231 80.509-37.199 103.053-54.947 49.528-38.783 82.032-64.401 104.947-82.653V4e2H48z"/></svg></a></li><li class=socials-item><a href=https://github.com/h1z3y3 target=_blank rel="external noopener" title=GitHub><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" class="icon social-icon"><path d="M12 .297c-6.63.0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577.0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93.0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176.0.0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22.0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22.0 1.606-.015 2.896-.015 3.286.0.315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a></li><li class=socials-item><a href=https://t.me/h1z3y3 target=_blank rel="external noopener" title=Telegram><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" class="icon social-icon"><path d="M248 8C111 8 0 119 0 256s111 248 248 248 248-111 248-248S385 8 248 8zm121.8 169.9-40.7 191.8c-3 13.6-11.1 16.9-22.4 10.5l-62-45.7-29.9 28.8c-3.3 3.3-6.1 6.1-12.5 6.1l4.4-63.1 114.9-103.8c5-4.4-1.1-6.9-7.7-2.5l-142 89.4-61.2-19.1c-13.3-4.2-13.6-13.3 2.8-19.7l239.1-92.2c11.1-4 20.8 2.7 17.2 19.5z"/></svg></a></li></ul></div></footer></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script>function loadComments(){if(typeof Gitalk=="undefined"){var e=t=>{var e=document.createElement("script");e.defer=!0,e.crossOrigin="anonymous",Object.keys(t).forEach(n=>{e[n]=t[n]}),document.body.appendChild(e)};e({src:"https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js",onload:()=>{newGitalk()}})}else newGitalk()}function newGitalk(){const e=new Gitalk({clientID:"03b4d6fcd0cfa3a62b6f",clientSecret:"f820e2998298a8bd9ea1b57fbdf623f4084b0c27",repo:"h1z3y3.github.io",owner:"h1z3y3",admin:["h1z3y3"],labels:["Gitalk"],distractionFreeMode:!1,perPage:10,language:"zh",pagerDirection:"last",createIssueManually:!1,proxy:"https://cors-anywhere.azm.workers.dev/https://github.com/login/oauth/access_token",enableHotKey:!0,id:location.pathname});e.render("gitalk-container")}</script><script src=https://cdn.jsdelivr.net/npm/medium-zoom@latest/dist/medium-zoom.min.js></script>
<script>mediumZoom(document.querySelectorAll("div.post-body img"),{background:"hsla(var(--color-bg-h), var(--color-bg-s), var(--color-bg-l), 0.95)"})</script><script src=https://cdn.jsdelivr.net/npm/instant.page@5.1.0/instantpage.min.js type=module defer></script>
<script>(function(e,n,s,o){if(typeof e.webpushr!="undefined")return;e.webpushr=e.webpushr||function(){(e.webpushr.q=e.webpushr.q||[]).push(arguments)};var i=n.getElementsByTagName(s)[0],t=n.createElement(s);t.id=o,t.async=1,t.src="https://cdn.webpushr.com/app.min.js",i.parentNode.appendChild(t)})(window,document,"script","webpushr-jssdk"),webpushr("setup",{key:"BMoSyd2Tn_2udNKZCybnWUZ1I6sWq6b2Q0y_0PQL_7FZ-9gBBHGqwq7gNKImXqMwd3TlBx3e1EAGXyukXt_e1tk"})</script></body></html>