<?xml version="1.0" encoding="utf-8"?><rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>ä¸œéš…å·²é€/æ¡‘æ¦†éæ™š</title><link>https://h1z3y3.me/</link><description>MemE is a powerful and highly customizable GoHugo theme for personal blogs.</description><generator>Hugo 0.83.1 https://gohugo.io/</generator><language>en</language><managingEditor>gmzhaoyang@gmail.com (h1z3y3)</managingEditor><webMaster>gmzhaoyang@gmail.com (h1z3y3)</webMaster><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><lastBuildDate>Wed, 26 May 2021 02:21:00 +0000</lastBuildDate><atom:link rel="self" type="application/rss+xml" href="https://h1z3y3.me/rss.xml"/><item><title>Golang unescape values in html templates</title><link>https://h1z3y3.me/posts/go-html-template-script-unescape/</link><guid isPermaLink="true">https://h1z3y3.me/posts/go-html-template-script-unescape/</guid><pubDate>Tue, 25 May 2021 21:56:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>While using values in a html template, my colleague faced a problem that the values in &lt;code>&amp;lt;script&amp;gt;&lt;/code> tags were all escaped.
So the template developer can not use the values in javascript. It just looks like this:&lt;/p>
&lt;pre>&lt;code>// ...
&amp;lt;script type=&amp;quot;text/json&amp;quot; id=&amp;quot;channel&amp;quot; ch=&amp;quot;recommend&amp;quot; tk=&amp;quot;&amp;quot;&amp;gt;
[&amp;amp;#34;news&amp;amp;#34;,&amp;amp;#34;comedy&amp;amp;#34;,&amp;amp;#34;cartoon&amp;amp;#34;,&amp;amp;#34;tech&amp;amp;#34;,&amp;amp;#34;travelling&amp;amp;#34;,&amp;amp;#34;fashion&amp;amp;#34;,&amp;amp;#34;photograph&amp;amp;#34;,&amp;amp;#34;household&amp;amp;#34;,&amp;amp;#34;movies&amp;amp;#34;,&amp;amp;#34;foods&amp;amp;#34;,&amp;amp;#34;military&amp;amp;#34;,&amp;amp;#34;health&amp;amp;#34;,&amp;amp;#34;test&amp;amp;#34;]
&amp;lt;/script&amp;gt;
// ...
&lt;/code>&lt;/pre>&lt;p>I tried to find out the reason. So I copied the template values in other HTML tags, like &lt;code>&amp;lt;div&amp;gt;&lt;/code>, rather than in &lt;code>&amp;lt;script&amp;gt;&lt;/code>.
It rendered correctly, and was not escaped:&lt;/p>
&lt;pre>&lt;code>// ...
&amp;lt;div&amp;gt;
[&amp;quot;news&amp;quot;,&amp;quot;comedy&amp;quot;,&amp;quot;cartoon&amp;quot;,&amp;quot;tech&amp;quot;,&amp;quot;travelling&amp;quot;,&amp;quot;fashion&amp;quot;,&amp;quot;photograph&amp;quot;,&amp;quot;household&amp;quot;,&amp;quot;movies&amp;quot;,&amp;quot;foods&amp;quot;,&amp;quot;military&amp;quot;,&amp;quot;health&amp;quot;,&amp;quot;test&amp;quot;]
&amp;lt;div&amp;gt;
// ...
&lt;/code>&lt;/pre>&lt;p>I start google the reason. At first, I thought it was because the values given template is wrong,
it had already been escaped before the page rendering.
I found some reasons in google, they said using &lt;code>json.NewEncoder()&lt;/code> instead of using &lt;code>json.Marshal()&lt;/code>.
So it can &lt;code>SetEscapeHTML(false)&lt;/code> before encode the data. This is the example code:&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-go" data-lang="go">&lt;span class="kd">func&lt;/span> &lt;span class="nf">toRawJson&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">v&lt;/span> &lt;span class="kd">interface&lt;/span>&lt;span class="p">{})&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">buf&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">new&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Buffer&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">enc&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">json&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewEncoder&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buf&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">enc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SetEscapeHTML&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kc">false&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">enc&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Encode&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">v&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TrimSuffix&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">buf&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">String&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="s">&amp;#34;\n&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>I tried it, but didn&amp;rsquo;t work either.&lt;/p>
&lt;p>Now, let&amp;rsquo;s think about for a moment. Only &lt;code>&amp;lt;script&amp;gt;&lt;/code> has the problem, but other html tags did not.
So if I could say the value is actually correct, but the template rendered in wrong ?&lt;/p>
&lt;p>I started google the problems about template render but not the wrong value.&lt;/p>
&lt;p>Then I found the &lt;code>html/template&lt;/code> official document:&lt;/p>
&lt;p>Let&amp;rsquo;s see its introduction: &lt;code>html/template&lt;/code> &lt;a href="https://golang.org/pkg/html/template/#hdr-Introduction">introduction&lt;/a>:&lt;/p>
&lt;blockquote>
&lt;p>This package wraps package text/template so you can share its template API
to parse and execute HTML templates safely.&lt;/p>
&lt;pre>&lt;code>tmpl, err := template.New(&amp;quot;name&amp;quot;).Parse(...)
// Error checking elided
err = tmpl.Execute(out, data)
&lt;/code>&lt;/pre>&lt;p>If successful, tmpl will now be injection-safe. Otherwise,
err is an error defined in the docs for ErrorCode.&lt;/p>
&lt;p>HTML templates treat data values as plain text which should be encoded so they
can be safely embedded in an HTML document.
The escaping is contextual, so actions can appear within JavaScript, CSS, and URI contexts.
The security model used by this package assumes that template authors are trusted,
while Execute&amp;rsquo;s data parameter is not. More details are provided below.&lt;/p>
&lt;p>Example&lt;/p>
&lt;pre>&lt;code>import &amp;quot;text/template&amp;quot;
...
t, err := template.New(&amp;quot;foo&amp;quot;).Parse(`{{define &amp;quot;T&amp;quot;}}Hello, {{.}}!{{end}}`)
err = t.ExecuteTemplate(out, &amp;quot;T&amp;quot;, &amp;quot;&amp;lt;script&amp;gt;alert('you have been pwned')&amp;lt;/script&amp;gt;&amp;quot;)
&lt;/code>&lt;/pre>&lt;p>produces&lt;/p>
&lt;pre>&lt;code>Hello, &amp;lt;script&amp;gt;alert('you have been pwned')&amp;lt;/script&amp;gt;!
&lt;/code>&lt;/pre>&lt;p>but the contextual autoescaping in html/template&lt;/p>
&lt;pre>&lt;code>import &amp;quot;html/template&amp;quot;
...
t, err := template.New(&amp;quot;foo&amp;quot;).Parse(`{{define &amp;quot;T&amp;quot;}}Hello, {{.}}!{{end}}`)
err = t.ExecuteTemplate(out, &amp;quot;T&amp;quot;, &amp;quot;&amp;lt;script&amp;gt;alert('you have been pwned')&amp;lt;/script&amp;gt;&amp;quot;)
&lt;/code>&lt;/pre>&lt;p>produces safe, escaped HTML output&lt;/p>
&lt;pre>&lt;code>Hello, &amp;amp;lt;script&amp;amp;gt;alert(&amp;amp;#39;you have been pwned&amp;amp;#39;)&amp;amp;lt;/script&amp;amp;gt;!
&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>ğŸ¥³ğŸ¥³ğŸ¥³ Now we find out the reason, but how we solve this problem?&lt;/p>
&lt;p>Maybe I could provide a function to unescape the value in templates.&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-go" data-lang="go"> &lt;span class="nx">r&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Default&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">funcMap&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="s">&amp;#34;unescapeHTML&amp;#34;&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">HTML&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">template&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">HTML&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">r&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">SetFuncMap&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">funcMap&lt;/span>&lt;span class="p">)&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Then you can use it in templates as below:&lt;/p>
&lt;pre>&lt;code>// ...
&amp;lt;script type=&amp;quot;text/json&amp;quot; id=&amp;quot;channel&amp;quot; ch=&amp;quot;recommend&amp;quot; tk=&amp;quot;&amp;quot;&amp;gt;
{{ .channel_data | unescapeHTML }}
&amp;lt;/script&amp;gt;
// ...
&lt;/code>&lt;/pre>&lt;p>Finally, it works.
When the template is loaded, the value won&amp;rsquo;t be escaped!&lt;/p>
&lt;pre>&lt;code>// ...
&amp;lt;script type=&amp;quot;text/json&amp;quot; id=&amp;quot;channel&amp;quot; ch=&amp;quot;recommend&amp;quot; tk=&amp;quot;&amp;quot;&amp;gt;
[&amp;quot;news&amp;quot;,&amp;quot;comedy&amp;quot;,&amp;quot;cartoon&amp;quot;,&amp;quot;tech&amp;quot;,&amp;quot;travelling&amp;quot;,&amp;quot;fashion&amp;quot;,&amp;quot;photograph&amp;quot;,&amp;quot;household&amp;quot;,&amp;quot;movies&amp;quot;,&amp;quot;foods&amp;quot;,&amp;quot;military&amp;quot;,&amp;quot;health&amp;quot;,&amp;quot;test&amp;quot;]
&amp;lt;/script&amp;gt;
// ...
&lt;/code>&lt;/pre>&lt;p>&lt;strong>Hope this helps you!! Thanks for reading :)&lt;/strong>&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>go module ä½¿ç”¨ gitlab ç§æœ‰ä»“åº“</title><link>https://h1z3y3.me/posts/go-private-git-repository/</link><guid isPermaLink="true">https://h1z3y3.me/posts/go-private-git-repository/</guid><pubDate>Thu, 20 May 2021 12:33:52 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="go-module-ä½¿ç”¨-gitlab-ç§æœ‰ä»“åº“">Go Module ä½¿ç”¨ gitlab ç§æœ‰ä»“åº“&lt;/h1>
&lt;p>åŒ…ç®¡ç†æ˜¯ Go ä¸€ç›´è¢«è¯Ÿç—…åšçš„ä¸å¥½çš„åŠŸèƒ½ã€‚åœ¨ 1.11 ä¹‹å‰ï¼Œgo get ç¼ºä¹å¯¹ä¾èµ–åŒ…ç‰ˆæœ¬ç®¡ç†å’Œ reproducible build çš„æ”¯æŒã€‚
å½“æ—¶åœ¨ Go ç¤¾åŒºå½“æ—¶è¯ç”Ÿäº†è®¸å¤šå¥½ç”¨çš„å·¥å…·ï¼Œæ¯”å¦‚ glideï¼Œdep ç­‰ã€‚
åœ¨ 1.11 ç‰ˆæœ¬ä¹‹åï¼Œ Go å¼•å…¥äº† Go Moduleï¼Œå†ä¹Ÿæ²¡æœ‰ GOPATH çš„é™åˆ¶ï¼Œä½ å¯ä»¥éšæ„åœ¨ä»»ä½•è·¯å¾„å†™é¡¹ç›®ï¼Œä½†æ˜¯æ­¤æ—¶å¯¹ç§æœ‰ä»“åº“çš„æ”¯æŒè¿˜ä¸æ˜¯å¾ˆå¥½ã€‚
è€Œåœ¨ 1.13 ç‰ˆæœ¬ä¹‹åï¼Œ Go å¯¹ Go Module åˆè¿›è¡Œäº†ä¼˜åŒ–ï¼Œæ”¯æŒäº† &lt;code>GOPRIVATE&lt;/code> ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥æŒ‡å®šç§æœ‰ä»“åº“çš„åœ°å€ï¼Œä½¿ç”¨ååˆ†ä¾¿æ·ã€‚
å¤§å®¶åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ–å¤šæˆ–å°‘åœ°ä¼šé‡åˆ°ä¸€äº›é—®é¢˜ï¼Œä¸‹é¢æˆ‘é’ˆå¯¹è‡ªå·±é‡åˆ°çš„é—®é¢˜è¿›è¡Œæ€»ç»“ã€‚&lt;/p>
&lt;h2 id="go-get">go get&lt;/h2>
&lt;p>å¦‚æœåœ¨æ²¡æœ‰è¿›è¡Œä»»ä½•è®¾ç½®çš„æƒ…å†µä¸‹ç›´æ¥æ‰§è¡Œ &lt;code>go get your.gitlab.com/pkg/example&lt;/code>ï¼Œä½ å¾ˆå¯èƒ½ä¼šé‡åˆ°ä»¥ä¸‹é”™è¯¯ï¼š&lt;/p>
&lt;pre>&lt;code>go get: module your.gitlab.com/pkg/example: git ls-remote -q origin in /go/pkg/mod/cache/vcs/a39fc2dbfb0a9645950d24df5d7e922bb7a6a877aecfe2b20f74b96385a83109: exit status 128:
fatal: could not read Username for 'https://your.gitlab.com': terminal prompts disabled
Confirm the import path was entered correctly.
If this is a private repository, see https://golang.org/doc/faq#git_https for additional information.
&lt;/code>&lt;/pre>&lt;p>å…¶å®é”™è¯¯æç¤ºå·²ç»æŠŠè§£å†³æ–¹æ¡ˆç»™åˆ°æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ç‚¹å‡» &lt;a href="https://golang.org/doc/faq#git_https">https://golang.org/doc/faq#git_https&lt;/a> æŸ¥çœ‹å³å¯ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯åŸæ–‡ï¼š&lt;/p>
&lt;blockquote>
&lt;h4 id="why-does-go-get-use-https-when-cloning-a-repository">Why does &amp;ldquo;go get&amp;rdquo; use HTTPS when cloning a repository?&lt;/h4>
&lt;p>Companies often permit outgoing traffic only on the standard TCP ports 80 (HTTP) and 443 (HTTPS), blocking outgoing traffic on other ports, including TCP port 9418 (git) and TCP port 22 (SSH).
When using HTTPS instead of HTTP, git enforces certificate validation by default, providing protection against man-in-the-middle, eavesdropping and tampering attacks.
The go get command therefore uses HTTPS for safety.&lt;/p>
&lt;p>Git can be configured to authenticate over HTTPS or to use SSH in place of HTTPS. To authenticate over HTTPS, you can add a line to the $HOME/.netrc file that git consults:&lt;/p>
&lt;pre>&lt;code>machine github.com login USERNAME password APIKEY
&lt;/code>&lt;/pre>&lt;p>For GitHub accounts, the password can be a &lt;a href="https://help.github.com/articles/creating-a-personal-access-token-for-the-command-line/">personal access token&lt;/a>.
Git can also be configured to use SSH in place of HTTPS for URLs matching a given prefix. For example, to use SSH for all GitHub access, add these lines to your ~/.gitconfig:&lt;/p>
&lt;pre>&lt;code>[url &amp;quot;ssh://git@github.com/&amp;quot;]
insteadOf = https://github.com/
&lt;/code>&lt;/pre>&lt;/blockquote>
&lt;p>å¤§æ¦‚æ„æ€æ˜¯ï¼ŒHTTPS æ›´å®‰å…¨ï¼Œæ‰€ä»¥ &lt;code>go get&lt;/code> å‘½ä»¤ä½¿ç”¨ HTTPSã€‚&lt;/p>
&lt;p>å¦‚æœä½ è¦ç”¨ HTTPSï¼Œé‚£ä½ å°±éœ€è¦é…ç½® HTTPS çš„ç”¨æˆ·åå’Œå¯†ç ï¼š&lt;/p>
&lt;pre>&lt;code>machine github.com login USERNAME password APIKEY
&lt;/code>&lt;/pre>&lt;p>å½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨ sshï¼Œéœ€è¦ä¿®æ”¹ä½ çš„ git é…ç½®ï¼Œ&lt;/p>
&lt;p>ä¿®æ”¹å½“å‰ç”¨æˆ·çš„ &lt;code>~/.gitconfig&lt;/code>ï¼Œæ·»åŠ ï¼š&lt;/p>
&lt;pre>&lt;code>[url &amp;quot;ssh://git@your.gitlab.com/&amp;quot;]
insteadOf = https://your.gitlab.com/
&lt;/code>&lt;/pre>&lt;p>å¦å¤–æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ä¹Ÿèƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">git config --global url.&lt;span class="s2">&amp;#34;git@your.gitlab.com/&amp;#34;&lt;/span>.insteadof &lt;span class="s2">&amp;#34;https://your.gitlab.com/&amp;#34;&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ“ä½œå®Œä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ &lt;code>go get&lt;/code> äº†ï¼Œä½¿ç”¨ &lt;code>go get -v&lt;/code> å¯ä»¥å±•ç¤ºæ‰§è¡Œæ—¥å¿—ã€‚&lt;/p>
&lt;h2 id="gonoproxy">GONOPROXY&lt;/h2>
&lt;p>ä¼—æ‰€å‘¨çŸ¥ï¼Œå›½å†…ç”¨æˆ·å¤§å¤šè®¾ç½®ä»£ç†ï¼Œæˆ‘ä»¬åœ¨ Go 1.12 ä¹‹å‰å¦‚æœä½¿ç”¨ &lt;code>GOPROXY&lt;/code> è¿™ä¸ªç¯å¢ƒå˜é‡è®¾ç½®ä»£ç†ï¼Œå¹¶ä½¿ç”¨ç§æœ‰ä»“åº“ï¼Œå¾ˆæœ‰å¯èƒ½ä¼šé‡åˆ°ä¸‹é¢çš„é”™è¯¯ï¼š&lt;/p>
&lt;pre>&lt;code>go get your.gitlab.com/pkg/example: module your.gitlab.com/pkg/example:
reading https://goproxy.cn/your.gitlab.com/pkg/example/@v/list: 404 Not Found
&lt;/code>&lt;/pre>&lt;p>è¿™æ˜¯å› ä¸ºä»£ç†æœåŠ¡ä¸å¯èƒ½è®¿é—®åˆ°æˆ‘ä»¬çš„ç§æœ‰ä»£ç ä»“åº“ï¼Œæ‰€ä»¥æŠ¥é”™ 404ã€‚è€Œä¸”ï¼Œå°±ç®—ä½¿ç”¨ä¸Šæ–‡æåˆ°çš„ &lt;code>ssh&lt;/code> é‰´æƒä¹Ÿä¸è¡Œã€‚&lt;/p>
&lt;p>&lt;strong>Go 1.13 åå¯ä»¥è®¾ç½® &lt;code>GONOPROXY&lt;/code> è¿™ä¸ªç¯å¢ƒå˜é‡æ¥æŒ‡å®šä¸ä½¿ç”¨ä»£ç†çš„åŸŸåï¼Œæ”¯æŒé€—å·åˆ†éš”å¤šä¸ªå€¼ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="gonosumdb">GONOSUMDB&lt;/h2>
&lt;p>go mod éœ€è¦å¯¹ä¸‹è½½åçš„ä¾èµ–åŒ…è¿›è¡Œ checksum æ ¡éªŒï¼Œå½“ä½ çš„ git ä»“åº“æ˜¯å¼€æ”¾çš„è¯æ²¡é—®é¢˜ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¸å¯è®¿é—®çš„ç§æœ‰ä»“åº“ï¼Œç”šè‡³åœ¨å…¬å¸å†…ç½‘ã€‚
å¾ˆå¯èƒ½å‡ºç°æ ¡éªŒå¤±è´¥çš„é”™è¯¯ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">get &lt;span class="s2">&amp;#34;your.gitlab.com/pkg/example&amp;#34;&lt;/span>: found meta tag get.metaImport&lt;span class="o">{&lt;/span>Prefix:&lt;span class="s2">&amp;#34;your.gitlab.com/pkg/example&amp;#34;&lt;/span>, VCS:&lt;span class="s2">&amp;#34;git&amp;#34;&lt;/span>, RepoRoot:&lt;span class="s2">&amp;#34;https://your.gitlab.com/pkg/example.git&amp;#34;&lt;/span>&lt;span class="o">}&lt;/span> at //your.gitlab.com/pkg/example?go-get&lt;span class="o">=&lt;/span>&lt;span class="m">1&lt;/span>
verifying your.gitlab.com/pkg/example@v0.0.0: your.gitlab.com/pkg/example@v0.0.0: reading https://sum.golang.org/lookup/your.gitlab.com/pkg/example@v0.0.0: &lt;span class="m">410&lt;/span> Gone
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å’Œä»£ç†ä¸€æ ·ï¼Œæˆ‘ä»¬çš„ç§æœ‰ä»“åº“å¯¹ sum.golang.org æ˜¯ä¸å¯è§çš„ï¼Œæ‰€ä»¥è‚¯å®šæ²¡åŠæ³•æ‰§è¡Œå®‰å…¨æ ¡éªŒã€‚&lt;/p>
&lt;p>&lt;strong>åŒæ ·çš„åœ¨ Go 1.13 åå¯ä»¥è®¾ç½® &lt;code>GONOSUMDB&lt;/code> ç¯å¢ƒå˜é‡æŒ‡å®šè·³è¿‡æ ¡éªŒçš„çš„åŸŸåï¼Œæ”¯æŒé€—å·åˆ†å‰²å¤šä¸ªå€¼ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="goprivate">GOPRIVATE&lt;/h2>
&lt;p>æœ€å Go 1.13 è¿˜å¼•å…¥çš„ &lt;code>GOPRIVATE&lt;/code> ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥è¯´è®¾ç½®åä¸€åŠ³æ°¸é€¸ï¼Œèƒ½è‡ªåŠ¨è·³è¿‡ proxy server å’Œ æ ¡éªŒæ£€æŸ¥ï¼Œ
è¿™ä¸ªå˜é‡å€¼ä¹Ÿæ”¯æŒé€—å·åˆ†å‰²ï¼Œå¯ä»¥å¡«å†™å¤šä¸ªå€¼ï¼Œå¦‚ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="nv">GOPRIVATE&lt;/span>&lt;span class="o">=&lt;/span>*.corp.example.com,your.gitlab.com
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å½“ç„¶ï¼Œè®¾ç½® &lt;code>GOPRIVATE&lt;/code> ä¹‹åï¼Œè¿˜å¯ä»¥åœ¨é€šè¿‡ &lt;code>GONOPROXY&lt;/code> å’Œ &lt;code>GONOSUMDB&lt;/code> æ¥å•ç‹¬è¿›è¡Œæ§åˆ¶ï¼Œ&lt;/p>
&lt;p>ä¸è¿‡éœ€è¦æ³¨æ„ä¸‹ &lt;code>GOPRIVATE&lt;/code> å¤±æ•ˆçš„é—®é¢˜ï¼Œ&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœå…¬å¸å†…éƒ¨æœ‰ç§æœ‰ä»“åº“ï¼š&lt;code>your.corp.com&lt;/code>ï¼Œå¦‚æœè¿™æ ·è®¾ç½®ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="nv">GOPRIVATE&lt;/span>&lt;span class="o">=&lt;/span>your.corp.com
&lt;span class="nv">GOPROXY&lt;/span>&lt;span class="o">=&lt;/span>https://goproxy.cn
&lt;span class="nv">GONOPROXY&lt;/span>&lt;span class="o">=&lt;/span>none
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å› ä¸º &lt;code>GONOPROXY&lt;/code> çš„å€¼æ˜¯ &lt;code>none&lt;/code>ï¼Œé‚£ä¹ˆç”¨æˆ·è¿˜æ˜¯ä¼šä» &lt;code>GOPROXY&lt;/code> çš„åœ°å€ä¸‹è½½æ‰€æœ‰ç§æœ‰å’Œå…±æœ‰çš„ä»“åº“ï¼Œ
æ­¤æ—¶å¯èƒ½è¿˜æ˜¯ä¼šæŠ¥é”™ï¼Œ&lt;code>GONOSUMDB&lt;/code> åŒç†ï¼Œå¤§å®¶æ³¨æ„ä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>å¦‚ä½•åœ¨ Go ä¸­ç»„ç»‡é¡¹ç›®ç»“æ„</title><link>https://h1z3y3.me/posts/how-i-structure-services-in-go/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-i-structure-services-in-go/</guid><pubDate>Wed, 12 May 2021 08:04:11 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è¯‘è€…æ³¨ï¼šåœ¨ç¿»è¯‘è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œæˆ‘è‡ªå·±å…¶å®å¯¹ Bob å¤§å”çš„ Clean Architecture ä¹Ÿåšè¿‡ä¸€äº›ç ”ç©¶ï¼Œåœ¨é¡¹ç›®ä¸­å®è·µä¹‹åï¼Œ
ä¹Ÿç¡®ç¡®å®å®ä½“éªŒåˆ°äº†åˆ†å±‚çš„é­…åŠ›ã€‚åœ¨å±‚ä¸å±‚ä¹‹é—´å°†ä¾èµ–è¿›è¡Œéš”ç¦»ï¼Œå„ä¸ªå±‚åªå…³æ³¨è‡ªå·±æœ¬èº«çš„é€»è¾‘ï¼Œ
æ‰€ä»¥èƒ½è®©å¼€å‘è€…åªå…³æ³¨æœ¬å±‚çš„ä¸šåŠ¡é€»è¾‘ï¼Œ ä¹Ÿæ›´å®¹æ˜“è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œæ— å½¢ä¸­å°±æé«˜äº†ä½ ä»£ç çš„è´¨é‡å’Œå¯é˜…è¯»æ€§ã€‚
æˆ‘è§‰å¾—å¦‚æœä½ å¯¹è‡ªå·±çš„ä»£ç æœ‰è¿½æ±‚ï¼Œå°±ä¸€å®šè¦å»å­¦ä¹ ä¸€ä¸‹ Clean Architectureã€‚
å½“ç„¶å¦ä¸€æ–¹é¢ï¼ŒClean Architecture ä¹Ÿä¸æ˜¯é“¶å¼¹ï¼Œåœ¨å¤æ‚çš„é¡¹ç›®ä¸­ç¡®å®èƒ½å¸®åŠ©æˆ‘ä»¬è§£è—•ï¼Œä½†æ˜¯å¦‚æœä½ çš„é¡¹ç›®éå¸¸ç®€å•ï¼Œ
é‚£ä¼ ç»Ÿçš„ MVC å°±è¶³å¤Ÿäº†ï¼Œå°±åƒæœ¬æ–‡ä½œè€…æœ€åè¯´çš„ï¼Œåƒä¸‡ä¸è¦è®©ç®€å•çš„äº‹æƒ…å˜å¤æ‚ã€‚
å¦å¤–ï¼Œå…¶å®å¯¹äº Golang çš„é¡¹ç›®ç»„ç»‡æ–¹å¼ï¼Œgithub ä¸Šé¢ç«è®¸å¤š star éå¸¸å¤šçš„é¡¹ç›®ï¼Œå¤§å¤šå¼€ç®±å³ç”¨ï¼Œ
æ¯”å¦‚ï¼š
&lt;a href="https://github.com/xinliangnote/go-gin-api">go-gin-api&lt;/a> ï¼ˆå›½äººå¼€æºçš„ï¼‰ã€
&lt;a href="https://github.com/bxcodec/go-clean-arch">go-clean-arch&lt;/a> ï¼Œè¿™é‡Œåˆ†äº«ç»™å¤§å®¶ï¼Œä¹Ÿæ˜¯ç»™å¤§å®¶æä¾›æ›´å¤šçš„é€‰æ‹©ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ˜¯åŸæ–‡ï¼š&lt;/p>
&lt;p>ä¸€ä¸ª main.go æ–‡ä»¶ï¼Œå‡ ä¸ª HTTP handler å°±å¯ä»¥æ„å»ºä¸€ä¸ªæ–°çš„ HTTP æœåŠ¡ã€‚ç„¶è€Œï¼Œå½“ä½ å¼€å§‹æ·»åŠ æ›´å¤šçš„è·¯ç”±è§„åˆ™ï¼Œ
å¼€å§‹å°†ä¸åŒçš„åŠŸèƒ½æ‹†åˆ†åˆ°ä¸åŒçš„æ–‡ä»¶ä¸­ï¼Œå¯èƒ½ä¼šéšå¤„åˆ›å»ºå¥½å¤š packages ï¼Œä½†æ˜¯ä½ ä¸ç¡®å®šé•¿è¿œæ¥çœ‹å°†ä¼šå®ƒä»¬æ€æ ·å‘å±•ï¼Œ
åŒæ—¶ä½ ä¹Ÿå¸Œæœ›å®ƒä»¬èƒ½å¤Ÿéšç€æœåŠ¡å¢é•¿è€Œæœ‰æ„ä¹‰ã€‚&lt;/p>
&lt;p>è¿™å‡ å¹´æˆ‘ç»å†è¿‡å‡ æ¬¡è¿™æ ·çš„åœºæ™¯ï¼Œåæ¥è¯»äº†ä¸€äº›æ–‡ç« ã€åšå®¢è¿˜æœ‰ Robert Martin çš„
&lt;a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html">Clean Architecture&lt;/a> (å¹²å‡€æ¶æ„)ï¼Œ
æˆ‘æ‰¾åˆ°äº†ä¸€ç§é€‚åˆæˆ‘çš„é€šç”¨çš„ä»£ç ç»“æ„ï¼Œæ‰€ä»¥æˆ‘æƒ³æˆ‘åº”è¯¥åˆ†äº«å‡ºæ¥ã€‚éœ€è¦æ³¨æ„çš„æ˜¯å®ƒå¯èƒ½å¹¶ä¸èƒ½åˆšå¥½é€‚åˆä½ çš„åº”ç”¨åœºæ™¯ï¼Œç‰¹åˆ«æ˜¯ä¸€äº›ç‰¹åˆ«ç®€å•çš„æœåŠ¡ï¼Œ
æ¯”å¦‚è¯´ä¸€ä¸ª main.go æ–‡ä»¶ï¼Œå‡ ä¸ª packages å°±å·²ç»è¶³å¤Ÿçš„æœåŠ¡ã€‚&lt;/p>
&lt;p>è®©æˆ‘ä»¬ç›´æ¥å¼€å§‹ï¼&lt;/p>
&lt;h2 id="æ¦‚è§ˆ">æ¦‚è§ˆ&lt;/h2>
&lt;pre>&lt;code class="language-goalng" data-lang="goalng">Go-Service
- cmd/
- api/
- pkg/
- api/
- db/
- services/
- serviceA/
- serviceB/
- ...
- utils/
- docker-compose.yml
- Dockerfile
- Makefile
- go.mod
- go.sum
- &amp;lt;environment&amp;gt;.env
- README.md
- ...
&lt;/code>&lt;/pre>&lt;p>æ•´ä¸ªç»“æ„æœ‰ 3 ä¸ªé‡è¦çš„éƒ¨åˆ†ï¼šrootï¼ˆè¯‘è€…æ³¨ï¼šæ ¹ç›®å½•ï¼‰ã€cmd å’Œ pkgã€‚æˆ‘å°†é€ä¸ªè§£é‡Šå„ä¸ªæ–‡ä»¶å¤¹çš„èŒè´£ï¼Œ
ç„¶åæˆ‘ä»¬å†æ¥ä»”ç»†çœ‹çœ‹æ¯ä¸ª service (&lt;code>pkg/service/...&lt;/code>) å¦‚ä½•ç»„ç»‡ã€‚&lt;/p>
&lt;h3 id="rootæ ¹ç›®å½•">Rootï¼ˆæ ¹ç›®å½•ï¼‰&lt;/h3>
&lt;p>æˆ‘å–œæ¬¢å°†ä¸€äº›å¯åŠ¨å’Œè¿è¡Œçš„ä»£ç æ”¾åˆ°æ ¹ç›®å½•ï¼Œæ¯”å¦‚ï¼šæ„å»ºå·¥å…·ã€é…ç½®æ–‡ä»¶ã€ä¾èµ–ç®¡ç†ç­‰ç­‰ã€‚
å®ƒä¹Ÿæä¾›ç»™é˜…è¯»ä»£ç çš„äººæˆ–å¼€å‘ä»£ç çš„äººä¸€ä¸ªå¾ˆå¥½çš„åˆ‡å…¥ç‚¹ï¼Œä»–ä»¬å¯åŠ¨æœåŠ¡æ‰€éœ€çš„æ‰€æœ‰é…ç½®éƒ½åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚&lt;/p>
&lt;h3 id="cmd">Cmd&lt;/h3>
&lt;p>è¿™é‡Œä¼šè¢«åˆ†æˆå‡ ä¸ªç›®å½•ï¼Œæ¯ä¸ªç›®å½•éƒ½æ˜¯æˆ‘ä»¬æ•´ä¸ªæœåŠ¡ä¸€éƒ¨åˆ†ï¼Œæ¯”å¦‚ API æœåŠ¡ï¼Œå®šæ—¶è„šæœ¬ä»»åŠ¡ç­‰ç­‰ã€‚
å®é™…ä¸Šè¿™é‡Œä¼šæœ‰å„å­æœåŠ¡çš„ main packageï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œåˆå§‹åŒ–é…ç½®å’Œæˆ‘ä»¬éœ€è¦çš„ä¾èµ–åŒ…ï¼Œæœ€åå­æœåŠ¡ä¼šè¢«ç¼–è¯‘æˆå¯¹åº”çš„äºŒè¿›åˆ¶æ¥æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;h3 id="pkg">Pkg&lt;/h3>
&lt;p>è¿™é‡ŒåŒ…å«äº†æˆ‘ä»¬é¡¹ç›®çš„ä¸»è¦éƒ¨åˆ†ï¼šå®šä¹‰æˆ‘ä»¬æœåŠ¡ä¸šåŠ¡é€»è¾‘çš„ä¸€äº› packageã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>api/&lt;/p>
&lt;p>åœ¨è¿™é‡Œï¼Œæˆ‘å®šä¹‰äº†å¦‚ä½•é€šè¿‡åˆå§‹åŒ–æ•°æ®åº“ï¼ŒæœåŠ¡ï¼ŒHTTPè·¯ç”±å™¨+ä¸­é—´ä»¶æ¥è¿æ¥APIï¼Œå¹¶å®šä¹‰äº†è¿è¡ŒAPIæ‰€éœ€çš„é…ç½®ã€‚
æˆ‘ä¸€èˆ¬ä¼šåŠ ä¸€ä¸ª &lt;code>Start(cfg *Config)&lt;/code> å‡½æ•°ï¼Œæä¾›ç»™ &lt;code>cmd/api/main.go&lt;/code> è°ƒç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>db/&lt;/p>
&lt;p>é¡¾åæ€ä¹‰ï¼Œè¿™é‡Œæ˜¯è¿æ¥ã€è¿ç§»æ•°æ®åº“é€»è¾‘ï¼Œæˆ‘ä¹Ÿå€¾å‘äºå°†ä»»ä½•å…³äºè¿ç§»çš„æ–‡ä»¶å¤¹æˆ–æ–‡ä»¶éƒ½æ”¾åœ¨è¿™é‡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>utils/&lt;/p>
&lt;p>æˆ‘ä¼šå°†ä»»ä½•å¯¹è¯·æ±‚ã€æ—¥å¿—ã€è‡ªå®šä¹‰ä¸­é—´ä»¶ç­‰æä¾›è¾…åŠ©åŠŸèƒ½çš„ pakcage æ”¾åœ¨è¿™é‡Œã€‚æˆ‘è™½ç„¶ä¸å¤ªå–œæ¬¢è¿™ä¸ªåå­—ï¼Œä½†æ˜¯æˆ‘ä¹Ÿæ²¡æ‰¾åˆ°æ›´é€‚åˆå®ƒçš„åå­—äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>services/&lt;/p>
&lt;p>è¿™ä¸ªéœ€è¦è¯¦ç»†è§£é‡Šä¸€ä¸‹ï¼Œå› ä¸ºæˆ‘ç”¨ç‰¹å®šçš„æ–¹å¼å»ç»„ç»‡æ‰€æœ‰çš„ serviceã€‚é€šå¸¸æ¥è¯´ï¼Œæ¯ä¸ª package
éƒ½å®šä¹‰äº†å„è‡ªæœåŠ¡çš„åŠŸèƒ½ï¼ˆåŸºäºåŠŸèƒ½è€Œä¸æ˜¯å‡½æ•°è¿›è¡Œç»„ç»‡ç»“æ„ï¼‰ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="services">Services&lt;/h2>
&lt;p>è®©æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹çœ‹ä»–ä»¬æ˜¯å¦‚ä½•ç»„ç»‡çš„ã€‚æˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªæœåŠ¡ï¼Œå¯ä»¥è®©æˆ‘ä»¬ä¿å­˜å¹¶åˆ›å»ºæ–‡ç« ï¼Œä»–çœ‹èµ·æ¥æ˜¯ä¸‹é¢è¿™æ ·ï¼š&lt;/p>
&lt;pre>&lt;code>...
- Services/
- Article/
- store/
- repo.go
- transport/
- http.go
- article.go
- errors.go
- models.go
&lt;/code>&lt;/pre>&lt;p>æˆ‘ä»¬å°†æ•°æ®çš„å­˜å‚¨å’Œä¼ è¾“é€»è¾‘åˆ†åˆ°äº†ä¸åŒçš„ packageï¼Œè¿™å¸®åŠ©æˆ‘ä»¬ä¸“æ³¨äºæˆ‘ä»¬çš„ä¸šåŠ¡é€»è¾‘è€Œä¸éœ€è¦å…³å¿ƒæˆ‘ä»¬åº”è¯¥å¦‚ä½•ä¿å­˜æ•°æ®æˆ–è€…å…¶å¦‚ä½•ä¼ é€’ç»™è°ƒç”¨æ–¹ã€‚
æ­¤å¤–ï¼Œå½“æˆ‘ä»¬æƒ³è¦æ”¹å˜æˆ‘ä»¬çš„åº•å±‚å­˜å‚¨æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å®šä¹‰å¥½å­˜å‚¨çš„ interfaceï¼Œå°±å¯ä»¥è½»æ¾åœ°æ›´æ¢åº•å±‚å­˜å‚¨ï¼Œ
è€Œä¸éœ€è¦ä¿®æ”¹å…¶ä½™çš„é€»è¾‘ï¼ˆ ä¸€ä¸ªç®€å•çš„
&lt;a href="https://en.wikipedia.org/wiki/Dependency_inversion_principle">ä¾èµ–åè½¬åŸåˆ™&lt;/a> çš„ä¾‹å­ ï¼‰ã€‚&lt;/p>
&lt;p>&lt;code>error.go&lt;/code> å’Œ &lt;code>models.go&lt;/code> æ¯”è¾ƒç®€å•ï¼Œå°±ä¸èµ˜è¿°äº†ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹ &lt;code>article.go&lt;/code> éƒ½æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kn">package&lt;/span> &lt;span class="nx">articles&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="c1">// Repo defines the DB level interaction of articles
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Repo&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Article&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">Create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ar&lt;/span> &lt;span class="nx">ArticleCreateUpdate&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Service defines the service level contract that other services
&lt;/span>&lt;span class="c1">// outside this package can use to interact with Article resources
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Service&lt;/span> &lt;span class="kd">interface&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Article&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nf">Create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ar&lt;/span> &lt;span class="nx">ArticleCreateUpdate&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Article&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">article&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">repo&lt;/span> &lt;span class="nx">Repo&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// New Service instance
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">repo&lt;/span> &lt;span class="nx">Repo&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nx">Service&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">article&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">repo&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Get sends the request straight to the repo
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">article&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Article&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Create passes of the created to the repo and retrieves the newly created record
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">article&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ar&lt;/span> &lt;span class="nx">ArticleCreateUpdate&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">Article&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">id&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">ar&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">Article&lt;/span>&lt;span class="p">{},&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">repo&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">id&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è°ƒç”¨ &lt;code>New()&lt;/code> åˆ›å»ºæˆ‘ä»¬ &lt;code>Article&lt;/code> æœåŠ¡å®ä¾‹çš„æ—¶å€™ï¼Œä¼ é€’äº†ä¸€ä¸ª &lt;code>Repo&lt;/code> interfaceã€‚
è¿™ä¸ªæ˜¯æˆ‘ä»¬åˆšåˆšè¯´çš„è§£è€¦çš„å¥½å¤„ï¼Œè€Œä¸”ä¹Ÿèƒ½å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°å»åšå•å…ƒæµ‹è¯•ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºä¸€ä¸ªå®ç°äº† &lt;code>Repo&lt;/code> interface çš„ mock å®ä¾‹ï¼Œç„¶åä½œä¸º &lt;code>New()&lt;/code> çš„å‚æ•°ä¼ é€’ç»™ &lt;code>Article&lt;/code>ï¼Œ
è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ç»•è¿‡æˆ‘ä»¬çš„æ•°æ®åº“å»å¯¹æˆ‘ä»¬çš„é€»è¾‘è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚&lt;/p>
&lt;h3 id="å¦‚ä½•æš´éœ²æœåŠ¡">å¦‚ä½•æš´éœ²æœåŠ¡&lt;/h3>
&lt;p>è®¾ç½®æ–¹æ³•ä¸éœ€è¦çŸ¥é“æ¯ä¸ªæœåŠ¡çš„æ¥å…¥ç‚¹ã€å¦‚ä½•åˆå§‹åŒ–å­˜å‚¨å±‚æˆ–è€…å…¶ä»–çš„ä¸€äº›äº‹é¡¹ã€‚
åªéœ€è¦å°†æ•°æ®åº“è¿æ¥å’Œè·¯ç”±å®ä¾‹ä¼ é€’ç»™ &lt;code>Activate()&lt;/code> æ–¹æ³•ï¼Œ
ç„¶å &lt;code>transport&lt;/code> package ä¸­çš„è·¯ç”±æ³¨å†Œç¨‹åºå°†å…¶è·¯ç”±è¿›è¡Œæ³¨å†Œï¼Œå°±å¯ä»¥å¯¹å¤–æä¾›æœåŠ¡äº†ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kn">package&lt;/span> &lt;span class="nx">transport&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;database/sql&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;net/http&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/gin-gonic/gin&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/services/articles&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/services/articles/store&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="kd">type&lt;/span> &lt;span class="nx">handler&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">ArticleService&lt;/span> &lt;span class="nx">articles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Service&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Activate sets all the services required for articles and registers all the endpoints with the engine.
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">Activate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">router&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Engine&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">db&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">sql&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DB&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">articleService&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">articles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">store&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">db&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="nf">newHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">router&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">articleService&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="nf">newHandler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">router&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Engine&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">as&lt;/span> &lt;span class="nx">articles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Service&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">h&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">handler&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">ArticleService&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">as&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GET&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/articles/:id&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">h&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Get&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">POST&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;/articles/&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">h&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Create&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">h&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Get&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">h&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Create&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">c&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>&lt;span class="o">...&lt;/span>&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿˜è®°å¾—æˆ‘ä¹‹å‰è¯´çš„ &lt;code>Start()&lt;/code> æ–¹æ³•ï¼ˆåœ¨ &lt;code>pkg/api&lt;/code> ä¸­ï¼‰å—ï¼Ÿ
å®ƒæ˜¯æˆ‘ä»¬å¯åŠ¨æˆ‘ä»¬æœåŠ¡å’Œé…ç½®çš„å…¥å£ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kn">package&lt;/span> &lt;span class="nx">api&lt;/span>
&lt;span class="kn">import&lt;/span> &lt;span class="p">(&lt;/span>
&lt;span class="s">&amp;#34;context&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;fmt&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/gin-gonic/gin&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/db&amp;#34;&lt;/span>
&lt;span class="nx">articles&lt;/span> &lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/services/articles/transport&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/utils/log&amp;#34;&lt;/span>
&lt;span class="s">&amp;#34;github.com/kott/go-service-example/pkg/utils/middleware&amp;#34;&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="c1">// Config defines what the API requires to run
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">type&lt;/span> &lt;span class="nx">Config&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">DBHost&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">DBPort&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">DBUser&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">DBPassword&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">DBName&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">AppHost&lt;/span> &lt;span class="kt">string&lt;/span>
&lt;span class="nx">AppPort&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// Start initializes the API server, adding the required middleware and dependent services
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="kd">func&lt;/span> &lt;span class="nf">Start&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">cfg&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Config&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">conn&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">db&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">GetConnection&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DBHost&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DBPort&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DBUser&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DBPassword&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">DBName&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Error&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;unable to establish a database connection: %s&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Error&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">defer&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">conn&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">conn&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}()&lt;/span>
&lt;span class="nx">router&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">gin&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">New&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Use&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="cm">/* some middleware */&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">articles&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Activate&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">router&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">conn&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">router&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Run&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Sprintf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;%s:%d&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AppHost&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">cfg&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AppPort&lt;/span>&lt;span class="p">));&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Fatal&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Background&lt;/span>&lt;span class="p">(),&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Error&lt;/span>&lt;span class="p">())&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä»¥ä¸Šå°±æ˜¯å…¨éƒ¨å†…å®¹ï¼Œå®é™…ä¸Šåªæ˜¯è¯•å›¾å»æ‰¾åˆ°ä¸€ç§æŠ½è±¡çš„æ–¹æ³•ï¼Œä»¥ä¾¿äºè®©ä½ çš„ç¨‹åºæ›´æ˜“è¯»ï¼Œè€Œä¸éœ€è¦å¢åŠ ä½ é¡¹ç›®çš„å¤æ‚åº¦ã€‚&lt;/p>
&lt;h2 id="æ€»ç»“">æ€»ç»“&lt;/h2>
&lt;p>æœ‰è®¸è®¸å¤šå¤šå¯ä»¥ç»„ç»‡é¡¹ç›®çš„æ–¹å¼ï¼Œè¿™ä¸ªæ–¹å¼æ˜¯æˆ‘è®¤ä¸ºæœ€å¥½çš„ã€‚
æ ¹æ®åŠŸèƒ½å°† service åˆ†å¼€æœ‰åŠ©äºä¹‹åè¿›è¡Œä¿®æ”¹æ—¶å®šä¹‰ä¸Šä¸‹æ–‡è¾¹ç•Œå’Œä»£ç å¯¼èˆªã€‚
å°†è·¯ç”±æ³¨å†Œã€ä¸šåŠ¡é€»è¾‘ã€å­˜å‚¨ç­‰æ”¾åˆ°åŒä¸€ä¸ª &lt;code>service&lt;/code> å±‚ä¸­ï¼Œä¹Ÿè®©æˆ‘ä»¬æ›´å…³æ³¨ä¸šåŠ¡é€»è¾‘æœ¬èº«å’Œæ›´å®¹æ˜“åœ°è¿›è¡Œæµ‹è¯•ã€‚
ä¸è¦è®©ç®€å•çš„äº‹æƒ…å˜å¤æ‚ï¼å¦‚æœæ‚¨æƒ³èŠ‚çº¦æ—¶é—´ï¼Œé‚£å°±ä¸€å®šè¦è¿™æ ·åšã€‚&lt;/p>
&lt;p>æˆ‘å¸Œæœ›èƒ½å¸®åŠ©åˆ°ä½ ï¼Œå¦‚æœä½ æƒ³é˜…è¯»æ‰€æœ‰æºç ï¼Œä½ å¯ä»¥åœ¨ &lt;a href="https://github.com/kott/go-service-example">Github&lt;/a> ä¸‹è½½ã€‚&lt;/p>
&lt;hr>
&lt;p>via: &lt;a href="https://medium.com/@ott.kristian/how-i-structure-services-in-go-19147ad0e6bd">https://medium.com/@ott.kristian/how-i-structure-services-in-go-19147ad0e6bd&lt;/a>&lt;/p>
&lt;p>ä½œè€…ï¼š&lt;a href="https://medium.com/@ott.kristian">Kristian Ott&lt;/a>
è¯‘è€…ï¼š&lt;a href="https://h1z3y3.me">h1z3y3&lt;/a>&lt;/p>
&lt;p>æœ¬æ–‡ç”± &lt;a href="https://github.com/studygolang/GCTT">GCTT&lt;/a> åŸåˆ›ç¼–è¯‘ï¼Œ&lt;a href="https://studygolang.com/">Go ä¸­æ–‡ç½‘&lt;/a> è£èª‰æ¨å‡º&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category><category domain="https://h1z3y3.me/tags/clean-arch/">clean-arch</category></item><item><title>ä½¿ç”¨ Github Actions è‡ªåŠ¨å‘å¸ƒ hugo ç«™ç‚¹</title><link>https://h1z3y3.me/posts/hugo-auto-deploy-github-with-actions/</link><guid isPermaLink="true">https://h1z3y3.me/posts/hugo-auto-deploy-github-with-actions/</guid><pubDate>Thu, 22 Apr 2021 22:21:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä» 2018 å¹´åº•åˆ° 2021 å¹´åˆï¼Œåšå®¢ä¸€ç›´æç½®ï¼Œè™½ç„¶ä¹Ÿå¶å°”å†™å‡ ç¯‡æ–‡ç« ï¼Œä½†æ˜¯éƒ½å‘å¸ƒåœ¨å›¢é˜Ÿçš„å…¬ä¼—å·ä¸­äº†ï¼Œ ç°åœ¨é‡æ–°å¼€å§‹ç»´æŠ¤è‡ªå·±çš„åšå®¢ï¼Œä¹Ÿä»
&lt;a href="https://github.com/hexojs/hexo">hexo&lt;/a>
è½¬ç§»åˆ°äº†
&lt;a href="https://github.com/gohugoio/hugo">hugo&lt;/a> ï¼Œ
è¿™ä¸¤ä¸ªéƒ½æ˜¯éå¸¸ä¼˜ç§€çš„é™æ€ç½‘ç«™ç”Ÿæˆå·¥å…·ã€‚&lt;/p>
&lt;p>ä½†æ˜¯ä¸å¾—ä¸è¯´ï¼Œä½¿ç”¨ hugo ä¹‹åæ„Ÿè§‰æ˜“ç”¨æ€§ä»¥åŠæ–‡ä»¶çš„ç”Ÿæˆé€Ÿåº¦éƒ½ä¼˜äºæˆ‘ä¹‹å‰ä½¿ç”¨çš„ hexo çš„ç‰ˆæœ¬ï¼ˆè¯´çš„ä¸¥è°¨ä¸€äº›ï¼Œæˆ‘ä¹Ÿä¸çŸ¥é“ç°åœ¨å¦‚ä½•ï¼‰ã€‚&lt;/p>
&lt;p>åŒæ—¶æˆ‘è¿˜ç»™è‡ªå·±é‡æ–°æŒ‘é€‰äº†ä¸»é¢˜ï¼Œä½¿ç”¨çš„æ˜¯
&lt;a href="https://github.com/h1z3y3/hugo-theme-meme">hugo-theme-meme&lt;/a> ï¼Œ
å¹¶ä¸”æˆ‘è¿˜åšäº†ä¸€éƒ¨åˆ†è‡ªå®šä¹‰ï¼Œ æ¯”å¦‚ æ–‡ç« åˆ—è¡¨é¡µ çš„æ ·å¼ã€å­—ä½“ã€è¿˜ä¿®æ”¹äº†ç§»åŠ¨ç«¯æ ‡é¢˜è¿‡é•¿æ ·å¼é”™ä¹±çš„ bugï¼Œ
å¦å¤–è¿˜æ¥å…¥äº† &lt;a href="">Gitalk&lt;/a>ï¼ˆå·²ç»æ pr å¹¶åˆå¹¶ï¼‰å’Œé¡µé¢å³ä¸‹è§’çš„ &lt;a href="">Webpusher&lt;/a> (æ²¡æœ‰æäº¤ PR),
ä¸å¾—ä¸è¯´ï¼ŒæŠŠè‡ªå·±çš„åšå®¢è¯„è®ºç”¨ &lt;a href="https://github.com/h1z3y3/h1z3y3.github.io/issues">Github Issue&lt;/a> æ¥ç»´æŠ¤çš„æƒ³æ³•ä¹Ÿå¤ªèµäº†ï¼&lt;/p>
&lt;h1 id="ä½¿ç”¨-github-action-è‡ªåŠ¨å‘å¸ƒ-hugo-ç«™ç‚¹">ä½¿ç”¨ Github Action è‡ªåŠ¨å‘å¸ƒ hugo ç«™ç‚¹&lt;/h1>
&lt;p>å¦‚ä½•ä½¿ç”¨ hugo ä»¥åŠ Github Pages çš„åŸºæœ¬çŸ¥è¯†æˆ‘å°±ä¸å†èµ˜è¿°ï¼Œæœ¬æ–‡ä¸»è¦ç»™å¤§å®¶è®²è§£å¦‚ä½•ä½¿ç”¨ Github Actions è‡ªåŠ¨ç¼–è¯‘ä½ çš„ç«™ç‚¹å®æ—¶å‘å¸ƒï¼Œ
æœ¬æ–‡å¯ä»¥å¸®ä½ è§£å†³çš„é—®é¢˜æ˜¯ï¼šå¦‚ä½•ä½¿ç”¨ä½ çš„ &lt;code>*.github.io&lt;/code> çš„ä»“åº“ç»´æŠ¤ç«™ç‚¹çš„é…ç½® ï¼ˆ&lt;code>config.toml&lt;/code>ï¼‰ã€
ä½¿ç”¨çš„ä¸»é¢˜ã€æˆ–è€…è‡ªå·± markdown æ ¼å¼çš„åŸæ–‡ï¼Œè€Œä¸éœ€è¦åˆ›å»ºæ–°ä»“åº“ã€‚&lt;/p>
&lt;p>å› ä¸ºæˆ‘è‡ªå·±ä¸€å¼€å§‹ä¹Ÿæƒ³åˆ›å»ºæ–°ä»“åº“ç»´æŠ¤ï¼Œä½†æ˜¯åæ¥æŸ¥é˜…äº†ä¸€äº›ç›¸å…³æ–‡æ¡£åï¼Œå‘ç°å®Œå…¨æ²¡å¿…è¦ï¼Œä¸‹é¢ä»‹ç»ç»™å¤§å®¶ã€‚&lt;/p>
&lt;h2 id="å®šä¹‰-github-actions">å®šä¹‰ Github Actions&lt;/h2>
&lt;p>ä¸‹é¢æ˜¯æˆ‘ç«™ç‚¹çš„ Hugo Actions çš„é…ç½®æ–‡ä»¶ï¼Œå’ŒåŸå§‹é…ç½®æœ‰äº›å°æ”¹åŠ¨ï¼Œ
åŸå§‹é…ç½®æ–‡ä»¶å¯ä»¥åœ¨ &lt;a href="https://github.com/peaceiris/actions-gh-pages">è¿™é‡Œ&lt;/a> æ‰¾åˆ°&lt;/p>
&lt;p>åœ¨ hugo ç«™ç‚¹çš„æ ¹ç›®å½•åˆ›å»º &lt;code>.github/workflows/gh-pages.yml&lt;/code> ï¼Œå¹¶å°†ä¸‹é¢çš„å†…å®¹æ‹·è´è¿›å»ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">github pages&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c"># on æ˜¯ Actions çš„è§¦å‘æ¡ä»¶ï¼Œè¿™é‡Œçš„é…ç½®è¯´æ˜å½“ master åˆ†æ”¯æœ‰æäº¤çš„æ—¶å€™ï¼Œæ ¹æ®è¿™ä¸ªé…ç½®æ–‡ä»¶æ‰§è¡Œ&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">push&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">branches&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="l">master&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># Set a branch to deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="c"># jobs æ˜¯è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œæˆ‘ä»¬çœ‹åˆ°ä»–è¦æ‰§è¡Œ deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">&lt;/span>&lt;span class="nt">jobs&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">deploy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">runs-on&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">ubuntu-18.04&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># è¿è¡Œç¯å¢ƒ&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">steps&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># æ‰§è¡Œæ­¥éª¤&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># checkout åˆ†æ”¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">actions/checkout@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">submodules&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># Fetch Hugo themes (true OR recursive)&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">fetch-depth&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">0&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># Fetch all history for .GitInfo and .Lastmod&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å®‰è£… hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Setup Hugo&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-hugo@v2&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">hugo-version&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;latest&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># extended: true&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># ç¼–è¯‘ç«™ç‚¹&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Build&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">run&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">hugo --minify&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># åˆ›å»º CNAMEï¼Œè¿™ä¸ªæ˜¯åŸå§‹é…ç½®ä¸­æ²¡æœ‰çš„&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;finnp/create-file-action@master&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">env&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">FILE_NAME&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;./public/CNAME&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">FILE_DATA&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;h1z3y3.me&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># å°†ç«™ç‚¹å‘å¸ƒåˆ°å¯¹åº”åˆ†æ”¯&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deploy&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">uses&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">peaceiris/actions-gh-pages@v3&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">with&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">github_token&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">${{ secrets.GITHUB_TOKEN }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="nt">publish_dir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">./public&lt;/span>&lt;span class="w">
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>Github Actions æ›´è¯¦ç»†çš„ä½¿ç”¨å¯ä»¥ä»
&lt;a href="https://docs.github.com/en/actions/learn-github-actions">è¿™é‡Œ&lt;/a> è·å–ã€‚&lt;/p>
&lt;h2 id="è®¾ç½®-hugo-ç›®å½•çš„æäº¤ä»“åº“ä¸º-githubio">è®¾ç½® hugo ç›®å½•çš„æäº¤ä»“åº“ä¸º *.github.io&lt;/h2>
&lt;p>å¦‚æœä½ çš„ hugo æ²¡åœ¨ github ç»´æŠ¤ï¼Œæ‰§è¡Œ:&lt;/p>
&lt;pre>&lt;code>&amp;gt; git remote add origin git@github.com:your/your.github.io.git
&lt;/code>&lt;/pre>&lt;p>å¦‚æœå·²ç»åœ¨ github ç»´æŠ¤äº†ï¼Œæ‰§è¡Œï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git remote set-url origin git@github.com:your/your.github.io.git
&lt;/code>&lt;/pre>&lt;p>å¦‚æœä»“åº“æœ‰æ–‡ä»¶ï¼Œå¾ˆå¯èƒ½ä½ éœ€è¦ä½¿ç”¨ &lt;code>git push -f origin master&lt;/code> æ¥å¼ºåˆ¶è¦†ç›–ã€‚&lt;/p>
&lt;p>æ¨é€åˆ° Github ä¹‹åï¼Œç°åœ¨ Github çš„ä»£ç å°±æ˜¯ä½  hugo çš„æ ¹ç›®å½•ï¼Œè¿™æ—¶å€™æˆ‘ä»¬çš„ *.github.io çš„ç«™ç‚¹è‚¯å®šä¸å·¥ä½œäº†ï¼Œæ¥ä¸‹æ¥å¾€ä¸‹çœ‹ã€‚&lt;/p>
&lt;h2 id="actions-æ‰§è¡Œ">Actions æ‰§è¡Œ&lt;/h2>
&lt;p>æˆ‘ä»¬åˆ‡æ¢åˆ° &lt;strong>Actions&lt;/strong> é€‰é¡¹å¡ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆšæ‰æäº¤çš„å·¥ä½œæµå·²ç»æ‰§è¡Œäº†ï¼Œ
åŒæ—¶åœ¨ &lt;strong>Code&lt;/strong> é€‰é¡¹å¡ï¼Œä¹Ÿå¸®æˆ‘ä»¬åˆ›å»ºå¥½äº†ä¸€ä¸ª &lt;code>gh-pages&lt;/code> çš„åˆ†æ”¯ï¼Œ
åˆ‡æ¢ä¹‹åå‘ç°è¿™ä¸ª hugo å·²ç»ç¼–è¯‘å¥½çš„é™æ€ç«™ç‚¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/h1z3y3/h1z3y3.github.io/master/images/hugo-auto-deploy-github-with-actions/actions-list.png" alt="">&lt;/p>
&lt;h2 id="ä¿®æ”¹-github-page-ç«™ç‚¹çš„é»˜è®¤åˆ†æ”¯">ä¿®æ”¹ Github Page ç«™ç‚¹çš„é»˜è®¤åˆ†æ”¯&lt;/h2>
&lt;p>æ²¡é”™ï¼Œ&lt;code>*.github.io&lt;/code> çš„ä»“åº“ï¼Œå…è®¸ä½ è‡ªå®šä¹‰ä½ è¦æä¾›é™æ€ç«™ç‚¹çš„åˆ†æ”¯ï¼Œé»˜è®¤æ˜¯ masterï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸ºå…¶ä»–çš„&lt;/p>
&lt;p>æ“ä½œæ–¹æ³•ï¼š&lt;/p>
&lt;p>è¿›å…¥ä½ çš„ &lt;code>*.github.io&lt;/code> çš„ä»“åº“ï¼Œç‚¹å‡»é¡¹ç›®çš„ &lt;code>Settings&lt;/code> ï¼Œå¹¶ç‚¹å‡»å·¦ä¾§çš„ &lt;code>Pages&lt;/code>ï¼Œåœ¨è¿™é‡Œä½ å¯ä»¥è‡ªå®šä¹‰ä¸€äº›ä½ ç«™ç‚¹çš„é…ç½®ï¼Œ
åœ¨è¿™é‡Œä½ å¯ä»¥è‡ªå·±é€‰æ‹©è‡ªå·±ç«™ç‚¹è¦ä½¿ç”¨çš„&lt;code>åˆ†æ”¯&lt;/code>ä»¥åŠ&lt;code>ç›®å½•&lt;/code>ï¼Œæˆ‘ä»¬è¿™é‡Œåˆ‡æ¢ä¸º &lt;code>gh-pages&lt;/code> è¿™ä¸ªåˆ†æ”¯ï¼Œå¹¶ç‚¹å‡»ä¿å­˜ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/h1z3y3/h1z3y3.github.io/master/images/hugo-auto-deploy-github-with-actions/set-github-pages-default-branch.png" alt="">&lt;/p>
&lt;h2 id="æ£€æŸ¥">æ£€æŸ¥&lt;/h2>
&lt;p>å…¨éƒ¨è®¾ç½®å¥½ä¹‹åï¼Œç¨ç­‰å‡ åˆ†é’Ÿç”Ÿæ•ˆåï¼Œé€šè¿‡æµè§ˆå™¨è®¿é—® &lt;code>your.github.io&lt;/code>ï¼Œå°±å¯ä»¥æ­£å¸¸è®¿é—®äº†ï¼Œä¹‹åæ¯æ¬¡æˆ‘ä»¬æ–‡ç« æœ‰æ›´æ–°ï¼Œ
ä» &lt;code>master&lt;/code> åˆ†æ”¯æäº¤ä¹‹åï¼ŒGithub å°±ä¼šé€šè¿‡ Actions å¸®æˆ‘ä»¬å»ç¼–è¯‘ç„¶åå‘å¸ƒåœ¨ &lt;code>gh-pages&lt;/code> åˆ†æ”¯ï¼Œååˆ†æ–¹ä¾¿ã€‚&lt;/p>
&lt;p>å¦‚æœä½ è®¾ç½®äº† CNAMEï¼Œé‚£ä¹ˆè¯·å‚ç…§æˆ‘ Actions é…ç½®ï¼Œé‡Œé¢æœ‰åˆ›å»º CNAME æ–‡ä»¶çš„æ­¥éª¤ï¼Œæ·»åŠ åˆ°ä½ è‡ªå·±çš„é…ç½®å³å¯ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/hugo/">hugo</category></item><item><title>Web åçˆ¬æŒ‡å—ï¼ˆæˆ–è‡³å°‘è®©å…¶æ›´éš¾æŠ“å–ï¼‰</title><link>https://h1z3y3.me/posts/how-to-prevent-scraping/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-prevent-scraping/</guid><pubDate>Thu, 22 Apr 2021 20:02:34 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="web-åçˆ¬æŒ‡å—æˆ–è‡³å°‘è®©å…¶æ›´éš¾æŠ“å–">Web åçˆ¬æŒ‡å—ï¼ˆæˆ–è‡³å°‘è®©å…¶æ›´éš¾æŠ“å–ï¼‰&lt;/h1>
&lt;hr>
&lt;p>æç¤ºï¼šè¿™ç¯‡æ–‡ç« æ˜¯æˆ‘ Stack Overflow &lt;a href="http://stackoverflow.com/a/34828465/4428462">è¿™ä¸ªé—®é¢˜&lt;/a> å›ç­”çš„æ‰©å±•ï¼Œ
æˆ‘æŠŠå®ƒæ•´ç†åœ¨ Github å› ä¸ºå®ƒå®åœ¨æ˜¯å¤ªé•¿äº†ï¼Œè¶…è¿‡äº† Stack Overflow çš„å­—æ•°é™åˆ¶ï¼ˆæœ€å¤š 3 ä¸‡ä¸ªå­—ï¼Œè¿™æ–‡ç« å·²ç»è¶…è¿‡ 4 ä¸‡å­—ï¼‰&lt;/p>
&lt;p>æ¬¢è¿å¤§å®¶ä¿®æ”¹ã€å®Œå–„è¿˜æœ‰åˆ†äº«ï¼Œæœ¬æ–‡ä½¿ç”¨ &lt;a href="https://creativecommons.org/licenses/by-sa/3.0/">CC-BY-SA 3.0&lt;/a> è®¸å¯ã€‚&lt;/p>
&lt;hr>
&lt;p>æœ¬è´¨ä¸Šè¯´ï¼Œ&lt;strong>é˜²æŠ“çš„ç›®çš„åœ¨äºå¢åŠ è„šæœ¬æˆ–æœºå™¨è·å–ä½ ç½‘ç«™å†…å®¹çš„éš¾åº¦ï¼Œè€Œä¸è¦å½±å“çœŸå®ç”¨æˆ·çš„ä½¿ç”¨æˆ–æœç´¢å¼•æ“çš„æ”¶å½•&lt;/strong>&lt;/p>
&lt;p>ä¸å¹¸çš„æ˜¯è¿™æŒºéš¾çš„ï¼Œä½ éœ€è¦åœ¨é˜²æŠ“å’Œé™ä½çœŸå®ç”¨æˆ·ä»¥åŠæœç´¢å¼•æ“çš„å¯è®¿é—®æ€§ä¹‹é—´åšä¸€ä¸‹æƒè¡¡ã€‚&lt;/p>
&lt;p>ä¸ºäº†é˜²çˆ¬ï¼ˆä¹Ÿç§°ä¸ºç½‘é¡µæŠ“å–ã€å±å¹•æŠ“å–ã€ç½‘ç«™æ•°æ®æŒ–æ˜ã€ç½‘ç«™æ”¶å‰²æˆ–è€…ç½‘ç«™æ•°æ®è·å–ï¼‰ï¼Œ
äº†è§£ä»–ä»¬çš„å·¥ä½œåŸç†å¾ˆé‡è¦ï¼Œè¿™èƒ½é˜²æ­¢ä»–ä»¬èƒ½é«˜æ•ˆçˆ¬å–ï¼Œè¿™ä¸ªå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„ä¸»è¦å†…å®¹ã€‚&lt;/p>
&lt;p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒæŠ“å–ç¨‹åºçš„ç›®çš„æ˜¯ä¸ºäº†è·å–ä½ ç½‘ç«™ç‰¹å®šçš„ä¿¡æ¯ï¼Œæ¯”å¦‚æ–‡ç« å†…å®¹ã€æœç´¢ç»“æœã€äº§å“è¯¦æƒ…è¿˜æœ‰ç½‘ç«™ä¸Šè‰ºæœ¯å®¶æˆ–è€…ç›¸å†Œä¿¡æ¯ã€‚
ä»–ä»¬çˆ¬å–è¿™äº›å†…å®¹ç”¨äºç»´æŠ¤ä»–ä»¬è‡ªå·±çš„ç½‘ç«™ï¼ˆç”šè‡³é€šè¿‡ä½ çš„å†…å®¹èµšé’±ï¼ï¼‰ï¼Œæˆ–è€…åˆ¶ä½œå’Œä½ ç½‘ç«™ä¸ä¸€æ ·çš„å‰ç«¯ç•Œé¢ï¼ˆæ¯”å¦‚å»åšç§»åŠ¨ APPï¼‰ï¼Œ
è¿˜æœ‰ä¸€äº›å¯èƒ½ä½œä¸ºä¸ªäººç ”ç©¶æˆ–åˆ†æä½¿ç”¨ã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œæœ‰ç‰¹åˆ«å¤šçš„çˆ¬è™«ç±»å‹ï¼Œè€Œä¸”ä»–ä»¬çš„çˆ¬å–æ–¹å¼éƒ½ä¸å¤ªç›¸åŒï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>èœ˜è››ï¼Œæ¯”å¦‚ &lt;a href="http://googlebot.com/">Google&amp;rsquo;s bot&lt;/a>
æˆ–è€…ç½‘ç«™å¤åˆ¶å·¥å…· &lt;a href="http://www.httrack.com/">HTtrack&lt;/a>ï¼Œä»–ä»¬è®¿é—®ä½ çš„ç½‘ç«™ï¼Œ
è€Œä¸”åœ¨é¡µé¢ä¸­å¯»æ‰¾é“¾æ¥åé€’å½’çš„å»çˆ¬å–ä»¥è·å–é¡µé¢çš„æ•°æ®ã€‚æœ‰æ—¶å€™ä»–ä»¬åªç”¨äºè·å–ç‰¹å®šæ•°æ®ï¼Œ
è€Œä¸ä¼šå…¨éƒ¨çˆ¬å–ï¼Œé€šå¸¸ç»“åˆ HTML åˆ†æå™¨åœ¨é¡µé¢ä¸­è·å–æƒ³è¦çš„æ•°æ®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Shell è„šæœ¬ï¼Œæœ‰æ—¶å€™ï¼Œé€šç”¨çš„ Unix å·¥å…·ä¹Ÿè¢«ç”¨æ¥çˆ¬å–ï¼šwget æˆ–è€… curl ç”¨äºä¸‹è½½é¡µé¢ï¼Œ
ç”¨ Grep ï¼ˆRegexï¼‰ å»åˆ†æè·å–æƒ³è¦çš„æ•°æ®ï¼Œä¸€èˆ¬éƒ½ä¼šå†™ä¸€ä¸ª Shell è„šæœ¬ã€‚
è¿™äº›éƒ½æ˜¯æœ€ç®€å•çš„çˆ¬è™«ï¼Œä¹Ÿæ˜¯æœ€è„†å¼±çš„ä¸€ç±»çˆ¬è™«
(&lt;a href="https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454">Don&amp;rsquo;t ever try parse HTML with regex !&lt;/a>ï¼‰ï¼Œ
æ‰€ä»¥æ˜¯æœ€æ—©å‘ç°å’Œé˜²èŒƒçš„çˆ¬è™«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>HTML çˆ¬å–å™¨å’Œåˆ†æå™¨ï¼Œä¼šåŸºäº &lt;a href="http://jsoup.org/">Jsoup&lt;/a>ã€&lt;a href="http://scrapy.org/">Scrapy&lt;/a> è¿˜æœ‰å…¶ä»–ä¸€äº›å·¥å…·ã€‚
å’Œ shell è„šæœ¬åŸºäºæ­£åˆ™ç±»ä¼¼ï¼Œä»–ä»¬èƒ½åŸºäºç‰¹å®šæ¨¡å¼ï¼ˆpatternï¼‰åˆ†æä½ çš„ HTML ç»“æ„ä»è€Œè·å–æƒ³è¦çš„æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ çš„ç½‘ç«™æœ‰æœç´¢åŠŸèƒ½ï¼Œé‚£è¿™ä¸ªçˆ¬è™«å¯èƒ½ä¼šæ¨¡æ‹Ÿæäº¤ä¸€ä¸ªæœç´¢çš„ HTTP è¯·æ±‚ï¼Œç„¶åä»æœç´¢ç»“æœé¡µä¸­è·å–æ‰€æœ‰çš„é“¾æ¥å’Œæ ‡é¢˜ï¼Œæœ‰æ—¶å€™ä¼šæ„é€ æœ‰æˆåƒä¸Šç™¾ä¸åŒçš„è¯·æ±‚ï¼Œåªæ˜¯ä¸ºäº†è·å–æ ‡é¢˜å’Œé“¾æ¥è€Œå·²ã€‚è¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç±»çˆ¬è™«ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å±å¹•çˆ¬å–ï¼Œæ¯”å¦‚ä¼šåŸºäº &lt;a href="http://www.seleniumhq.org/">Selenium&lt;/a> æˆ–è€… &lt;a href="http://phantomjs.org/">PhantomJS&lt;/a>ï¼Œ
ä»–ä»¬å®é™…ä¸Šä¼šé€šè¿‡çœŸå®æµè§ˆå™¨æ‰“å¼€ä½ çš„ç½‘ç«™ï¼Œå› æ­¤ä¹Ÿä¼šè¿è¡Œä½ ç½‘ç«™çš„ JavaScriptã€AJAX æˆ–è€…å…¶ä»–çš„ï¼Œ
ç„¶åä»–ä»¬ä»ä½ çš„é¡µé¢è·å–è‡ªå·±æƒ³è¦çš„æ–‡æœ¬å†…å®¹ï¼Œé€šå¸¸ï¼š&lt;/p>
&lt;ul>
&lt;li>ç­‰é¡µé¢åŠ è½½å®Œæ¯•ï¼Œ JavaScript ä¹Ÿæ‰§è¡Œä¹‹åï¼Œä»æµè§ˆå™¨è·å– HTML ç»“æ„ï¼Œç„¶åç”¨ HTML åˆ†æå™¨å»è·å–æƒ³è¦çš„æ•°æ®æˆ–è€…æ–‡æœ¬ã€‚è¿™æ˜¯å¸¸è§åšæ³•ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥é˜²æ­¢è¿™ç±» HTML åˆ†æå™¨æˆ–çˆ¬è™«ã€‚&lt;/li>
&lt;li>è·å–åŠ è½½å®Œé¡µé¢çš„å±å¹•æˆªå›¾ï¼Œç„¶åä½¿ç”¨ OCR åˆ†æä»æˆªå±ä¸­è·å–æƒ³è¦çš„æ•°æ®ã€‚è¿™ç±»ä¸å¸¸è§ï¼Œè€Œä¸”åªæœ‰éå¸¸æƒ³è¦ä½ ç½‘ç«™å†…å®¹çš„çˆ¬è™«æ‰ä¼šä½¿ç”¨ã€‚&lt;/li>
&lt;/ul>
&lt;p>åŸºäºæµè§ˆå™¨çš„çˆ¬å»å¾ˆéš¾å¤„ç†ï¼Œä»–ä»¬è¿è¡Œè„šæœ¬ï¼Œæ¸²æŸ“ HTMLï¼Œå°±åƒçœŸå®ç”¨æˆ·ä¸€æ ·è®¿é—®ä½ çš„ç½‘ç«™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Webçˆ¬å–æœåŠ¡ï¼Œæ¯”å¦‚ &lt;a href="http://scrapinghub.com/">ScrapingHub&lt;/a>æˆ–è€… &lt;a href="https://www.kimonolabs.com/">Kimono&lt;/a>ã€‚
å®é™…ä¸Šï¼Œå¾ˆå¤šäººçš„å·¥ä½œå°±æ˜¯æ‰¾å‡ºå¦‚ä½•çˆ¬å–ä½ çš„é¡µé¢è·å–å…¶ä¸­å†…å®¹å¹¶ç»™å…¶ä»–äººä½¿ç”¨ã€‚
ä»–ä»¬æœ‰æ—¶ä¼šç”¨å¤§é‡çš„ä»£ç†ç”šè‡³ä¿®æ”¹ IP åœ°å€æ¥ç»•è¿‡é¢‘ç‡é™åˆ¶å’Œå°ç¦ï¼Œæ‰€ä»¥ä»–ä»¬æ˜¯åçˆ¬çš„å…³é”®å¯¹è±¡ã€‚&lt;/p>
&lt;p>æ¯«æ— ç–‘é—®ï¼Œé˜²æ­¢ä¸“ä¸šçš„çˆ¬å–æœåŠ¡æ˜¯éå¸¸å›°éš¾çš„ï¼Œä½†æ˜¯å¦‚æœä½ å¢åŠ çˆ¬å–çš„éš¾åº¦ï¼Œæˆ–è€…å¢åŠ ä»–ä»¬æ‰¾å‡ºçˆ¬å–æ–¹æ³•çš„æ—¶é—´ï¼Œé‚£è¿™äº›äººï¼ˆæˆ–è€…ä»˜é’±è®©ä»–ä»¬è¿™æ ·åšçš„äººï¼‰å¯èƒ½ä¼šæ”¾å¼ƒçˆ¬å–ä½ çš„ç½‘ç«™ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æŠŠä½ çš„ç½‘ç«™é¡µé¢é€šè¿‡ &lt;a href="https://en.wikipedia.org/wiki/Framing_(World_Wide_Web)">frames&lt;/a> åµŒå…¥å…¶ä»–ç«™ç‚¹ï¼Œ æˆ–è€…æŠŠä½ çš„é¡µé¢åµŒå…¥ç§»åŠ¨ APPã€‚&lt;/p>
&lt;p>è™½ç„¶æ²¡æœ‰ä»€ä¹ˆæŠ€æœ¯å«é‡ï¼Œä½†æ˜¯ç¡®å®ä¹Ÿæ˜¯ä¸ªé—®é¢˜ï¼Œæ¯”å¦‚ç§»åŠ¨ APPï¼ˆAndroid å’Œ iOSï¼‰å¯ä»¥åµŒå…¥ä½ çš„ç½‘ç«™ï¼Œç”šè‡³å¯ä»¥æ³¨å…¥ä¸€äº›è‡ªå®šä¹‰çš„ CSS å’Œ
JavaScriptï¼Œæ‰€ä»¥å¯ä»¥å®Œå…¨æ”¹å˜ä½ ç½‘ç«™çš„å¤–è§‚ï¼Œç„¶ååªå±•ç¤ºæƒ³è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚åªå±•ç¤ºæ–‡ç« å†…å®¹æˆ–è€…æœç´¢ç»“æœï¼Œç„¶åéšè—ä½ ç½‘ç«™çš„ headersã€footers è¿˜æœ‰å¹¿å‘Šã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>äººè‚‰å¤åˆ¶ç²˜è´´ï¼šäººè‚‰å¤åˆ¶å’Œç²˜è´´ä½ ç½‘ç«™çš„å†…å®¹åˆ°å…¶ä»–åœ°æ–¹ã€‚å¾ˆé—æ†¾ï¼Œè¿™ä¸ªæ²¡æœ‰å¥½çš„æ–¹æ³•åŠ ä»¥é˜²èŒƒã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä»¥ä¸Šä¸åŒçš„çˆ¬è™«ç±»å‹æœ‰å¾ˆå¤šç›¸åŒç‚¹ï¼Œå¾ˆå¤šçˆ¬è™«çš„è¡Œä¸ºä¹Ÿå¾ˆç›¸ä¼¼ï¼Œå³ä½¿ä»–ä»¬ä½¿ç”¨äº†ä¸åŒçš„æŠ€æœ¯æˆ–è€…æ–¹æ¡ˆå»çˆ¬å–ä½ çš„å†…å®¹ã€‚&lt;/p>
&lt;p>è¿™äº›å¤§å¤šæ•°éƒ½æ˜¯æˆ‘è‡ªå·±çš„æƒ³æ³•ï¼Œæˆ‘åœ¨å†™çˆ¬è™«æ—¶ä¹Ÿé‡åˆ°è®¸å¤šå›°éš¾ï¼Œè¿˜æœ‰ä¸€äº›æ˜¯æ¥æºäºç½‘ç»œã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•åçˆ¬">å¦‚ä½•åçˆ¬&lt;/h2>
&lt;p>ä¸€äº›å¸¸è§çš„æ£€æµ‹å’Œé˜²æ­¢çˆ¬è™«çš„æ–¹æ³•ï¼š&lt;/p>
&lt;h3 id="ç›‘æ§ä½ çš„æ—¥å¿—å’Œè¯·æ±‚å½“å‘ç°å¼‚å¸¸è¡Œä¸ºæ—¶é™åˆ¶è®¿é—®">ç›‘æ§ä½ çš„æ—¥å¿—å’Œè¯·æ±‚ï¼›å½“å‘ç°å¼‚å¸¸è¡Œä¸ºæ—¶é™åˆ¶è®¿é—®&lt;/h3>
&lt;p>å‘¨æœŸæ€§çš„æ£€æŸ¥ä½ çš„æ—¥å¿—ï¼Œå¦‚æœå‘ç°æœ‰å¼‚å¸¸æ´»åŠ¨è¡¨æ˜æ˜¯è‡ªåŠ¨çˆ¬å–ï¼ˆçˆ¬è™«ï¼‰ï¼Œç±»ä¼¼æŸä¸€ä¸ªç›¸åŒçš„ IP å¾ˆå¤šç›¸åŒçš„è¡Œä¸ºï¼Œ é‚£ä½ å°±å¯ä»¥é˜»æ­¢æˆ–é™åˆ¶è®¿é—®ã€‚&lt;/p>
&lt;p>ä¸€äº›å¸¸ç”¨çš„æ–¹æ³•ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;strong>é¢‘ç‡é™åˆ¶&lt;/strong>&lt;/p>
&lt;p>åªå…è®¸ç”¨æˆ·ï¼ˆæˆ–çˆ¬è™«ï¼‰åœ¨ä¸€æ®µæ—¶é—´å†…è®¿é—®ç‰¹å®šçš„æ¬¡æ•°ï¼Œä¸¾ä¸ªä¾‹å­ï¼ŒæŸä¸ª IP æˆ–ç”¨æˆ·åªå…è®¸ä¸€åˆ†é’Ÿæœç´¢å¾ˆå°‘çš„æ¬¡æ•°ã€‚
è¿™ä¸ªä¼šå‡æ…¢çˆ¬è™«çš„çˆ¬å–é€Ÿåº¦ï¼Œè®©ä»–ä»¬å˜å¾—ä½æ•ˆã€‚å¦‚æœæ¬¡æ•°ç‰¹åˆ«å¤šæˆ–è€…æ¯”çœŸå®ç”¨æˆ·å¤šå¾ˆå¤šï¼Œé‚£ä½ ä¹Ÿå¯ä»¥æ˜¾ç¤ºéªŒè¯ç é¡µé¢ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>æ£€æµ‹å¼‚å¸¸è¡Œä¸º&lt;/strong>&lt;/p>
&lt;p>å¦‚æœä½ èƒ½çœ‹åˆ°å¼‚å¸¸è¡Œä¸ºï¼Œæ¯”å¦‚åŒä¸€ä¸ª IP æœ‰å¾ˆå¤šç›¸åŒçš„è¯·æ±‚ï¼Œæœ‰äº›ä¼šç¿»å¾ˆå¤šé¡µæˆ–è€…è®¿é—®ä¸€äº›å¼‚å¸¸çš„é¡µç ï¼Œä½ å¯ä»¥æ‹’ç»è®¿é—®æˆ–è€…åœ¨åç»­çš„è¯·æ±‚ä¸­å±•ç¤ºéªŒè¯ç ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä¸è¦åªé€šè¿‡ IP æ£€æµ‹å’Œé™åˆ¶ï¼Œä¹Ÿè¦ç”¨å…¶ä»–çš„ç”¨æˆ·æ ‡è¯†&lt;/strong>&lt;/p>
&lt;p>å¦‚æœä½ åšäº†è®¿é—®é™åˆ¶æˆ–é¢‘ç‡é™åˆ¶ï¼Œä¸è¦åªç®€å•çš„æ ¹æ®å•ä¸ª IP åœ°å€å»åšï¼›ä½ å¯ä»¥é€šè¿‡å…¶ä»–çš„æ ‡è¯†å’Œæ–¹æ³•å»è¯†åˆ«ä¸€ä¸ªç”¨æˆ·æˆ–çˆ¬è™«ã€‚
ä¸€äº›å¯ä»¥å¸®ä½ è¯†åˆ«ç”¨æˆ·/çˆ¬è™«çš„æ ‡è¯†ï¼š&lt;/p>
&lt;ul>
&lt;li>ç”¨æˆ·å¡«å†™è¡¨å•çš„é€Ÿåº¦ï¼Œè¿˜æœ‰ä»–ä»¬ç‚¹å‡»æŒ‰é’®çš„ä½ç½®&lt;/li>
&lt;li>ä½ å¯ä»¥é€šè¿‡ JavaScript è·å–å¾ˆå¤šä¿¡æ¯ï¼Œæ¯”å¦‚å±å¹•çš„å¤§å° / åˆ†è¾¨ç‡ï¼Œæ—¶åŒºï¼Œå®‰è£…çš„å­—ä½“ç­‰ç­‰ï¼Œä½ å¯ä»¥ç”¨è¿™äº›å»è¯†åˆ«ç”¨æˆ·&lt;/li>
&lt;li>æºå¸¦çš„ HTTP å¤´ï¼Œç‰¹åˆ«æ˜¯ User-Agent&lt;/li>
&lt;/ul>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæŸä¸ª IP è¯·æ±‚äº†ä½ ç½‘ç«™å¾ˆå¤šæ¬¡ï¼Œæ‰€æœ‰çš„è®¿é—®éƒ½æœ‰ç›¸åŒçš„ UserAgent ã€å±å¹•å°ºå¯¸ï¼ˆJavaScript
æ£€æµ‹ï¼‰ï¼Œè¿˜æœ‰å…¨éƒ½ä½¿ç”¨åŒæ ·çš„æ–¹å¼å’Œå›ºå®šçš„æ—¶é—´é—´éš”ç‚¹å‡»åŒä¸€ä¸ªæŒ‰é’®ï¼Œé‚£å®ƒå¤§æ¦‚æ˜¯ä¸€ä¸ªå±å¹•çˆ¬è™«ï¼›
ä½ å¯ä»¥ä¸´æ—¶é™åˆ¶ç›¸ä¼¼çš„è¯·æ±‚ï¼ˆæ¯”å¦‚ åªé™åˆ¶æ¥è‡ªé‚£ä¸ª IP ç‰¹å®š User-Agent å’Œ å±å¹•å°ºå¯¸çš„è¯·æ±‚ï¼‰ï¼Œè¿™æ ·ä½ ä¸ä¼šè¯¯ä¼¤åŒæ ·ä½¿ç”¨è¿™ä¸ª IP çš„çœŸå®ç”¨æˆ·ï¼Œæ¯”å¦‚å…±äº«ç½‘ç»œé“¾æ¥çš„ç”¨æˆ·ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ›´è¿›ä¸€æ­¥ï¼Œå½“ä½ å‘ç°ç›¸ä¼¼çš„è¯·æ±‚ï¼Œä½†æ˜¯æ¥è‡ªä¸åŒçš„ IP åœ°å€ï¼Œè¡¨æ˜æ˜¯åˆ†å¸ƒå¼çˆ¬è™«ï¼ˆä½¿ç”¨åƒµå°¸ç½‘ç»œæˆ–ç½‘ç»œä»£ç†çš„çˆ¬è™«ï¼‰ã€‚
å¦‚æœä½ æ”¶åˆ°ç±»ä¼¼å¤§é‡çš„è¯·æ±‚ï¼Œä½†æ˜¯ä»–ä»¬æ¥è‡ªä¸åŒçš„ IP åœ°å€ï¼Œä½ å¯ä»¥æ‹’ç»è®¿é—®ã€‚å†å¼ºè°ƒä¸€ä¸‹ï¼Œå°å¿ƒä¸ç»æ„é™åˆ¶äº†çœŸå®ç”¨æˆ·ã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹æ³•å¯¹é‚£ç§è¿è¡Œ JavaScript çš„å±å¹•çˆ¬è™«æ¯”è¾ƒæœ‰æ•ˆï¼Œå› ä¸ºä½ å¯ä»¥è·å¾—ä»–ä»¬å¤§é‡çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>Stack Exchange ä¸Šå…³äº Secruity çš„ç›¸å…³é—®é¢˜ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>&lt;a href="http://security.stackexchange.com/questions/81302/how-to-uniquely-identify-users-with-the-same-external-ip-address">How to uniquely identify users with the same external IP address? &lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;a href="http://security.stackexchange.com/questions/96377/why-do-people-use-ip-address-bans-when-ip-addresses-often-change">Why do people use IP address bans when IP addresses often change? &lt;/a>
å…³äºä»…ä½¿ç”¨ IP çš„å…¶ä»–é™åˆ¶&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;strong>ä½¿ç”¨éªŒè¯ç ï¼Œè€Œä¸æ˜¯ä¸´æ—¶é™åˆ¶è®¿é—®&lt;/strong>&lt;/p>
&lt;p>å¯¹äºé¢‘ç‡é™åˆ¶ï¼Œæœ€ç®€å•çš„æ–¹å¼å°±æ˜¯ä¸´æ—¶é™åˆ¶è®¿é—®ï¼Œç„¶è€Œä½¿ç”¨éªŒè¯ç ä¼šæ›´å¥½ï¼Œå¯ä»¥çœ‹ä¸‹é¢å…³äºéªŒè¯ç çš„éƒ¨åˆ†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="è¦æ±‚æ³¨å†Œå’Œç™»å½•">è¦æ±‚æ³¨å†Œå’Œç™»å½•&lt;/h3>
&lt;p>å¦‚æœå¯è¡Œï¼Œè¦æ±‚åˆ›å»ºç”¨æˆ·æ‰å¯ä»¥æŸ¥çœ‹å†…å®¹ã€‚è¿™ä¸ªå¯ä»¥å¾ˆå¥½çš„éåˆ¶çˆ¬è™«ï¼Œä½†å¾ˆå®¹æ˜“éåˆ¶çœŸå®ç”¨æˆ·ï¼š&lt;/p>
&lt;ul>
&lt;li>å¦‚æœä½ è¦æ±‚å¿…é¡»åˆ›å»ºè´¦æˆ·å’Œç™»å½•ï¼Œä½ å¯ä»¥ç²¾å‡†çš„è·Ÿè¸ªç”¨æˆ·å’Œçˆ¬è™«çš„è¡Œä¸ºã€‚è¿™æ ·çš„è¯ï¼Œä½ å¯ä»¥å¾ˆç®€å•å°±èƒ½æ£€æµ‹åˆ°æœ‰çˆ¬å–è¡Œä¸ºçš„è´¦æˆ·ï¼Œç„¶åå°ç¦å®ƒã€‚
åƒé¢‘ç‡é™åˆ¶æˆ–æ£€æµ‹æ»¥ç”¨ï¼ˆæ¯”å¦‚ä¸€æ®µæ—¶é—´æœ‰å¤§é‡æœç´¢ï¼‰å°±å˜å¾—ç®€å•ï¼Œä½ ä¹Ÿå¯ä»¥ä¸ä»…ä»…é€šè¿‡ IP å»è¯†åˆ«çˆ¬è™«ã€‚&lt;/li>
&lt;/ul>
&lt;p>ä¸ºäº†é˜²æ­¢çˆ¬è™«åˆ›å»ºå¤§é‡çš„ç”¨æˆ·ï¼Œä½ åº”è¯¥ï¼š&lt;/p>
&lt;ul>
&lt;li>æ³¨å†Œæ—¶éœ€è¦æä¾› email åœ°å€ï¼Œå‘é€ä¸€ä¸ªéªŒè¯é“¾æ¥åˆ°é‚®ç®±ï¼Œè€Œä¸”è¿™ä¸ªé“¾æ¥å¿…é¡»è¢«æ‰“å¼€æ‰å¯ä»¥æ¿€æ´»è¿™ä¸ªè´¦æˆ·ã€‚ä¸€ä¸ªé‚®ç®±åªå…è®¸ä¸€ä¸ªè´¦æˆ·ä½¿ç”¨ã€‚&lt;/li>
&lt;li>åœ¨æ³¨å†Œæˆ–åˆ›å»ºç”¨æˆ·æ—¶ï¼Œå¿…é¡»é€šè¿‡éªŒè¯ç éªŒè¯ï¼Œä¸ºäº†é˜²æ­¢åˆ›å»ºç”¨æˆ·çš„è‡ªåŠ¨è„šæœ¬ã€‚&lt;/li>
&lt;/ul>
&lt;p>è¦æ±‚æ³¨å†Œç”¨æˆ·å¯¹ç”¨æˆ·å’Œæœç´¢å¼•æ“æ¥è¯´ä¸å‹å¥½ï¼›å¦‚æœä½ è¦æ±‚å¿…é¡»æ³¨å†Œæ‰å¯ä»¥çœ‹æ–‡ç« ï¼Œé‚£ç”¨æˆ·ä¹Ÿå¯èƒ½ç›´æ¥ç¦»å¼€ã€‚&lt;/p>
&lt;h3 id="é˜»æ­¢æ¥è‡ªäº‘æœåŠ¡å•†å’ŒæŠ“å–æœåŠ¡çš„-ip">é˜»æ­¢æ¥è‡ªäº‘æœåŠ¡å•†å’ŒæŠ“å–æœåŠ¡çš„ IP&lt;/h3>
&lt;p>æœ‰æ—¶ï¼Œçˆ¬è™«ä¼šè¢«è¿è¡Œåœ¨äº‘æœåŠ¡å•†ï¼Œæ¯”å¦‚ Amazon Web Services æˆ– Google App Engineï¼Œæˆ–è€…å…¶ä»– VPSã€‚
é™åˆ¶è¿™äº›æ¥è‡ªäº‘æœåŠ¡å•†çš„ IP åœ°å€è®¿é—®ä½ çš„ç½‘ç«™ï¼ˆæˆ–å‡ºéªŒè¯ç ï¼‰ã€‚ ä½ å¯ä»¥å¯ä»¥ç›´æ¥å¯¹æ¥è‡ªçˆ¬å–æœåŠ¡çš„ IP åœ°å€é™åˆ¶è®¿é—®ã€‚&lt;/p>
&lt;p>ç±»ä¼¼çš„ï¼Œä½ ä¹Ÿå¯ä»¥é™åˆ¶æ¥è‡ªä»£ç†æˆ– VPN çš„ IP åœ°å€ï¼Œå› ä¸ºå¾ˆå¤šçˆ¬è™«ä¼šä½¿ç”¨å®ƒä»¬æ¥é˜²æ­¢è¢«æ£€æµ‹åˆ°ã€‚&lt;/p>
&lt;p>ä½†æ˜¯è¦çŸ¥é“é™åˆ¶æ¥è‡ªä»£ç†æœåŠ¡å™¨æˆ– VPN çš„ IPï¼Œä¹Ÿå¾ˆå®¹æ˜“å½±å“åˆ°çœŸå®ç”¨æˆ·ã€‚&lt;/p>
&lt;h3 id="å½“ä½ å°ç¦æ—¶ä¸è¦å±•ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯">å½“ä½ å°ç¦æ—¶ä¸è¦å±•ç¤ºå…·ä½“é”™è¯¯ä¿¡æ¯&lt;/h3>
&lt;p>å¦‚æœä½ è¦å°ç¦æˆ–é™åˆ¶è®¿é—®ï¼Œä½ åº”è¯¥ç¡®ä¿ä¸è¦æŠŠå¯¼è‡´å°ç¦çš„åŸå› å‘Šè¯‰çˆ¬è™«ï¼Œä»–ä»¬ä¼šæ ¹æ®æç¤ºä¿®æ”¹è‡ªå·±çš„çˆ¬è™«ç¨‹åºã€‚æ‰€ä»¥ä¸‹é¢çš„è¿™äº›é”™è¯¯æœ€å¥½ä¸è¦å‡ºç°ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½ çš„ IP è®¿é—®å¤ªå¤šæ¬¡äº†ï¼Œè¯·é‡è¯•&lt;/li>
&lt;li>å‡ºé”™äº†ï¼Œæ²¡æœ‰ User Agent&lt;/li>
&lt;/ul>
&lt;p>ç›¸åçš„ï¼Œå±•ç¤ºä¸€äº›ä¸åŒ…å«åŸå› å¹¶å¯¹ç”¨æˆ·å‹å¥½ä¿¡æ¯ä¼šæ›´å¥½ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¿¡æ¯ä¼šæ›´å¥½ï¼š&lt;/p>
&lt;ul>
&lt;li>å¯¹ä¸èµ·ï¼Œæœ‰äº›ä¸å¯¹åŠ²ã€‚å¦‚æœé—®é¢˜æŒç»­å‡ºç°ï¼Œä½ å¯ä»¥è”ç³» &lt;a href="mailto:helpdesk@example.com">helpdesk@example.com&lt;/a> ä»¥è·å–æ”¯æŒã€‚&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœçœŸå®ç”¨æˆ·çœ‹åˆ°è¿™ä¸ªé”™è¯¯é¡µé¢ï¼Œè¿™ä¸ªå¯¹çœŸå®ç”¨æˆ·æ¥è¯´ä¹Ÿååˆ†å‹å¥½ã€‚åœ¨åç»­è®¿é—®ä¸­ï¼Œä½ ä¹Ÿå¯ä»¥è€ƒè™‘å±•ç¤ºéªŒè¯ç è€Œä¸æ˜¯ç›´æ¥å°ç¦ï¼Œ
å¦‚æœçœŸå®ç”¨æˆ·çœ‹åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå¯¹äºåˆæ³•ç”¨æˆ·ä¹Ÿä¼šè”ç³»ä½ ã€‚&lt;/p>
&lt;h3 id="å¦‚æœæœ‰çˆ¬è™«è®¿é—®è¯·ä½¿ç”¨éªŒè¯ç ">å¦‚æœæœ‰çˆ¬è™«è®¿é—®ï¼Œè¯·ä½¿ç”¨éªŒè¯ç &lt;/h3>
&lt;p>éªŒè¯ç ï¼ˆCaptchaï¼Œâ€œCompletely Automated Test to Tell Computers and Humans Apartâ€)å¯¹äºé˜²çˆ¬ååˆ†æœ‰æ•ˆã€‚ä¸å¹¸çš„æ˜¯ï¼Œå®ƒä¹Ÿå¾ˆå®¹æ˜“æƒ¹æ¼ç”¨æˆ·ã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œå¦‚æœä½ å‘ç°ç–‘ä¼¼çˆ¬è™«ï¼Œè€Œä¸”æƒ³è¦é˜»æ­¢å®ƒçš„çˆ¬å–è¡Œä¸ºï¼Œè€Œä¸æ˜¯å°ç¦å®ƒä»¥å…å®ƒæ˜¯çœŸå®ç”¨æˆ·ã€‚ä½ å¯ä»¥è€ƒè™‘æ˜¾ç¤ºéªŒè¯ç åœ¨å®ƒå†æ¬¡å…è®¸è®¿é—®ä¹‹å‰ã€‚&lt;/p>
&lt;p>ä½¿ç”¨éªŒè¯ç çš„æ³¨æ„äº‹é¡¹ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸è¦é€ è½®å­ï¼Œä½¿ç”¨ç±»ä¼¼ Google çš„ &lt;a href="https://www.google.com/recaptcha/intro/index.html">reCaptcha&lt;/a>çš„ä¸€äº›æœåŠ¡ï¼š
æ¯”ä½ è‡ªå·±å®ç°ä¸€å¥—éªŒè¯ç æœåŠ¡è¦ç®€å•å¤ªå¤šï¼Œå¯¹äºç”¨æˆ·æ¥è¯´ï¼Œä¹Ÿæ¯”è¯†åˆ«æ¨¡ç³Šæˆ–æ‰­æ›²çš„æ–‡å­—æ›´å‹å¥½ï¼ˆç”¨æˆ·ä¸€èˆ¬åªéœ€è¦ç‚¹å‡»ä¸€ä¸‹ï¼‰ï¼Œ
è€Œä¸”ç›¸å¯¹äºä½ è‡ªå·±æä¾›çš„ç®€å•éªŒè¯ç å›¾ç‰‡ï¼Œçˆ¬è™«ä¹Ÿæ›´éš¾å»ç ´è§£&lt;/li>
&lt;li>ä¸è¦åœ¨ HTML ç»“æ„ä¸­åŒ…å«éªŒè¯ç ç­”æ¡ˆï¼šæˆ‘æ›¾ç»çœ‹åˆ°è¿‡ä¸€ä¸ªç½‘ç«™åœ¨å®ƒè‡ªå·±é¡µé¢ä¸Šæœ‰éªŒè¯ç çš„ç­”æ¡ˆï¼Œï¼ˆè™½ç„¶éšè—çš„å¾ˆå¥½ï¼‰æ‰€ä»¥è®©éªŒè¯ç æ ¹æœ¬å°±æ²¡æœ‰ç”¨ã€‚
ä¸è¦åšç±»ä¼¼çš„äº‹æƒ…ã€‚å†å¼ºè°ƒä¸€æ¬¡ï¼Œç”¨åƒ reCaptcha çš„æœåŠ¡ï¼Œä½ å°†ä¸ä¼šæœ‰ç±»ä¼¼çš„é—®é¢˜ï¼ˆå¦‚æœä½ æ­£ç¡®åœ°ä½¿ç”¨å®ƒï¼‰&lt;/li>
&lt;/ul>
&lt;h3 id="å°†ä½ çš„æ–‡å­—è½¬ä½å›¾ç‰‡">å°†ä½ çš„æ–‡å­—è½¬ä½å›¾ç‰‡&lt;/h3>
&lt;p>ä½ å¯ä»¥åœ¨æœåŠ¡ç«¯å°†æ–‡å­—æ¸²æŸ“æˆå›¾ç‰‡æ˜¾ç¤ºï¼Œä»–å°†é˜²æ­¢ç®€å•çš„çˆ¬è™«å»è·å–æ–‡å­—å†…å®¹ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼Œè¿™ä¸ªå¯¹äºå±å¹•é˜…è¯»å™¨ã€æœç´¢å¼•æ“ã€æ€§èƒ½è¿˜æœ‰ä¸€äº›å…¶ä»–ä¸€äº›äº‹æƒ…éƒ½ä¸å¤ªå¥½ã€‚
è¿™ä¸ªåœ¨æŸäº›æ–¹é¢ä¹Ÿæ˜¯ä¸è¿æ³•çš„ï¼ˆæºäºè®¿é—®æ€§é—®é¢˜ï¼Œeg. the Americans with Disabilities Actï¼‰ï¼Œè€Œä¸”å¯¹äºä¸€äº› OCR çˆ¬è™«ä¹Ÿèƒ½éå¸¸ç®€å•çš„è§„é¿ï¼Œæ‰€ä»¥ä¸è¦é‡‡ç”¨è¿™ç§æ–¹å¼ã€‚&lt;/p>
&lt;p>ä½ ä¹Ÿå¯ä»¥ç”¨ CSS sprites åšç±»ä¼¼çš„äº‹æƒ…ï¼Œä½†æ˜¯ä¹Ÿæœ‰ç›¸åŒçš„é—®é¢˜ã€‚&lt;/p>
&lt;h3 id="ä¸è¦æš´éœ²ä½ å®Œæ•´çš„æ•°æ®">ä¸è¦æš´éœ²ä½ å®Œæ•´çš„æ•°æ®&lt;/h3>
&lt;p>å¦‚æœå¯ä»¥çš„è¯ï¼Œä¸è¦è®©è„šæœ¬/çˆ¬è™«èƒ½è·å–ä½ æ‰€æœ‰çš„æ•°æ®ã€‚ä¸¾ä¸ªä¾‹å­ï¼šä½ æœ‰ä¸€ä¸ªæ–°é—»ç«™ï¼Œæœ‰å¤§é‡çš„ä¸ªäººæ–‡ç« ã€‚
ä½ åº”è¯¥ç¡®ä¿æ–‡ç« åªèƒ½é€šè¿‡ä½ è‡ªå·±ç½‘ç«™çš„æœç´¢åˆ°ï¼Œå¦‚æœä½ ç½‘ç«™ä¸æ˜¯åˆ°å¤„éƒ½æœ‰ä½ çš„æ–‡ç« è¿˜æœ‰é“¾æ¥ï¼Œé‚£ä¹ˆç¡®ä¿å®ƒä»¬åªèƒ½è¢«æœç´¢åŠŸèƒ½è®¿é—®åˆ°ã€‚
è¿™æ„å‘³ç€å¦‚æœä¸€ä¸ªè„šæœ¬æƒ³è¦è·å–ä½ ç½‘ç«™çš„æ‰€æœ‰æ–‡ç« ï¼Œå°±å¿…é¡»é€šè¿‡ä½ ç«™ç‚¹æ–‡ç« ä¸­æ‰€æœ‰å¯èƒ½çš„çŸ­è¯­å»è¿›è¡Œæœç´¢ï¼Œä»è€Œè·å–æ‰€æœ‰çš„æ–‡ç« åˆ—è¡¨ï¼Œä½†æ˜¯è¿™ä¸ªä¼šéå¸¸è€—æ—¶ï¼Œè€Œä¸”ä½æ•ˆï¼Œä»è€Œè®©çˆ¬è™«æ”¾å¼ƒã€‚&lt;/p>
&lt;p>ä»¥ä¸‹æ“ä½œä¼šè®©ä½ å®Œå…¨æš´éœ²ï¼š&lt;/p>
&lt;ul>
&lt;li>çˆ¬è™«/è„šæœ¬å¹¶ä¸æƒ³/éœ€è¦è·å–æ‰€æœ‰çš„æ•°æ®&lt;/li>
&lt;li>ä½ ç«™ç‚¹æ–‡ç« çš„é“¾æ¥çœ‹èµ·æ¥æ˜¯è¿™ç§æ–¹å¼ &lt;code>example.com/article.php?articleId=12345&lt;/code>ï¼Œè¿™æ ·åšï¼ˆæˆ–ç±»ä¼¼çš„å…¶ä»–åšæ³•ï¼‰ä¼šè®©çˆ¬è™«å¾ˆç®€å•çš„è¿­ä»£ &lt;code>articleID&lt;/code> å°±èƒ½è·å–ä½ æ‰€æœ‰çš„æ–‡ç« &lt;/li>
&lt;li>è¿˜æœ‰ä¸€äº›å…¶ä»–æ–¹å¼è·å–æ‰€æœ‰çš„æ–‡ç« ï¼Œæ¯”å¦‚å†™ä¸€ä¸ªè„šæœ¬å»é€’å½’çš„çˆ¬å–ä½ æ–‡ç« ä¸­å…¶ä»–æ–‡ç« çš„é“¾æ¥&lt;/li>
&lt;li>æœç´¢ä¸€äº›å¸¸ç”¨çš„è¯æ¯”å¦‚ &amp;ldquo;ä¸€&amp;rdquo; æˆ–è€… &amp;ldquo;çš„&amp;rdquo; å°†ä¼šæš´éœ²å‡ ä¹æ‰€æœ‰çš„å†…å®¹ã€‚æ‰€ä»¥è¿™ç‚¹æ˜¯è¦æ³¨æ„çš„ï¼ˆä½ å¯ä»¥é€šè¿‡åªè¿”å› top 10 æˆ– top 20 æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼‰&lt;/li>
&lt;li>ä½ çš„æ–‡ç« éœ€è¦è¢«æœç´¢å¼•æ“æ”¶å½•&lt;/li>
&lt;/ul>
&lt;h3 id="ä¸è¦æš´éœ²ä½ çš„-apièŠ‚ç‚¹æˆ–å…¶ä»–ç±»ä¼¼çš„ä¸œè¥¿">ä¸è¦æš´éœ²ä½ çš„ APIã€èŠ‚ç‚¹æˆ–å…¶ä»–ç±»ä¼¼çš„ä¸œè¥¿&lt;/h3>
&lt;p>ç¡®ä¿ä½ ä¸ä¼šæš´éœ²ä½ çš„ä»»ä½• APIï¼Œå¾ˆå¤šæ—¶å€™éƒ½æ˜¯æ— æ„é—´æš´éœ²ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨ AJAX æˆ– Adobe Flash çš„ç½‘ç»œè¯·æ±‚ æˆ– Java Appletï¼ˆåƒä¸‡ä¸è¦ç”¨ï¼ï¼‰æ¥åŠ è½½ä½ çš„æ•°æ®ï¼Œ
ä»è¿™äº›ç½‘ç»œè¯·æ±‚ä¸­æ‰¾åˆ°è¦è¯·æ±‚çš„ API ååˆ†ç®€å•ï¼Œæ¯”å¦‚å¯ä»¥è¿›è¡Œåç¼–è¯‘ç„¶ååœ¨çˆ¬è™«ç¨‹åºä¸­ä½¿ç”¨è¿™äº›æ¥å£ã€‚ç¡®ä¿ä½ æ··æ·†äº†ä½ çš„ API å¹¶ä¸”å…¶ä»–äººè¦ç”¨å®ƒä¼šéå¸¸éš¾ç ´è§£ã€‚&lt;/p>
&lt;h2 id="é˜»æ­¢-html-è§£æå™¨å’Œçˆ¬å–å™¨">é˜»æ­¢ HTML è§£æå™¨å’Œçˆ¬å–å™¨&lt;/h2>
&lt;p>ç”±äº HTML è§£æå™¨æ˜¯é€šè¿‡åˆ†æé¡µé¢ç‰¹å®šç»“æ„å»è·å–å†…å®¹ï¼Œæˆ‘ä»¬å¯ä»¥æ•…æ„ä¿®æ”¹è¿™äº›ç»“æ„æ¥é˜»æ­¢è¿™ç±»çˆ¬è™«ï¼Œç”šè‡³ä»æ ¹æœ¬ä¸Šä»–ä»¬è·å–å†…å®¹ã€‚
ä¸‹é¢å¤§å¤šæ•°åšæ³•å¯¹å…¶ä»–ç±»å‹çˆ¬è™«å¦‚æœç´¢å¼•æ“èœ˜è››ã€å±å¹•çˆ¬è™«ä¹Ÿæœ‰æ•ˆã€‚&lt;/p>
&lt;h3 id="ç»å¸¸ä¿®æ”¹ä½ çš„-html-ç»“æ„">ç»å¸¸ä¿®æ”¹ä½ çš„ HTML ç»“æ„&lt;/h3>
&lt;p>å¤„ç† HTML çš„çˆ¬è™«é€šè¿‡åˆ†æç‰¹å®šå¯è¯†åˆ«çš„éƒ¨åˆ†æ¥å¤„ç† HTMLã€‚ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ æ‰€æœ‰çš„é¡µé¢éƒ½æœ‰ id ä¸º &lt;code>article-content&lt;/code> çš„ &lt;code>div&lt;/code>ç»“æ„ï¼Œç„¶åé‡Œé¢æœ‰ä½ çš„æ–‡ç« å†…å®¹ï¼Œ
é‚£è¦è·å–ä½ ç«™ç‚¹æ‰€æœ‰æ–‡ç« å†…å®¹æ˜¯ååˆ†ç®€å•çš„ï¼Œåªè¦è§£æé‚£ä¸ª &lt;code>article-content&lt;/code> é‚£ä¸ª &lt;code>div&lt;/code> å°±å¯ä»¥äº†ï¼Œç„¶åæœ‰è¿™ä¸ªç»“æ„çš„çˆ¬è™«å°±å¯ä»¥æŠŠä½ çš„æ–‡ç« éšä¾¿ç”¨åœ¨ä»€ä¹ˆåœ°æ–¹ã€‚&lt;/p>
&lt;p>å¦‚æœä½ å¸¸å¸¸ä¿®æ”¹ HTML è¿˜æœ‰ä½ é¡µé¢çš„ç»“æ„ï¼Œ é‚£è¿™ç±»çˆ¬è™«å°±ä¸èƒ½ä¸€ç›´ä½¿ç”¨ã€‚&lt;/p>
&lt;ul>
&lt;li>ä½ å¯ä»¥ç»å¸¸ä¿®æ”¹ä½  HTML çš„ &lt;code>id&lt;/code> å’Œ &lt;code>class&lt;/code>ï¼Œç”šè‡³è®©ä»–èƒ½è‡ªåŠ¨æ”¹å˜ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„ &lt;code>div.article-content&lt;/code> å˜æˆ &lt;code>div.a4c36dda13eaf0&lt;/code>ï¼Œè€Œä¸”æ¯å‘¨éƒ½ä¼šå˜åŒ–ï¼Œ
é‚£ä¹ˆçˆ¬è™«ä¸€å¼€å§‹å¯èƒ½èƒ½æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯ä¸€å‘¨ä¹‹åå°±ä¸èƒ½ä½¿ç”¨äº†ã€‚åŒæ—¶ä¹Ÿç¡®ä¿ä¿®æ”¹ä½  id/classçš„é•¿åº¦ï¼Œè¿™æ ·ä¹Ÿå¯ä»¥é¿å…çˆ¬è™«ä½¿ç”¨ç±»ä¼¼ &lt;code>div.[any-14-characters]&lt;/code> æ¥æ‰¾åˆ°æƒ³è¦çš„ &lt;code>div&lt;/code>ã€‚&lt;/li>
&lt;li>å¦‚æœæ— æ³•ä»æ ‡è®°ä¸­æ‰¾åˆ°æ‰€éœ€çš„å†…å®¹ï¼Œåˆ™æŠ“å–å·¥å…·å°†é€šè¿‡HTMLçš„ç»“æ„æ–¹å¼è¿›è¡ŒæŸ¥æ‰¾ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ çš„æ‰€æœ‰æ–‡ç« éƒ½æœ‰ç±»ä¼¼çš„ç»“æ„ï¼Œæ¯”å¦‚æ¯ä¸ª &lt;code>div&lt;/code>ï¼Œå¹¶ä¸”é‡Œé¢é€šè¿‡ &lt;code>h1&lt;/code>
æ”¾æ–‡ç« çš„æ ‡é¢˜ï¼Œçˆ¬è™«å°†åŸºäºè¿™ä¸ªç»“æ„è·å–æ–‡ç« å†…å®¹ã€‚åŒæ ·çš„ï¼Œä¸ºäº†é˜²æ­¢è¿™ä¸ªï¼Œä½ å¯ä»¥åœ¨ä½ çš„ HTML æ·»åŠ /åˆ é™¤ é¢å¤–çš„æ ‡è®°ï¼Œå‘¨æœŸå¹¶ä¸”éšæœºçš„åšï¼Œeg. æ·»åŠ é¢å¤–çš„ &lt;code>div&lt;/code> æˆ– &lt;code>span&lt;/code>ã€‚å¯¹äºæœåŠ¡ç«¯æ¸²æŸ“çš„ç¨‹åºï¼Œè¿™åº”è¯¥ä¸ä¼šå¾ˆéš¾ã€‚&lt;/li>
&lt;/ul>
&lt;h4 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h4>
&lt;ul>
&lt;li>å®ƒçš„å®ç°ã€ç»´æŠ¤å’Œè°ƒè¯•éƒ½æ˜¯å¾ˆå¤æ‚å›°éš¾çš„&lt;/li>
&lt;li>ä½ è¦æ³¨æ„ç¼“å­˜ã€‚ç‰¹åˆ«æ˜¯ä½ ä¿®æ”¹ä½  HTML å…ƒç´ çš„ id æˆ– class æ—¶ï¼Œä¹Ÿè¦å»ä¿®æ”¹ç›¸åº”çš„ CSS å’Œ JavaScript
æ–‡ä»¶ï¼Œè¿™æ„å‘³ç€æ¯æ¬¡ä¿®æ”¹éƒ½è¦ä¿®æ”¹è¿™äº›ï¼Œè€Œæµè§ˆå™¨æ¯æ¬¡éƒ½è¦é‡æ–°ä¸‹è½½ä»–ä»¬ã€‚è¿™å°†å¯¼è‡´é¡µé¢æ‰“å¼€æ…¢ä¹Ÿä¼šå¯¼è‡´æœåŠ¡ç«¯è´Ÿè½½å‡é«˜ã€‚ä¸è¿‡è¿™ä¹Ÿä¸æ˜¯ä¸€ä¸ªå¤§é—®é¢˜ï¼Œå¦‚æœä½ åªæ˜¯ä¸€ä¸ªæ˜ŸæœŸæ”¹å˜ä¸€æ¬¡ã€‚&lt;/li>
&lt;li>èªæ˜çš„çˆ¬è™«ä»ç„¶èƒ½æ¨æ–­å‡ºä½ æ–‡ç« çš„ä½ç½®ï¼Œæ¯”å¦‚ï¼Œé¡µé¢ä¸Šå¤§å—çš„æ–‡æœ¬å¤§æ¦‚ç‡æ˜¯æ–‡ç« å†…å®¹ã€‚è¿™ä¸ªè®©çˆ¬è™«ä»é¡µé¢æ‰¾åˆ°ã€è·å–æƒ³è¦çš„æ•°æ®ã€‚ &lt;a href="https://code.google.com/archive/p/boilerpipe/">Boilerpipe&lt;/a>
å°±æ˜¯è¿™æ ·åšçš„ã€‚&lt;/li>
&lt;/ul>
&lt;p>æœ¬è´¨ä¸Šæ¥è¯´ï¼Œå°±æ˜¯ç¡®ä¿çˆ¬è™«ä»ç›¸ä¼¼é¡µé¢è·å–æƒ³è¦çš„å†…å®¹å˜å¾—ä¸é‚£ä¹ˆå®¹æ˜“ã€‚&lt;/p>
&lt;p>å¯ä»¥å‚è€ƒè¿™ä¸ª PHP
çš„å®ç°ï¼š&lt;a href="http://stackoverflow.com/questions/30361740/">How to prevent crawlers depending on XPath from getting page contents&lt;/a>&lt;/p>
&lt;h3 id="åŸºäºç”¨æˆ·åœ°ç†ä½ç½®ä¿®æ”¹-html">åŸºäºç”¨æˆ·åœ°ç†ä½ç½®ä¿®æ”¹ HTML&lt;/h3>
&lt;p>è¿™ä¸ªå’Œå‰ä¸€ä¸ªç±»ä¼¼ã€‚å¦‚æœä½ æ ¹æ®ä¸åŒç”¨æˆ·çš„ä½ç½®/å›½å®¶ï¼ˆæ ¹æ® IP è·å–ï¼‰æ¥æä¾›ä¸åŒçš„ HTMLï¼Œè¿™ä¸ªå¯èƒ½ä¼šç ´åå°†ç«™ç‚¹ HTML ç»™ç”¨æˆ·çš„çˆ¬è™«ã€‚æ¯”å¦‚ï¼Œå¦‚æœæœ‰äººå†™äº†ä¸€ä¸ªç§»åŠ¨ APP
æ¥æŠ“å–ä½ çš„ç«™ç‚¹ï¼Œä¸€å¼€å§‹å¯ä»¥ç”¨ï¼Œä½†æ˜¯å¯¹äºä¸åŒåœ°åŒºçš„ç”¨æˆ·å°±ä¸èµ·ä½œç”¨äº†ï¼Œå› ä¸ºä»–ä»¬ä¼šè·å–åˆ°ä¸åŒçš„ HTML ç»“æ„ï¼ŒåµŒå…¥å¼çš„ HTML å°†ä¸ä¸èƒ½æ­£å¸¸ä½¿ç”¨ã€‚&lt;/p>
&lt;h3 id="ç»å¸¸æ”¹å˜-htmlå¹¶ä¸çˆ¬è™«æ–—æ™ºæ–—å‹‡">ç»å¸¸æ”¹å˜ HTMLï¼Œå¹¶ä¸çˆ¬è™«æ–—æ™ºæ–—å‹‡ï¼&lt;/h3>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼šä½ æœ‰ä¸€ä¸ªåŒ…å«æœç´¢åŠŸèƒ½çš„ç½‘ç«™ï¼Œ&lt;code>example.com/search?query=somesearchquery&lt;/code> çš„æœç´¢ç»“æœæ˜¯ä¸‹é¢çš„ HTML ç»“æ„ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-html" data-lang="html">
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h3&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-title&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Stack Overflow has become the world&amp;#39;s most popular programming Q &lt;span class="err">&amp;amp;&lt;/span> A website&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h3&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-excerpt&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>The website Stack Overflow has now become the most popular programming Q &lt;span class="err">&amp;amp;&lt;/span> A
website, with 10 million questions and many users, which...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="na">search-result-link&lt;/span>&lt;span class="err">&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/stories/stack-overflow-has-become-the-most-popular&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Read more&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
(And so on, lots more identically structured divs with search results)
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä½ å¯ä»¥çŒœåˆ°è¿™ä¸ªéå¸¸å®¹æ˜“çˆ¬å–ï¼šä¸€ä¸ªçˆ¬è™«éœ€è¦åšçš„å°±åªæ˜¯è®¿é—®æœç´¢é“¾æ¥ï¼Œç„¶åä»è¿”å›çš„ HTML åˆ†ææƒ³è¦çš„æ•°æ®ã€‚é™¤äº†å®šæœŸä¿®æ”¹ä¸Šé¢ HTML çš„å†…å®¹ï¼Œ
ä½ ä¹Ÿå¯ä»¥&lt;strong>ä¿ç•™æ—§ç»“æ„çš„ id å’Œ classï¼Œç„¶åä½¿ç”¨ CSS è¿›è¡Œéšè—ï¼Œå¹¶ä½¿ç”¨å‡æ•°æ®è¿›è¡Œå¡«å……ï¼Œä»è€Œç»™çˆ¬è™«æŠ•æ¯’&lt;/strong>ã€‚æ¯”å¦‚åƒä¸‹é¢è¿™æ ·ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-html" data-lang="html">
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;the-real-search-result&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h3&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;the-real-search-result-title&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Stack Overflow has become the world&amp;#39;s most popular programming Q &lt;span class="err">&amp;amp;&lt;/span> A
website&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h3&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;the-real-search-result-excerpt&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>The website Stack Overflow has now become the most popular programming Q &lt;span class="err">&amp;amp;&lt;/span>
A website, with 10 million questions and many users, which...&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="na">the-real-search-result-link&lt;/span>&lt;span class="err">&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/stories/stack-overflow-has-become-the-most-popular&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Read more&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;display:none&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h3&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-title&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Visit example.com now, for all the latest Stack Overflow related news !&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h3&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-excerpt&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>EXAMPLE.COM IS SO AWESOME, VISIT NOW! (Real users of your site will never see this,
only the scrapers will.)&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="na">search-result-link&lt;/span>&lt;span class="err">&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;http://example.com/&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>Visit Now !&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
(More real search results follow)
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>è¿™æ„å‘³ç€åŸºäº id æˆ– class è·å–ç‰¹å®šæ•°æ®çš„çˆ¬è™«ä»ç„¶èƒ½ç»§ç»­å·¥ä½œï¼Œä½†æ˜¯ä»–ä»¬å°†ä¼šè·å–å‡æ•°æ®ç”šè‡³å¹¿å‘Šï¼Œè€Œè¿™äº›æ•°æ®çœŸå®ç”¨æˆ·æ˜¯çœ‹ä¸åˆ°çš„ï¼Œå› ä¸ºä»–ä»¬è¢« CSS éšè—äº†ã€‚&lt;/p>
&lt;h3 id="ä¸çˆ¬è™«æ–—æ™ºæ–—å‹‡åœ¨é¡µé¢æ’å…¥å‡çš„ä¸å¯è§çš„èœœç½æ•°æ®">ä¸çˆ¬è™«æ–—æ™ºæ–—å‹‡ï¼šåœ¨é¡µé¢æ’å…¥å‡çš„ã€ä¸å¯è§çš„èœœç½æ•°æ®&lt;/h3>
&lt;p>å¯¹ä¸Šä¸ªä¾‹å­è¿›è¡Œè¡¥å……ï¼Œä½ å¯ä»¥åœ¨ä½ çš„ HTML é‡Œé¢å¢åŠ ä¸å¯è§çš„èœœç½æ•°æ®æ¥æŠ“ä½çˆ¬è™«ã€‚ä¸‹é¢çš„ä¾‹å­æ¥è¡¥å……ä¹‹å‰è¯´çš„æœç´¢ç»“æœï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-html" data-lang="html">
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">div&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result&amp;#34;&lt;/span> &lt;span class="na">style&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;display:none&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">h3&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-title&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>This search result is here to prevent scraping&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">h3&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">p&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;search-result-excerpt&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>If you&amp;#39;re a human and see this, please ignore it. If you&amp;#39;re a scraper, please click
the link below :-)
Note that clicking the link below will block access to this site for 24 hours.&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">p&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;&lt;/span>&lt;span class="nt">a&lt;/span> &lt;span class="na">class&lt;/span>&lt;span class="err">&amp;#34;&lt;/span>&lt;span class="na">search-result-link&lt;/span>&lt;span class="err">&amp;#34;&lt;/span> &lt;span class="na">href&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="s">&amp;#34;/scrapertrap/scrapertrap.php&amp;#34;&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>I&amp;#39;m a scraper !&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">a&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
&lt;span class="p">&amp;lt;/&lt;/span>&lt;span class="nt">div&lt;/span>&lt;span class="p">&amp;gt;&lt;/span>
(The actual, real, search results follow.)
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸€ä¸ªæ¥è·å–æ‰€æœ‰å†…å®¹çš„çˆ¬è™«å°†ä¼šè¢«æ‰¾åˆ°ï¼Œå°±åƒè·å–å…¶ä»–ç»“æœä¸€æ ·ï¼Œè®¿é—®é“¾æ¥ï¼ŒæŸ¥æ‰¾æƒ³è¦çš„å†…å®¹ã€‚ä¸€ä¸ªçœŸäººå°†ä¸ä¼šçœ‹åˆ°ï¼ˆå› ä¸ºä½¿ç”¨ CSS
éšè—ï¼‰ï¼Œè€Œä¸”æ›´ä¸ä¼šè®¿é—®è¿™ä¸ªé“¾æ¥ã€‚è€Œæ­£è§„æˆ–è€…æœŸæœ›çš„èœ˜è››æ¯”å¦‚è°·æ­Œçš„èœ˜è››å°†ä¸ä¼šè®¿é—®è¿™ä¸ªé“¾æ¥ï¼Œå› ä¸ºä½ å¯ä»¥å°† &lt;code>/scrapertrap/&lt;/code> åŠ å…¥ä½ çš„ robots.txt ä¸­ï¼ˆä¸è¦å¿˜è®°å¢åŠ ï¼‰&lt;/p>
&lt;p>ä½ å¯ä»¥è®©ä½ çš„ &lt;code>scrapertrap.php&lt;/code> åšä¸€äº›æ¯”å¦‚é™åˆ¶è¿™ä¸ª IP è®¿é—®çš„äº‹æƒ…ï¼Œæˆ–è€…å¼ºåˆ¶è¿™ä¸ª IP ä¹‹åçš„è¯·æ±‚å‡ºéªŒè¯ç ã€‚&lt;/p>
&lt;ul>
&lt;li>ä¸è¦å¿˜è®°åœ¨ä½ çš„ robots.txt ä¸­æ·»åŠ ç¦æ­¢è®¿é—® &lt;code>/scrapertrap/&lt;/code> çš„è§„åˆ™é¿å…æ‰€æœ‰çš„æœç´¢å¼•æ“ä¸ä¼šä¸­æ‹›&lt;/li>
&lt;li>ä½ å¯ä»¥/åº”è¯¥å’Œä¸Šä¸ªç»å¸¸æ›´æ¢ HTML ç»“æ„çš„ä¾‹å­ä¸€èµ·ä½¿ç”¨&lt;/li>
&lt;li>ä¹Ÿè¦ç»å¸¸ä¿®æ”¹å®ƒï¼Œå› ä¸ºçˆ¬è™«å¯èƒ½ä¼šå‘¨æœŸæ€§çš„äº†è§£å¹¶ä¸å»è®¿é—®å®ƒã€‚ä¿®æ”¹èœœç½ URL å’Œæ–‡æœ¬ã€‚
åŒæ—¶è¦è€ƒè™‘ä½¿ç”¨ id å±æ€§æˆ–å¤–éƒ¨çš„ CSS æ¥å–ä»£å†…è”çš„ CSSï¼Œè¦ä¸ç„¶çˆ¬è™«å°†ä¼šå­¦ä¼šé˜²æ­¢çˆ¬å–æ‰€æœ‰åŒ…å«éšè—å±æ€§ &lt;code>style&lt;/code> çš„èŠ‚ç‚¹ã€‚
å¹¶ä¸”åªæ˜¯å¶å°”å¯ç”¨å®ƒï¼Œ è¿™æ ·çˆ¬è™«ä¸€å¼€å§‹æ­£å¸¸å·¥ä½œï¼Œä½†æ˜¯è¿‡æ®µæ—¶é—´å°±ä¸èµ·ä½œç”¨ã€‚è¿™ä¸ªåŒæ ·ä¹Ÿé€‚ç”¨äºä¸Šä¸ªä¾‹å­ã€‚&lt;/li>
&lt;li>è¦æ³¨æ„å¯èƒ½ä¼šæœ‰æ¶æ„çš„äººåœ¨è®ºå›å‘å¸ƒåƒ &lt;code>[img]http://yoursite.com/scrapertrap/scrapertrap.php[img]&lt;/code>ï¼Œ
ç„¶åå½“æ­£å¸¸ç”¨æˆ·è®¿é—®è½®ç„¶ç„¶åç‚¹å‡»åˆ°ä½ çš„èœœç½é“¾æ¥ã€‚æ‰€ä»¥ä¸Šä¸ªæ³¨æ„äº‹é¡¹ä¸­ç»å¸¸æ›´æ¢ä½ çš„èœœç½é“¾æ¥æ˜¯éå¸¸é‡è¦çš„ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æ£€æŸ¥ Refererã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="å½“è¯†åˆ«ä¸ºçˆ¬è™«æ—¶æä¾›å‡çš„æˆ–æ— ç”¨çš„æ•°æ®">å½“è¯†åˆ«ä¸ºçˆ¬è™«æ—¶ï¼Œæä¾›å‡çš„æˆ–æ— ç”¨çš„æ•°æ®&lt;/h3>
&lt;p>å¦‚æœä½ ç¡®å®šæŸä¸ªè®¿é—®æ˜¯çˆ¬è™«ï¼Œä½ å¯ä»¥æä¾›å‡çš„æˆ–è€…æ— ç”¨çš„æ•°æ®ï¼›è¿™å°†ç ´åçˆ¬è™«ä»ä½ ç½‘ç«™è·å–çš„æ•°æ®ã€‚
ä½ è¿˜åº”è¯¥æŠŠå®ƒå’ŒçœŸå®æ•°æ®è¿›è¡Œæ··æ·†ï¼Œè¿™æ ·çˆ¬è™«å°±ä¸çŸ¥é“ä»–ä»¬è·å–çš„åˆ°åº•æ˜¯çœŸçš„è¿˜æ˜¯å‡çš„æ•°æ®ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼šå¦‚æœä½ æœ‰ä¸€ä¸ªæ–°é—»ç«™ï¼Œä½ æ£€æµ‹åˆ°äº†ä¸€ä¸ªçˆ¬è™«ï¼Œä¸è¦å»ç›´æ¥å°ç¦å®ƒï¼Œ
è€Œæ˜¯æä¾›å‡çš„æˆ–è€… &lt;a href="https://en.wikipedia.org/wiki/Markov_chain#Markov_text_generators">éšæœºç”Ÿæˆ&lt;/a>
çš„æ–‡ç« ï¼Œé‚£çˆ¬è™«è·å–çš„æ•°æ®å°†ä¼šè¢«ç ´åã€‚å¦‚æœä½ å°†å‡æ•°æ®å’ŒçœŸå®çš„æ•°æ®è¿›è¡Œæ··æ·†ï¼Œé‚£çˆ¬è™«å¾ˆéš¾è·å–åˆ°ä»–ä»¬æƒ³è¦çš„çœŸå®æ–‡ç« ã€‚&lt;/p>
&lt;h3 id="ä¸è¦æ¥å—æ²¡æœ‰-useragent-çš„è¯·æ±‚">ä¸è¦æ¥å—æ²¡æœ‰ UserAgent çš„è¯·æ±‚&lt;/h3>
&lt;p>å¾ˆå¤šæ‡’æƒ°çš„ç¨‹åºå‘˜ä¸ä¼šåœ¨ä»–ä»¬çš„çˆ¬è™«å‘è¯·æ±‚æ—¶å¸¦ä¸Š UserAgentï¼Œè€Œæ‰€æœ‰çš„æµè§ˆå™¨åŒ…æ‹¬æœç´¢å¼•æ“èœ˜è››éƒ½ä¼šæºå¸¦ã€‚&lt;/p>
&lt;p>å¦‚æœè¯·æ±‚ä½ æ—¶æ²¡æœ‰æºå¸¦ UserAgent header å¤´ï¼Œä½ å¯ä»¥å±•ç¤ºéªŒè¯ç ï¼Œæˆ–è€…ç›´æ¥å°ç¦æˆ–è€…é™åˆ¶è®¿é—®ï¼ˆæˆ–è€…åƒä¸Šé¢è¯´çš„æä¾›å‡æ•°æ®æˆ–è€…å…¶ä»–çš„ï¼‰&lt;/p>
&lt;p>è¿™ä¸ªéå¸¸ç®€å•å»é¿å…ï¼Œä½†æ˜¯ä½œä¸ºä¸€ç§é’ˆå¯¹ä¹¦å†™ä¸å½“çš„çˆ¬è™«ï¼Œæ˜¯å€¼å¾—å»åšçš„ã€‚&lt;/p>
&lt;h3 id="ä¸è¦æ¥å—-useragent-æ˜¯é€šç”¨çˆ¬è™«æˆ–åœ¨çˆ¬è™«é»‘åå•çš„è¯·æ±‚">ä¸è¦æ¥å— UserAgent æ˜¯é€šç”¨çˆ¬è™«æˆ–åœ¨çˆ¬è™«é»‘åå•çš„è¯·æ±‚&lt;/h3>
&lt;p>å¾ˆå¤šæƒ…å†µä¸‹ï¼Œçˆ¬è™«å°†ä¼šä½¿ç”¨çœŸå®æµè§ˆå™¨æˆ–æœç´¢å¼•æ“çˆ¬è™«ç»å¯¹ä¸ä¼šä½¿ç”¨çš„ UserAgentï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;ul>
&lt;li>&amp;ldquo;Mozilla&amp;rdquo; ï¼ˆå°±åªæœ‰è¿™ä¸ªï¼Œæˆ‘æ›¾ç»çœ‹åˆ°è¿‡ä¸€äº›çˆ¬è™«çš„é—®é¢˜ç”¨è¿™ä¸ªï¼Œä½†çœŸå®æµè§ˆå™¨ç»å¯¹ä¸ä¼šç”¨ï¼‰&lt;/li>
&lt;li>&amp;ldquo;Java 1.7.43_u43&amp;rdquo; ï¼ˆJava çš„ HttpUrlConnection çš„é»˜è®¤ UserAgentï¼‰&lt;/li>
&lt;li>&amp;ldquo;BIZCO EasyScraping Studio 2.0&amp;rdquo;&lt;/li>
&lt;li>&amp;ldquo;wget&amp;rdquo;, &amp;ldquo;curl&amp;rdquo;, &amp;ldquo;libcurl&amp;rdquo;,.. ï¼ˆåŸºç¡€çˆ¬è™«æœ‰æ—¶å€™ä¼šç”¨ Wget å’Œ cURLï¼‰&lt;/li>
&lt;/ul>
&lt;p>å¦‚æœä½ å‘ç°ä¸€äº›çˆ¬è™«ä½¿ç”¨çœŸå®æµè§ˆå™¨æˆ–åˆæ³•èœ˜è››ç»å¯¹ä¸ä¼šä½¿ç”¨çš„ UserAgentï¼Œä½ å¯ä»¥å°†å…¶æ·»åŠ åˆ°ä½ çš„é»‘åå•ä¸­ã€‚&lt;/p>
&lt;h3 id="æ£€æŸ¥-referer-header-å¤´">æ£€æŸ¥ Referer header å¤´&lt;/h3>
&lt;p>å¯¹ä¸Šä¸€ç« èŠ‚çš„è¡¥å……ï¼Œä½ ä¹Ÿå¯ä»¥æ£€æŸ¥ &lt;a href="https://en.wikipedia.org/wiki/HTTP_referer">Referer&lt;/a>
ï¼ˆæ˜¯çš„ï¼Œå®ƒæ˜¯ Refererï¼Œè€Œä¸æ˜¯ Referrerï¼‰ï¼Œ ä¸€äº›æ‡’æƒ°çš„çˆ¬è™«å¯èƒ½ä¸ä¼šæºå¸¦çš„è¿™ä¸ªï¼Œæˆ–è€…åªæ˜¯æ¯æ¬¡éƒ½æºå¸¦ä¸€æ ·çš„ï¼ˆæœ‰æ—¶å€™æ˜¯ â€œgoogle.comâ€ï¼‰ã€‚
ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœç”¨æˆ·æ˜¯ä»ç«™å†…æœç´¢ç»“æœé¡µç‚¹å‡»è¿›å…¥æ–‡ç« è¯¦æƒ…çš„ï¼Œé‚£è¦æ£€æŸ¥ Referer è¿™ä¸ª header å¤´æ˜¯å¦å­˜åœ¨è¿˜è¦çœ‹æœç´¢ç»“æœé¡µçš„æ‰“ç‚¹ã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>çœŸå®æµè§ˆå™¨å¹¶ä¸æ€»æ˜¯æºå¸¦ Refererï¼›&lt;/li>
&lt;li>å¾ˆå®¹æ˜“è¢«é¿å…&lt;/li>
&lt;/ul>
&lt;p>è¿˜æ˜¯ï¼Œä½œä¸ºä¸€ç§é˜²æ­¢ç®€å•çˆ¬è™«çš„æ–¹æ³•ï¼Œä¹Ÿå€¼å¾—å»å®ç°ã€‚&lt;/p>
&lt;h3 id="å¦‚æœä¸è¯·æ±‚èµ„æºcssimageså®ƒå¯èƒ½ä¸æ˜¯çœŸå®æµè§ˆå™¨">å¦‚æœä¸è¯·æ±‚èµ„æºï¼ˆCSSï¼Œimagesï¼‰ï¼Œå®ƒå¯èƒ½ä¸æ˜¯çœŸå®æµè§ˆå™¨&lt;/h3>
&lt;p>ä¸€ä¸ªçœŸå®æµè§ˆå™¨ï¼ˆé€šå¸¸ï¼‰ä¼šè¯·æ±‚å’Œä¸‹è½½èµ„æºæ¯”å¦‚ CSS å’Œ å›¾ç‰‡ã€‚HTML è§£æå™¨å’Œçˆ¬å–å™¨å¯èƒ½åªå…³å¿ƒç‰¹å®šçš„é¡µé¢å’Œå†…å®¹ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥åŸºäºè®¿é—®ä½ èµ„æºçš„æ—¥å¿—ï¼Œå¦‚æœä½ çœ‹åˆ°å¾ˆå¤šè¯·æ±‚åªè¯·æ±‚ HTMLï¼Œé‚£å®ƒå¯èƒ½å°±æ˜¯çˆ¬è™«ã€‚&lt;/p>
&lt;p>æ³¨æ„æœç´¢å¼•æ“èœ˜è››ã€æ—§çš„ç§»åŠ¨è®¾å¤‡ã€å±å¹•é˜…è¯»å™¨å’Œè®¾ç½®é”™è¯¯çš„è®¾å¤‡å¯èƒ½ä¹Ÿä¸ä¼šè¯·æ±‚èµ„æºã€‚&lt;/p>
&lt;h3 id="è¦æ±‚ä½¿ç”¨-cookieä½¿ç”¨å®ƒä»¬æ¥è·Ÿè¸ªç”¨æˆ·å’Œçˆ¬è™«è¡Œä¸º">è¦æ±‚ä½¿ç”¨ Cookieï¼›ä½¿ç”¨å®ƒä»¬æ¥è·Ÿè¸ªç”¨æˆ·å’Œçˆ¬è™«è¡Œä¸º&lt;/h3>
&lt;p>è®¿é—®ä½ ç½‘ç«™æ—¶ï¼Œä½ å¯ä»¥è¦æ±‚ cookie å¿…é¡»å¼€å¯ã€‚è¿™ä¸ªèƒ½è¯†åˆ«æ²¡æœ‰ç»éªŒå’Œçˆ¬è™«æ–°æ‰‹ï¼Œç„¶è€Œçˆ¬è™«è¦æºå¸¦ Cookie ä¹Ÿååˆ†ç®€å•ã€‚å¦‚æœä½ è¦æ±‚å¼€å¯
Cookieï¼Œä½ èƒ½ä½¿ç”¨å®ƒä»¬æ¥è¿½è¸ªç”¨æˆ·å’Œçˆ¬è™«çš„è¡Œä¸ºï¼Œç„¶ååŸºäºæ­¤æ¥å®ç°é¢‘ç‡é™åˆ¶ã€å°ç¦ã€æˆ–è€…æ˜¾ç¤ºéªŒè¯ç è€Œä¸ä»…ä»…ä¾èµ– IP åœ°å€ã€‚&lt;/p>
&lt;p>ä¸¾ä¸ªä¾‹å­ï¼š å½“ç”¨æˆ·è¿›è¡Œæœç´¢æ—¶ï¼Œè®¾ç½®ä¸€ä¸ªå”¯ä¸€çš„ Cookieã€‚å½“æœç´¢ç»“æœåŠ è½½å‡ºæ¥ä¹‹åï¼ŒéªŒè¯è¿™ä¸ª Cookieã€‚
å¦‚æœä¸€ä¸ªç”¨æˆ·æ‰“å¼€äº†æ‰€æœ‰çš„æœç´¢ç»“æœï¼ˆå¯ä»¥ä» Cookie ä¸­å¾—çŸ¥ï¼‰ï¼Œé‚£å¾ˆå¯èƒ½å°±æ˜¯çˆ¬è™«&lt;/p>
&lt;p>ä½¿ç”¨ Cookie å¯èƒ½æ˜¯ä½æ•ˆçš„ï¼Œå› ä¸ºçˆ¬è™«ä¹Ÿå¯ä»¥æºå¸¦ Cookie å‘é€è¯·æ±‚ï¼Œä¹Ÿå¯ä»¥æ ¹æ®éœ€è¦ä¸¢å¼ƒã€‚
å¦‚æœä½ çš„ç½‘ç«™åªèƒ½åœ¨å¼€å¯ Cookie æ—¶ä½¿ç”¨ï¼Œä½ ä¹Ÿä¸èƒ½ç»™å…³é—­ Cookie çš„ç”¨æˆ·æä¾›æœåŠ¡ã€‚&lt;/p>
&lt;p>è¦æ³¨æ„å¦‚æœä½ ä½¿ç”¨ JavaScript å»è®¾ç½®å’Œæ£€æµ‹ Cookieï¼Œä½ èƒ½å°ç¦é‚£äº›æ²¡æœ‰è¿è¡Œ JavaScript çš„çˆ¬è™«ï¼Œå› ä¸ºå®ƒä»¬æ²¡åŠæ³•è·å–å’Œå‘é€ Cookieã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨-javascript-å’Œ-ajax-åŠ è½½å†…å®¹">ä½¿ç”¨ JavaScript å’Œ AJAX åŠ è½½å†…å®¹&lt;/h3>
&lt;p>ä½ å¯ä»¥åœ¨é¡µé¢åŠ è½½å®Œæˆä¹‹åï¼Œä½¿ç”¨ JavaScript + AJAX æ¥åŠ è½½ä½ çš„å†…å®¹ã€‚è¿™ä¸ªå¯¹äºé‚£äº›æ²¡æœ‰è¿è¡Œ JavaScript çš„ HTML åˆ†æå™¨æ¥è¯´å°†æ— æ³•å–å¾—æ•°æ®ã€‚
è¿™ä¸ªå¯¹äºæ²¡æœ‰ç»éªŒæˆ–è€…æ–°æ‰‹ç¨‹åºå‘˜å†™çš„çˆ¬è™«éå¸¸æœ‰æ•ˆã€‚&lt;/p>
&lt;p>æ³¨æ„ï¼š&lt;/p>
&lt;ul>
&lt;li>ä½¿ç”¨ JavaScript åŠ è½½å†…å®¹å°†ä¼šé™ä½ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½ï¼›&lt;/li>
&lt;li>æœç´¢å¼•æ“ä¹Ÿä¸ä¼šè¿è¡Œ JavaScriptï¼Œå› æ­¤ä¸ä¼šå¯¹ä½ çš„å†…å®¹è¿›è¡Œæ”¶å½•ã€‚è¿™å¯¹äºæœç´¢ç»“æœæ¥è¯´å¯èƒ½ä¸æ˜¯é—®é¢˜ï¼Œä½†æ˜¯è¦æ³¨æ„å…¶ä»–é¡µé¢ï¼Œæ¯”å¦‚æ–‡ç« é¡µé¢ï¼›&lt;/li>
&lt;li>å†™çˆ¬è™«çš„ç¨‹åºå‘˜è·å–åˆ°åŠ è½½å†…å®¹çš„ API åå¯ä»¥ç›´æ¥ä½¿ç”¨å®ƒ&lt;/li>
&lt;/ul>
&lt;h3 id="æ··æ·†ä½ çš„æ•°æ®å’Œç½‘ç»œè¯·æ±‚ä¸è¦è®©å…¶ç›´æ¥é€šè¿‡è„šæœ¬å°±èƒ½è·å–">æ··æ·†ä½ çš„æ•°æ®å’Œç½‘ç»œè¯·æ±‚ï¼Œä¸è¦è®©å…¶ç›´æ¥é€šè¿‡è„šæœ¬å°±èƒ½è·å–&lt;/h3>
&lt;p>å¦‚æœä½ ç”¨ Ajax å’Œ JavaScript åŠ è½½ä½ çš„æ•°æ®ï¼Œåœ¨ä¼ è¾“çš„æ—¶å€™è¦æ··æ·†ä¸€ä¸‹ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥åœ¨æœåŠ¡å™¨ç«¯ encode ä½ çš„æ•°æ®ï¼ˆæ¯”å¦‚ç®€å•çš„ä½¿ç”¨ base64 æˆ– è´Ÿè½½ä¸€äº›çš„å¤šæ¬¡æ··æ·†ã€ä½åç§»æˆ–è€…æ˜¯è¿›è¡ŒåŠ å¯†ï¼‰ï¼Œ
ç„¶ååœ¨å®¢æˆ·ç«¯åœ¨ Ajax è·å–æ•°æ®ä¹‹åå†è¿›è¡Œ decodeã€‚è¿™æ„å‘³ç€å¦‚æœæœ‰äººè¦æŠ“åŒ…è·å–ä½ çš„è¯·æ±‚å°±ä¸èƒ½ç›´æ¥çœ‹åˆ°ä½ é¡µé¢å¦‚ä½•åŠ è½½æ•°æ®ï¼Œè€Œä¸”é‚£äº›äººä¹Ÿä¸èƒ½ç›´æ¥é€šè¿‡ API è·å¾—ä½ çš„æ•°æ®ï¼Œå¦‚æœæƒ³è¦è·å–æ•°æ®ï¼Œå°±å¿…é¡»è¦å»è§£å¯†ä½ çš„ç®—æ³•ã€‚&lt;/p>
&lt;ul>
&lt;li>
&lt;p>å¦‚æœä½ ç”¨ Ajax åŠ è½½æ•°æ®ï¼Œé‚£ä½ åº”è¯¥å¼ºåˆ¶åœ¨é¡µé¢åŠ è½½ä¹‹åæ‰å¯ä»¥è·å–ï¼Œæ¯”å¦‚è¦æ±‚è·å–æ•°æ®å¿…é¡»åŒ…å« session ä¿¡æ¯ï¼Œè¿™äº›ä½ å¯ä»¥åœ¨é¡µé¢åŠ è½½çš„æ—¶å€™åµŒå…¥åˆ° JavaScript æˆ– HTML ä¸­&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½ ä¹Ÿå¯ä»¥ç›´æ¥å§æ··æ·†çš„æ•°æ®åµŒå…¥åˆ° HTML ä¸­ï¼Œç„¶åç”¨ JavaScript å»è§£å¯†ç„¶åå†æ˜¾ç¤ºå®ƒä»¬ï¼Œè¿™æ ·çš„è¯ï¼Œä½ å°±ä¸éœ€è¦å†ä½¿ç”¨ Ajax å»åšé¢å¤–çš„è¯·æ±‚ã€‚
è¿™æ ·åšå¯ä»¥è®©é‚£äº›ä¸è¿è¡Œ JavaScript çš„ HTML è§£æå™¨æ›´éš¾è·å–ä½ çš„æ•°æ®ï¼Œä»–ä»¬å¿…é¡»è¦åè§£ä½ çš„ JavaScriptï¼ˆæ²¡é”™ï¼ŒJavaScript ä¹Ÿè¦åšæ··æ·†ï¼‰&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½ åº”è¯¥ç»å¸¸æ›´æ¢æ··æ·†æ–¹æ³•ä»¥å…çˆ¬è™«æ‰¾å‡ºæ–¹æ³•æ­ç§˜å®ƒ&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>ä¸‹é¢æ˜¯ä¸€äº›è¿™ä¸ªæ–¹å¼çš„ç¼ºç‚¹ï¼š&lt;/p>
&lt;ul>
&lt;li>å®ç°ã€ç»´æŠ¤å’Œè°ƒè¯•éƒ½éå¸¸éº»çƒ¦&lt;/li>
&lt;li>&lt;strong>è™½ç„¶è®©çˆ¬è™«å˜å¾—ä¸å®¹æ˜“æŠ“å–ï¼Œä½†æ˜¯å¯¹äºæˆªå±ç±»çš„çˆ¬è™«æ¥è¯´ï¼Œå®ƒä»¬å®é™…ä¸Šä¼šè¿è¡Œ JavaScriptï¼Œæ‰€ä»¥èƒ½è·å–åˆ°æ•°æ®&lt;/strong>
ï¼ˆä¸è¿‡å¾ˆå¤šç®€å•çš„ HTML è§£é‡Šå™¨ä¸ä¼šè¿è¡Œ JavaScriptï¼‰&lt;/li>
&lt;li>å¦‚æœçœŸå®ç”¨æˆ·ç¦ç”¨äº† JavaScriptï¼Œé‚£ä½ çš„ç½‘ç«™å°†ä¸èƒ½æ­£å¸¸æ˜¾ç¤º&lt;/li>
&lt;li>æ€§èƒ½å’Œé¡µé¢åŠ è½½é€Ÿåº¦ä¼šå—åˆ°å½±å“&lt;/li>
&lt;/ul>
&lt;h2 id="å…¶ä»–éæŠ€æœ¯åšæ³•">å…¶ä»–éæŠ€æœ¯åšæ³•&lt;/h2>
&lt;h3 id="ä½ çš„æœåŠ¡å™¨ä¾›åº”å•†å¯èƒ½æä¾›æœç´¢å¼•æ“èœ˜è››æˆ–çˆ¬è™«çš„é˜²å¾¡">ä½ çš„æœåŠ¡å™¨ä¾›åº”å•†å¯èƒ½æä¾›æœç´¢å¼•æ“èœ˜è››æˆ–çˆ¬è™«çš„é˜²å¾¡ï¼š&lt;/h3>
&lt;p>æ¯”å¦‚ï¼ŒCloudFlare æä¾›åèœ˜è››å’Œåçˆ¬è™«çš„é˜²å¾¡ï¼Œä½ åªéœ€è¦ç›´æ¥å¯ç”¨å®ƒå°±å¯ä»¥äº†ï¼Œå¦å¤– AWS ä¹Ÿæä¾›ç±»ä¼¼æœåŠ¡ã€‚è€Œä¸” Apache çš„ mod_evasive æ¨¡å—ä¹Ÿèƒ½è®©ä½ å¾ˆè½»æ¾åœ°å®ç°é¢‘ç‡é™åˆ¶ã€‚&lt;/p>
&lt;h3 id="ç›´æ¥å‘Šè¯‰åˆ«äººä¸è¦æŠ“å–ä¼šæœ‰äººå°Šé‡è€Œä¸”åœæ­¢æŠ“å–">ç›´æ¥å‘Šè¯‰åˆ«äººä¸è¦æŠ“å–ï¼Œä¼šæœ‰äººå°Šé‡è€Œä¸”åœæ­¢æŠ“å–&lt;/h3>
&lt;p>ä½ åº”è¯¥ç›´æ¥å‘Šè¯‰äººä»¬ä¸è¦æŠ“å–ä½ çš„ç½‘ç«™ï¼Œæ¯”å¦‚ï¼Œåœ¨ä½ çš„æœåŠ¡æ¡æ¬¾ä¸­è¡¨æ˜ã€‚æœ‰äº›äººç¡®å®ä¼šå°Šé‡å®ƒï¼Œè€Œä¸”ä¸åœ¨ä½ å…è®¸çš„æƒ…å†µä¸‹ä¸ä¼šå†å»æŠ“å–æ•°æ®ã€‚&lt;/p>
&lt;h3 id="å¯»æ±‚å¾‹å¸ˆçš„æ´åŠ©">å¯»æ±‚å¾‹å¸ˆçš„æ´åŠ©&lt;/h3>
&lt;p>å¾‹å¸ˆä»¬çŸ¥é“å¦‚ä½•å¤„ç†ä¾µçŠ¯ç‰ˆæƒçš„äº‹æƒ…ï¼Œè€Œä¸”ä»–ä»¬å¯ä»¥å‘é€å¾‹å¸ˆå‡½ã€‚
DMCAï¼ˆè¯‘è€…æ³¨ï¼šDigital Millennium Copyright Actï¼Œæ•°å­—åƒå¹´ç‰ˆæƒæ³•æ¡ˆï¼Œæ˜¯ä¸€ä¸ªç¾å›½ç‰ˆæƒæ³•å¾‹ï¼‰ ä¹Ÿèƒ½æä¾›æ´åŠ©ã€‚&lt;/p>
&lt;h3 id="ç›´æ¥æä¾›-api-è·å–ä½ çš„æ•°æ®">ç›´æ¥æä¾› API è·å–ä½ çš„æ•°æ®&lt;/h3>
&lt;p>è¿™çœ‹èµ·æ¥é€‚å¾—å…¶åï¼Œä½†æ˜¯ä½ å¯ä»¥è¦æ±‚æ ‡æ˜æ¥æºå¹¶åŒ…å«è¿”å›ä½ ç«™ç‚¹çš„é“¾æ¥ã€‚ç”šè‡³ä¹Ÿå¯ä»¥å”®å–ä½ çš„ API è€Œèµšå–è´¹ç”¨ã€‚&lt;/p>
&lt;p>è¿˜æœ‰å°±æ˜¯ï¼ŒStack Exchange æä¾›äº† APIï¼Œä½†æ˜¯å¿…é¡»è¦æ ‡æ˜æ¥æºã€‚&lt;/p>
&lt;h2 id="å…¶ä»–è¡¥å……">å…¶ä»–è¡¥å……&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>è¦åœ¨ç”¨æˆ·ä½“éªŒå’Œåçˆ¬ä¹‹é—´åšæƒè¡¡ï¼šä½ åšçš„æ¯ä¸ªä¸¾æªéƒ½æœ‰å¯èƒ½åœ¨æŸç§ç¨‹åº¦ä¸Šå½±å“ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥ä½ å¿…é¡»è¦æƒè¡¡å’Œå¦¥åï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä¸è¦å¿˜ä½ çš„ç§»åŠ¨ç«™ç‚¹å’Œ APPï¼šå¦‚æœä½ çš„ç«™ç‚¹æœ‰ç§»åŠ¨ç‰ˆï¼Œè¦å°å¿ƒçˆ¬è™«ä¹Ÿå¯ä»¥é€šè¿‡å®ƒçˆ¬å–ä½ çš„æ•°æ®ã€‚æˆ–è€…è¯´ä½ æœ‰ç§»åŠ¨ APPï¼Œä»–ä»¬ä¹Ÿå¯ä»¥æˆªå±åˆ†æï¼Œ
æˆ–è€…å¯ä»¥æŠ“å–ä½ çš„ç½‘ç»œè¯·æ±‚å»ç›´æ¥æ‰¾åˆ°ä½ çš„ RESTful çš„ API ç›´æ¥ä½¿ç”¨ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœä½ å¯¹ä¸€äº›ç‰¹å®šæµè§ˆå™¨æä¾›äº†ç‰¹å®šçš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚å¯¹å¾ˆè€çš„ IE ç‰ˆæœ¬æä¾›ç½‘ç«™çš„é˜‰å‰²ç‰ˆï¼Œä¸è¦å¿˜è®°çˆ¬è™«ä¹Ÿå¯ä»¥ç›´æ¥çˆ¬å–å®ƒï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é€‰å‡ºé›†ä¸­æœ€é€‚åˆä½ çš„ç­–ç•¥ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œè€Œä¸æ˜¯åªç”¨ä¸€ç§ï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>çˆ¬è™«å¯ä»¥æŠ“å–å…¶ä»–çˆ¬è™«ï¼šå¦‚æœæœ‰ä¸ªç½‘ç«™æ˜¾ç¤ºçš„å†…å®¹éƒ½æ˜¯ä»ä½ ç½‘ç«™çˆ¬å–çš„ï¼Œé‚£å¦å¤–ä¸€ä¸ªçˆ¬è™«ä¹Ÿå¯ä»¥ç›´æ¥çˆ¬å–é‚£ä¸ªç½‘ç«™ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h2 id="æœ‰å“ªäº›æœ€æœ‰æ•ˆçš„æ–¹æ³•-">æœ‰å“ªäº›æœ€æœ‰æ•ˆçš„æ–¹æ³• ï¼Ÿ&lt;/h2>
&lt;p>ä»¥æˆ‘è‡ªå·±å†™å’Œå¸®å¿™åˆ«äººå†™çˆ¬è™«çš„ç»éªŒï¼Œæˆ‘è®¤ä¸ºæœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>
&lt;p>ç»å¸¸ä¿®æ”¹ HTML çš„ç»“æ„&lt;/p>
&lt;/li>
&lt;li>
&lt;p>èœœç½å’Œå‡æ•°æ®&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨æ··æ·†çš„ JavaScriptã€Ajax è¿˜æœ‰ Cookie&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¢‘ç‡é™åˆ¶ã€çˆ¬è™«æ£€æµ‹å’Œè¯·æ±‚å°ç¦&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>æ‰©å±•é˜…è¯»ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a href="http://en.wikipedia.org/wiki/Web_scraping">ç»´åŸºç™¾ç§‘å…³äº Web çˆ¬è™«çš„æ–‡ç« &lt;/a> ï¼Œ
å…¶ä¸­æåˆ°äº†å¾ˆå¤š Web çˆ¬è™«çš„ç›¸å…³æŠ€æœ¯å’Œçˆ¬è™«ç±»å‹ï¼Œçœ‹å®Œå¦‚ä½•è¿›è¡Œ web çˆ¬å–çš„ä¸€äº›ä¿¡æ¯ï¼Œä¹Ÿä¸è¦å¿˜è®°çœ‹ä¸€çœ‹çˆ¬å–çš„åˆæ³•æ€§ã€‚&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æœ€åç¥ä½ åœ¨ä¿æŠ¤ä½ ç½‘ç«™çš„å†…å®¹åå·è·¯ä¸Šä¸€è·¯é¡ºé£&amp;hellip;&lt;/strong>&lt;/p>
&lt;p>via: &lt;a href="https://github.com/JonasCz/How-To-Prevent-Scraping">https://github.com/JonasCz/How-To-Prevent-Scraping&lt;/a>&lt;/p>
&lt;p>ä½œè€…ï¼š&lt;a href="https://github.com/JonasCz">JonasCz&lt;/a>
è¯‘è€…ï¼š&lt;a href="https://h1z3y3.me">h1z3y3&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E5%8F%8D%E7%88%AC/">åçˆ¬</category></item><item><title>Golang é€ƒé€¸åˆ†æ</title><link>https://h1z3y3.me/posts/golang-escape-analysis/</link><guid isPermaLink="true">https://h1z3y3.me/posts/golang-escape-analysis/</guid><pubDate>Wed, 21 Apr 2021 13:12:00 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="golang-é€ƒé€¸åˆ†æ">Golang é€ƒé€¸åˆ†æ&lt;/h1>
&lt;p>Golang çš„åƒåœ¾å›æ”¶æœºåˆ¶å¯ä»¥è¿›è¡Œè‡ªåŠ¨å†…å­˜ç®¡ç†è®©æˆ‘ä»¬çš„ä»£ç æ›´ç®€æ´ï¼ŒåŒæ—¶å‘ç”Ÿå†…å­˜æ³„æ¼çš„å¯èƒ½æ€§æ›´å°ã€‚
ç„¶è€Œï¼ŒGC ä¼šå®šæœŸåœæ­¢å¹¶æ”¶é›†æœªä½¿ç”¨çš„å¯¹è±¡ï¼Œå› æ­¤è¿˜æ˜¯ä¼šå¢åŠ ç¨‹åºçš„å¼€é”€ã€‚
Go çš„ç¼–è¯‘å™¨ååˆ†èªæ˜ï¼Œæ¯”å¦‚å†³å®šå˜é‡éœ€è¦åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Œå’Œåˆ†é…åœ¨å †ä¸Šä¸åŒçš„æ˜¯åœ¨æ ˆä¸Šçš„å˜é‡åœ¨å£°æ˜å®ƒçš„å‡½æ•°ç»“æŸä¹‹åå°±ä¼šè¢«å›æ”¶ã€‚
é‚£å¯¹äº GC æ¥è¯´ï¼Œåˆ†é…åœ¨æ ˆä¸Šçš„å˜é‡ä¸ä¼šå¸¦æ¥é¢å¤–çš„å¼€é”€ï¼Œåœ¨å‡½æ•° return ä¹‹åï¼Œå‡½æ•°çš„æ•´ä¸ªè°ƒç”¨æ ˆéƒ½ä¼šè¢«é”€æ¯ã€‚&lt;/p>
&lt;p>é‚£åˆ°åº•å˜é‡åº”è¯¥åˆ†é…åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼ŒGolang å¦‚ä½•å†³å®šå‘¢ï¼Œè¿™å°±è¦è¯´åˆ° Golang çš„&lt;strong>é€ƒé€¸åˆ†æ&lt;/strong>ã€‚&lt;/p>
&lt;p>åˆ¤æ–­é€ƒé€¸çš„åŸºæœ¬è§„åˆ™æ˜¯å¦‚æœä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼æ˜¯æœ¬å‡½æ•°å†…å£°æ˜çš„æŸä¸ªå˜é‡çš„å¼•ç”¨ï¼Œé‚£ä¹ˆå°±ç§°è¿™ä¸ªå˜é‡ä»è¿™ä¸ªå‡½æ•°ä¸­é€ƒé€¸äº†ã€‚
ä½œä¸ºæœ¬å‡½æ•°çš„è¿”å›å€¼ï¼Œå®ƒè¿˜èƒ½è¢«å‡½æ•°å¤–çš„å…¶ä»–ç¨‹åºä¿®æ”¹ï¼Œæ‰€ä»¥å®ƒå¿…é¡»åˆ†é…åœ¨å †ä¸Šï¼Œè€Œä¸èƒ½åˆ†é…åœ¨é‚£ä¸ªå‡½æ•°çš„æ ˆä¸Šã€‚&lt;/p>
&lt;p>å› æ­¤ï¼Œå¦‚æœåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œèƒ½å¯¹å˜é‡çš„é€ƒé€¸æƒ…å†µä½œåˆ†æï¼Œå¯ä»¥æé«˜æˆ‘ä»¬ç¨‹åºçš„æ€§èƒ½ã€‚
é¦–å…ˆæœ€å¤§çš„å¥½å¤„å°±æ˜¯èƒ½å¤Ÿå‡å°‘åƒåœ¾å›æ”¶çš„å‹åŠ›ï¼Œæ²¡æœ‰é€ƒé€¸çš„å˜é‡åˆ†é…åœ¨æ ˆä¸Šï¼Œå‡½æ•°è¿”å›å°±èƒ½ç›´æ¥å›æ”¶èµ„æºï¼›
å…¶æ¬¡é€ƒé€¸åˆ†æå®Œä¹‹åï¼Œæˆ‘ä»¬èƒ½ç¡®å®šå“ªäº›å˜é‡å…¶å®å¯ä»¥åˆ†é…åœ¨æ ˆä¸Šï¼Œæ ˆçš„åˆ†é…æ¯”å †å¿«ï¼Œæ€§èƒ½æ›´å¥½ï¼›
è¿˜æœ‰å¯ä»¥è¿›è¡ŒåŒæ­¥æ¶ˆé™¤ï¼Œå¦‚æœå®šä¹‰å˜é‡çš„å‡½æ•°æœ‰åŒæ­¥é”ï¼Œä½†æ˜¯è¿è¡Œæ—¶å´åªæœ‰ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£æ­¤æ—¶é€ƒé€¸åˆ†æåçš„æœºå™¨ç ï¼Œä¼šå»æ‰åŒæ­¥é”è¿è¡Œã€‚&lt;/p>
&lt;h2 id="å¼€å¯-go-ç¼–è¯‘æ—¶çš„é€ƒé€¸åˆ†ææ—¥å¿—">å¼€å¯ Go ç¼–è¯‘æ—¶çš„é€ƒé€¸åˆ†ææ—¥å¿—&lt;/h2>
&lt;p>åœ¨ç¼–è¯‘æ—¶ï¼Œæ·»åŠ  &lt;code>-gcflags '-m'&lt;/code> å‚æ•°å³å¯æŸ¥çœ‹goç¼–è¯‘è¿‡ç¨‹ä¸­è¯¦ç»†çš„é€ƒé€¸åˆ†ææ—¥å¿—ã€‚
ä½†ä¸ºäº†ä¸è®© Go ç¼–è¯‘æ—¶è‡ªåŠ¨å†…è”å‡½æ•°ï¼Œä¼šåŠ ä¸Š &lt;code>-l&lt;/code> å‚æ•°ï¼Œæœ€ç»ˆä¸º &lt;code>-gcflags '-m -l'&lt;/code>ã€‚&lt;/p>
&lt;p>Example 0:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {}
func main() {
var x S
_ = identity(x)
}
func identity(x S) S {
return x
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
$
$
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œæˆ‘ä»¬çŸ¥é“ Go åœ¨è°ƒç”¨å‡½æ•°çš„æ—¶å€™ï¼Œä¼šé‡‡ç”¨æŒ‰å€¼ä¼ é€’ï¼Œé‚£ä¹ˆåœ¨ &lt;code>main&lt;/code> å‡½æ•°ä¸­å£°æ˜çš„ &lt;code>x&lt;/code>ï¼Œ
ä¼šè¢«æ‹·è´åˆ° &lt;code>identity()&lt;/code> å‡½æ•°çš„æ ˆä¸­ã€‚&lt;strong>é€šå¸¸ï¼Œæ²¡æœ‰å¼•ç”¨çš„ä»£ç æ€»æ˜¯ä½¿ç”¨æ ˆåˆ†é…ï¼Œå› æ­¤æ²¡æœ‰é€ƒé€¸åˆ†ææ—¥å¿—çš„è¾“å‡ºã€‚&lt;/strong>&lt;/p>
&lt;p>é‚£å¦‚æœç¨å¾®æ”¹ä¸€ä¸‹ä»£ç ï¼š&lt;/p>
&lt;p>Example 1:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {}
func main() {
var x S
y := &amp;amp;x
_ = *identity(y)
}
func identity(z *S) *S {
return z
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
# command-line-arguments
./escape.go:11:22: leaking param: z to result ~r1 level=0
./escape.go:7:8: main &amp;amp;x does not escape
&lt;/code>&lt;/pre>&lt;p>ç¬¬ä¸€è¡Œæ˜¯ &lt;code>z&lt;/code> å˜é‡æ˜¯æµç»æŸä¸ªå‡½æ•°çš„æ„æ€ï¼Œä»…ä½œä¸ºå‡½æ•°çš„è¾“å…¥ï¼Œå¹¶ä¸”ç›´æ¥è¿”å›ï¼Œ
åœ¨ &lt;code>identity()&lt;/code> ä¸­ä¹Ÿæ²¡æœ‰ä½¿ç”¨åˆ° &lt;code>z&lt;/code> çš„å¼•ç”¨ï¼Œæ‰€ä»¥å˜é‡æ²¡æœ‰é€ƒé€¸ã€‚&lt;/p>
&lt;p>ç¬¬äºŒè¡Œï¼Œ&lt;code>x&lt;/code> åœ¨ &lt;code>main()&lt;/code> å‡½æ•°ä¸­å£°æ˜ï¼Œæ‰€ä»¥æ˜¯åœ¨ &lt;code>main()&lt;/code> å‡½æ•°ä¸­çš„æ ˆä¸­çš„ï¼Œä¹Ÿæ²¡æœ‰é€ƒé€¸ã€‚&lt;/p>
&lt;p>Example 2:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {}
func main() {
var x S
_ = *ref(x)
}
func ref(z S) *S {
return &amp;amp;z
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
# command-line-arguments
./escape.go:11:10: &amp;amp;z escapes to heap
./escape.go:10:16: moved to heap: z
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥çœ‹åˆ°å‘ç”Ÿäº†é€ƒé€¸ã€‚
&lt;code>ref()&lt;/code> çš„å‚æ•° &lt;code>z&lt;/code> æ˜¯é€šè¿‡å€¼ä¼ é€’çš„ï¼Œæ‰€ä»¥ &lt;code>z&lt;/code> æ˜¯ &lt;code>main()&lt;/code> å‡½æ•°ä¸­ &lt;code>x&lt;/code> çš„ä¸€ä¸ªå€¼æ‹·è´ï¼Œ
è€Œ &lt;code>ref()&lt;/code> è¿”å›äº† &lt;code>z&lt;/code> çš„å¼•ç”¨ï¼Œæ‰€ä»¥ &lt;code>z&lt;/code> ä¸èƒ½æ”¾åœ¨&lt;code>ref()&lt;/code>çš„æ ˆä¸­ï¼Œ å®é™…ä¸Šè¢«åˆ†é…åˆ°äº†å †ä¸Šã€‚&lt;/p>
&lt;p>å®é™…ä¸Šï¼Œæˆ‘ä»¬å‘ç° &lt;code>main()&lt;/code> å‡½æ•°ä¸­æ²¡æœ‰ç›´æ¥ä½¿ç”¨ &lt;code>ref()&lt;/code> è¿”å›çš„å¼•ç”¨ï¼Œè¿™ç§æƒ…å†µå…¶å® &lt;code>z&lt;/code> å¯ä»¥åˆ†é…åˆ°&lt;code>ref()&lt;/code>çš„æ ˆä¸Šï¼Œ
ä½†æ˜¯Goçš„é€ƒé€¸åˆ†æå¹¶æ²¡æœ‰å¤æ‚åˆ°æ¥è¯†åˆ«å‡ºè¿™ç§æƒ…å†µï¼Œå®ƒåªçœ‹è¾“å…¥è¿˜æœ‰è¿”å›çš„å˜é‡çš„æµç¨‹ã€‚
&lt;strong>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰åŠ  &lt;code>-l&lt;/code> å‚æ•°ï¼Œå…¶å® &lt;code>ref()&lt;/code> ä¼šè¢«ç¼–è¯‘å™¨å†…è”åˆ° &lt;code>main()&lt;/code> ä½¿ç”¨ã€‚&lt;/strong>&lt;/p>
&lt;p>å¦‚æœå¼•ç”¨è¢«èµ‹å€¼åˆ°ç»“æ„ä½“çš„æˆå‘˜å‘¢ï¼Ÿ&lt;/p>
&lt;p>Example 3:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {
M *int
}
func main() {
var i int
refStruct(i)
}
func refStruct(y int) (z S) {
z.M = &amp;amp;y
return z
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
# command-line-arguments
./escape.go:13:9: &amp;amp;y escapes to heap
./escape.go:12:26: moved to heap: y
&lt;/code>&lt;/pre>&lt;p>å¯ä»¥å‘ç°ï¼Œå³ä½¿è¿™ä¸ªå¼•ç”¨æ˜¯ç»“æ„ä½“çš„ä¸€ä¸ªæˆå‘˜ï¼ŒGoçš„é€ƒé€¸åˆ†æå¯ä»¥è·Ÿè¸ªå¼•ç”¨çš„ã€‚
å½“ç»“æ„ä½“ &lt;code>refStruct&lt;/code> è¿”å›æ—¶ï¼Œ&lt;code>y&lt;/code> ä¸€å®šæ˜¯ä» &lt;code>refStruct()&lt;/code> ä¸­é€ƒé€¸çš„ã€‚&lt;/p>
&lt;p>å¯ä»¥å†å’Œä¸‹é¢ä¾‹å­æ¯”è¾ƒä¸€ä¸‹ï¼š&lt;/p>
&lt;p>Example 4:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {
M *int
}
func main() {
var i int
refStruct(&amp;amp;i)
}
func refStruct(y *int) (z S) {
z.M = y
return z
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
# command-line-arguments
./escape.go:12:27: leaking param: y to result z level=0
./escape.go:9:13: main &amp;amp;i does not escape
&lt;/code>&lt;/pre>&lt;p>é‚£è¿™ä¸ª &lt;code>y&lt;/code> æ²¡æœ‰é€ƒé€¸çš„åŸå› æ˜¯ï¼Œ&lt;code>main()&lt;/code> ä¸­å¸¦ç€ &lt;code>i&lt;/code> çš„å¼•ç”¨è°ƒç”¨äº† &lt;code>refStruct()&lt;/code> å¹¶ç›´æ¥è¿”å›äº†ï¼Œ
ä»æ¥æ²¡æœ‰è¶…è¿‡ &lt;code>main()&lt;/code> å‡½æ•°çš„è°ƒç”¨æ ˆï¼ŒåŸå› å’Œ Example 1 å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚&lt;/p>
&lt;p>å¦å¤–è¦è¯´æ˜ä¸€ç‚¹ï¼ŒExample 4 è¦æ¯” Example 3 æ›´é«˜æ•ˆï¼š&lt;/p>
&lt;p>åœ¨ Example 3 ä¸­ï¼Œ&lt;code>i&lt;/code> å¿…é¡»åœ¨&lt;code>main()&lt;/code> çš„æ ˆä¸­ç”³è¯·ä¸€å—æ ˆç©ºé—´ï¼Œç»è¿‡&lt;code>refStruct()&lt;/code>åï¼Œ&lt;code>y&lt;/code>è¿˜è¦åœ¨å †ä¸Šå†ç”³è¯·ä¸€å—ç©ºé—´ï¼›
è€Œåœ¨ Example 4 ä¸­ï¼Œå®é™…ä¸Šåªæœ‰&lt;code>i&lt;/code>ç”³è¯·äº†ä¸€æ¬¡ç©ºé—´ï¼Œç„¶åå®ƒçš„å¼•ç”¨ç»è¿‡äº† &lt;code>refStruct()&lt;/code> è€Œå·²ã€‚&lt;/p>
&lt;p>ä¸€ä¸ªæ›´å¤æ‚çš„ä¾‹å­ï¼š&lt;/p>
&lt;p>Example 5:&lt;/p>
&lt;pre>&lt;code>package main
type S struct {
M *int
}
func main() {
var x S
var i int
ref(&amp;amp;i, &amp;amp;x)
}
func ref(y *int, z *S) {
z.M = y
}
&lt;/code>&lt;/pre>&lt;p>Output:&lt;/p>
&lt;pre>&lt;code>$ go run -gcflags '-m -l' escape.go
# command-line-arguments
./escape.go:13:21: leaking param: y
./escape.go:13:21: ref z does not escape
./escape.go:10:7: &amp;amp;i escapes to heap
./escape.go:9:7: moved to heap: i
./escape.go:10:11: main &amp;amp;x does not escape
&lt;/code>&lt;/pre>&lt;p>&lt;code>y&lt;/code> å’Œ &lt;code>z&lt;/code> æ²¡æœ‰é€ƒé€¸å¾ˆå¥½ç†è§£ï¼Œä½†é—®é¢˜åœ¨äº &lt;code>y&lt;/code> è¿˜è¢«èµ‹å€¼åˆ°å‡½æ•° &lt;code>ref()&lt;/code> çš„è¾“å…¥ &lt;code>z&lt;/code> çš„æˆå‘˜äº†ï¼Œ
è€ŒGoçš„é€ƒé€¸åˆ†æä¸èƒ½è·Ÿè¸ªå˜é‡ä¹‹é—´çš„å…³ç³»ï¼Œä¸çŸ¥é“ &lt;code>i&lt;/code> å˜æˆäº† &lt;code>x&lt;/code> çš„ä¸€ä¸ªæˆå‘˜ï¼Œ
åˆ†æç»“æœè¯´ &lt;code>i&lt;/code> æ˜¯é€ƒé€¸çš„ï¼Œä½†æœ¬è´¨ä¸Š &lt;code>i&lt;/code>æ˜¯æ²¡é€ƒé€¸çš„ï¼Œ è¿™ä¸ªæ—¶å€™Goçš„é€ƒé€¸åˆ†æå®é™…ä¸Šæ˜¯æœ‰é—®é¢˜çš„ã€‚&lt;/p>
&lt;p>è¿™é‡Œè¿˜æœ‰å¥½å¤šå› ä¸ºGoé€ƒé€¸åˆ†æçš„ä¸è¶³è€Œå¯¼è‡´è¢«åˆ†é…åˆ°å †çš„å˜æ€ä¾‹å­ï¼š
&lt;a href="https://docs.google.com/document/d/1CxgUBPlx9iJzkz9JWkb6tIpTe5q32QDmz8l0BouG0Cw/preview">https://docs.google.com/document/d/1CxgUBPlx9iJzkz9JWkb6tIpTe5q32QDmz8l0BouG0Cw/preview&lt;/a>&lt;/p>
&lt;p>å…¶å®è¯´è¿™ä¹ˆå¤šå…¶å®å°±æ˜¯ä¸ºäº†è¯´æ˜å¦‚æœæƒ³è¦å‡å°‘åƒåœ¾å›æ”¶çš„æ—¶é—´ï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼Œ
é‚£å°±è¦å°½é‡é¿å…åœ¨å †ä¸Šåˆ†é…ç©ºé—´ï¼Œä¹‹ååœ¨å†™ç¨‹åºçš„æ—¶å€™å¯ä»¥å¤šè€ƒè™‘ä¸€ä¸‹è¿™æ–¹é¢çš„é—®é¢˜ã€‚;)&lt;/p>
&lt;h3 id="å‚è€ƒ">å‚è€ƒ&lt;/h3>
&lt;p>&lt;a href="http://www.agardner.me/golang/garbage/collection/gc/escape/analysis/2015/10/18/go-escape-analysis.html">ã€ŠGolang escape analysisã€‹&lt;/a>&lt;/p>
&lt;p>&lt;a href="https://docs.google.com/document/d/1CxgUBPlx9iJzkz9JWkb6tIpTe5q32QDmz8l0BouG0Cw/preview">ã€ŠGo Escape Analysis Flawsã€‹&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>æ·±å…¥å‰–æ Golang Pprof æ ‡ç­¾</title><link>https://h1z3y3.me/posts/demysitifying-pprof-labels-with-go/</link><guid isPermaLink="true">https://h1z3y3.me/posts/demysitifying-pprof-labels-with-go/</guid><pubDate>Sun, 18 Apr 2021 21:22:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="æ·±å…¥å‰–æ-golang-pprof-æ ‡ç­¾">æ·±å…¥å‰–æ Golang Pprof æ ‡ç­¾&lt;/h1>
&lt;p>Polar Signal æä¾›çš„æŒç»­åˆ†æå·¥å…·å¯ä»¥å’Œä»»ä½•æ ¼å¼çš„ pprof é…ç½®é€‚é…ï¼ŒGo æ·±åº¦é›†æˆäº† pprof ç”šè‡³æ”¯æŒäº†å®ƒçš„&lt;code>æ ‡ç­¾&lt;/code>ç‰¹æ€§ã€‚ç„¶è€Œï¼Œè‡ªä»æˆ‘ä»¬å‘å¸ƒäº†æˆ‘ä»¬æŒç»­åˆ†æçš„äº§å“ä¹‹åï¼Œæˆ‘ä»¬æ”¶åˆ°äº†å¾ˆå¤šå·¥ç¨‹å¸ˆçš„åé¦ˆï¼Œå‘ç°è®¸å¤šå·¥ç¨‹å¸ˆä¸çŸ¥é“å¦‚ä½•å»åˆ†æï¼Œæˆ–è€…ä¸çŸ¥é“åˆ†æèƒ½ç»™ä»–ä»¬å¸¦æ¥ä»€ä¹ˆå¥½å¤„ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦å‰–æ pprof æ ‡ç­¾ï¼Œå¹¶ä¼šç»“åˆä¸€äº› Go çš„ç¤ºä¾‹ä»£ç å»åˆ†æã€‚&lt;/p>
&lt;h2 id="åŸºç¡€">åŸºç¡€&lt;/h2>
&lt;p>pprof æ ‡ç­¾åªæ”¯æŒ Go çš„ CPU åˆ†æå™¨ã€‚Go çš„åˆ†æå™¨æ˜¯æŠ½æ ·åˆ†æï¼Œè¿™æ„å‘³ç€å®ƒåªä¼šæ ¹æ®ç‰¹å®šçš„é¢‘ç‡ï¼ˆé»˜è®¤æ˜¯ 1 ç§’é’Ÿ 100 æ¬¡ï¼‰å»è·å–æ‰§è¡Œä¸­å‡½æ•°çš„è°ƒç”¨æ ˆå¹¶è®°å½•ã€‚ç®€å•æ¥è¯´ï¼Œå¼€å‘è€…å¦‚æœä½¿ç”¨æ ‡ç­¾ï¼Œåœ¨åˆ†æå™¨å–æ ·æ—¶å°±å¯ä»¥å°†å‡½æ•°çš„è°ƒç”¨æ ˆè¿›è¡ŒåŒºåˆ†ï¼Œç„¶ååªèšåˆæœ‰ç›¸åŒæ ‡ç­¾çš„å‡½æ•°è°ƒç”¨æ ˆã€‚&lt;/p>
&lt;p>Go åœ¨ &lt;code>runtime/pprof&lt;/code> åŒ…ä¸­å·²ç»æ”¯æŒäº†æ ‡ç­¾æ£€æµ‹ï¼Œå¯ä»¥ä½¿ç”¨ &lt;code>pprof.Do&lt;/code> å‡½æ•°éå¸¸æ–¹ä¾¿çš„ä½¿ç”¨ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="nx">pprof&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Do&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">pprof&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Labels&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;label-key&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="s">&amp;#34;label-value&amp;#34;&lt;/span>&lt;span class="p">),&lt;/span> &lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ctx&lt;/span> &lt;span class="nx">context&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Context&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// execute labeled code
&lt;/span>&lt;span class="c1">&lt;/span>&lt;span class="p">})&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h2 id="è¿›é˜¶">è¿›é˜¶&lt;/h2>
&lt;p>ä¸ºäº†è¿›è¡Œæ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ pprof æ ‡ç­¾ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«è®¸å¤šç¤ºä¾‹çš„ä»“åº“ï¼Œç¤ºä¾‹ä»“åº“ä¼šä½œä¸ºè¿™ç¯‡æ–‡ç« å†…å®¹çš„è¯´æ˜ã€‚ä»“åº“åœ°å€ï¼š&lt;a href="https://github.com/polarsignals/pprof-labels-example">https://github.com/polarsignals/pprof-labels-example&lt;/a>&lt;/p>
&lt;p>ç¤ºä¾‹ä»£ç çš„ &lt;code>main.go&lt;/code> é€šè¿‡å°† &lt;code>tanant&lt;/code> ä¼ é€’ç»™ &lt;code>iterate&lt;/code> å‡½æ•°å®ç°äº†å¤§é‡çš„ for å¾ªç¯ï¼Œå…¶ä¸­&lt;code>tanant1&lt;/code> åšäº† 10 äº¿æ¬¡å¾ªç¯ï¼Œè€Œ &lt;code>tanant2&lt;/code> åšäº† 1 äº¿æ¬¡å¾ªç¯ï¼ŒåŒæ—¶ä¼šè®°å½• CPU çš„åˆ†ææ—¥å¿—å¹¶å°†å…¶å†™å…¥ &lt;code>./cpuprofile.pb.gz&lt;/code>ã€‚&lt;/p>
&lt;p>ä¸ºäº†æ¼”ç¤ºå¦‚ä½•åœ¨ pprof çš„åˆ†ææ—¥å¿—ä¸­å±•ç¤º pprof æ ‡ç­¾ï¼Œç”¨ &lt;code>printprofile.go&lt;/code> æ¥æ‰“å°æ¯æ¬¡æŠ½æ ·å‡½æ•°è°ƒç”¨æ ˆä»¥åŠæ ·æœ¬å€¼ï¼Œè¿˜æœ‰æ”¶é›†åˆ°æ ·æœ¬çš„æ ‡ç­¾ã€‚&lt;/p>
&lt;p>å¦‚æœæˆ‘ä»¬æ³¨é‡Šæ‰ &lt;code>pprof.Do&lt;/code> çš„è¿™éƒ¨åˆ†ï¼Œæˆ‘ä»¬å°†æ— æ³•è¿›è¡Œæ ‡ç­¾æ£€æµ‹ï¼Œè¿è¡Œ &lt;code>printprofile.go&lt;/code> ä»£ç ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ²¡æœ‰æ ‡ç­¾çš„æŠ½æ ·åˆ†ææ—¥å¿—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">runtime.main
main.main
main.iteratePerTenant
main.iterate
&lt;span class="m">2540000000&lt;/span>
---
runtime.main
main.main
main.iteratePerTenant
main.iterate
&lt;span class="m">250000000&lt;/span>
---
Total: 2.79s
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>CPU åˆ†ææ•°æ®çš„å•ä½æ˜¯ çº³ç§’ï¼Œæ‰€ä»¥è¿™äº›æŠ½æ ·æ€»å…±èŠ±è´¹æ—¶é—´æ˜¯ 2.79 ç§’ï¼ˆ2540000000ns + 250000000ns = 2790000000ns = 2.79sï¼‰ã€‚&lt;/p>
&lt;p>åŒæ ·çš„ï¼Œç°åœ¨å½“æ¯æ¬¡è°ƒç”¨ &lt;code>iterate&lt;/code> æ—¶æ·»åŠ æ ‡ç­¾ï¼Œç”¨ pprof åˆ†æï¼Œè¿™äº›æ•°æ®çœ‹èµ·æ¥å°±ä¸å¤ªä¸€æ ·ï¼Œæ‰“å°å‡ºå¸¦æœ‰æ ‡ç­¾çš„æŠ½æ ·åˆ†ææ—¥å¿—ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">runtime.main
main.main
main.iteratePerTenant
runtime/pprof.Do
main.iteratePerTenant.func1
main.iterate
&lt;span class="m">10000000&lt;/span>
---
runtime.main
main.main
main.iteratePerTenant
runtime/pprof.Do
main.iteratePerTenant.func1
main.iterate
&lt;span class="m">2540000000&lt;/span>
map&lt;span class="o">[&lt;/span>tenant:&lt;span class="o">[&lt;/span>tenant1&lt;span class="o">]]&lt;/span>
---
runtime.main
main.main
main.iteratePerTenant
runtime/pprof.Do
main.iteratePerTenant.func1
main.iterate
&lt;span class="m">10000000&lt;/span>
map&lt;span class="o">[&lt;/span>tenant:&lt;span class="o">[&lt;/span>tenant1&lt;span class="o">]]&lt;/span>
---
runtime.main
main.main
main.iteratePerTenant
runtime/pprof.Do
main.iteratePerTenant.func1
main.iterate
&lt;span class="m">260000000&lt;/span>
map&lt;span class="o">[&lt;/span>tenant:&lt;span class="o">[&lt;/span>tenant2&lt;span class="o">]]&lt;/span>
---
Total: 2.82s
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å°†æ‰€æœ‰æŠ½æ ·åŠ èµ·æ¥æ€»å…±èŠ±è´¹äº† 2.82 ç§’ï¼Œç„¶è€Œï¼Œå› ä¸ºè°ƒç”¨ &lt;code>iterate&lt;/code> æ—¶ï¼Œæˆ‘ä»¬æ·»åŠ äº†æ ‡ç­¾ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨ç»“æœä¸­åŒºåˆ†å“ªä¸ª &lt;code>tanant&lt;/code> å¯¼è‡´äº†æ›´å¤šçš„ CPU å ç”¨ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¯´ &lt;code>tenant1&lt;/code> èŠ±è´¹äº†æ€»æ—¶é—´ 2.82 ç§’ä¸­çš„ 2.55 ç§’ï¼ˆ2540000000ns + 10000000ns = 2550000000ns = 2.55sï¼‰ã€‚&lt;/p>
&lt;p>è®©æˆ‘ä»¬çœ‹çœ‹æŠ½æ ·çš„åŸå§‹æ—¥å¿—ï¼ˆè¿˜æœ‰å®ƒä»¬çš„å…ƒæ•°æ®ï¼‰ï¼Œå»æ›´æ·±å…¥ç†è§£ä¸€ä¸‹å®ƒä»¬çš„æ ¼å¼ï¼š&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-bash" data-lang="bash">$ protoc --decode perftools.profiles.Profile --proto_path ~/src/github.com/google/pprof/proto profile.proto &amp;lt; cpuprofile.pb &lt;span class="p">|&lt;/span> grep -A12 &lt;span class="s2">&amp;#34;sample {&amp;#34;&lt;/span>
sample &lt;span class="o">{&lt;/span>
location_id: &lt;span class="m">1&lt;/span>
location_id: &lt;span class="m">2&lt;/span>
location_id: &lt;span class="m">3&lt;/span>
location_id: &lt;span class="m">4&lt;/span>
location_id: &lt;span class="m">5&lt;/span>
value: &lt;span class="m">1&lt;/span>
value: &lt;span class="m">10000000&lt;/span>
&lt;span class="o">}&lt;/span>
sample &lt;span class="o">{&lt;/span>
location_id: &lt;span class="m">1&lt;/span>
location_id: &lt;span class="m">2&lt;/span>
location_id: &lt;span class="m">3&lt;/span>
location_id: &lt;span class="m">4&lt;/span>
location_id: &lt;span class="m">5&lt;/span>
value: &lt;span class="m">254&lt;/span>
value: &lt;span class="m">2540000000&lt;/span>
label &lt;span class="o">{&lt;/span>
key: &lt;span class="m">14&lt;/span>
str: &lt;span class="m">15&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="o">}&lt;/span>
sample &lt;span class="o">{&lt;/span>
location_id: &lt;span class="m">6&lt;/span>
location_id: &lt;span class="m">2&lt;/span>
location_id: &lt;span class="m">3&lt;/span>
location_id: &lt;span class="m">4&lt;/span>
location_id: &lt;span class="m">5&lt;/span>
value: &lt;span class="m">1&lt;/span>
value: &lt;span class="m">10000000&lt;/span>
label &lt;span class="o">{&lt;/span>
key: &lt;span class="m">14&lt;/span>
str: &lt;span class="m">15&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="o">}&lt;/span>
sample &lt;span class="o">{&lt;/span>
location_id: &lt;span class="m">1&lt;/span>
location_id: &lt;span class="m">2&lt;/span>
location_id: &lt;span class="m">3&lt;/span>
location_id: &lt;span class="m">7&lt;/span>
location_id: &lt;span class="m">5&lt;/span>
value: &lt;span class="m">26&lt;/span>
value: &lt;span class="m">260000000&lt;/span>
label &lt;span class="o">{&lt;/span>
key: &lt;span class="m">14&lt;/span>
str: &lt;span class="m">16&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;span class="o">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ¯ä¸ªæŠ½æ ·éƒ½ç”±è®¸å¤š ID ç»„æˆï¼Œè¿™äº› ID æŒ‡å‘å®ƒä»¬åœ¨åˆ†ææ—¥å¿— &lt;code>location&lt;/code> æ•°ç»„ä¸­çš„ä½ç½®ï¼Œé™¤äº†è¿™äº› ID è¿˜æœ‰å‡ ä¸ªå€¼ã€‚ä»”ç»†çœ‹ä¸‹ &lt;code>printprofile.go&lt;/code> ç¨‹åºï¼Œä½ ä¼šå‘ç°å®ƒä½¿ç”¨äº†æ¯ä¸ªæŠ½æ ·çš„æœ€åä¸€ä¸ªæŠ½æ · valueã€‚ å®é™…ä¸Šï¼ŒGo çš„ CPU åˆ†æå™¨ä¼šè®°å½•ä¸¤ä¸ª valueï¼Œç¬¬ä¸€ä¸ªä»£è¡¨è¿™ä¸ªè°ƒç”¨æ ˆåœ¨ä¸€æ¬¡åˆ†æåŒºé—´è¢«è®°å½•æ ·æœ¬çš„æ•°é‡ï¼Œç¬¬äºŒä¸ªä»£è¡¨å®ƒèŠ±è´¹äº†å¤šå°‘çº³ç§’ã€‚pprof çš„å®šä¹‰æè¿°å½“æ²¡è®¾ç½® &lt;code>default_sample_type&lt;/code> æ—¶ï¼ˆåœ¨ Go çš„ CPU é…ç½®ä¸­è®¾ç½®ï¼‰ï¼Œå°±ä½¿ç”¨æ‰€æœ‰ value ä¸­çš„æœ€åä¸€ä¸ªï¼Œå› æ­¤æˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ä»£è¡¨çº³ç§’çš„ value è€Œä¸æ˜¯æ ·æœ¬æ•°çš„ valueã€‚æœ€åï¼Œæˆ‘ä»¬å¯ä»¥æ‰“å°å‡ºæ ‡ç­¾ï¼Œå®ƒæ˜¯ pprof å®šä¹‰çš„ä¸€ä¸ªä»¥å­—ç¬¦ä¸²ç»„æˆçš„å­—å…¸ã€‚&lt;/p>
&lt;p>æœ€åï¼Œå› ä¸ºç”¨æ ‡ç­¾å»åŒºåˆ†æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥è®©å¯è§†åŒ–ç•Œé¢æ›´ç›´è§‚ã€‚&lt;/p>
&lt;p>ä½ å¯ä»¥åœ¨ Polar Signals ç½‘ç«™è¿™é‡Œå»æ›´è¯¦ç»†çš„äº†è§£ä¸Šé¢çš„è¿™æ¬¡åˆ†æï¼š&lt;a href="https://share.polarsignals.com/2063c5c/">https://share.polarsignals.com/2063c5c/&lt;/a>&lt;/p>
&lt;h2 id="ç»“è®º">ç»“è®º&lt;/h2>
&lt;p>pprof æ ‡ç­¾æ˜¯å¸®åŠ©æˆ‘ä»¬ç†è§£ä¸åŒæ‰§è¡Œè·¯å¾„éå¸¸æœ‰ç”¨çš„æ–¹æ³•ï¼Œè®¸å¤šäººå–œæ¬¢åœ¨å¤šç§Ÿæˆ·ç³»ç»Ÿä¸­ä½¿ç”¨å®ƒä»¬ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†èƒ½å¤Ÿå®šä½åœ¨ä»–ä»¬ç³»ç»Ÿä¸­å‡ºç°çš„ç”±æŸä¸€ä¸ªç§Ÿæˆ·å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚å°±åƒå¼€å¤´è¯´çš„ï¼Œåªéœ€è¦è°ƒç”¨ &lt;code>pprof.Do&lt;/code> å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>Polar Signals æä¾›çš„æŒç»­åˆ†æå·¥å…·ä¹Ÿæ”¯æŒäº† pprof æ ‡ç­¾çš„å¯è§†åŒ–ç•Œé¢å’ŒæŠ¥å‘Šï¼Œå¦‚æœä½ æƒ³å‚ä¸ä¸ªäººä½“éªŒç‰ˆè¯·ç‚¹å‡»ï¼š&lt;a href="https://www.polarsignals.com/#request-access">ç”³è¯·èµ„æ ¼&lt;/a>&lt;/p>
&lt;hr>
&lt;p>via: &lt;a href="https://www.polarsignals.com/blog/posts/2021/04/13/demystifying-pprof-labels-with-go/">https://www.polarsignals.com/blog/posts/2021/04/13/demystifying-pprof-labels-with-go/&lt;/a>&lt;/p>
&lt;p>ä½œè€…ï¼š&lt;a href="https://twitter.com/fredbrancz">Frederic Branczyk&lt;/a>
è¯‘è€…ï¼š&lt;a href="https://h1z3y3.me">h1z3y3&lt;/a>
æ ¡å¯¹ï¼š&lt;a href="https://github.com/%E6%A0%A1%E5%AF%B9%E8%80%85ID">æ ¡å¯¹è€…ID&lt;/a>&lt;/p>
&lt;p>æœ¬æ–‡ç”± &lt;a href="https://github.com/studygolang/GCTT">GCTT&lt;/a> åŸåˆ›ç¼–è¯‘ï¼Œ&lt;a href="https://studygolang.com/">Go ä¸­æ–‡ç½‘&lt;/a> è£èª‰æ¨å‡º&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category><category domain="https://h1z3y3.me/tags/gctt/">GCTT</category></item><item><title>ç”¨ kqueue å®ç°ä¸€ä¸ªç®€å•çš„ TCP Server</title><link>https://h1z3y3.me/posts/writing-a-tcp-server-using-kqueue/</link><guid isPermaLink="true">https://h1z3y3.me/posts/writing-a-tcp-server-using-kqueue/</guid><pubDate>Fri, 16 Apr 2021 21:36:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h2 id="ä»‹ç»">ä»‹ç»&lt;/h2>
&lt;p>åœ¨ &lt;a href="https://dev.to/frosnerd/explain-non-blocking-i-o-like-i-m-five-2a5f">éé˜»å¡ I/O è¶…ç®€æ˜ä»‹ç»&lt;/a> ä¸­ï¼Œ
æˆ‘ä»¬å·²ç»è®¨è®ºè¿‡ç°ä»£ Web æœåŠ¡å™¨å¯ä»¥å¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œè¿™å¾—ç›Šäºç°ä»£æ“ä½œç³»ç»Ÿå†…æ ¸å†…ç½®çš„äº‹ä»¶é€šçŸ¥æœºåˆ¶ã€‚
å— Linux epoll [ &lt;a href="https://man7.org/linux/man-pages/man7/epoll.7.html">æ–‡æ¡£&lt;/a> ] å¯å‘ï¼Œ
FreeBSD å‘æ˜äº† kqueue [ &lt;a href="https://people.freebsd.org/~jlemon/papers/kqueue.pdf">è®ºæ–‡&lt;/a> ,
&lt;a href="https://www.freebsd.org/cgi/man.cgi?query=kqueue&amp;amp;sektion=2">æ–‡æ¡£&lt;/a> ]&lt;/p>
&lt;p>è¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†ä»”ç»†ç ”ç©¶ä¸‹ kqueueï¼Œæˆ‘ä»¬ä¼šç”¨ Go å®ç°ä¸€ä¸ªåŸºäº kqueue event loop çš„ TCP serverï¼Œ
ä½ å¯ä»¥åœ¨ Github ä¸Šæ‰¾åˆ° &lt;a href="https://github.com/FRosner/FrSrv">æºä»£ç &lt;/a> ã€‚
è¦è¿è¡Œä»£ç å¿…é¡»ä½¿ç”¨å’Œ FreeBSD å…¼å®¹çš„æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚ macOSã€‚&lt;/p>
&lt;p>æ³¨æ„ kqueue ä¸ä»…èƒ½å¤„ç† socket eventï¼Œè€Œä¸”è¿˜èƒ½å¤„ç†æ–‡ä»¶æè¿°ç¬¦ eventã€ä¿¡å·ã€å¼‚æ­¥ I/O eventã€å­è¿›ç¨‹çŠ¶æ€æ”¹å˜ eventã€
å®šæ—¶å™¨ä»¥åŠç”¨æˆ·è‡ªå®šä¹‰ eventã€‚å®ƒç¡®å®é€šç”¨å’Œå¼ºå¤§ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è¿™ç¯‡æ–‡ç« ä¸»è¦åˆ†ä¸ºä¸€ä¸‹å‡ éƒ¨åˆ†è®²è§£ã€‚
é¦–å…ˆï¼Œæˆ‘ä»¬ä¼šåœ¨å…ˆä»ç†è®ºå‡ºå‘è®¾è®¡æˆ‘ä»¬çš„ TCP Serverã€‚
ç„¶åï¼Œæˆ‘ä»¬ä¼šå»å®ç°å®ƒçš„å¿…è¦çš„æ¨¡å—ã€‚
æœ€åæˆ‘ä»¬ä¼šå¯¹æ•´ä¸ªè¿‡ç¨‹è¿›è¡Œæ€»ç»“ä»¥åŠæ€è€ƒã€‚&lt;/p>
&lt;h2 id="è®¾è®¡">è®¾è®¡&lt;/h2>
&lt;p>æˆ‘ä»¬ TCP Server å¤§æ¦‚æœ‰ä»¥ä¸‹å‡ éƒ¨åˆ†ï¼š
ä¸€ä¸ªç›‘å¬ TCP çš„ socketã€
æ¥æ”¶å®¢æˆ·ç«¯è¿æ¥çš„ socketã€
ä¸€ä¸ªå†…æ ¸äº‹ä»¶é˜Ÿåˆ—ï¼ˆkqueueï¼‰ï¼Œ
è¿˜æœ‰ä¸€ä¸ªäº‹ä»¶å¾ªç¯æœºåˆ¶æ¥è½®è¯¢è¿™ä¸ªé˜Ÿåˆ—ã€‚
ä¸‹é¢è¿™ä¸ªå›¾æè¿°äº†æ¥æ”¶è¿æ¥çš„åœºæ™¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/h1z3y3/gctt-images2/master/20210219-Writing-A-Simple-TCP-Server-Using-Kqueue/accepting-incoming-connections.png" alt="">&lt;/p>
&lt;p>å½“å®¢æˆ·ç«¯æƒ³è¦è¿æ¥æœåŠ¡ç«¯ï¼Œä¸€ä¸ªè¿æ¥è¯·æ±‚å°†ä¼šè¢«æ”¾åˆ° TCP è¿æ¥é˜Ÿåˆ—ä¸­ï¼Œ
è€Œå†…æ ¸ä¼šå°†ä¸€ä¸ªæ–°çš„äº‹ä»¶æ”¾åˆ° kqueue ä¸­ã€‚
è¿™ä¸ªäº‹ä»¶å°†ä¼šåœ¨äº‹ä»¶å¾ªç¯æ—¶è¢«å¤„ç†ï¼Œäº‹ä»¶å¾ªç¯ä¼šæ¥å—è¯·æ±‚ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯è¿æ¥ã€‚
ä¸‹é¢è¿™ä¸ªå›¾æè¿°äº†æ–°åˆ›å»ºçš„ socket å¦‚ä½•ä»å®¢æˆ·ç«¯è¯»å–è¯·æ±‚ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/h1z3y3/gctt-images2/master/20210219-Writing-A-Simple-TCP-Server-Using-Kqueue/read-data-from-the-client.png" alt="">&lt;/p>
&lt;p>å®¢æˆ·ç«¯å†™æ•°æ®åˆ°æ–°åˆ›å»ºçš„ socketï¼Œå†…æ ¸ä¼šå°†ä¸€ä¸ªæ–° event æ”¾åˆ° kqueue ä¸­ï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ª socket ä¸­æœ‰ç­‰å¾…è¯»å–çš„æ•°æ®ã€‚
äº‹ä»¶å¾ªç¯å°†è½®è¯¢åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶ä» socket è¯»å–æ•°æ®ã€‚
æ³¨æ„åªæœ‰ä¸€ä¸ª socket ç›‘å¬è¿æ¥ï¼Œè€Œæˆ‘ä»¬å°†ä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºæ–°çš„ socketã€‚&lt;/p>
&lt;p>ä¸‹æ–‡è¦è®¨è®ºå®ç°ç»†èŠ‚ï¼Œå¯ä»¥å¤§æ¦‚æŒ‰ç…§ä¸‹é¢çš„æ­¥éª¤å®ç°æˆ‘ä»¬çš„è®¾è®¡ã€‚&lt;/p>
&lt;p>1 åˆ›å»ºï¼Œç»‘å®šä»¥åŠç›‘å¬æ–°çš„ socket
2 åˆ›å»º kqueue
3 è®¢é˜… socket event
4 å¾ªç¯é˜Ÿåˆ—è·å– event å¹¶å¤„ç†å®ƒä»¬&lt;/p>
&lt;h2 id="å®ç°">å®ç°&lt;/h2>
&lt;p>ä¸ºäº†é¿å…å•ä¸ªæ–‡ä»¶æœ‰å¤§é‡ç³»ç»Ÿè°ƒç”¨ï¼Œæˆ‘ä»¬æ‹†åˆ†æˆå‡ ä¸ªä¸åŒæ¨¡å—ï¼š&lt;/p>
&lt;ul>
&lt;li>ä¸€ä¸ª &lt;code>socket&lt;/code> æ¨¡å—æ¥å¤„ç†æ‰€æœ‰ç®¡ç† socket çš„ç›¸å…³åŠŸèƒ½ï¼Œ&lt;/li>
&lt;li>ä¸€ä¸ª &lt;code>kqueue&lt;/code> æ¨¡å—æ¥å¤„ç†äº‹ä»¶å¾ªç¯ï¼Œ&lt;/li>
&lt;li>æœ€å &lt;code>main&lt;/code> æ¨¡å—ç”¨æ¥æ•´åˆæ‰€æœ‰æ¨¡å—å¹¶å¯åŠ¨æˆ‘ä»¬çš„ TCP serverã€‚&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä¸‹é¢ä» &lt;code>socket&lt;/code> æ¨¡å—å¼€å§‹ã€‚&lt;/p>
&lt;h3 id="å®šä¹‰-socket">å®šä¹‰ Socket&lt;/h3>
&lt;p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª socket ç»“æ„ä½“ã€‚ç±» Unix æ“ä½œç³»ç»Ÿï¼Œæ¯”å¦‚ FreeBSDï¼Œä¼šæŠŠ socket ä½œä¸ºæ–‡ä»¶ã€‚
ä¸ºäº†ç”¨ Go å®ç° socketï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=fd&amp;amp;sektion=4&amp;amp;manpath=freebsd-release-ports">æ–‡ä»¶æè¿°ç¬¦&lt;/a>ã€‚
æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªç±»ä¼¼ä¸‹é¢å¸¦æœ‰æ–‡ä»¶æè¿°ç¬¦çš„ç»“æ„ä½“ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">
&lt;span class="kd">type&lt;/span> &lt;span class="nx">Socket&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">FileDescriptor&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æˆ‘ä»¬æœŸæœ›æˆ‘ä»¬çš„ socket å¯ä»¥åº”å¯¹ä¸åŒçš„åœºæ™¯ï¼Œæ¯”å¦‚ï¼šè¯»ã€å†™ socket æ•°æ®ï¼Œä»¥åŠå…³é—­ socketã€‚
åœ¨ Go ä¸­ï¼Œè¦æ”¯æŒè¿™äº›æ“ä½œï¼Œéœ€è¦å®ç°é€šç”¨çš„ interfaceï¼Œæ¯”å¦‚ &lt;code>io.Reader&lt;/code>ï¼Œ&lt;code>io.Writer&lt;/code>ï¼Œè¿˜æœ‰ &lt;code>io.Closer&lt;/code>&lt;/p>
&lt;p>é¦–å…ˆï¼Œå®ç° &lt;code>io.Reader&lt;/code> è¿™ä¸ªæ¥å£ï¼Œä»–ä¼šè°ƒç”¨ &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=read&amp;amp;sektion=2">read()&lt;/a> ç³»ç»Ÿå‡½æ•°ã€‚
è¿™ä¸ªå‡½æ•°ä¼šè¿”å›è¯»åˆ°å­—èŠ‚çš„æ•°é‡ï¼Œä»¥åŠè¿›è¡Œè¯»æ“ä½œæ—¶å¯èƒ½å‘ç”Ÿçš„é”™è¯¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span> &lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nb">len&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">numBytesRead&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Read&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">bytes&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">numBytesRead&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">numBytesRead&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=write&amp;amp;sektion=2">write()&lt;/a> æ¥å®ç° &lt;code>io.Writer&lt;/code> æ¥å£ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;span class="lnt">7
&lt;/span>&lt;span class="lnt">8
&lt;/span>&lt;span class="lnt">9
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">
&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span> &lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">bytes&lt;/span> &lt;span class="p">[]&lt;/span>&lt;span class="kt">byte&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="kt">int&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">numBytesWritten&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Write&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">bytes&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">numBytesWritten&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="mi">0&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">numBytesWritten&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æœ€åå…³é—­ socket å¯ä»¥è°ƒç”¨ &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=close&amp;amp;apropos=0&amp;amp;sektion=2">close()&lt;/a> ï¼Œå¹¶ä¼ å…¥ socket å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">error&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ä¸ºäº†ç¨åèƒ½æ‰“å°ä¸€äº›æœ‰ç”¨çš„é”™è¯¯å’Œæ—¥å¿—ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦å®ç° &lt;code>fmt.Stringer&lt;/code> æ¥å£ã€‚
æˆ‘ä»¬é€šè¿‡ä¸åŒçš„æ–‡ä»¶æè¿°ç¬¦æ¥åŒºåˆ†ä¸åŒçš„ socketã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">String&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="kt">string&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">strconv&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Itoa&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="ç›‘å¬ä¸€ä¸ª-socket">ç›‘å¬ä¸€ä¸ª Socket&lt;/h3>
&lt;p>å®šä¹‰å¥½ Socket ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åˆå§‹åŒ–å®ƒï¼Œå¹¶è®©å®ƒä¸€ä¸ªç›‘å¬ç‰¹å®š IP å’Œ ç«¯å£çš„ã€‚
ç›‘å¬ä¸€ä¸ª socket ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›ç³»ç»Ÿå‡½æ•°æ¥å®ç°ã€‚
ç°åœ¨å…ˆæ•´ä½“çœ‹ä¸€ä¸‹æˆ‘ä»¬å®ç°çš„ &lt;code>Listen()&lt;/code> æ–¹æ³•ï¼Œç„¶åå†ä¸€æ­¥æ­¥è¿›è¡Œåˆ†æã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kd">func&lt;/span> &lt;span class="nf">Listen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ip&lt;/span> &lt;span class="kt">string&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">port&lt;/span> &lt;span class="kt">int&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">socket&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">{}&lt;/span>
&lt;span class="nx">socketFileDescriptor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Socket&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">AF_INET&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SOCK_STREAM&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to create socket (%v)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">socketFileDescriptor&lt;/span>
&lt;span class="nx">socketAddress&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SockaddrInet4&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">Port&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">port&lt;/span>&lt;span class="p">}&lt;/span>
&lt;span class="nb">copy&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socketAddress&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Addr&lt;/span>&lt;span class="p">[:],&lt;/span> &lt;span class="nx">net&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ParseIP&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">ip&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Bind&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">socketAddress&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to bind socket (%v)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="p">=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Listen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SOMAXCONN&lt;/span>&lt;span class="p">);&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to listen on socket (%v)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="nx">socket&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>é¦–å…ˆè°ƒç”¨äº† &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=socket&amp;amp;apropos=0&amp;amp;sektion=2">socket()&lt;/a> å‡½æ•°ï¼Œ
è¿™å°†ä¼šåˆ›å»ºé€šä¿¡çš„æ¥å…¥ç‚¹ï¼Œå¹¶è¿”å›æè¿°ç¬¦ç¼–å·ã€‚
å®ƒéœ€è¦ 3 ä¸ªå‚æ•°ï¼š&lt;/p>
&lt;ul>
&lt;li>åœ°å€ç±»å‹ï¼šæˆ‘ä»¬ç”¨çš„æ˜¯ &lt;code>AF_INET&lt;/code> (IPv4)&lt;/li>
&lt;li>socket ç±»å‹ï¼šæˆ‘ä»¬ç”¨ &lt;code>SOCKET_STREAM&lt;/code>ï¼Œä»£è¡¨åŸºäºå­—èŠ‚æµè¿ç»­ã€å¯é çš„åŒå‘è¿æ¥ã€‚&lt;/li>
&lt;li>åè®®ç±»å‹ï¼š&lt;code>0&lt;/code> åœ¨ &lt;code>SOCKET_STREAM&lt;/code> ç±»å‹ä¸‹ä»£è¡¨çš„æ˜¯ TCPã€‚&lt;/li>
&lt;/ul>
&lt;p>ç„¶åï¼Œæˆ‘ä»¬è°ƒç”¨äº† &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=bind&amp;amp;apropos=0&amp;amp;sektion=2">bind()&lt;/a> æ–¹æ³•æ¥æŒ‡å®šæ–°åˆ›å»º socket çš„åè®®åœ°å€ã€‚
&lt;code>bind()&lt;/code> æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯åŒ…å«åœ°å€ä¿¡æ¯çš„ç»“æ„ä½“æŒ‡é’ˆã€‚
æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº† Go é¢„å®šä¹‰çš„ &lt;code>SockaddrInet4&lt;/code> ç»“æ„ä½“ï¼Œå¹¶æŒ‡å®šè¦ç»‘å®šçš„ IP åœ°å€å’Œç«¯å£ã€‚&lt;/p>
&lt;p>æœ€åï¼Œæˆ‘ä»¬è°ƒç”¨äº† &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=listen&amp;amp;apropos=0&amp;amp;sektion=2">listen()&lt;/a> æ–¹æ³•ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ç­‰å¾…æ¥æ”¶è¿æ¥äº†ã€‚
å®ƒçš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯è¿æ¥è¯·æ±‚é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚
æˆ‘ä»¬ä½¿ç”¨äº†å†…æ ¸å‚æ•° &lt;code>SOMAXCONN&lt;/code> ï¼Œåœ¨æˆ‘çš„ Mac ä¸Šé»˜è®¤æ˜¯ 128ã€‚
ä½ å¯ä»¥é€šè¿‡æ‰§è¡Œ &lt;code>sysctl kern.ipc.somaxconn&lt;/code> æ¥è·å–è¿™ä¸ªå€¼ã€‚&lt;/p>
&lt;h3 id="å®šä¹‰äº‹ä»¶å¾ªç¯">å®šä¹‰äº‹ä»¶å¾ªç¯&lt;/h3>
&lt;p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å°†å®šä¹‰ä¸€ä¸ªç»“æ„ä½“æ¥è¡¨ç¤º kqueue çš„äº‹ä»¶å¾ªç¯ã€‚
æˆ‘ä»¬å¿…é¡»è¦ä¿å­˜ kqueue çš„æ–‡ä»¶æè¿°ç¬¦ä»¥åŠ socket çš„æ–‡ä»¶æè¿°ç¬¦,
æˆ‘ä»¬å½“ç„¶ä¹Ÿèƒ½å°†æˆ‘ä»¬å‰é¢å®šä¹‰çš„ socket å¯¹è±¡ä½œä¸ºæŒ‡é’ˆæ¥æ›¿ä»£ &lt;code>SocketFileDescriptor&lt;/code>ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt">1
&lt;/span>&lt;span class="lnt">2
&lt;/span>&lt;span class="lnt">3
&lt;/span>&lt;span class="lnt">4
&lt;/span>&lt;span class="lnt">5
&lt;/span>&lt;span class="lnt">6
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">
&lt;span class="kd">type&lt;/span> &lt;span class="nx">EventLoop&lt;/span> &lt;span class="kd">struct&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">KqueueFileDescriptor&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="nx">SocketFileDescriptor&lt;/span> &lt;span class="kt">int&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ ¹æ®æˆ‘ä»¬æä¾›çš„ socket åˆ›å»ºä¸€ä¸ªäº‹ä»¶å¾ªç¯ã€‚
å’Œä¹‹å‰ä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ç³»åˆ—ç³»ç»Ÿå‡½æ•°å»åˆ›å»º Kqueueã€‚
æˆ‘ä»¬è¿˜æ˜¯å…ˆçœ‹ä¸‹æ•´ä¸ªå‡½æ•°ï¼Œç„¶åå†ä¸€æ­¥æ­¥æ‹†è§£æ¥çœ‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">
&lt;span class="kd">func&lt;/span> &lt;span class="nf">NewEventLoop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="o">*&lt;/span>&lt;span class="nx">EventLoop&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="kt">error&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">kQueue&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Kqueue&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to create kqueue file descriptor (%v)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">changeEvent&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kevent_t&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Ident&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">uint64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">Filter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EVFILT_READ&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EV_ADD&lt;/span> &lt;span class="p">|&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EV_ENABLE&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Fflags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Data&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Udata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">changeEventRegistered&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Kevent&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">kQueue&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">[]&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kevent_t&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">changeEvent&lt;/span>&lt;span class="p">},&lt;/span>
&lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="kc">nil&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">changeEventRegistered&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">fmt&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Errorf&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;failed to register change event (%v)&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">return&lt;/span> &lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">EventLoop&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">KqueueFileDescriptor&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">kQueue&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">SocketFileDescriptor&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">FileDescriptor&lt;/span>
&lt;span class="p">},&lt;/span> &lt;span class="kc">nil&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¬¬ä¸€ä¸ªç³»ç»Ÿå‡½æ•° &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=kqueue&amp;amp;apropos=0&amp;amp;sektion=0&amp;amp;format=html">kqueue()&lt;/a> åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å†…æ ¸äº‹ä»¶é˜Ÿåˆ—ï¼Œå¹¶ä¸”è¿”å›äº†å®ƒçš„æ–‡ä»¶æè¿°ç¬¦ã€‚
æˆ‘ä»¬ç­‰ä¼šè°ƒç”¨ &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=kqueue&amp;amp;apropos=0&amp;amp;sektion=0&amp;amp;format=html">&lt;code>kevent()&lt;/code>&lt;/a> çš„æ—¶å€™ä¼šç”¨åˆ°è¿™ä¸ªé˜Ÿåˆ—ã€‚
&lt;code>kevent()&lt;/code> æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œè®¢é˜…æ–°äº‹ä»¶å’Œè½®è¯¢é˜Ÿåˆ—ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬çš„ä¾‹å­æ˜¯è¦è®¢é˜…ä¼ å…¥è¿æ¥çš„äº‹ä»¶ï¼Œ
å¯ä»¥é€šè¿‡ä¼ é€’ &lt;code>kevent&lt;/code> ç»“æ„ä½“ï¼ˆåœ¨ Go ä¸­ï¼Œç”¨ &lt;code>Kevent_t&lt;/code> è¡¨ç¤ºï¼‰ç»™ &lt;code>kevent()&lt;/code> è¿™ä¸ªç³»ç»Ÿå‡½æ•°æ¥å®ç°è®¢é˜…ã€‚
&lt;code>Kevent_t&lt;/code> éœ€è¦åŒ…å«ä»¥ä¸‹ä¿¡æ¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;code>Ident&lt;/code> çš„æ–‡ä»¶æè¿°ç¬¦ï¼šå€¼æ˜¯æˆ‘ä»¬ socket çš„æ–‡ä»¶æè¿°ç¬¦&lt;/li>
&lt;li>å¤„ç†äº‹ä»¶çš„ &lt;code>Filter&lt;/code>ï¼šè®¾ç½®ä¸º &lt;code>EVFILT_READ&lt;/code>ï¼Œå½“å’Œç›‘å¬ socket ä¸€èµ·ç”¨æ—¶ï¼Œå®ƒä»£è¡¨æˆ‘ä»¬åªå…³å¿ƒä¼ å…¥è¿æ¥çš„äº‹ä»¶ã€‚&lt;/li>
&lt;li>ä»£è¡¨å¯¹è¿™ä¸ªäº‹ä»¶è¦æ‰§è¡Œæ“ä½œçš„ &lt;code>Flag&lt;/code>ï¼šåœ¨æˆ‘ä»¬ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æƒ³è¦æ·»åŠ ï¼ˆEV_ADDï¼‰äº‹ä»¶åˆ° &lt;code>kqueue&lt;/code>ï¼Œæ¯”å¦‚è¯´è®¢é˜…äº‹ä»¶ï¼ŒåŒæ—¶è¦å¯ç”¨ï¼ˆEV_ENABLEï¼‰å®ƒã€‚Flag å¯ä»¥ä½¿ç”¨ &lt;code>æˆ–&lt;/code> è¿™ä¸ªä½æ“ä½œè¿›è¡Œç»“åˆã€‚&lt;/li>
&lt;/ul>
&lt;p>å…¶ä»–çš„å‡ ä¸ªå‚æ•°æˆ‘ä»¬å°±ä¸éœ€è¦äº†ï¼Œåˆ›å»ºå¥½è¿™ä¸ªäº‹ä»¶ä¹‹åï¼Œè¦æŠŠå®ƒç”¨ä¸€ä¸ªæ•°ç»„åŒ…è£¹ï¼Œå¹¶ä¼ é€’ç»™ &lt;code>kevent()&lt;/code> è¿™ä¸ªç³»ç»Ÿå‡½æ•°ã€‚
æœ€åï¼Œæˆ‘ä»¬è¿”å›è¿™ä¸ªç­‰å¾…è¢«è½®è¯¢çš„äº‹ä»¶å¾ªç¯ã€‚æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®ç°è½®è¯¢çš„å‡½æ•°ã€‚&lt;/p>
&lt;h3 id="äº‹ä»¶å¾ªç¯è½®è¯¢">äº‹ä»¶å¾ªç¯è½®è¯¢&lt;/h3>
&lt;p>äº‹ä»¶å¾ªç¯æ˜¯ä¸€ä¸ªç®€å•çš„ for å¾ªç¯ï¼Œå¯ä»¥è½®è¯¢æ–°çš„å†…æ ¸äº‹ä»¶å¹¶è¿›è¡Œå¤„ç†ã€‚
ä¹‹å‰ä½¿ç”¨ç³»ç»Ÿå‡½æ•° &lt;code>kevent()&lt;/code> æ—¶ï¼Œè®¢é˜…è½®è¯¢å°±å·²ç»å®Œæˆäº†ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åˆä¼ é€’ä¸€ä¸ªç©ºçš„äº‹ä»¶æ•°ç»„ç»™å®ƒï¼Œ
ç›®çš„æ˜¯å½“æœ‰æ–°çš„äº‹ä»¶æ—¶ï¼Œæ–°çš„äº‹ä»¶ä¼šå¡«å……åˆ°è¿™ä¸ªæ•°ç»„ã€‚&lt;/p>
&lt;p>ç„¶åæˆ‘ä»¬å°±å¯ä»¥ä¸€ä¸ªä¸ªå¾ªç¯è¿™äº›äº‹ä»¶å¹¶å¤„ç†å®ƒä»¬äº†ã€‚
æ–°çš„å®¢æˆ·ç«¯è¿æ¥ä¼šè¢«è½¬æ¢æˆå®¢æˆ·ç«¯ socketï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä»å®¢æˆ·ç«¯è¯»å–æˆ–å†™å…¥æ•°æ®ã€‚
ç°åœ¨è®©æˆ‘ä»¬çœ‹ä¸‹ä»£ç å¦‚ä½•å¾ªç¯ä¸åŒçš„äº‹ä»¶ç±»å‹ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;span class="lnt">29
&lt;/span>&lt;span class="lnt">30
&lt;/span>&lt;span class="lnt">31
&lt;/span>&lt;span class="lnt">32
&lt;/span>&lt;span class="lnt">33
&lt;/span>&lt;span class="lnt">34
&lt;/span>&lt;span class="lnt">35
&lt;/span>&lt;span class="lnt">36
&lt;/span>&lt;span class="lnt">37
&lt;/span>&lt;span class="lnt">38
&lt;/span>&lt;span class="lnt">39
&lt;/span>&lt;span class="lnt">40
&lt;/span>&lt;span class="lnt">41
&lt;/span>&lt;span class="lnt">42
&lt;/span>&lt;span class="lnt">43
&lt;/span>&lt;span class="lnt">44
&lt;/span>&lt;span class="lnt">45
&lt;/span>&lt;span class="lnt">46
&lt;/span>&lt;span class="lnt">47
&lt;/span>&lt;span class="lnt">48
&lt;/span>&lt;span class="lnt">49
&lt;/span>&lt;span class="lnt">50
&lt;/span>&lt;span class="lnt">51
&lt;/span>&lt;span class="lnt">52
&lt;/span>&lt;span class="lnt">53
&lt;/span>&lt;span class="lnt">54
&lt;/span>&lt;span class="lnt">55
&lt;/span>&lt;span class="lnt">56
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kd">func&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="nx">eventLoop&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">EventLoop&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="nf">Handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">handler&lt;/span> &lt;span class="nx">Handler&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">newEvents&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">make&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kevent_t&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">10&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">numNewEvents&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Kevent&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">eventLoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KqueueFileDescriptor&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">newEvents&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="kc">nil&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span> &lt;span class="p">&amp;lt;&lt;/span> &lt;span class="nx">numNewEvents&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="nx">i&lt;/span>&lt;span class="o">++&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">currentEvent&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">newEvents&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="nx">i&lt;/span>&lt;span class="p">]&lt;/span>
&lt;span class="nx">eventFileDescriptor&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">currentEvent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Ident&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">currentEvent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Flags&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EV_EOF&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// client closing connection
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">eventFileDescriptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">eventFileDescriptor&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="nx">eventLoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">SocketFileDescriptor&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// new incoming connection
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nx">socketConnection&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">_&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Accept&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">eventFileDescriptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">socketEvent&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kevent_t&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">Ident&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">uint64&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">socketConnection&lt;/span>&lt;span class="p">),&lt;/span>
&lt;span class="nx">Filter&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EVFILT_READ&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Flags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EV_ADD&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Fflags&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Data&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="nx">Udata&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">socketEventRegistered&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Kevent&lt;/span>&lt;span class="p">(&lt;/span>
&lt;span class="nx">eventLoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">KqueueFileDescriptor&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="p">[]&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Kevent_t&lt;/span>&lt;span class="p">{&lt;/span>&lt;span class="nx">socketEvent&lt;/span>&lt;span class="p">},&lt;/span>
&lt;span class="kc">nil&lt;/span>&lt;span class="p">,&lt;/span>
&lt;span class="kc">nil&lt;/span>
&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">socketEventRegistered&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="o">-&lt;/span>&lt;span class="mi">1&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">continue&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span> &lt;span class="k">else&lt;/span> &lt;span class="k">if&lt;/span> &lt;span class="nx">currentEvent&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Filter&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">syscall&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">EVFILT_READ&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="c1">// data available -&amp;gt; forward to handler
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="nf">handler&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="o">&amp;amp;&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">{&lt;/span>
&lt;span class="nx">FileDescriptor&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="nb">int&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">eventFileDescriptor&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="c1">// ignore all other events
&lt;/span>&lt;span class="c1">&lt;/span> &lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>ç¬¬ä¸€ç§æƒ…å†µï¼Œæˆ‘ä»¬è¦å¤„ç† &lt;code>EV_EOF&lt;/code> äº‹ä»¶ï¼Œä»£è¡¨å®¢æˆ·ç«¯æƒ³è¦å…³é—­å®ƒçš„è¿æ¥çš„äº‹ä»¶ã€‚è¿™ç§æƒ…å†µæˆ‘ä»¬ç®€å•çš„å…³é—­äº†å¯¹åº” socket çš„æ–‡ä»¶æè¿°ç¬¦ã€‚&lt;/p>
&lt;p>ç¬¬äºŒç§æƒ…å†µä»£è¡¨æˆ‘ä»¬çš„ç›‘å¬ socket æœ‰è¿æ¥è¯·æ±‚ã€‚
æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç³»ç»Ÿå‡½æ•° &lt;a href="https://www.freebsd.org/cgi/man.cgi?query=accept">accept()&lt;/a> ä» TCP è¿æ¥è¯·æ±‚é˜Ÿåˆ—ä¸­è·å–è¿æ¥è¯·æ±‚ï¼Œ
å®ƒä¼šä¸ºç›‘å¬ socket åˆ›å»ºä¸€ä¸ªæ–°çš„å®¢æˆ·ç«¯ socket å’Œæ–°çš„æ–‡ä»¶æè¿°ç¬¦ã€‚
æˆ‘ä»¬ä¸ºè¿™ä¸ªæ–°åˆ›å»ºçš„ socket è®¢é˜…ä¸€ä¸ªæ–°çš„ &lt;code>EVFILT_READ&lt;/code> äº‹ä»¶ã€‚
åœ¨æ–°åˆ›å»ºçš„å®¢æˆ·ç«¯ socket ä¸­ï¼Œæ— è®ºä»€ä¹ˆæ—¶å€™æœ‰å¯ä»¥è¯»å–çš„æ•°æ®ï¼Œå°±ä¼šæœ‰ &lt;code>EVFILT_READ&lt;/code> äº‹ä»¶å‘ç”Ÿã€‚&lt;/p>
&lt;p>ç¬¬ä¸‰ç§æƒ…å†µå°±æ˜¯å¤„ç†åˆšæåˆ°çš„ &lt;code>EVFILT_READ&lt;/code> äº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶æœ‰å®¢æˆ·ç«¯ socket çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œ
æˆ‘ä»¬å°†å…¶å°è£…åœ¨ &lt;code>Socket&lt;/code> å¯¹è±¡ä¸­å¹¶ä¼ é€’ç»™è¦å¤„ç†å®ƒçš„æ–¹æ³•ã€‚&lt;/p>
&lt;p>è¦æ³¨æ„æˆ‘ä»¬çœç•¥ä¸€äº›é”™è¯¯ç„¶åä½¿ç”¨äº†ç®€å•çš„ continue ç»§ç»­æ‰§è¡Œå¾ªç¯ã€‚ç°åœ¨äº‹ä»¶å¾ªç¯å‡½æ•°ä¹Ÿå†™å¥½äº†ï¼Œè®©æˆ‘ä»¬å°†æ‰€æœ‰çš„é€»è¾‘å°è£…åœ¨ main å‡½æ•°ä¸­å¹¶æ‰§è¡Œã€‚&lt;/p>
&lt;h3 id="main-å‡½æ•°">main å‡½æ•°&lt;/h3>
&lt;p>å› ä¸ºä¹‹å‰å·²ç»å®šä¹‰å¥½äº† &lt;code>socket&lt;/code> å’Œ &lt;code>kqueue&lt;/code> æ¨¡å—ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥éå¸¸å®¹æ˜“åœ°å®ç°æœåŠ¡å™¨ã€‚
æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªç›‘å¬ç‰¹å®š IP åœ°å€å’Œç«¯å£çš„ socketï¼Œç„¶ååŸºäºå®ƒåˆ›å»ºä¸€ä¸ªæ–°çš„äº‹ä»¶å¾ªç¯ï¼Œ
æœ€åæˆ‘ä»¬å®šä¹‰å¤„ç†è¾“å‡ºçš„å‡½æ•°ï¼Œæ¥å¼€å¯æˆ‘ä»¬çš„äº‹ä»¶å¾ªç¯ã€‚&lt;/p>
&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre class="chroma">&lt;code class="language-golang" data-lang="golang">&lt;span class="kd">func&lt;/span> &lt;span class="nf">main&lt;/span>&lt;span class="p">()&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Listen&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;127.0.0.1&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="mi">8080&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to create Socket:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">eventLoop&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">kqueue&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewEventLoop&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Failed to create event loop:&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">os&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Exit&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="mi">1&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">log&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Println&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="s">&amp;#34;Server started. Waiting for incoming connections. ^C to exit.&amp;#34;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="nx">eventLoop&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Handle&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="kd">func&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="nx">socket&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nx">Socket&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">reader&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">bufio&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">NewReader&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">s&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">for&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="nx">line&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">:=&lt;/span> &lt;span class="nx">reader&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">ReadString&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="sc">&amp;#39;\n&amp;#39;&lt;/span>&lt;span class="p">)&lt;/span>
&lt;span class="k">if&lt;/span> &lt;span class="nx">err&lt;/span> &lt;span class="o">!=&lt;/span> &lt;span class="kc">nil&lt;/span> &lt;span class="o">||&lt;/span> &lt;span class="nx">strings&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">TrimSpace&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">line&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="s">&amp;#34;&amp;#34;&lt;/span> &lt;span class="p">{&lt;/span>
&lt;span class="k">break&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Write&lt;/span>&lt;span class="p">([]&lt;/span>&lt;span class="nb">byte&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="nx">line&lt;/span>&lt;span class="p">))&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;span class="nx">s&lt;/span>&lt;span class="p">.&lt;/span>&lt;span class="nf">Close&lt;/span>&lt;span class="p">()&lt;/span>
&lt;span class="p">})&lt;/span>
&lt;span class="p">}&lt;/span>
&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;p>å¤„ç†å‡½æ•°ä¼šæ ¹æ®æ¢è¡Œç¬¦é€è¡Œè¯»å–æ•°æ®å†…å®¹ï¼Œç›´åˆ°å®ƒè¯»å–åˆ°ç©ºè¡Œï¼Œç„¶åä¼šå…³é—­è¿æ¥ã€‚
æˆ‘ä»¬å¯ä»¥é€šè¿‡ &lt;code>curl&lt;/code> æ¥æµ‹è¯•ï¼Œ&lt;code>curl&lt;/code> å°†ä¼šå‘é€ä¸€ä¸ª GET è¯·æ±‚ï¼Œå¹¶è¾“å‡ºå“åº”çš„å†…å®¹ï¼Œå“åº”å†…å®¹å…¶å®å°±æ˜¯å®ƒå‘é€çš„ GET è¯·æ±‚ä½“çš„å†…å®¹ã€‚&lt;/p>
&lt;p>&lt;img src="https://raw.githubusercontent.com/h1z3y3/gctt-images2/master/20210219-Writing-A-Simple-TCP-Server-Using-Kqueue/demo.gif" alt="">&lt;/p>
&lt;h2 id="æ€è€ƒ">æ€è€ƒ&lt;/h2>
&lt;p>æˆ‘ä»¬æˆåŠŸç”¨ &lt;code>kqueue&lt;/code> å®ç°äº†ä¸€ä¸ªç®€å•çš„ TCP Serverï¼Œå½“ç„¶ï¼Œè¿™ä¸ªä»£ç æƒ³ç”¨äºç”Ÿäº§ç¯å¢ƒè¿˜éœ€è¦åšå¾ˆå¤šå·¥ä½œã€‚
æˆ‘ä»¬ä½¿ç”¨å•è¿›ç¨‹å’Œé˜»å¡ socket è¿è¡Œï¼Œå¦å¤–ï¼Œä¹Ÿæ²¡æœ‰å»å¤„ç†é”™è¯¯ã€‚
å…¶å®å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œä½¿ç”¨å·²ç»å­˜åœ¨çš„åº“è€Œä¸æ˜¯è‡ªå·±è°ƒç”¨æ“ä½œç³»ç»Ÿå†…æ ¸å‡½æ•°ä¼šæ›´å¥½ã€‚&lt;/p>
&lt;p>æ²¡æƒ³åˆ°ç”¨å†…æ ¸æ“ä½œäº‹ä»¶è¿™ä¹ˆéš¾ï¼ŒAPI éå¸¸å¤æ‚ï¼Œè€Œä¸”å¿…é¡»è¦è¯»å¥½å¤šæ–‡æ¡£å»æ‰¾éœ€è¦æ€ä¹ˆåšã€‚
ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªæƒŠäººçš„å­¦ä¹ ä½“éªŒã€‚&lt;/p>
&lt;hr>
&lt;p>via: &lt;a href="https://dev.to/frosnerd/writing-a-simple-tcp-server-using-kqueue-cah">https://dev.to/frosnerd/writing-a-simple-tcp-server-using-kqueue-cah&lt;/a>&lt;/p>
&lt;p>ä½œè€…ï¼š&lt;a href="https://dev.to/frosnerd">Frank Rosner&lt;/a>
è¯‘è€…ï¼š&lt;a href="https://github.com/h1z3y3">h1z3y3&lt;/a>
æ ¡å¯¹ï¼š&lt;a href="https://github.com/polarisxu">polarisxu&lt;/a>&lt;/p>
&lt;p>æœ¬æ–‡ç”± &lt;a href="https://github.com/studygolang/GCTT">GCTT&lt;/a> åŸåˆ›ç¼–è¯‘ï¼Œ&lt;a href="https://studygolang.com/">Go ä¸­æ–‡ç½‘&lt;/a> è£èª‰æ¨å‡º&lt;/p></description><category domain="https://h1z3y3.me/tags/golang/">Golang</category><category domain="https://h1z3y3.me/tags/gctt/">GCTT</category></item><item><title>è¯‘ï¼šHTTP/3 æ¥äº†</title><link>https://h1z3y3.me/posts/http3/</link><guid isPermaLink="true">https://h1z3y3.me/posts/http3/</guid><pubDate>Thu, 06 Dec 2018 14:43:12 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è‹±æ–‡åŸæ–‡é“¾æ¥ï¼š&lt;a href="https://www.zdnet.com/article/http-over-quic-to-be-renamed-http3/">https://www.zdnet.com/article/http-over-quic-to-be-renamed-http3/&lt;/a>&lt;/p>
&lt;p>æ® IETF å®˜æ–¹äººå‘˜é€éœ²ï¼ŒHTTP-over-QUIC å®éªŒæ–¹æ¡ˆå°†ä¼šè¢«å‘½åä¸º HTTP/3ï¼Œå¹¶å°†æˆä¸º HTTP åè®®çš„ç¬¬ä¸‰ä¸ªå®˜æ–¹ç‰ˆæœ¬ã€‚ &lt;br>
åœ¨è°·æ­Œå°† SPDY æŠ€æœ¯å‘å±•æˆä¸º HTTP/2 åè®®ä¹‹åï¼Œè¿™æ˜¯è°·æ­Œç¬¬äºŒæ¬¡å°†å®éªŒæŠ€æœ¯å‘å±•æˆä¸º HTTP çš„å®˜æ–¹åè®®ç‰ˆæœ¬ã€‚ &lt;br>
HTTP-over-QUIC åè®®æ˜¯ HTTP åè®®çš„å‡çº§ï¼Œè°·æ­Œä½¿ç”¨ QUIC å–ä»£ TCP (Transmission Control Protocal) ä½œä¸º HTTP çš„åŸºç¡€æŠ€æœ¯ã€‚ &lt;br>
QUIC å…¨ç§° Quick UDP Internet Connectionsï¼Œæ˜¯è°·æ­Œå°† TCP åè®®é‡å†™ä¸ºä¸€ç§ç»“åˆäº†HTTP/2ã€TCPã€UDP å’Œ TLS çš„æ”¹è¿›æŠ€æœ¯ã€‚&lt;/p>
&lt;p>è°·æ­Œå¸Œæœ› QUIC èƒ½é€æ¸å–ä»£ TCP å’Œ UDP æˆä¸ºåœ¨å› ç‰¹ç½‘ä¼ è¾“äºŒè¿›åˆ¶æ•°æ®åè®®çš„æ–°é€‰æ‹©ï¼Œè€Œä½¿ç”¨å®ƒçš„æ›´å¥½çš„ç†ç”±ï¼Œæ˜¯ QUIC çš„åŠ å¯†æ–¹æ¡ˆå®ç°å·²ç»è¢«æµ‹è¯•è¯æ˜æ›´å¿«è€Œä¸”æ›´å®‰å…¨ (ç›®å‰ HTTP-over-QUIC åè®®è‰æ¡ˆä½¿ç”¨çš„æ˜¯ TLS1.3 åè®®)ã€‚&lt;/p>
&lt;p>&lt;img src="https://p4.ssl.qhimg.com/t01f147b97634e732d0.png" alt="Google">&lt;/p>
&lt;p>QUIC è¢«æè®®ä½œä¸º2015å¹´ IETF çš„æ ‡å‡†è‰æ¡ˆï¼Œè€Œ HTTP-over-QUIC è¿™ä¸ªåŸºäº QUIC è€Œä¸æ˜¯ TCP é‡å†™ HTTP çš„åè®®åˆ™åœ¨2016å¹´7æœˆè¢«æè®®ã€‚ &lt;br>
åœ¨é‚£ä¹‹åï¼ŒHTTP-over-QUIC åœ¨ Chrome 29ã€Opera 16 è¢«æ”¯æŒï¼Œå½“ç„¶è¿˜æœ‰ä¸€äº›ä½æ€§èƒ½çš„æµè§ˆå™¨ã€‚æœ€åˆï¼Œåªæœ‰è°·æ­Œçš„æœåŠ¡å™¨æ”¯æŒ HTTP-over-QUICï¼Œä»Šå¹´ï¼ŒFacebookä¹Ÿå¼€å§‹é‡‡ç”¨è¿™é¡¹æŠ€æœ¯ã€‚ &lt;br>
åœ¨2018å¹´10æœˆä»½çš„é‚®ä»¶è®¨è®ºé‡Œï¼ŒIETF HTTP å’Œ QUIC å·¥ä½œç»„çš„ä¸»å¸­ Mark Nottingham æå‡ºäº†å°† HTTP-over-QUIC é‡å‘½åä¸º HTTP/3 çš„å®˜æ–¹ç”³è¯·ï¼Œå¹¶å¸Œæœ›å°† QUIC å·¥ä½œç»„çš„å¼€å‘å·¥ä½œè½¬é€’ç»™ HTTP å·¥ä½œç»„ã€‚ &lt;br>
ç»è¿‡å‡ å¤©çš„è®¨è®ºï¼ŒNottingham çš„æè®®è¢« IETF çš„æˆå‘˜æ¥å—å¹¶ç»™å‡ºäº†å®˜æ–¹è®¤å¯ï¼Œå°† HTTP-over-QUIC ä½œä¸º HTTP åè®®çš„ä¸‹ä¸€ä¸ªç‰ˆæœ¬ â€”â€” HTTP/3ï¼Œç”¨äºå®Œå–„ä¼˜åŒ–å½“ä»Šçš„ç½‘ç»œã€‚ &lt;br>
æ ¹æ® W3Techs çš„ç»Ÿè®¡ï¼Œæˆªæ­¢2018å¹´11æœˆï¼Œå…¨çƒè®¿é—®é‡æœ€é«˜çš„1åƒä¸‡ä¸ªç½‘ç«™ä¸­ï¼Œå·²ç»æœ‰31.2%çš„ç½‘ç«™æ”¯æŒäº† HTTP/2ï¼Œåªæœ‰1.2%çš„ç½‘ç«™æ”¯æŒäº† QUICã€‚&lt;/p>
&lt;p>&lt;em>ä»¥ä¸‹æ˜¯è‡ªå·±çš„ä¸€ç‚¹æ€è€ƒï¼š&lt;/em>&lt;br>
å¯ä»¥çœ‹åˆ°ï¼ŒHTTP/3 åè®®å¸¦æ¥çš„æœ€å¤§æ”¹å˜æ˜¯åè®®åº•å±‚å°†é‡‡ç”¨ UDP åè®®ï¼Œè€Œä¸å†æ˜¯ TCP åè®®ï¼Œé‚£è¿™æ ·çš„å¥½å¤„å¯ä»¥è¯´æ˜¯æ›´ä½æ—¶å»¶å’Œæ›´å¥½çš„æ‹¥å¡æ§åˆ¶ï¼Œè¿˜æœ‰æ›´é«˜æ•ˆç‡çš„å¤šè·¯å¤ç”¨ï¼Œå¯ä»¥è¯´è°·æ­ŒçœŸçš„å¾ˆå‰å®³äº†ï¼Œè¦çŸ¥é“ HTTP/2 ä¹Ÿæ˜¯è°·æ­Œçš„ SPDY æ ‡å‡†åŒ–ä¹‹åçš„åè®®ã€‚è€Œä¸”è¿™æ¬¡ QUIC å‘éŸ³åŒ quick ï¼Œä¸Šæ¬¡ SPDY å‘éŸ³åŒ speedyï¼Œæ˜¯å·§åˆè¿˜æ˜¯æœ‰æ„ä¸ºä¹‹å‘¢ã€‚ï¼šï¼‰&lt;/p>
&lt;p>çœŸæ˜¯å¼ºè€…åˆ¶å®šè§„åˆ™ï¼š&lt;/p>
&lt;blockquote>
&lt;p>They are in control of future web protocol development.&lt;/p>
&lt;/blockquote></description><category domain="https://h1z3y3.me/tags/http/">HTTP</category></item><item><title>è®¾è®¡æ¨¡å¼ï¼šå·¥å‚æ–¹æ³•æ¨¡å¼</title><link>https://h1z3y3.me/posts/design-pattern-factory-method/</link><guid isPermaLink="true">https://h1z3y3.me/posts/design-pattern-factory-method/</guid><pubDate>Sun, 25 Nov 2018 18:01:29 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>å·¥å‚æ–¹æ³•æ¨¡å¼æ˜¯ç®€å•å·¥å‚çš„å‡çº§ã€‚ä»–åˆ›å»ºä¸€ä¸ªç”¨äºå®ä¾‹åŒ–ç±»çš„æ¥å£ï¼Œå¹¶ç”±å·¥å‚çš„å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ä½¿å¾—ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å­ç±»ã€‚&lt;/p>
&lt;p>ä¸‹é¢ä»ç„¶ä»¥â€œä¸¤ä¸ªæ•°å­—çš„è¿ç®—â€ä½œä¸ºä¾‹å­&lt;/p>
&lt;!-- more -->
&lt;p>operations.go // è¿ç®—ç±»&lt;/p>
&lt;pre>&lt;code>package factory_method
// è¿ç®—
type Operation interface {
SetA(float64)
SetB(float64)
GetResult() (float64, error)
}
// è¿ç®—åŸºç±»ï¼Œå®ç°å…¬å…±çš„æ–¹æ³•
type OperationBase struct {
a float64
b float64
}
func (oper *OperationBase) SetA(a float64) {
oper.a = a
}
func (oper *OperationBase) SetB(b float64) {
oper.b = b
}
// åŠ æ³•è¿ç®—
type AddOperation struct {
*OperationBase
}
func (oper *AddOperation) GetResult() (float64, error) {
return oper.a + oper.b, nil
}
// å‡æ³•è¿ç®—
type SubOperation struct {
*OperationBase
}
func (oper *SubOperation) GetResult() (float64, error) {
return oper.a - oper.b, nil
}
// ä¹˜æ³•å…ƒç®—
type MulOperation struct {
*OperationBase
}
func (oper *MulOperation) GetResult() (float64, error) {
return oper.a * oper.b, nil
}
&lt;/code>&lt;/pre>&lt;p>factory_method.go // å·¥å‚ç±»&lt;/p>
&lt;pre>&lt;code>package factory_method
// å·¥å‚ç±»
type OperationFactory interface {
CreateOperation() Operation
}
// åŠ æ³•å·¥å‚
type AddFactory struct {
}
func (f *AddFactory) CreateOperation() Operation {
return &amp;amp;AddOperation{
OperationBase: &amp;amp;OperationBase{},
}
}
// å‡æ³•å·¥å‚
type SubFactory struct {
}
func (f *SubFactory) CreateOperation() Operation {
return &amp;amp;SubOperation{
OperationBase: &amp;amp;OperationBase{},
}
}
// ä¹˜æ³•å·¥å‚
type MulFactory struct {
}
func (f *MulFactory) CreateOperation() Operation {
return &amp;amp;MulOperation{
OperationBase: &amp;amp;OperationBase{},
}
}
&lt;/code>&lt;/pre>&lt;p>æºç ä»¥åŠæµ‹è¯•æºç ä¸‹è½½åœ°å€ï¼š&lt;a href="https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/04_factory_method">https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/04_factory_method&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</category><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>è®¾è®¡æ¨¡å¼ï¼šä»£ç†æ¨¡å¼</title><link>https://h1z3y3.me/posts/design-pattern-proxy/</link><guid isPermaLink="true">https://h1z3y3.me/posts/design-pattern-proxy/</guid><pubDate>Sun, 25 Nov 2018 16:50:58 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä»£ç†æ¨¡å¼å³åœ¨çœŸå®ç±»çš„åŸºç¡€ä¸Šå°è£…ä¸€å±‚ä»£ç†ç±»ï¼Œç”±ä»£ç†ç±»å®Œæˆå¯¹çœŸå®ç±»çš„è°ƒç”¨ã€‚ &lt;br>
ä»¥ä¾¿å¯ä»¥åœ¨ä»£ç†ç±»ä¸­åšä¸€äº›é¢å¤–çš„å·¥ä½œï¼Œå¦‚è¿›è¡Œè®¿é—®æƒé™æ ¡éªŒã€ä¿å­˜Cacheç¼“å­˜ç­‰æ“ä½œã€‚&lt;/p>
&lt;p>ä¸‹é¢ä»¥&amp;quot;è¯»å–å›¾ç‰‡èµ„æº&amp;quot;ä¸ºä¾‹è¯´æ˜ä»£ç†æ¨¡å¼ï¼š&lt;/p>
&lt;!-- more -->
&lt;pre>&lt;code>package proxy
// æ¥å£ï¼Œä»£ç†ç±»å’ŒçœŸå®ç±»éƒ½è¦å®ç°
type Image interface {
Get() string
}
// çœŸå®çš„å›¾ç‰‡ç±»
type RealImage struct {}
func (r *RealImage) Get() string {
return &amp;quot;real_image_url&amp;quot;
}
// ä»£ç†ç±»
type ImageProxy struct {
realImage RealImage
}
// ç”±ä»£ç†ç±»è¿›è¡ŒåŸç±»çš„è°ƒç”¨ï¼Œä»è€Œèƒ½åœ¨åŸç±»åŸºç¡€ä¸Šåšä¸€äº›æ“ä½œ
func (r *ImageProxy) Get() string {
var res string
// pre: æƒé™æ£€æŸ¥ã€æŸ¥çœ‹æ˜¯å¦æœ‰cacheç­‰
res += &amp;quot;pre:&amp;quot;
res += r.realImage.Get()
// after: ä¿å­˜cacheã€æ ¼å¼åŒ–ç»“æœç­‰
res += &amp;quot;:after&amp;quot;
return res
}
&lt;/code>&lt;/pre>&lt;p>æºç ä»¥åŠæµ‹è¯•æºç ä¸‹è½½åœ°å€ï¼š&lt;a href="https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/03_proxy">https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/03_proxy&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</category><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>Linux:å¹³å‡è´Ÿè½½</title><link>https://h1z3y3.me/posts/linux-avarage-load/</link><guid isPermaLink="true">https://h1z3y3.me/posts/linux-avarage-load/</guid><pubDate>Sun, 25 Nov 2018 16:08:22 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;ol>
&lt;li>&lt;strong>å¹³å‡è´Ÿè½½&lt;/strong>æ˜¯å•ä½æ—¶é—´å†…â€œæ­£åœ¨ä½¿ç”¨CPUâ€ã€â€œç­‰å¾…CPUâ€ã€â€œç­‰å¾…IOâ€çš„è¿›ç¨‹æ•°é‡&lt;/li>
&lt;li>&lt;strong>å¹³å‡è´Ÿè½½&lt;/strong>å’Œ&lt;em>CPUä½¿ç”¨ç‡&lt;/em>ä¸ä¸€æ ·ï¼Œä½†æ˜¯CPUå¯†é›†å‹ä»»åŠ¡å¯èƒ½å¯¼è‡´å¹³å‡è´Ÿè½½å‡é«˜&lt;/li>
&lt;li>ç”±1ï¼Œ2å¯çŸ¥ï¼Œ&lt;strong>å¹³å‡è´Ÿè½½&lt;/strong>å‡é«˜ï¼Œä¸ä¸€å®šæ˜¯ç”±äºCPUä½¿ç”¨ç‡é«˜å¯¼è‡´ï¼Œä¹Ÿå¯èƒ½æ˜¯IOç¹å¿™&lt;/li>
&lt;li>é™¤äº†&lt;code>top&lt;/code>å‘½ä»¤ï¼Œè¿˜æœ‰&lt;code>mpstat&lt;/code>ã€&lt;code>pidstat&lt;/code>ç­‰å‘½ä»¤&lt;/li>
&lt;li>&lt;code>watch&lt;/code>å‘½ä»¤ï¼Œå¯ä»¥æ£€æµ‹ä¸€ä¸ªå‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œè€Œä¸å¿…ä¸€æ¬¡æ¬¡æ‰‹åŠ¨è¾“å…¥è¿è¡Œ&lt;/li>
&lt;li>&lt;code>uptime&lt;/code>å‘½ä»¤&lt;/li>
&lt;/ol></description><category domain="https://h1z3y3.me/tags/linux/">Linux</category></item><item><title>è®¾è®¡æ¨¡å¼ï¼šè£…é¥°å™¨æ¨¡å¼</title><link>https://h1z3y3.me/posts/design-pattern-decorator/</link><guid isPermaLink="true">https://h1z3y3.me/posts/design-pattern-decorator/</guid><pubDate>Tue, 06 Nov 2018 21:33:52 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è£…é¥°å™¨æ¨¡å¼ä¸»è¦è§£å†³è¦åŠ¨æ€çš„ç»™ä¸€ä¸ªç±»æ·»åŠ ä¸€äº›æ–°åŠŸèƒ½ï¼Œè€Œåˆä¸æƒ³è®©è¿™ä¸ªç±»å˜å¾—åºå¤§ã€‚
è¿™ç§æ¨¡å¼éœ€è¦åˆ›å»ºä¸€ä¸ªè£…é¥°ç±»æ¥åŒ…è£…æ‰©å±•åŸæœ‰çš„ç±»ï¼Œå¹¶ä¸”åœ¨ä¿è¯åŸæœ‰çš„ç±»ä¿æŒç»“æ„ä¸€è‡´çš„å‰æä¸‹ï¼Œæä¾›é¢å¤–çš„åŠŸèƒ½ã€‚&lt;/p>
&lt;p>ä¸‹é¢æ˜¯ç»™ä¸€ä¸ªäººè£…é¥°è¡£æœçš„å®ä¾‹ï¼š&lt;/p>
&lt;!-- more -->
&lt;pre>&lt;code>package decorator
import &amp;quot;fmt&amp;quot;
type Person interface {
Show()
}
// å…·ä½“å®ç°
type ConcreteComponent struct {
}
func (c *ConcreteComponent) Show() {
fmt.Print(&amp;quot;A Person wears sunglasses; &amp;quot;)
}
// ç”·äºº
type Man struct{}
func (m *Man) Show() {
fmt.Print(&amp;quot;A man wear a hat!&amp;quot;)
}
// å¥³äºº
type Woman struct{}
func (w *Woman) Show() {
fmt.Print(&amp;quot;A woman wear a skirt!&amp;quot;)
}
// TShirt
type TShirtDecorator struct {
Person
Color string
}
func (t *TShirtDecorator) Show() {
t.Person.Show() // è°ƒç”¨çˆ¶ç±»çš„ Show() æ–¹æ³•
// &amp;quot;è£…é¥°&amp;quot;: å¢åŠ è‡ªå·±ç‰¹æœ‰çš„å±æ€§
fmt.Print(fmt.Sprintf(&amp;quot;Color: %s, TShirt; &amp;quot;, t.Color))
}
func WearTShirt(p Person, c string) Person {
return &amp;amp;TShirtDecorator{
Person: p,
Color: c,
}
}
// Pants
type PantsDecorator struct {
Person
Length int64
}
func (p *PantsDecorator) Show() {
p.Person.Show()
fmt.Print(fmt.Sprintf(&amp;quot;Lenght: %dcm, Pants.; &amp;quot;, p.Length))
}
func WearPants(p Person, l int64) Person {
return &amp;amp;PantsDecorator{
Person: p,
Length: l,
}
}
// Shoes
type ShoesDecorator struct {
Person
Size int64
}
func (s *ShoesDecorator) Show() {
s.Person.Show()
fmt.Print(fmt.Sprintf(&amp;quot;Size: %d, Shoes; &amp;quot;, s.Size))
}
func WearShoes(p Person, s int64) Person {
return &amp;amp;ShoesDecorator{
Person: p,
Size: s,
}
}
// Examples
func ExampleConcrete_Wear() {
var p Person = &amp;amp;ConcreteComponent{}
p = WearTShirt(p, &amp;quot;Blue&amp;quot;)
p = WearPants(p, 100)
p = WearShoes(p, 42)
p.Show()
// Output: A Person wears sunglasses; Color: Blue, TShirt; Lenght: 100cm, Pants.; Size: 42, Shoes;
}
func ExampleMan_Show() {
var xiaoming Person = &amp;amp;Man{}
xiaoming = WearShoes(xiaoming, 43)
xiaoming = WearTShirt(xiaoming, &amp;quot;White&amp;quot;)
xiaoming.Show()
// Output:A man wear a hat!Size: 43, Shoes; Color: White, TShirt;
}
func ExampleWoman_Show() {
var xiaohong Person = &amp;amp;Woman{}
xiaohong = WearTShirt(xiaohong, &amp;quot;Red&amp;quot;)
xiaohong = WearShoes(xiaohong, 38)
xiaohong.Show()
// Output: A woman wear a skirt!Color: Red, TShirt; Size: 38, Shoes;
}
&lt;/code>&lt;/pre>&lt;p>æºç ä»¥åŠæµ‹è¯•æºç ä¸‹è½½åœ°å€ï¼š&lt;a href="https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/02_decorator">https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/02_decorator&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</category><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>è®¾è®¡æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼</title><link>https://h1z3y3.me/posts/design-pattern-strategy/</link><guid isPermaLink="true">https://h1z3y3.me/posts/design-pattern-strategy/</guid><pubDate>Wed, 24 Oct 2018 23:33:52 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>åœ¨ç­–ç•¥æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ç³»åˆ—ç­–ç•¥å¯¹è±¡å’Œä¸€ä¸ªèƒ½éšç­–ç•¥å¯¹è±¡æ”¹å˜è€Œæ”¹å˜çš„Contextå¯¹è±¡ï¼Œç­–ç•¥å¯¹è±¡æ”¹å˜Contextçš„æ‰§è¡Œæ–¹æ³•ã€‚&lt;/p>
&lt;p>ä»ä»¥ä¸¤ä¸ªæ•°å­—çš„åŠ å‡ä¹˜é™¤æ“ä½œä½œä¸ºç¤ºä¾‹&lt;/p>
&lt;!-- more -->
&lt;pre>&lt;code>package strategy
import &amp;quot;fmt&amp;quot;
// Context ç±»
type Context struct {
strategy Strategy
}
func NewContext(strategy Strategy) *Context {
return &amp;amp;Context{
strategy: strategy,
}
}
func (c *Context) GetResult(a float64, b float64) (float64, error) {
return c.strategy.GetResult(a, b)
}
// ç­–ç•¥æ¥å£
type Strategy interface {
GetResult(a float64, b float64) (float64, error)
}
// ä»¥ä¸‹ç±»å®ç°ç­–ç•¥æ¥å£
// åŠ æ³•
type Add struct{}
func (o *Add) GetResult(a float64, b float64) (float64, error) {
return a + b, nil
}
// å‡æ³•
type Sub struct{}
func (o *Sub) GetResult(a float64, b float64) (float64, error) {
return a - b, nil
}
// ä¹˜æ³•
type Mul struct{}
func (o *Mul) GetResult(a float64, b float64) (float64, error) {
return a * b, nil
}
// é™¤æ³•
type Div struct{}
func (o *Div) GetResult(a float64, b float64) (float64, error) {
if b == 0 {
return 0, fmt.Errorf(&amp;quot;é™¤æ•°ä¸èƒ½ä¸º0&amp;quot;)
}
return a / b, nil
}
&lt;/code>&lt;/pre>&lt;p>æºç ä»¥åŠæµ‹è¯•æºç ä¸‹è½½åœ°å€ï¼š&lt;a href="https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/01_strategy">https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/01_strategy&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</category><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>è®¾è®¡æ¨¡å¼ï¼šç®€å•å·¥å‚æ¨¡å¼</title><link>https://h1z3y3.me/posts/design-pattern-simple-factory/</link><guid isPermaLink="true">https://h1z3y3.me/posts/design-pattern-simple-factory/</guid><pubDate>Sun, 21 Oct 2018 20:58:52 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è¿™ä¸ªç³»åˆ—æ˜¯ã€Šå¤§è¯è®¾è®¡æ¨¡å¼ã€‹çš„è¯»åæ„Ÿï¼Œå°†ä¹¦ä¸­çš„è®¾è®¡æ¨¡å¼ç”¨golangå®ç°ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€ä¸ªè®¾è®¡æ¨¡å¼æ˜¯ç®€å•å·¥å‚æ¨¡å¼ï¼Œä¸»è¦ç”¨åˆ°çš„çŸ¥è¯†ç‚¹æ˜¯ç±»çš„&lt;strong>å¤šæ€&lt;/strong>ã€‚ &lt;br>
&lt;strong>å¤šæ€&lt;/strong>è¡¨ç¤ºä¸åŒçš„ç±»å¯ä»¥æ‰§è¡Œç›¸åŒçš„æ–¹æ³•ï¼Œä½†è¦é€šè¿‡å®ƒä»¬è‡ªå·±çš„å®ç°ä»£ç æ¥æ‰§è¡Œã€‚ &lt;br>
è€Œåœ¨golangä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©æ¥å£(interface)ç±»å‹å®ç°ç±»çš„å¤šæ€ã€‚&lt;br>
å¦‚æœä¸€ä¸ªç±»å‹å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œé‚£ä¹ˆå°±å¯ä»¥è¯´è¿™ä¸ªç±»å‹å®ç°äº†è¿™ä¸ªæ¥å£ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬è¦å®ç°ä¸¤ä¸ªæ•°å­—çš„åŠ å‡ä¹˜é™¤æ“ä½œä½œä¸ºç¤ºä¾‹&lt;/p>
&lt;!-- more -->
&lt;pre>&lt;code>package simplefactory
import &amp;quot;fmt&amp;quot;
// 1. å®šä¹‰ä¸€ä¸ªæ¥å£ç±»å‹ï¼Œå­ç±»å¿…é¡»å®ç°GoResultæ–¹æ³•æ¥å®ç°è¯¥æ¥å£
type Operation interface {
GetResult(a float64, b float64) (float64, error)
}
// 2. åˆå§‹åŒ–å·¥å‚ç±»æ–¹æ³•ï¼Œä¼ å…¥æ“ä½œç¬¦ï¼Œè¿”å›å¯¹åº”çš„ç±»
func NewOperation(oper string) Operation {
switch oper {
case &amp;quot;+&amp;quot;:
return &amp;amp;operationAdd{}
case &amp;quot;-&amp;quot;:
return &amp;amp;operationSub{}
case &amp;quot;*&amp;quot;:
return &amp;amp;operationMul{}
case &amp;quot;/&amp;quot;:
return &amp;amp;operationDiv{}
default:
return nil
}
}
// åŠ æ³•
type operationAdd struct{}
func (o *operationAdd) GetResult(a float64, b float64) (float64, error) {
return a + b, nil
}
// å‡æ³•
type operationSub struct{}
func (o *operationSub) GetResult(a float64, b float64) (float64, error) {
return a - b, nil
}
// ä¹˜æ³•
type operationMul struct{}
func (o *operationMul) GetResult(a float64, b float64) (float64, error) {
return a * b, nil
}
// é™¤æ³•
type operationDiv struct{}
func (o *operationDiv) GetResult(a float64, b float64) (float64, error) {
if b == 0 {
return 0, fmt.Errorf(&amp;quot;é™¤æ•°ä¸èƒ½ä¸º0&amp;quot;)
}
return a / b, nil
}
&lt;/code>&lt;/pre>&lt;p>æºç ä»¥åŠæµ‹è¯•æºç ä¸‹è½½åœ°å€ï¼š&lt;a href="https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/00_simple_factory">https://github.com/h1z3y3/big-talk-go-design-patterns/tree/master/00_simple_factory&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">è®¾è®¡æ¨¡å¼</category><category domain="https://h1z3y3.me/tags/golang/">Golang</category></item><item><title>è®¡ç®—å¯†é›†å‹ vs. IOå¯†é›†å‹</title><link>https://h1z3y3.me/posts/cpu-io/</link><guid isPermaLink="true">https://h1z3y3.me/posts/cpu-io/</guid><pubDate>Thu, 16 Nov 2017 21:56:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;blockquote>
&lt;p>è®¡ç®—å¯†é›†å‹ä»»åŠ¡&lt;/p>
&lt;/blockquote>
&lt;p>è®¡ç®—å¯†é›†å‹ä»»åŠ¡ä¸»è¦æ¶ˆè€—CPUèµ„æºï¼Œéœ€è¦è¿›è¡Œå¤§é‡çš„è®¡ç®—ï¼Œå¦‚è®¡ç®—åœ†å‘¨ç‡æˆ–å¯¹è§†é¢‘è¿›è¡Œé«˜æ¸…çš„è§£ç ç­‰ï¼Œå…¨é CPUçš„è¿ç®—èƒ½åŠ›ã€‚
è¿™ç§ä»»åŠ¡è™½ç„¶å¯ä»¥åˆ©ç”¨å¤šä»»åŠ¡å»å®Œæˆï¼Œä½†æ˜¯ä»»åŠ¡è¶Šå¤šï¼ŒèŠ±åœ¨ä»»åŠ¡åˆ‡æ¢ä¸Šçš„æ—¶é—´å°±ä¼šè¶Šå¤šï¼Œé‚£ä¹ˆCPUçš„æ‰§è¡Œæ•ˆç‡å°±ä¼šè¶Šä½ï¼Œ
æ‰€ä»¥ï¼Œè¦é«˜æ•ˆçš„åˆ©ç”¨CPUï¼Œè®¡ç®—å¯†é›†å‹ä»»åŠ¡åŒæ—¶è¿›è¡Œçš„æ•°é‡åº”å½“ç­‰äºCPUçš„æ ¸å¿ƒæ•°ï¼Œå°½é‡å‡å°‘CPUåœ¨ä»»åŠ¡é—´çš„åˆ‡æ¢æ—¶é—´ã€‚&lt;/p>
&lt;blockquote>
&lt;p>IOå¯†é›†å‹ä»»åŠ¡&lt;/p>
&lt;/blockquote>
&lt;p>ä¸€èˆ¬æ¶‰åŠåˆ°ç½‘ç»œã€ç£ç›˜IOçš„ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œè¿™ç±»ä»»åŠ¡çš„ç‰¹ç‚¹å°±æ˜¯CPUæ¶ˆè€—å¾ˆå°‘ï¼Œä»»åŠ¡çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½èŠ±åœ¨ç­‰å¾…IOæ“ä½œçš„å®Œæˆã€‚
ç”±äºIOçš„é€Ÿåº¦è¿œè¿œä½äºCPUå’Œå†…å­˜çš„é€Ÿåº¦ï¼Œæ‰€ä»¥IOå¯†é›†å‹ä»»åŠ¡çš„æ•°é‡è¶Šå¤šï¼ŒCPUçš„æ•ˆç‡å°±ä¼šè¶Šé«˜ï¼Œä½†æ˜¯ä¹Ÿä¼šæœ‰ä¸€å®šçš„é™åº¦ã€‚
å¸¸è§çš„å¤§éƒ¨åˆ†ä»»åŠ¡éƒ½æ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œæ¯”å¦‚Webåº”ç”¨ã€‚&lt;/p>
&lt;p>IOå¯†é›†å‹ä»»åŠ¡æ‰§è¡ŒæœŸé—´ï¼Œ99%çš„æ—¶é—´éƒ½èŠ±åœ¨IOä¸Šï¼ŒèŠ±åœ¨CPUä¸Šçš„æ—¶é—´å¾ˆå°‘ï¼Œå› æ­¤ï¼Œç”¨è¿è¡Œé€Ÿåº¦æå¿«çš„Cè¯­è¨€æ›¿æ¢Pythonè¿™æ ·è¿è¡Œé€Ÿåº¦æä½çš„è„šæœ¬è¯­è¨€ï¼Œ
ä¹Ÿå®Œå…¨æ— æ³•æå‡è¿è¡Œæ•ˆç‡ã€‚å¯¹äºIOå¯†é›†å‹ä»»åŠ¡ï¼Œæœ€åˆé€‚çš„è¯­è¨€å°±æ˜¯å¼€å‘æ•ˆç‡æœ€é«˜ï¼Œä»£ç é‡æœ€å°‘çš„è¯­è¨€ï¼Œè„šæœ¬è¯­è¨€æ˜¯é¦–é€‰ï¼ŒCè¯­è¨€æœ€å·®ã€‚&lt;/p>
&lt;blockquote>
&lt;p>æ€»ç»“&lt;/p>
&lt;/blockquote>
&lt;p>è®¡ç®—å¯†é›†å‹ç¨‹åºé€‚åˆCè¯­è¨€å¤šçº¿ç¨‹
IOå¯†é›†å‹ç¨‹åºé€‚åˆè„šæœ¬è¯­è¨€å¼€å‘çš„å¤šçº¿ç¨‹&lt;/p></description><category domain="https://h1z3y3.me/tags/%E5%9F%BA%E7%A1%80/">åŸºç¡€</category></item><item><title>å»é™¤CKFinderç‰ˆæƒä¿¡æ¯ä»¥åŠå¯ç”¨æ–‡ä»¶ç§»åŠ¨åŠŸèƒ½</title><link>https://h1z3y3.me/posts/remove-ckfinder-copyright/</link><guid isPermaLink="true">https://h1z3y3.me/posts/remove-ckfinder-copyright/</guid><pubDate>Sun, 14 May 2017 20:12:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>æœ€è¿‘åœ¨åšæ¯•ä¸šè®¾è®¡ï¼Œä½¿ç”¨åˆ°äº†CkEditorå’ŒCkFinderæ¥åšå¯Œæ–‡æœ¬ç¼–è¾‘æ¡†ä»¥åŠæ–‡ä»¶ç®¡ç†ã€‚
å› ä¸ºCkFinderåªèƒ½ä¸‹è½½ä½¿ç”¨Demoç‰ˆæœ¬ï¼Œä¼šæœ‰ä¸€äº›ç‰ˆæƒä¿¡æ¯ã€‚
æˆ‘ä¸æ˜¯ç”¨åšå•†ä¸šç›®çš„ï¼Œä»…ä»…ä¸ºäº†å­¦ä¹ ï¼Œæ‰€ä»¥æƒ³æŠŠç‰ˆæƒä¿¡æ¯å»æ‰ã€‚
çœ‹äº†å‡ ç¯‡åšå®¢ï¼Œéƒ½æ˜¯æ•™ä½ æŠŠalertæ¡†åŠ ä¸Š&lt;code>display:none&lt;/code>ï¼Œæˆ‘è€ƒè™‘åˆ°è¿™æ ·å¹¶ä¸å¥½ï¼Œå› ä¸ºå¦‚æœæœ‰å…¶ä»–æ­£å¸¸çš„ä¿¡æ¯ä¹Ÿä¸èƒ½æ˜¾ç¤ºäº†ï¼Œæ‰€ä»¥èŠ±äº†äº›æ—¶é—´æ”¹äº†ä¸‹ckfinder.jsï¼Œæ—¢å»æ‰äº†ç‰ˆæƒä¿¡æ¯ï¼Œåˆä¸ä¼šå½±å“å…¶ä»–ä¿¡æ¯çš„æç¤ºã€‚&lt;/p>
&lt;p>&lt;strong>ä¸‹æ–‡æä¾›äº†ä¸¤ç§æ–¹æ³•ï¼Œå»ºè®®ä½¿ç”¨ç¬¬äºŒç§ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;strong>å¦‚æœä½ æ˜¯ç”¨äºå•†ä¸šç›®çš„ï¼Œè¯·åˆ°&lt;a href="https://cksource.com/ckfinder/buy">å®˜ç½‘&lt;/a>è´­ä¹°ä½¿ç”¨çš„Licenseä½¿ç”¨ã€‚&lt;/strong>&lt;/p>
&lt;p>&lt;em>&lt;strong>CKFinderç‰ˆæœ¬: Version: 2.6.2.1 â€¢ Released 11 Oct 2016&lt;/strong>&lt;/em>&lt;/p>
&lt;p>ä¸æƒ³è‡ªå·±æ“ä½œè¿™ä¹ˆéº»çƒ¦çš„ï¼Œå»CSDNä¸‹è½½æˆ‘ä¸Šä¼ å¥½çš„ï¼Œ2ç§¯åˆ† å“ˆå“ˆå“ˆ&lt;br>
é“¾æ¥ï¼š&lt;a href="http://download.csdn.net/detail/qq1255685485/9845062">http://download.csdn.net/detail/qq1255685485/9845062&lt;/a>&lt;/p>
&lt;h1 id="ç¬¬ä¸€ç§">ç¬¬ä¸€ç§&lt;/h1>
&lt;p>ç¬¬ä¸€ç§éº»çƒ¦è€Œä¸”éœ€è¦é€»è¾‘æ”¹åŠ¨è¾ƒå¤§ã€‚&lt;/p>
&lt;h2 id="å·¦ä¸‹è§’ä¿¡æ¯">å·¦ä¸‹è§’ä¿¡æ¯&lt;/h2>
&lt;p>åœ¨ckfinder.jsä¸­æœç´¢:&lt;/p>
&lt;pre>&lt;code>t=&amp;quot;\x54\150\151\163\040\x69\163\x20\164\x68\145\040\x44\105\x4d\x4f\040\166\x65\x72\x73\x69\157\156\x20\157\146\040\103\113\x46\151\x6e\144\145\x72\056\040\120\154\x65\141\163\145\040\166\x69\x73\x69\x74\x20\164\150\145\040\x3c\x61\x20\150\162\x65\x66\x3d\x27\150\164\x74\x70\x3a\x2f\x2f\x63\x6b\163\157\x75\x72\x63\x65\056\143\x6f\x6d\057\143\153\146\151\x6e\144\x65\162\x27\x20\164\141\162\x67\x65\x74\x3d\047\x5f\x62\154\141\x6e\x6b\x27\x3e\x43\x4b\106\151\156\144\x65\x72\040\x77\145\x62\040\163\151\x74\x65\x3c\x2f\x61\x3e\x20\164\157\040\x6f\x62\x74\141\x69\x6e\x20\141\040\166\x61\154\151\144\040\x6c\151\x63\x65\156\163\x65\x2e&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>ä½ç½®åœ¨æ–‡ä»¶æ¯”è¾ƒé åçš„ä½ç½®ï¼Œæ›¿æ¢ä¸º:&lt;/p>
&lt;pre>&lt;code>t=&amp;quot;&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>è¿™ä¸€å¥çš„è§£ç åä¸º:&lt;/p>
&lt;pre>&lt;code>This is the DEMO version of CKFinder.Please visit the &amp;lt;a href='http://cksource.com/ckfinder' target='_blank'&amp;gt;CKFinder web site&amp;lt;/a&amp;gt; to obtain a valid license.
&lt;/code>&lt;/pre>
&lt;p>å¯ä»¥åœ¨ &lt;a href="http://ddecode.com/hexdecoder">http://ddecode.com/hexdecoder&lt;/a> è§£ç &lt;/p>
&lt;h2 id="é¡¶ç«¯ä¿¡æ¯">é¡¶ç«¯ä¿¡æ¯&lt;/h2>
&lt;p>åœ¨ckfinder.jsä¸­æœç´¢:&lt;/p>
&lt;pre>&lt;code>P=&amp;quot;\x50\x6c\x65\141\x73\x65\040\166\151\x73\x69\x74\x20\164\x68\x65\040\074\141\040\x68\162\x65\146\075\x27\x68\164\x74\160\072\057\057\x63\x6b\x73\x6f\x75\x72\x63\x65\056\x63\157\155\057\143\x6b\x66\151\x6e\x64\x65\x72\x27\x20\x74\141\162\147\145\x74\x3d\x27\x5f\x62\154\141\x6e\153\x27\x3e\x43\x4b\106\x69\x6e\x64\x65\162\x20\x77\x65\142\x20\x73\x69\x74\145\x3c\x2f\x61\x3e\040\x74\x6f\x20\157\142\x74\x61\151\156\x20\141\040\166\141\154\151\x64\040\154\151\143\145\x6e\163\145\x2e&amp;quot;,Q=&amp;quot;\x54\150\x69\163\x20\151\x73\040\x74\x68\x65\040\x44\x45\x4d\117\040\x76\x65\x72\163\x69\157\156\x20\157\x66\040\x43\x4b\106\x69\156\144\145\x72\x2e\x20&amp;quot;+P,R=&amp;quot;\x50\162\157\144\x75\x63\164\040\154\151\143\x65\156\163\145\x20\150\141\x73\x20\x65\x78\160\x69\162\145\144\x2e\040&amp;quot;+P;
&lt;/code>&lt;/pre>
&lt;p>è¿™é‡Œå®šä¹‰äº†ä¸‰ä¸ªå˜é‡P, Q, R, åˆ†åˆ«ä»£è¡¨çš„æ„æ€å¦‚ä¸‹:&lt;/p>
&lt;pre>&lt;code>P=&amp;quot;Please visit the &amp;lt;a href='http://cksource.com/ckfinder' target='_blank'&amp;gt;CKFinder web site&amp;lt;/a&amp;gt; to obtain a valid license.&amp;quot;;
Q=&amp;quot;This is the DEMO version of CKFinder.&amp;quot; + P;
R=&amp;quot;Product license has expired.&amp;quot; + P;
&lt;/code>&lt;/pre>
&lt;p>å°†æœç´¢åˆ°çš„å†…å®¹æ›¿æ¢ä¸º&lt;/p>
&lt;pre>&lt;code>P=&amp;quot;&amp;quot;; Q=&amp;quot;&amp;quot;; R=&amp;quot;&amp;quot;;
&lt;/code>&lt;/pre>
&lt;p>æ›¿æ¢å®Œæˆåå‘ç°æ–‡ä»¶åº“ä¸ºç©ºç™½ï¼Œæ›´å…·ä½“å¯ä»¥è¯´ï¼Œå½“å°†&lt;code>Q&lt;/code>è®¾ç½®ä¸ºç©ºç™½å­—ç¬¦ä¸²ä¹‹åæ‰ä¼šæ˜¾ç¤ºç©ºç™½ï¼Œè€Œæ›¿æ¢&lt;code>P&lt;/code>å’Œ&lt;code>R&lt;/code>éƒ½ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼Œå› ä¸ºä»£ç åé¢å¯¹&lt;code>Q&lt;/code>çš„å€¼åšäº†åˆ¤æ–­.&lt;/p>
&lt;p>æ‰€ä»¥æˆ‘ä»¬ç»§ç»­å‘ä¸‹çœ‹ï¼Œç»§ç»­æœç´¢ï¼š&lt;/p>
&lt;pre>&lt;code>if(!Q)
&lt;/code>&lt;/pre>
&lt;p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªåˆ¤æ–­&lt;code>if(!Q) return;&lt;/code>,åˆ é™¤è¿™ä¸€ä¸ªåˆ¤æ–­ä½“.&lt;/p>
&lt;p>è¿˜æ²¡æœ‰ç»“æŸï¼Œç»§ç»­æœç´¢:&lt;/p>
&lt;pre>&lt;code>Q.charAt
&lt;/code>&lt;/pre>
&lt;p>å¯ä»¥çœ‹åˆ°å¦å¤–ä¸€ä¸ªåˆ¤æ–­&lt;code>if(pw||Q.charAt(2&amp;lt;&amp;lt;2)!='t')return;&lt;/code>ï¼Œä¸ºäº†ä¿è¯æ­£å¸¸ä½¿ç”¨ï¼Œå°†è¿™ä¸ªåˆ¤æ–­ä½“æ›¿æ¢ä¸º:&lt;/p>
&lt;pre>&lt;code>if(pw) return;
&lt;/code>&lt;/pre>
&lt;p>å¦å¤–å¤šè¯´ä¸€å¥ï¼Œ&lt;code>Q&lt;/code>å˜é‡åˆ é™¤åˆ°&lt;code>Q=&amp;quot;\x54\150\x69\163\x20\151\x73\040\x74&amp;quot;&lt;/code>çš„æ—¶å€™è¿˜èƒ½æ­£å¸¸ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯&lt;code>Q=&amp;quot;This is t&amp;quot;&lt;/code>ï¼Œå¯ä»¥åšäº›å°è¯•ã€‚&lt;/p>
&lt;p>å½“ä»¥ä¸Šå·¥ä½œå…¨éƒ¨å®Œæˆä¹‹åï¼Œåˆ·æ–°é¡µé¢å³å¯ä»¥çœ‹åˆ°ç‰ˆæƒä¿¡æ¯å…¨éƒ¨å»æ‰äº†ï¼Œè€Œä¸”å¹¶æ²¡æœ‰å½±å“åˆ°å…¶ä»–ä¿¡æ¯çš„æé†’ã€‚&lt;/p>
&lt;p>å“ˆå“ˆå“ˆğŸ˜‚ã€‚çœ‹åˆ°è¿™çš„éƒ½æ˜¯çœŸçˆ±ã€‚
é‚£ä¹ˆç»™ä½ ä»¬è¯´ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•ï¼Œåªéœ€ä¸‰æ­¥ï¼Œæ›´å®Œç¾çš„è§£å†³é—®é¢˜ã€‚&lt;/p>
&lt;h1 id="ç¬¬äºŒç§">ç¬¬äºŒç§&lt;/h1>
&lt;p>ç®€å•ï¼Œåªéœ€ä¸‰æ­¥&lt;/p>
&lt;h2 id="å·¦ä¸‹è§’ä¿¡æ¯-1">å·¦ä¸‹è§’ä¿¡æ¯&lt;/h2>
&lt;p>æœç´¢: &lt;code>this.dV().getChild(0).appendHtml&lt;/code>ï¼Œå¾ˆæ˜¾ç„¶æ˜¯ä¸ºå·¦ä¸‹è§’æ·»åŠ ä¿¡æ¯ï¼Œçœ‹è¿™ä¸€å¥ä¸Šé¢æœ‰ä¸ªifåˆ¤æ–­:&lt;/p>
&lt;pre>&lt;code> if (this.app.gd == 'bootstrap') {
var H = &amp;quot;\x3c\x64\151\x76\x20\143\x6c\x61\x73\x73\x3d\x27\166\x69\145\167\x20\164\157\157\154\137\160\141\x6e\145\x6c\047\040\x73\x74\x79\154\145\075\047\x64\151\x73\x70\154\141\x79\x3a\x62\x6c\157\143\153\x20\x21\x69\x6d\160\157\x72\164\x61\x6e\164\x3b\160\x6f\163\x69\x74\151\x6f\x6e\072\x73\x74\x61\164\151\143\040\x21\x69\x6d\160\157\x72\164\x61\x6e\x74\x3b\x63\x6f\x6c\157\x72\x3a\043\x33\x31\x37\x30\x38\x66\x20\041\151\155\x70\157\x72\x74\x61\156\x74\073\x62\x61\x63\x6b\147\162\157\165\x6e\144\055\143\157\x6c\x6f\x72\x3a\x23\144\x39\145\144\146\x37\x20\x21\x69\x6d\x70\157\x72\x74\141\156\x74\073\146\x6f\156\164\x2d\x73\151\172\x65\x3a\x20\061\063\x70\170\073\040\x70\141\x64\144\x69\156\147\072\040\x35\x70\170\073\x20\155\141\162\147\x69\x6e\072\065\160\170\x3b\x62\157\162\144\x65\162\055\x72\141\144\x69\x75\x73\x3a\x34\160\x78\x3b\047\x3e&amp;quot;;
v = H + t + s;
w = H + u + s;
}
&lt;/code>&lt;/pre>
&lt;p>è¿›è¡Œè§£ç å’Œå­—ç¬¦ä¸²ç»„åˆï¼Œå¯ä»¥çœ‹åˆ°å˜é‡&lt;code>v&lt;/code>å°±æ˜¯ç‰ˆæƒä¿¡æ¯, &lt;code>w&lt;/code>æ˜¯å·²ç»è´­ä¹°çš„ä¿¡æ¯ã€‚åœ¨æœç´¢åˆ°çš„&lt;code>this.dV().getChild(0).appendHtml&lt;/code>æ‹¬å·é‡Œé¢ï¼Œæ”¹ä¸º:&lt;/p>
&lt;pre>&lt;code>this.dV().getChild(0).appendHtml(C||D||A!=4?&amp;quot;&amp;quot;:&amp;quot;&amp;quot;);
&lt;/code>&lt;/pre>
&lt;p>ç®€è¨€ä¹‹å°±æ˜¯ä¸ç®¡ä¹°æ²¡ä¹°ï¼Œéƒ½ä¸æ˜¾ç¤ºè¿™ä¸ªæç¤ºï¼Œè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²å°±å¥½äº†ã€‚&lt;/p>
&lt;h2 id="é¡¶ç«¯ä¿¡æ¯-1">é¡¶ç«¯ä¿¡æ¯&lt;/h2>
&lt;p>é¡¶ç«¯çš„å»å¤„ç‰ˆæƒä¿¡æ¯çš„æ–¹æ³•å’Œå·¦ä¸‹è§’ç±»ä¼¼ã€‚&lt;/p>
&lt;p>æœç´¢: &lt;code>aT.mj=Q&lt;/code> æ›¿æ¢ä¸º &lt;code>aT.mj=Q.toLowerCase().indexOf(&amp;quot;demo&amp;quot;) ? &amp;quot;&amp;quot; : Q;&lt;/code>
æœç´¢: &lt;code>aT.mj=R&lt;/code> æ›¿æ¢ä¸º &lt;code>aT.mj=R.toLowerCase().indexOf(&amp;quot;demo&amp;quot;) ? &amp;quot;&amp;quot; : R;&lt;/code>&lt;/p>
&lt;p>å¤§åŠŸå‘Šæˆï¼Œ æ›´å®Œç¾çš„è§£å†³äº†é—®é¢˜ï½ ğŸ˜&lt;/p>
&lt;h1 id="2017-5-17-æ›´æ–°å¯ç”¨å‰ªåˆ‡åŠŸèƒ½">2017-5-17 æ›´æ–°ï¼šå¯ç”¨å‰ªåˆ‡åŠŸèƒ½&lt;/h1>
&lt;p>ä»Šå¤©å‘ç°è™½ç„¶ç‰ˆæƒä¿¡æ¯æ²¡æœ‰äº†ï¼Œä½†æ˜¯â€œä¸´æ—¶æ–‡ä»¶å¤¹â€åŠŸèƒ½â€œä»ä¸´æ—¶æ–‡ä»¶å¤¹å‰ªåˆ‡è‡³æ­¤â€åœ¨Demoç‰ˆæœ¬ä¸­ä¸èƒ½ä½¿ç”¨ï¼Œæç¤º:&lt;/p>
&lt;pre>&lt;code>This function is disabled in the demo version of CKFinder.
Please visit the CKFinder web site to obtain a valid license.
&lt;/code>&lt;/pre>
&lt;p>å¯ç”¨æ–¹æ³•ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;p>æœç´¢&lt;code>z.app.msgDialog&lt;/code>, å¯ä»¥çœ‹åˆ°åŒ…å«å®ƒçš„æ˜¯ä¸€ä¸ªåˆ¤æ–­ã€‚&lt;/p>
&lt;pre>&lt;code> if('balabalabalabalabala...') //è¿™ä¸ªåˆ¤æ–­å¾ˆé•¿
æ˜¾ç¤ºè¿™æ˜¯Demoç‰ˆæœ¬ï¼Œä¸èƒ½ç”¨è¿™ä¸ªåŠŸèƒ½;
else
æ‰§è¡ŒæŒ‡ä»¤;
&lt;/code>&lt;/pre>
&lt;p>é‚£æˆ‘ä»¬è¦åšçš„å°±æ˜¯åªç•™ä¸‹éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤å°±å¯ä»¥äº†ã€‚
è¿™ä¸€æ­¥å®Œæˆï¼Œå°±å¯ä»¥ä»ä¸´æ—¶æ–‡ä»¶ä¸­ç§»åŠ¨æ–‡ä»¶äº†ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å’Œç¬¬1æ­¥ç±»ä¼¼ï¼Œæœç´¢&lt;code>y.msgDialog&lt;/code>,åŒæ ·åŒ…å«å®ƒçš„æ˜¯ä¸€ä¸ªåˆ¤æ–­ï¼Œä¸åŒçš„æ˜¯è¿™ä¸ªåˆ¤æ–­ä½“çš„&lt;code>else&lt;/code>éƒ¨åˆ†æ‰§è¡Œäº†å¤šæ¡æŒ‡ä»¤ã€‚åˆ é™¤åˆ¤æ–­åªç•™ä¸‹æŒ‡ä»¤å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸€æ­¥å®Œæˆï¼Œå°±å¯ä»¥åœ¨å„ä¸ªæ–‡ä»¶å¤¹ä¸­ç§»åŠ¨æ–‡ä»¶äº†ã€‚&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>è¿™æ ·æ–‡ä»¶çš„ç§»åŠ¨åŠŸèƒ½å°±å¯ä»¥æ­£å¸¸ä½¿ç”¨äº†ã€‚æˆ‘å¥½åƒå¤ªåäº†ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/j2ee/">J2EE</category><category domain="https://h1z3y3.me/tags/ckfinder/">CKFinder</category><category domain="https://h1z3y3.me/tags/ckeditor/">CKEditor</category></item><item><title>Shiroæ¸…é™¤æ›´æ–°ç¼“å­˜çš„ç”¨æˆ·æƒé™</title><link>https://h1z3y3.me/posts/shiro-clear-update-authorization/</link><guid isPermaLink="true">https://h1z3y3.me/posts/shiro-clear-update-authorization/</guid><pubDate>Tue, 04 Apr 2017 18:57:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>Apache Shiroç”¨äºæƒé™ç®¡ç†ååˆ†æ–¹ä¾¿ï¼Œä½†å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“ç”¨æˆ·çš„æƒé™å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±éœ€è¦ç”¨æˆ·é‡æ–°ç™»å½•ï¼Œé‡æ–°ç¼“å­˜ç”¨æˆ·çš„æƒé™ä¿¡æ¯ã€‚&lt;br>
ç°åœ¨æƒ³è¦åœ¨æ”¹å˜ç”¨æˆ·çš„æƒé™çš„æ—¶å€™ï¼Œæ¸…ç†ç”¨æˆ·çš„æƒé™ã€‚ &lt;br>
åœ¨å†™çš„è¿‡ç¨‹ä¸­æŸ¥æ‰¾äº†ä¸€äº›èµ„æ–™ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æˆåŠŸå®ç°æƒé™çš„æ¸…ç†ï¼Œæ‰€ä»¥æˆ‘è¿›è¡Œäº†ä¸€äº›ä¿®æ”¹ï¼Œå¹¶å®ç°äº†Helperç±»ã€‚&lt;/p>
&lt;p>æˆ‘å†™çš„å¸®åŠ©ç±»ï¼š&lt;/p>
&lt;pre>&lt;code>package com.zhaoyang.core.feature.security;
import org.apache.shiro.SecurityUtils;
import org.apache.shiro.cache.Cache;
import org.apache.shiro.cache.CacheManager;
import org.apache.shiro.subject.SimplePrincipalCollection;
import org.apache.shiro.subject.Subject;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
/**
* @author zhaoyang
*
* @since 2017-04-04 2:12 PM
*/
public class ShiroAuthorizationHelper {
//shiro é…ç½®çš„cacheManagerï¼Œ éœ€è¦ä½¿ç”¨Spring beanè¿›è¡Œæ³¨å…¥
private static CacheManager cacheManager;
private static Logger logger = LoggerFactory.getLogger(ShiroAuthorizationHelper.class);
/**
* æ¸…é™¤ç”¨æˆ·çš„æƒé™
*
* è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ
* ç½‘ä¸Šå¾ˆå¤šå®ç°éƒ½æ˜¯è¿™é‡Œåªä¼ é€’ä¸€ä¸ªStringç±»å‹çš„usernameè¿‡æ¥ï¼Œæ ¹æ®è¿™ä¸ªStringå½“keyå»æ¸…é™¤Cache
* ä½†æ˜¯Shiroåœ¨ç¼“å­˜ç”¨æˆ·æƒé™çš„æ—¶å€™ä½¿ç”¨çš„keyå¹¶ä¸æ˜¯Stringç±»å‹ï¼Œæ‰€ä»¥è°ƒç”¨removeçš„æ—¶å€™å¹¶ä¸èƒ½æ¸…é™¤ç¼“å­˜çš„æƒé™
*
* shiroç¼“å­˜æ—¶ä½¿ç”¨çš„keyï¼Œæ˜¯ç™»å½•æ—¶ä½¿ç”¨çš„SimplePrincipalCollectionå¯¹è±¡ï¼Œæ‰€ä»¥removeçš„æ—¶å€™éœ€è¦çš„ä¸æ˜¯ä¸€ä¸ªStringå€¼ï¼Œ
* å…·ä½“å¯ä»¥å‚è€ƒä¸‹é¢æ–¹æ³•ä¸­æ‰“å°cacheçš„keyçš„è¿‡ç¨‹, å¯ä»¥çœ‹åˆ°æ‰“å°å‡ºkeyçš„ç±»æ˜¯ `class org.apache.shiro.subject.SimplePrincipalCollection`
* æ‰€ä»¥ä½ cache.remove(String username)è‚¯å®šæ¸…é™¤ä¸äº†
*
* @param principal
*/
public static void clearAuthorizationInfo(SimplePrincipalCollection principal) {
logger.info(&amp;quot;clear the user: &amp;quot; + principal.toString() + &amp;quot;'s authorizationInfo&amp;quot;);
Cache&amp;lt;Object, Object&amp;gt; cache = cacheManager.getCache(&amp;quot;myShiroCache&amp;quot;);//myShiroCacheæ˜¯æˆ‘é…ç½®ç”¨äºç¼“å­˜çš„cacheçš„Nameï¼Œåœ¨springé…ç½®æ–‡ä»¶ä¸­é…ç½®ï¼Œå¯ä»¥çœ‹æ–‡ç« æœ€å
// for (Object k : cache.keys()) {
// System.out.println(k.getClass());
// }
cache.remove(principal);
}
/**
* æ¸…é™¤å½“å‰ç”¨æˆ·çš„æƒé™
*/
public static void clearAuthorizationInfo() {
if (SecurityUtils.getSubject().isAuthenticated()) {
Subject subject = SecurityUtils.getSubject();
String username = subject.getPrincipal().toString();
String realmName = subject.getPrincipals().getRealmNames().iterator().next();
SimplePrincipalCollection principalCollection = new SimplePrincipalCollection(username, realmName);
// è°ƒç”¨æ¸…ç†ç”¨æˆ·æƒé™
clearAuthorizationInfo(principalCollection);
}
}
/**
* ç”±Spring beanå°†å¯¹è±¡æ³¨å…¥
* @param cacheManager
*/
public static void setCacheManager(CacheManager cacheManager) {
ShiroAuthorizationHelper.cacheManager = cacheManager;
}
}
&lt;/code>&lt;/pre>
&lt;p>å°†cacheManageræ³¨å…¥åˆ°å¸®åŠ©ç±»ï¼š&lt;/p>
&lt;pre>&lt;code> &amp;lt;!-- æ³¨å…¥Shiroå¸®åŠ©ç±»çš„cacheManager --&amp;gt;
&amp;lt;bean class=&amp;quot;org.springframework.beans.factory.config.MethodInvokingFactoryBean&amp;quot;&amp;gt;
&amp;lt;property name=&amp;quot;staticMethod&amp;quot; value=&amp;quot;com.damaiya.DMYSite.core.feature.security.ShiroAuthorizationHelper.setCacheManager&amp;quot;/&amp;gt;
&amp;lt;property name=&amp;quot;arguments&amp;quot; ref=&amp;quot;shiroEhcacheManager&amp;quot;/&amp;gt;
&amp;lt;/bean&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>å½“ç„¶ref=â€œshiroEhcacheManagerâ€éœ€è¦ä½ è‡ªå·±å»å®ç°, æˆ‘è¿™é‡Œè´´ä¸‹æˆ‘çš„ï¼š&lt;/p>
&lt;pre>&lt;code> &amp;lt;!-- ç¼“å­˜ç®¡ç†å™¨ ä½¿ç”¨Ehcacheå®ç° --&amp;gt;
&amp;lt;bean id=&amp;quot;shiroEhcacheManager&amp;quot; class=&amp;quot;org.apache.shiro.cache.ehcache.EhCacheManager&amp;quot;&amp;gt;
&amp;lt;property name=&amp;quot;cacheManagerConfigFile&amp;quot; value=&amp;quot;classpath:ehcache-shiro.xml&amp;quot;/&amp;gt;
&amp;lt;/bean&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>ä¸‹é¢æ˜¯ehcache-shiro.xmlé…ç½®, å…·ä½“çš„å‚æ•°ä½œç”¨æˆ‘å°±ä¸è¯´äº†:&lt;/p>
&lt;pre>&lt;code>&amp;lt;ehcache updateCheck=&amp;quot;false&amp;quot; name=&amp;quot;shiroCache&amp;quot;&amp;gt;
&amp;lt;defaultCache
maxElementsInMemory=&amp;quot;10000&amp;quot;
eternal=&amp;quot;false&amp;quot;
timeToIdleSeconds=&amp;quot;120&amp;quot;
timeToLiveSeconds=&amp;quot;120&amp;quot;
overflowToDisk=&amp;quot;false&amp;quot;
diskPersistent=&amp;quot;false&amp;quot;
diskExpiryThreadIntervalSeconds=&amp;quot;120&amp;quot;
/&amp;gt;
&amp;lt;cache name=&amp;quot;myShiroCache&amp;quot;
maxElementsInMemory=&amp;quot;10000&amp;quot;
eternal=&amp;quot;false&amp;quot;
timeToIdleSeconds=&amp;quot;30&amp;quot;
timeToLiveSeconds=&amp;quot;0&amp;quot;
overflowToDisk=&amp;quot;false&amp;quot;
diskPersistent=&amp;quot;false&amp;quot;
diskExpiryThreadIntervalSeconds=&amp;quot;120&amp;quot;/&amp;gt;
&amp;lt;/ehcache&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>ä½¿ç”¨æŒ‡å®šNameçš„Cacheè¿›è¡Œæƒé™ç¼“å­˜é…ç½®, securityRealmæ˜¯æˆ‘è‡ªå·±çš„Realmï¼š&lt;/p>
&lt;pre>&lt;code>&amp;lt;bean id=&amp;quot;securityRealm&amp;quot; class=&amp;quot;com.damaiya.DMYSite.web.security.SecurityRealm&amp;quot;&amp;gt;
&amp;lt;property name=&amp;quot;authorizationCacheName&amp;quot; value=&amp;quot;myShiroCache&amp;quot;/&amp;gt;
&amp;lt;/bean&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>è¿™æ ·æ•´ä¸ªé…ç½®å°±å®Œæˆäº†ï¼Œè€Œä¸”è°ƒç”¨&lt;code>clearAuthorizationInfo()&lt;/code>æ—¶å°±å¯ä»¥æ¸…é™¤å½“å‰ç™»å½•ç”¨æˆ·çš„æƒé™ä¿¡æ¯äº†ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/j2ee/">J2EE</category><category domain="https://h1z3y3.me/tags/shiro/">Shiro</category></item><item><title>æœ€ç®€å•æ–¹æ³•è§£å†³ä½¿ç”¨ShiroåURLä¸­JSESSIONIDçš„é—®é¢˜</title><link>https://h1z3y3.me/posts/tomcat-shiro-disable-jsessionid-in-url/</link><guid isPermaLink="true">https://h1z3y3.me/posts/tomcat-shiro-disable-jsessionid-in-url/</guid><pubDate>Thu, 30 Mar 2017 22:02:19 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>&lt;strong>åœ¨J2EEé¡¹ç›®ä¸­ä½¿ç”¨Shiroè¿›è¡Œæƒé™éªŒè¯åï¼Œæ¯æ¬¡éƒ¨ç½²è·³è½¬åˆ°ç™»å½•ç•Œé¢æ€»ä¼šåœ¨é“¾æ¥åé¢å¤šå‡º&lt;code>;JSESSION=xxxx&lt;/code>ï¼ŒæŸ¥äº†å¾ˆå¤šï¼Œå¤§æ¦‚æœ‰ä¸‹é¢å‡ ç§æ–¹æ³•ï¼š&lt;/strong>&lt;/p>
&lt;ol>
&lt;li>
&lt;p>åœ¨web.xmlä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š&lt;/p>
&lt;pre>&lt;code> &amp;lt;session-config&amp;gt;
&amp;lt;tracking-mode&amp;gt;COOKIE&amp;lt;/tracking-mode&amp;gt;
&amp;lt;/session-config&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>å…·ä½“è¯·å‚è€ƒï¼š&lt;br>
&lt;a href="">http://stackoverflow.com/questions/11327631/remove-jsessionid-from-url&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;ol start="2">
&lt;li>
&lt;p>ä½¿ç”¨Filterå¯¹URLè¿›è¡Œrewrite&lt;br>
å…·ä½“è¯·å‚è€ƒï¼š&lt;br>
&lt;a href="">http://dr-yanglong.github.io/2015/07/07/del-jeesessionid/&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æœ‰äº›åŒå­¦é‡å†™äº†shiroé‡å®šå‘æ—¶éœ€è¦è°ƒç”¨çš„æ–¹æ³•&lt;code>encodeRedirectURL()&lt;/code>å’Œ&lt;code>toEncoded()&lt;/code>&lt;/p>
&lt;p>å…·ä½“è¯·å‚è€ƒï¼š&lt;br>
&lt;a href="">http://dwangel.iteye.com/blog/2275899&lt;/a>&lt;br>
&lt;a href="">http://alex233.blog.51cto.com/8904951/1856155&lt;/a>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åæ¥å»çœ‹äº†æºç ï¼Œå‘ç°äº†ä¸€ä¸ªæœ€æœ€ç®€å•çš„æ–¹æ³•ï¼Œå¦‚ä¸‹ï¼š&lt;/p>
&lt;p>shiroæºç ï¼š&lt;br>
&lt;a href="">https://github.com/apache/shiro/pull/31/commits/7f37394c6048d8c8a214eabd312721ddb51adc9b&lt;/a>&lt;/p>
&lt;/li>
&lt;/ol>
&lt;p>é˜…è¯»æºç ä¹‹åï¼Œå¯ä»¥å‘ç°&lt;code>DefaultWebSessionManager.java&lt;/code>æ–‡ä»¶ä¸­æ·»åŠ äº†æ–°å±æ€§&lt;code>private boolean sessionIdUrlRewritingEnabled;&lt;/code>, é¡¾åæ€ä¹‰, æ˜¯ç”¨æ¥æ§åˆ¶æ˜¯å¦é‡å†™URLæ·»åŠ SESSIONIDçš„ï¼Œåªè¦ä¿®æ”¹shiroçš„sessionManageré…ç½®å¦‚ä¸‹å³å¯ï¼š&lt;/p>
&lt;pre>&lt;code> &amp;lt;bean id=&amp;quot;sessionManager&amp;quot; class=&amp;quot;org.apache.shiro.web.session.mgt.DefaultWebSessionManager&amp;quot;&amp;gt;
...
&amp;lt;property name=&amp;quot;sessionIdUrlRewritingEnabled&amp;quot; value=&amp;quot;true&amp;quot;/&amp;gt;
...
&amp;lt;/bean&amp;gt;
&lt;/code>&lt;/pre>
&lt;h4 id="more-source">More Sourceï¼š&lt;/h4>
&lt;p>&lt;a href="">https://fralef.me/tomcat-disable-jsessionid-in-url.html&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/j2ee/">J2EE</category><category domain="https://h1z3y3.me/tags/shiro/">Shiro</category></item><item><title>Grep, Sed, Awk æ—¥å¸¸ä½¿ç”¨</title><link>https://h1z3y3.me/posts/grepsedawk/</link><guid isPermaLink="true">https://h1z3y3.me/posts/grepsedawk/</guid><pubDate>Fri, 19 Aug 2016 22:03:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h2 id="grep">grep&lt;/h2>
&lt;h3 id="æ¦‚è¿°">æ¦‚è¿°&lt;/h3>
&lt;p>åœ¨ç»™å‡ºæ–‡ä»¶åˆ—è¡¨æˆ–æ ‡å‡†è¾“å…¥å, grepä¼šå¯¹åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬è¿›è¡Œæœç´¢, å¹¶è¾“å‡ºåŒ¹é…ï¼ˆæˆ–è€…ä¸åŒ¹é…ï¼‰çš„è¡Œæˆ–æ–‡æœ¬.&lt;/p>
&lt;h3 id="ä½¿ç”¨æ ¼å¼">ä½¿ç”¨æ ¼å¼&lt;/h3>
&lt;pre>&lt;code>grep [options] PATTERN [FILE...]
&lt;/code>&lt;/pre>
&lt;h3 id="å¸¸ç”¨é€‰é¡¹">å¸¸ç”¨é€‰é¡¹&lt;/h3>
&lt;ul>
&lt;li>-i å¿½ç•¥å­—ç¬¦å¤§å°å†™&lt;/li>
&lt;li>-v æ˜¾ç¤ºæœªè¢«æ¨¡å¼åŒ¹é…åˆ°çš„è¡Œæˆ–ä¸²&lt;/li>
&lt;li>-o åªæ˜¾ç¤ºåŒ¹é…åˆ°çš„ä¸²è€Œä¸æ˜¯æ•´è¡Œ&lt;/li>
&lt;li>-n æ˜¾ç¤ºåŒ¹é…çš„è¡ŒåŠè¡Œå·&lt;/li>
&lt;li>-E ä½¿ç”¨æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;li>-A n æ˜¾ç¤ºå‡ºåŒ¹é…åˆ°çš„è¡Œå’Œånè¡Œ&lt;/li>
&lt;li>-B n æ˜¾ç¤ºå‡ºåŒ¹é…åˆ°çš„è¡Œå’Œå‰nè¡Œ&lt;/li>
&lt;li>-C n æ˜¾ç¤ºå‡ºåŒ¹é…åˆ°çš„è¡Œå’Œå‰åå„nè¡Œ&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼&lt;/strong>&lt;/p>
&lt;p>æ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ä¸åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼çš„å”¯ä¸€åŒºåˆ«åœ¨äº: &lt;code>() {} ? +&lt;/code> è¿™å‡ ä¸ªå­—ç¬¦.&lt;/p>
&lt;p>åŸºç¡€æ­£åˆ™è¡¨è¾¾å¼ä¸­, &lt;code>() {} ? +&lt;/code> è¡¨ç¤ºç‰¹æ®Šå«ä¹‰ï¼Œä½¿ç”¨æ—¶éœ€è¦å°†ä»–ä»¬è½¬ä¹‰&lt;/p>
&lt;p>è€Œæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼ä¸­, &lt;code>() {} ? +&lt;/code> ä¸è¡¨ç¤ºç‰¹æ®Šå«ä¹‰, ä½ éœ€è¦å°†ä»–ä»¬è½¬ä¹‰.&lt;/p>
&lt;p>è½¬ä¹‰ç¬¦å·, éƒ½æ˜¯ä¸€æ ·çš„: åæ–œçº¿ &lt;code>\&lt;/code> .&lt;/p>
&lt;p>æ‰€è°“ç‰¹æ®Šå«ä¹‰, å°±æ˜¯æ­£åˆ™è¡¨è¾¾å¼ä¸­çš„å«ä¹‰. éç‰¹æ®Šå«ä¹‰, å°±æ˜¯è¿™ä¸ªç¬¦å·æœ¬èº«.&lt;/p>
&lt;h3 id="æ­£åˆ™è¡¨è¾¾å¼">æ­£åˆ™è¡¨è¾¾å¼&lt;/h3>
&lt;h4 id="å…ƒå­—ç¬¦">å…ƒå­—ç¬¦&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">.&lt;/td>
&lt;td style="text-align:left">åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">[]&lt;/td>
&lt;td style="text-align:left">åŒ¹é…[]æŒ‡å®šèŒƒå›´å†…çš„ä»»æ„å•ä¸ªå­—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">[^]&lt;/td>
&lt;td style="text-align:left">åŒ¹é…[]æŒ‡å®šèŒƒå›´å¤–çš„ä»»æ„å•ä¸ªå­—ç¬¦&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="å­—ç¬¦é›†">å­—ç¬¦é›†&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>[:digit:]&lt;/td>
&lt;td>æ•°å­—&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:lower:]&lt;/td>
&lt;td>å°å†™å­—æ¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:upper:]&lt;/td>
&lt;td>å¤§å†™å­—æ¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:punct:]&lt;/td>
&lt;td>æ ‡ç‚¹ç¬¦å·&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:space:]&lt;/td>
&lt;td>ç©ºç™½å­—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:alpha:]&lt;/td>
&lt;td>æ‰€æœ‰å­—æ¯&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>[:alnum:]&lt;/td>
&lt;td>æ‰€æœ‰å­—æ¯å’Œæ•°å­—, éæ ‡ç‚¹&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>&lt;strong>ä¾‹1.1&lt;/strong>&lt;/p>
&lt;pre>&lt;code>$ grep '[[:punct:]]' grep_example # æ‰€æœ‰æœ‰æ ‡ç‚¹çš„è¡Œ
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="http://p2.qhimg.com/t01e24acc78b267c1db.png" alt="">&lt;/p>
&lt;h4 id="åŒ¹é…æ¬¡æ•°">åŒ¹é…æ¬¡æ•°&lt;/h4>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>.*&lt;/td>
&lt;td>åŒ¹é…ä»»æ„å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>*&lt;/td>
&lt;td>å‰é¢çš„å­—ç¬¦é‡å¤ä»»æ„æ¬¡æ•°, 0æ¬¡1æ¬¡æˆ–å¤šæ¬¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>+&lt;/td>
&lt;td>å‰é¢çš„å­—ç¬¦é‡å¤1æ¬¡æˆ–å¤šæ¬¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>?&lt;/td>
&lt;td>å‰é¢çš„å­—ç¬¦é‡å¤0æ¬¡æˆ–è€…å¤šæ¬¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>{m, n}&lt;/td>
&lt;td>åŒ¹é…å‰é¢çš„å­—ç¬¦è‡³å°‘mæ¬¡, è‡³å¤šnæ¬¡&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>{m, }&lt;/td>
&lt;td>åŒ¹é…å‰é¢çš„å­—ç¬¦è‡³å°‘mæ¬¡&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h4 id="ä½ç½®é”šå®š">ä½ç½®é”šå®š&lt;/h4>
&lt;p>|||
| ^ | ^åé¢çš„å­—ç¬¦å¿…é¡»å‡ºç°åœ¨è¡Œé¦– |
| $ | $å‰é¢çš„å­—ç¬¦å¿…é¡»å‡ºç°åœ¨è¡Œå°¾ |
| ^$ | ç©ºç™½è¡Œ |
| &amp;lt; | &amp;lt;åé¢çš„å­—ç¬¦å¿…é¡»å‡ºç°åœ¨è¯é¦– |
| &amp;gt; | &amp;gt;å‰é¢çš„å­—ç¬¦å¿…é¡»å‡ºç°åœ¨è¯å°¾ |
| () | ()ä¸­çš„å½“åšä¸€ä¸ªæ•´ä½“åŒ¹é… |&lt;/p>
&lt;p>&lt;strong>ä¾‹1.2&lt;/strong>&lt;/p>
&lt;pre>&lt;code>$ grep -E '.*(d+)' grep_example
$ grep -E '.*(d+)$' grep_example
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="http://p7.qhimg.com/t01376509bbf9bd0068.png" alt="">&lt;/p>
&lt;h2 id="sed">sed&lt;/h2>
&lt;h3 id="æ¦‚è¿°-1">æ¦‚è¿°&lt;/h3>
&lt;p>sed (æ„ä¸ºæµç¼–è¾‘å™¨, æºè‡ªè‹±è¯­&amp;quot;Stream Editor&amp;quot;çš„ç¼©å†™)&lt;/p>
&lt;p>sedç”¨æ¥æŠŠæ–‡æ¡£æˆ–å­—ç¬¦ä¸²é‡Œé¢çš„æ–‡å­—ç»è¿‡ä¸€ç³»åˆ—ç¼–è¾‘å‘½ä»¤è½¬æ¢ä¸ºå¦ä¸€ç§æ ¼å¼è¾“å‡º.&lt;/p>
&lt;p>sedé€šå¸¸ç”¨æ¥åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„æ–‡æœ¬è¿›è¡Œå¤„ç†.&lt;/p>
&lt;p>&lt;strong>æ¨¡å¼ç©ºé—´&lt;/strong>&lt;/p>
&lt;p>æ¨¡å¼ç©ºé—´: æŠŠå½“å‰å¤„ç†çš„è¡Œå­˜å‚¨åœ¨ä¸´æ—¶çš„ç¼“å†²åŒº, ç§°ä¸º&amp;quot;æ¨¡å¼ç©ºé—´&amp;quot;(Pattern Space)&lt;/p>
&lt;p>æ¨¡å¼ç©ºé—´å°±æ˜¯è¯»å…¥è¡Œæ‰€åœ¨çš„ç¼“å­˜ï¼Œsedå¯¹æ–‡æœ¬è¡Œè¿›è¡Œçš„å¤„ç†éƒ½æ˜¯åœ¨è¿™ä¸ªç¼“å­˜ä¸­è¿›è¡Œçš„ã€‚&lt;/p>
&lt;h3 id="ä½¿ç”¨æ ¼å¼-1">ä½¿ç”¨æ ¼å¼&lt;/h3>
&lt;pre>&lt;code>sed 'Address Command' [FILE...]
&lt;/code>&lt;/pre>
&lt;h3 id="å¸¸ç”¨é€‰é¡¹-1">å¸¸ç”¨é€‰é¡¹&lt;/h3>
&lt;ul>
&lt;li>-n ä¸æ˜¾ç¤ºæ¨¡å¼ç©ºé—´ä¸­çš„å†…å®¹&lt;/li>
&lt;li>-i ç›´æ¥ä¿®æ”¹åŸæ–‡ä»¶&lt;/li>
&lt;li>-r ä½¿ç”¨æ‰©å±•çš„æ­£åˆ™è¡¨è¾¾å¼&lt;/li>
&lt;/ul>
&lt;h3 id="address">Address&lt;/h3>
&lt;pre>&lt;code>1. StartLine, EndLine:
# å¼€å§‹è¡Œ, ç»“æŸè¡Œ
# å¦‚: 1, 100 è¡¨ç¤º 1 åˆ° 100 è¡Œ
2. /RegExp/
# æ­£åˆ™è¡¨è¾¾å¼
3. /pattern1/, /pattern2/
# ä»åŒ¹é…åˆ°/pattern1/å¼€å§‹, ä¸€ç›´åˆ°åŒ¹é…åˆ°/pattern2/ç»“æŸä¸­é—´æ‰€æœ‰çš„è¡Œ
4. LineNumber
# æŒ‡å®šçš„æŸä¸€è¡Œ
5. StartLine, +N
# ä»StartLineå¼€å§‹åé¢Nè¡Œ
&lt;/code>&lt;/pre>
&lt;h3 id="command">Command&lt;/h3>
&lt;ol>
&lt;li>d åˆ é™¤æ»¡è¶³æ¨¡å¼çš„è¡Œ&lt;/li>
&lt;li>p æ˜¾ç¤ºæ»¡è¶³æ¨¡å¼çš„è¡Œ&lt;/li>
&lt;li>a \string åœ¨æ»¡è¶³æ¨¡å¼çš„è¡Œåæ·»åŠ æ–°è¡Œ, å†…å®¹ä¸ºstringä¸²çš„å†…å®¹&lt;/li>
&lt;li>i \string åœ¨æ»¡è¶³æ¨¡å¼çš„è¡Œå‰æ·»åŠ æ–°è¡Œ, å†…å®¹ä¸ºstringä¸²çš„å†…å®¹&lt;/li>
&lt;li>r fileï¼šå°†æŒ‡å®šçš„æ–‡ä»¶çš„å†…å®¹æ·»åŠ è‡³ç¬¦åˆæ¡ä»¶çš„è¡Œå&lt;/li>
&lt;li>w fileï¼šå°†åœ°å€æŒ‡å®šèŒƒå›´å†…çš„è¡Œå¦å­˜è‡³æŒ‡å®šçš„æ–‡ä»¶ä¸­&lt;/li>
&lt;li>s \pattern\string\ä¿®é¥°ç¬¦ å°†æ»¡è¶³patternçš„ä¸²æ›¿æ¢ä¸ºstring
ä¿®é¥°ç¬¦:
\g å…¨å±€æ›¿æ¢, å³å°†è¯¥è¡Œä¸­æ‰€æœ‰åŒ¹é…é¡¹æ›¿æ¢, é»˜è®¤åªæ›¿æ¢ç¬¬ä¸€ä¸ªåŒ¹é…é¡¹
\i å¿½ç•¥å¤§å°å†™
&amp;amp; å¼•ç”¨æ¨¡å¼åŒ¹é…çš„æ•´ä¸ªä¸²
\1 è¡¨ç¤ºåŒ¹é…åˆ°æ¨¡å¼ä¸­çš„ç¬¬ä¸€ä¸ª ( å¼€å§‹çš„ä¸²
\2 è¡¨ç¤ºåŒ¹é…åˆ°æ¨¡å¼ä¸­çš„ç¬¬äºŒä¸ª ( å¼€å§‹çš„ä¸²&lt;/li>
&lt;/ol>
&lt;p>&lt;strong>ä¾‹2.1&lt;/strong>&lt;/p>
&lt;pre>&lt;code>#ä»ä»¥hezhaoyangå¼€å¤´çš„è¡Œå¼€å§‹åŒ¹é…, ä¸€ç›´åˆ°ä»¥Iå¼€å¤´çš„è¡Œ, æ˜¾ç¤ºä¸­é—´æ‰€æœ‰è¡Œ
$ sed -n '/^hezhaoyang/,/^I/p' sed_example
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="http://p1.qhimg.com/t016c7b865c3597bb7c.png" alt="">&lt;/p>
&lt;p>&lt;strong>ä¾‹2.2&lt;/strong>&lt;/p>
&lt;pre>&lt;code>#å°†sed_insertä¸­çš„å†…å®¹æ’å…¥åˆ°ä»¥hezhaoyangå¼€å¤´çš„è¡Œå
$ sed '/hezhaoyang/r sed_insert' sed_example
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="http://p2.qhimg.com/t01c35938e797df3318.png" alt="">&lt;/p>
&lt;h2 id="awk">awk&lt;/h2>
&lt;h3 id="æ¦‚è¿°-2">æ¦‚è¿°&lt;/h3>
&lt;p>AWKæ˜¯ä¸€ç§å¤„ç†æ–‡æœ¬æ–‡ä»¶çš„è¯­è¨€. å®ƒå°†æ–‡ä»¶ä½œä¸ºè®°å½•åºåˆ—å¤„ç†.
åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–‡ä»¶å†…å®¹çš„æ¯è¡Œéƒ½æ˜¯ä¸€ä¸ªè®°å½•. æ¯è¡Œå†…å®¹éƒ½ä¼šè¢«åˆ†å‰²æˆä¸€ç³»åˆ—çš„åŸŸ,
å› æ­¤, æˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸€è¡Œçš„ç¬¬ä¸€ä¸ªè¯ä¸ºç¬¬ä¸€ä¸ªåŸŸ,ç¬¬äºŒä¸ªè¯ä¸ºç¬¬äºŒä¸ª, ä»¥æ­¤ç±»æ¨.
AWKç¨‹åºæ˜¯ç”±ä¸€äº›å¤„ç†ç‰¹å®šæ¨¡å¼çš„è¯­å¥å—æ„æˆçš„. AWKä¸€æ¬¡å¯ä»¥è¯»å–ä¸€ä¸ªè¾“å…¥è¡Œ.
å¯¹æ¯ä¸ªè¾“å…¥è¡Œ, AWKè§£é‡Šå™¨ä¼šåˆ¤æ–­å®ƒæ˜¯å¦ç¬¦åˆç¨‹åºä¸­å‡ºç°çš„å„ä¸ªæ¨¡å¼, å¹¶æ‰§è¡Œç¬¦åˆçš„æ¨¡å¼æ‰€å¯¹åº”çš„åŠ¨ä½œã€‚&lt;/p>
&lt;p>â€”â€”é˜¿å°”ä½›é›·å¾·Â·è‰¾ä¾¯ï¼Œ&lt;a href="http://www.computerworld.com.au/index.php/id;1726534212;pp;2">The A-Z of Programming Languages: AWK&lt;/a>&lt;/p>
&lt;h3 id="ä½¿ç”¨æ ¼å¼-2">ä½¿ç”¨æ ¼å¼&lt;/h3>
&lt;pre>&lt;code>awk [options] 'BEGIN{ } pattern{ } END{ }'
&lt;/code>&lt;/pre>
&lt;h3 id="å¸¸ç”¨é€‰é¡¹-2">å¸¸ç”¨é€‰é¡¹&lt;/h3>
&lt;ul>
&lt;li>-F fs : æŒ‡å®šåˆ†éš”ç¬¦ä¸ºfs&lt;/li>
&lt;li>-v var=value : å®šä¹‰å¯ä¼ é€’ç»™awkçš„å˜é‡&lt;/li>
&lt;li>-f scriptfile : ä»è„šæœ¬æ–‡ä»¶ä¸­è¯»å–awkå‘½ä»¤&lt;/li>
&lt;/ul>
&lt;h3 id="åŸºæœ¬ç»“æ„">åŸºæœ¬ç»“æ„&lt;/h3>
&lt;p>ä¸€ä¸ªawkè„šæœ¬é€šå¸¸ç”±: BEGINè¯­å¥å—ã€èƒ½å¤Ÿä½¿ç”¨æ¨¡å¼åŒ¹é…çš„é€šç”¨è¯­å¥å—ã€ENDè¯­å¥å—3éƒ¨åˆ†ç»„æˆ, è¿™ä¸‰ä¸ªéƒ¨åˆ†æ˜¯å¯é€‰çš„.
ä»»æ„ä¸€ä¸ªéƒ¨åˆ†éƒ½å¯ä»¥ä¸å‡ºç°åœ¨è„šæœ¬ä¸­, è„šæœ¬é€šå¸¸æ˜¯è¢«å•å¼•å·æˆ–åŒå¼•å·ä¸­.&lt;/p>
&lt;h3 id="awk-çš„å·¥ä½œè¿‡ç¨‹">awk çš„å·¥ä½œè¿‡ç¨‹&lt;/h3>
&lt;p>ç¬¬ä¸€æ­¥: æ‰§è¡ŒBEGIN{ commands }è¯­å¥å—ä¸­çš„è¯­å¥;
ç¬¬äºŒæ­¥: ä»æ–‡ä»¶æˆ–æ ‡å‡†è¾“å…¥(stdin)è¯»å–ä¸€è¡Œ, ç„¶åæ‰§è¡Œpattern{ commands }è¯­å¥å—, å®ƒé€è¡Œæ‰«ææ–‡ä»¶, ä»ç¬¬ä¸€è¡Œåˆ°æœ€åä¸€è¡Œé‡å¤è¿™ä¸ªè¿‡ç¨‹, ç›´åˆ°æ–‡ä»¶å…¨éƒ¨è¢«è¯»å–å®Œæ¯•.
ç¬¬ä¸‰æ­¥: å½“è¯»è‡³è¾“å…¥æµæœ«å°¾æ—¶, æ‰§è¡ŒEND{ commands }è¯­å¥å—.&lt;/p>
&lt;p>BEGINè¯­å¥å—åœ¨awkå¼€å§‹ä»è¾“å…¥æµä¸­è¯»å–è¡Œä¹‹å‰è¢«æ‰§è¡Œ, è¿™æ˜¯ä¸€ä¸ªå¯é€‰çš„è¯­å¥å—, æ¯”å¦‚å˜é‡åˆå§‹åŒ–ã€æ‰“å°è¾“å‡ºè¡¨æ ¼çš„è¡¨å¤´ç­‰è¯­å¥é€šå¸¸å¯ä»¥å†™åœ¨BEGINè¯­å¥å—ä¸­.
ENDè¯­å¥å—åœ¨awkä»è¾“å…¥æµä¸­è¯»å–å®Œæ‰€æœ‰çš„è¡Œä¹‹åå³è¢«æ‰§è¡Œ, æ¯”å¦‚æ‰“å°æ‰€æœ‰è¡Œçš„åˆ†æç»“æœè¿™ç±»ä¿¡æ¯æ±‡æ€»éƒ½æ˜¯åœ¨ENDè¯­å¥å—ä¸­å®Œæˆ, å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯é€‰è¯­å¥å—.
patternè¯­å¥å—ä¸­çš„é€šç”¨å‘½ä»¤æ˜¯æœ€é‡è¦çš„éƒ¨åˆ†, å®ƒä¹Ÿæ˜¯å¯é€‰çš„. {} ç›¸å½“äºä¸€ä¸ªå¾ªç¯ä½“, å®ƒä¼šå¯¹æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œè¿›è¡Œè¿­ä»£.&lt;/p>
&lt;h3 id="è¾“å‡º-print--printf">è¾“å‡º print / printf&lt;/h3>
&lt;h4 id="print">print&lt;/h4>
&lt;ol>
&lt;li>
&lt;p>å½“è¦è¾“å‡ºå¤šä¸ªå˜é‡æ—¶, åº”è¯¥ç”¨é€—å·',&amp;lsquo;åˆ†éš”&lt;/p>
&lt;pre>&lt;code> $ echo | awk '{ var1=&amp;quot;v1&amp;quot;; var2=&amp;quot;v2&amp;quot;; var3=&amp;quot;v3&amp;quot;; print var1,var2,var3; }'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;p>åªå†™ &lt;code>print&lt;/code> ç›¸å½“äº &lt;code>print $0&lt;/code>, å¦‚æœæƒ³è¦è¾“å‡ºç©ºè¡Œ, åº”è¯¥å†™åš: &lt;code>print ''&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>&lt;code>$1&lt;/code>, &lt;code>$2&lt;/code>, &lt;code>$3&lt;/code> &amp;hellip; åˆ†åˆ«å¯¹åº”è¯¥è¡Œçš„ç¬¬1ä¸ª, ç¬¬2ä¸ª, ç¬¬3ä¸ªå­—æ®µ, ä»¥æ­¤ç±»å¯¹&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="printf">printf&lt;/h4>
&lt;p>ä¸ print çš„åŒºåˆ«åœ¨äº printf éœ€è¦æ ¼å¼åŒ–è¾“å‡º.&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>%c&lt;/td>
&lt;td>å­—ç¬¦ç±»å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%d, %i&lt;/td>
&lt;td>åè¿›åˆ¶&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%e, %E&lt;/td>
&lt;td>ç§‘å­¦è®¡æ•°æ³•è¾“å‡ºæ•°å€¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%f&lt;/td>
&lt;td>æµ®ç‚¹æ•°ç±»å‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%g, %G&lt;/td>
&lt;td>ç§‘å­¦è®¡æ•°æ³•æˆ–æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤º&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%s&lt;/td>
&lt;td>å­—ç¬¦ä¸²&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%u&lt;/td>
&lt;td>æ— ç¬¦å·æ•´æ•°&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>%%&lt;/td>
&lt;td>%æœ¬èº«&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h5 id="ä¿®é¥°ç¬¦">ä¿®é¥°ç¬¦&lt;/h5>
&lt;ul>
&lt;li>N: å®½åº¦&lt;/li>
&lt;li>-: å·¦å¯¹é½&lt;/li>
&lt;li>+: æ˜¾ç¤ºæ•°å€¼ç¬¦å·&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ³¨æ„&lt;/strong>:
printf é»˜è®¤ä¸æ¢è¡Œ, éœ€è¦ä½¿ç”¨&lt;code>&amp;quot;\n&amp;quot;&lt;/code>&lt;/p>
&lt;p>&lt;strong>ä¾‹3.1:&lt;/strong>&lt;/p>
&lt;pre>&lt;code>#è¾“å‡ºç”¨æˆ·åå’Œä½¿ç”¨çš„shellç±»å‹
$ head -10 /etc/passwd | awk -F: '{printf &amp;quot;%-15s%s\n&amp;quot;, $1, $7}'
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="http://p3.qhimg.com/t0171ee814b38a60d04.png" alt="">&lt;/p>
&lt;h3 id="awkå†…ç½®å˜é‡">awkå†…ç½®å˜é‡&lt;/h3>
&lt;h4 id="è®°å½•å˜é‡">è®°å½•å˜é‡&lt;/h4>
&lt;ul>
&lt;li>FS: field separator å­—æ®µåˆ†éš”ç¬¦, é»˜è®¤ä¸ºç©ºç™½å­—ç¬¦&lt;/li>
&lt;li>RS: record separator è®°å½•åˆ†éš”ç¬¦, é»˜è®¤ä¸ºæ¢è¡Œç¬¦&lt;/li>
&lt;li>OFS: output field separator è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦&lt;/li>
&lt;li>ORS: output record separator è¾“å‡ºè®°å½•åˆ†éš”ç¬¦&lt;/li>
&lt;/ul>
&lt;h4 id="æ•°æ®å˜é‡">æ•°æ®å˜é‡&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>NR: number of input rows å¤„ç†çš„è¡Œæ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>NF: number of fields è¯¥è¡Œå­—æ®µçš„ä¸ªæ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ARGV: æ•°ç»„, ä¿å­˜awkå‘½ä»¤è¡Œ.
å¦‚: $ awk &amp;lsquo;{ print $0 }&amp;rsquo; a.txt b.txtä¸­ARGV[0]=awk, ARGV[1]=a.txt&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ARGC: awkå‘½ä»¤å‚æ•°çš„ä¸ªæ•°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>FILENAME: æ‰€å¤„ç†æ–‡ä»¶çš„åç§°&lt;/p>
&lt;/li>
&lt;li>
&lt;p>IGNORECASE: IGNORECASE=1æ—¶å¿½ç•¥å¤§å°å†™&lt;/p>
&lt;pre>&lt;code> $ echo &amp;quot;TEST HHHH&amp;quot; | awk '{IGNORECASE=1; if($1 == &amp;quot;test&amp;quot;){print &amp;quot;ok&amp;quot;;}}'
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;h3 id="èµ‹å€¼">èµ‹å€¼&lt;/h3>
&lt;pre>&lt;code>$ awk -v var=&amp;quot;value&amp;quot; '{print var}'
$ awk 'BEGIN{ var=&amp;quot;value&amp;quot;; print var; }'
&lt;/code>&lt;/pre>
&lt;h3 id="æ“ä½œç¬¦">æ“ä½œç¬¦&lt;/h3>
&lt;pre>&lt;code>+ - * / ^ ** %
&lt;/code>&lt;/pre>
&lt;h3 id="æ¯”è¾ƒè¿ç®—ç¬¦">æ¯”è¾ƒè¿ç®—ç¬¦&lt;/h3>
&lt;pre>&lt;code> &amp;lt; &amp;lt;= &amp;gt;= &amp;gt; &amp;gt;= == !=
x~y
# True if the string x matches the regexp denoted by y
# å¦‚æœå­—ç¬¦ä¸²xè¢«æ­£åˆ™è¡¨è¾¾å¼yåŒ¹é…, åˆ™ä¸ºçœŸ
x!~y
&lt;/code>&lt;/pre>
&lt;h3 id="æ•°ç»„">æ•°ç»„&lt;/h3>
&lt;h4 id="å®šä¹‰">å®šä¹‰&lt;/h4>
&lt;pre>&lt;code>arr[1] = 'first'
arr[2] = 'second'
arr['year'] = 2016
arr['month'] = 8
&lt;/code>&lt;/pre>
&lt;h4 id="é•¿åº¦">é•¿åº¦&lt;/h4>
&lt;pre>&lt;code>length() è·å–å­—ç¬¦ä¸²ï¼Œæ•°ç»„çš„é•¿åº¦
split() åˆ†å‰²æ•°ç»„ï¼Œ è¿”å›é•¿åº¦
asort() æ’åºæ•°ç»„ï¼Œ è¿”å›é•¿åº¦
&lt;/code>&lt;/pre>
&lt;p>&lt;strong>éœ€è¦æ³¨æ„&lt;/strong>ï¼š&lt;/p>
&lt;p>åˆ¤æ–­æ•°ç»„æ˜¯å¦åŒ…å«æŸé”®å€¼&lt;/p>
&lt;pre>&lt;code>#é”™è¯¯å†™æ³•
$ echo | awk 'BEGIN{a[&amp;quot;a&amp;quot;]=1;a[&amp;quot;b&amp;quot;]=2; if(a[&amp;quot;c&amp;quot;]!=1){print &amp;quot;ok&amp;quot;}; for(i in a) {print i, a[i];} }'
#æ­£ç¡®åˆ¤æ–­
$ echo | awk 'BEGIN{a[&amp;quot;a&amp;quot;]=1;a[&amp;quot;b&amp;quot;]=2; if(&amp;quot;c&amp;quot; in a){print &amp;quot;ok&amp;quot;}; for(i in a) {print i, a[i];} }'
&lt;/code>&lt;/pre>
&lt;p>awk ä¸­çš„æ•°ç»„æ˜¯å…³è”æ•°ç»„, åªè¦æ˜¯é€šè¿‡ä»–çš„æ•°ç»„å¼•ç”¨è¿‡key, å°±ä¼šè‡ªåŠ¨åˆ›å»ºè¯¥åºåˆ—.&lt;/p>
&lt;h4 id="å¤šç»´æ•°ç»„">å¤šç»´æ•°ç»„&lt;/h4>
&lt;p>awkçš„å¤šç»´æ•°ç»„æœ¬è´¨ä¸Šæ˜¯ä¸€ç»´æ•°ç»„, æ›´ç¡®åˆ‡åœ°è¯´, awkæ˜¯ä¸æ”¯æŒä»¥ä¸ºå¤šç»´æ•°ç»„çš„.
ä½†æ˜¯awkæä¾›äº†é€»è¾‘ä¸Šæ¨¡æ‹Ÿå¤šç»´æ•°ç»„çš„æ–¹å¼. åœ¨awkä¸­, &lt;code>array[1, 2]=1&lt;/code> , è¿™æ ·çš„å†™æ³•æ˜¯å…è®¸çš„.
ä»–æ˜¯ä½¿ç”¨äº†ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦ä¸²&lt;code>SUBSEP(\034)&lt;/code>åˆ†éš”é”®, &lt;strong>[2, 4]&lt;strong>å®é™…ä¸Šæ˜¯&lt;/strong>[2SUBSEP4]&lt;/strong>.&lt;/p>
&lt;p>è®¿é—®å¯ä»¥ä½¿ç”¨&lt;code>for( (i, j) in array ){}&lt;/code>ä½†æ˜¯å¿…é¡»ç”¨åœ†æ‹¬å·.
ä½†æ˜¯å•ç‹¬è®¿é—®æ—¶, å¿…é¡»ä½¿ç”¨split()å°†æ•°ç»„é”®å€¼åˆ†å¼€.
å³:&lt;/p>
&lt;pre>&lt;code>arr[1,1] = 11;
arr[1,2] = 12;
arr[2,1] = 21;
arr[2,2] = 22;
for (a in arr) {
split(a, tmp, SUBSEP);
print tmp[1], tmp[2];z
}
&lt;/code>&lt;/pre>
&lt;h3 id="æ§åˆ¶è¯­å¥">æ§åˆ¶è¯­å¥&lt;/h3>
&lt;pre>&lt;code>1. if-else
if (condition) {} else {}
2. while
while (condition) {}
3. do-while
do {} while (condition)
4. for
for ( ; ; ) {}
for (item in array) {}
5. switch
switch (expression) { case x: ; case y: ;}
6. break, continue
7. next # æå‰ç»“æŸæœ¬è¡Œ
&lt;/code>&lt;/pre>
&lt;h3 id="å†…ç½®å‡½æ•°">å†…ç½®å‡½æ•°&lt;/h3>
&lt;pre>&lt;code>split(string, array [,fieldsep])
# ä½¿ç”¨fieldsepåˆ†éš”string, å¹¶å­˜å‚¨åœ¨åä¸ºarrayçš„æ•°ç»„ä¸­
#å®ä¾‹:
$ awk '{ split( &amp;quot;20:18:00&amp;quot;, time, &amp;quot;:&amp;quot; ); print time[2] }'
# ä¸Šä¾‹æŠŠæ—¶é—´æŒ‰å†’å·åˆ†å‰²åˆ°timeæ•°ç»„å†…ï¼Œå¹¶æ˜¾ç¤ºç¬¬äºŒä¸ªæ•°ç»„å…ƒç´ 18ã€‚
# è¿”å›å€¼ä¸ºåˆ†å‰²æ•°ç»„çš„é•¿åº¦
length(string)
substr(string, start [, length])
system(command) : æ‰§è¡Œå‘½ä»¤å¹¶è¿”å›ç»™awk
systime() : è¿”å›å½“å‰æ—¶é—´æ—¶é—´æˆ³
tolower(string)
toupper(string)
match(string, regular expression)
# matchå‡½æ•°è¿”å›åœ¨å­—ç¬¦ä¸²ä¸­æ­£åˆ™è¡¨è¾¾å¼ä½ç½®çš„ç´¢å¼•,
# å¦‚æœæ‰¾ä¸åˆ°æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼åˆ™è¿”å›0, æ‰¾åˆ°è¿”å›1ã€‚
# matchå‡½æ•°ä¼šè®¾ç½®å†…å»ºå˜é‡RSTARTä¸ºå­—ç¬¦ä¸²ä¸­å­å­—ç¬¦ä¸²çš„å¼€å§‹ä½ç½®, RLENGTHä¸ºåˆ°å­å­—ç¬¦ä¸²æœ«å°¾çš„å­—ç¬¦ä¸ªæ•°.
# substrå¯åˆ©äºè¿™äº›å˜é‡æ¥æˆªå–å­—ç¬¦ä¸².
#å®ä¾‹ï¼š
$ awk '{start=match(&amp;quot;this is a test&amp;quot;,/[a-z]+$/); print start}'
$ awk '{start=match(&amp;quot;this is a test&amp;quot;,/[a-z]+$/); print start, RSTART, RLENGTH }'
# ç¬¬ä¸€ä¸ªå®ä¾‹æ‰“å°ä»¥è¿ç»­å°å†™å­—ç¬¦ç»“å°¾çš„å¼€å§‹ä½ç½®, è¿™é‡Œæ˜¯11.
# ç¬¬äºŒä¸ªå®ä¾‹è¿˜æ‰“å°RSTARTå’ŒRLENGTHå˜é‡, è¿™é‡Œæ˜¯11(start), 11(RSTART), 4(RLENGTH).
&lt;/code>&lt;/pre>
&lt;h3 id="å†…å»ºæ•°å­¦å‡½æ•°">å†…å»ºæ•°å­¦å‡½æ•°&lt;/h3>
&lt;pre>&lt;code>1. cos(x) ä½™å¼¦å‡½æ•°
2. exp(x) æ±‚å¹‚
3. int(x) å–æ•´
4. log(x) è‡ªç„¶å¯¹æ•°, è¿‡ç¨‹æ²¡æœ‰èˆå…¥
5. rand() äº§ç”Ÿä¸€ä¸ªå¤§äºç­‰äº0è€Œå°äº1çš„éšæœºæ•°
6. sin(x) æ­£å¼¦
7. sqrt(x) å¹³æ–¹æ ¹
8. srand(x) xæ˜¯rand()å‡½æ•°çš„ç§å­
&lt;/code>&lt;/pre>
&lt;h3 id="è‡ªå®šä¹‰å‡½æ•°">è‡ªå®šä¹‰å‡½æ•°&lt;/h3>
&lt;pre>&lt;code>function F_NAME([variable])
{
statements
}
# å‡½æ•°è¿˜å¯ä»¥ä½¿ç”¨returnè¯­å¥è¿”å›å€¼ï¼Œæ ¼å¼ä¸ºâ€œreturn valueâ€
&lt;/code>&lt;/pre></description><category domain="https://h1z3y3.me/tags/linux/">Linux</category></item><item><title>Vim åˆçº§å…¥é—¨</title><link>https://h1z3y3.me/posts/how-to-use-vim/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-use-vim/</guid><pubDate>Sat, 23 Jul 2016 19:04:11 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h2 id="å‰è¨€">å‰è¨€&lt;/h2>
&lt;p>æ²¡æœ‰æ¥è§¦è¿‡Vimçš„åŒå­¦, ä¸€å®šä¼šè§‰å¾—å¹³æ—¶ä½¿ç”¨çš„IDEå¾ˆå¥½ç”¨, ä½†æ˜¯å½“ä½ å¼€å§‹ä½¿ç”¨Vim, å¹¶ä¸”æ¸æ¸ç†Ÿæ‚‰, æˆ‘è§‰å¾—ä½ ä¼šçˆ±ä¸Šè¿™ä¸€æ¬¾ç¼–è¾‘å™¨.
åƒä¸‡ä¸è¦å› ä¸ºä¸€å¼€å§‹Vimæœ‰å¤ªå¤šå‘½ä»¤éœ€è¦è®°å¿†è€Œæ”¾å¼ƒå®ƒ.&lt;/p>
&lt;p>è¿™ç¯‡åšå®¢æ˜¯ç¿»è¯‘è‡ªã€Š&lt;a href="http://yannesposito.com/Scratch/en/blog/Learn-Vim-Progressively/">Learn Vim Progressively&lt;/a>ã€‹, å¹¶åœ¨æˆ‘è§‰å¾—æœ‰å¿…è¦æ·»åŠ è¯´æ˜çš„åœ°æ–¹æ·»åŠ äº†è‡ªå·±çš„è¯´æ˜. æˆ‘è®¤ä¸ºæ˜¯æœ€é€‚åˆå…¥é—¨Vimçš„æ•™ç¨‹, æ²¡æœ‰ä¹‹ä¸€.&lt;/p>
&lt;hr>
&lt;h2 id="æ­£æ–‡å¼€å§‹">æ­£æ–‡å¼€å§‹&lt;/h2>
&lt;p>ä½ æƒ³ä»¥æœ€å¿«çš„æ–¹å¼è‡ªå­¦Vimå—? åœ¨äººç±»æœ€ä¼˜ç§€çš„ç¼–è¾‘å™¨é¢å‰, ä½ å¿…é¡»è‡³å°‘å…ˆå­¦ä¼šå¦‚ä½•å¹¸å­˜ä¸‹æ¥, ç„¶åå†å»ä¸€ç‚¹ç‚¹æ•´åˆä½¿ç”¨å®ƒçš„æŠ€å·§.&lt;/p>
&lt;p>&lt;a href="http://www.vim.org/">Vim&lt;/a> the Six Billion Dollar editor&lt;/p>
&lt;blockquote>
&lt;p>Better, Stronger, Faster&lt;/p>
&lt;/blockquote>
&lt;p>å½“ä½ å­¦ä¼šä½¿ç”¨Vim, å®ƒå°†æˆä¸ºä½ æœ€åä¸€ä¸ªç¼–è¾‘å™¨. è™½ç„¶å­¦ä¹ å®ƒçš„è¿‡ç¨‹å¾ˆä¸å®¹æ˜“, ä½†æ˜¯æœ€åå®ƒä¼šéš¾ä»¥ç½®ä¿¡çš„å¥½ç”¨.&lt;/p>
&lt;p>ä¸‹é¢4ä¸ªæ­¥éª¤æ˜¯ä½ è‡ªå­¦çš„æ„Ÿå—:&lt;/p>
&lt;ol>
&lt;li>å­˜æ´»&lt;/li>
&lt;li>ä½¿ç”¨é¡ºæ‰‹&lt;/li>
&lt;li>æ›´å¥½, æ›´å¼º, æ›´å¿«&lt;/li>
&lt;li>ä½¿ç”¨Vimçš„è¶…èƒ½åŠ›&lt;/li>
&lt;/ol>
&lt;p>å½“ä½ è¯»å®Œè¿™ç¯‡æ–‡ç« , ä½ å°†ä¼šçˆ±ä¸Švim.&lt;/p>
&lt;p>ä½†æ˜¯æˆ‘ä»¬å¼€å§‹ä¹‹å‰, è¦å…ˆè¯´æ˜ä¸€ç‚¹:&lt;/p>
&lt;ul>
&lt;li>å­¦ä¹ vimçš„è¿‡ç¨‹å°†æ˜¯ååˆ†ç—›è‹¦çš„&lt;/li>
&lt;li>å°†èŠ±è´¹ä¸€äº›æ—¶é—´, åƒä¸‡ä¸è¦è§‰å¾—æµªè´¹æ—¶é—´å„¿æ”¾å¼ƒ&lt;/li>
&lt;li>å­¦ä¹ ä»–çš„è¿‡ç¨‹å°±åƒæ˜¯å­¦ä¹ ä¹å™¨, ä¸€æ—¦å…¥é—¨, å°±ä¼šå˜å¾—å¾ˆè½»æ¾&lt;/li>
&lt;li>ä¸è¦å¥¢æœ›åƒå…¶ä»–ç¼–è¾‘å™¨ä¸€æ ·ä¸‰å¤©ä¹‹å†…å°±èƒ½ç†Ÿç»ƒæŒæ¡, å­¦ä¹ vimè‡³å°‘éœ€è¦ä¸¤ä¸ªæ˜ŸæœŸè€Œä¸æ˜¯ä¸‰å¤©&lt;/li>
&lt;/ul>
&lt;h3 id="level-1---å­˜æ´»">Level 1 - å­˜æ´»&lt;/h3>
&lt;ol start="0">
&lt;li>å®‰è£…vim&lt;/li>
&lt;li>è¿è¡Œvim&lt;/li>
&lt;li>&lt;strong>ä¸è¦åšä»»ä½•äº‹æƒ…!&lt;/strong> è¯·å…ˆé˜…è¯»&lt;/li>
&lt;/ol>
&lt;p>åœ¨æ™®é€šç¼–è¾‘å™¨ä¸­, å½“ä½ æ•²å‡»é”®ç›˜å°±èƒ½åœ¨å±å¹•ä¸Šçœ‹åˆ°æƒ³è¦çš„å­—ç¬¦. ä½†æ˜¯å¯¹äºVimæ¥è®², ä¸æ˜¯è¿™æ ·çš„. å½“ä½ å¯åŠ¨vimçš„æ—¶å€™, vimå½“å‰æ­£åœ¨ &lt;em>&lt;code>Normal&lt;/code>&lt;/em> æ¨¡å¼ä¸‹, ä½ éœ€è¦å…ˆå°†æ¨¡å¼åˆ‡æ¢ä¸º &lt;em>&lt;code>Insert&lt;/code>&lt;/em> æ¨¡å¼, æ‰èƒ½å¤Ÿè¾“å…¥å­—ç¬¦. ä» &lt;em>&lt;code>Normal&lt;/code>&lt;/em> æ¨¡å¼åˆ° &lt;em>&lt;code>Insert&lt;/code>&lt;/em> æ¨¡å¼, éœ€è¦æ•²å‡»é”®ç›˜å­—ç¬¦ &lt;code>i&lt;/code>.&lt;/p>
&lt;p>å½“ä½ è¿›å…¥*&lt;code>Insert&lt;/code>*æ¨¡å¼, ä½ å¯èƒ½ä¼šæ„Ÿè§‰èˆ’æœä¸€ç‚¹, å› ä¸ºä½ å¯ä»¥åƒæ™®é€šç¼–è¾‘å™¨ä¸€æ ·è¾“å…¥å­—ç¬¦äº†. å¦‚æœä½ æƒ³ä»*&lt;code>Insert&lt;/code>*æ¨¡å¼åˆ‡æ¢å›*&lt;code>Normal&lt;/code>*æ¨¡å¼, åªéœ€è¦æ•²å‡»é”®ç›˜æœ€å·¦ä¸Šè§’çš„é”®&lt;code>ESC&lt;/code>é”®.&lt;/p>
&lt;p>ç°åœ¨ä½ çŸ¥é“å¦‚ä½•åœ¨*&lt;code>Insert&lt;/code>*æ¨¡å¼å’Œ*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¹‹é—´åˆ‡æ¢äº†. ç°åœ¨, ä½ å¿…é¡»è¦æŒæ¡ä¸‹é¢å‡ ä¸ªå‘½ä»¤ä»¥ä¿è¯ä½ èƒ½åœ¨*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¸‹å­˜æ´»ä¸‹å»:&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>i&lt;/code> : åˆ‡æ¢åˆ°*&lt;code>Insert&lt;/code>*æ¨¡å¼. æŒ‰&lt;code>ESC&lt;/code>è¿”å›*&lt;code>Normal&lt;/code>*æ¨¡å¼&lt;/li>
&lt;li>&lt;code>x&lt;/code> : åˆ é™¤å½“å‰å…‰æ ‡æ‰€åœ¨çš„ä¸€ä¸ªå­—ç¬¦&lt;/li>
&lt;li>&lt;code>:wq&lt;/code> : ä¿å­˜å¹¶é€€å‡º (&lt;code>:w&lt;/code> ä¿å­˜ç¼–è¾‘çš„æ–‡ä»¶, &lt;code>:q&lt;/code> é€€å‡ºvim)&lt;/li>
&lt;li>&lt;code>dd&lt;/code> : åˆ é™¤å…‰æ ‡æ‰€åœ¨çš„ä¸€è¡Œ&lt;/li>
&lt;li>&lt;code>p&lt;/code> : ç²˜è´´&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;blockquote>
&lt;p>#####æ¨è&lt;/p>
&lt;/blockquote>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>hjkl&lt;/code> (å¼ºçƒˆæ¨èä½†ä¸å¼ºåˆ¶ä½¿ç”¨): ä½ å¯ä»¥ä½¿ç”¨é”®ç›˜çš„ â†‘ â†“ â† â†’ è¿›è¡Œå…‰æ ‡çš„ç§»åŠ¨. &lt;strong>æç¤º:&lt;/strong> åœ¨*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¸‹, &lt;code>j&lt;/code>ä»£è¡¨æ–¹å‘ â†“&lt;/li>
&lt;li>&lt;code>:help &amp;lt;command&amp;gt;&lt;/code> : æ˜¾ç¤º &lt;code>&amp;lt;command&amp;gt;&lt;/code> çš„å¸®åŠ©æ–‡æ¡£. ä½ å¯ä»¥ç›´æ¥è¾“å…¥ &lt;code>:help&lt;/code> è€Œä¸è¾“å…¥ &lt;code>&amp;lt;command&amp;gt;&lt;/code> è·å–ä¸€èˆ¬æ€§å¸®åŠ©.&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>æœ€å¼€å§‹, ä½ åªéœ€è¦ä¸Šé¢5ä¸ªå‘½ä»¤. å½“ä½ å¾ˆè‡ªç„¶åœ°ä½¿ç”¨ä»¥ä¸Šå‘½ä»¤, æŠ›å¼ƒä¹‹å‰æ™®é€šç¼–è¾‘å™¨çš„ä¹ æƒ¯, é‚£ä¹ˆä½ å°±å¯ä»¥åˆ°&lt;strong>Level 2&lt;/strong>äº†.&lt;/p>
&lt;p>ä½†æ˜¯, åœ¨*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¸‹éœ€è¦æ³¨æ„çš„æ˜¯: åœ¨æ™®é€šç¼–è¾‘å™¨ä¸‹, &lt;code>Ctrl-C&lt;/code>æ˜¯å¤åˆ¶å‘½ä»¤, è¿™æ˜¯ä¸ªç»„åˆæŒ‰é”®æ¥å®Œæˆä¸€é¡¹å¤åˆ¶çš„åŠŸèƒ½, ä½†æ˜¯åœ¨vimä¸‹, ä¸å¯ä»¥è½»æ˜“åœ°ä½¿ç”¨&lt;code>Ctrl&lt;/code>. äº‹å®ä¸Š, åœ¨Vimçš„ *&lt;code>Normal&lt;/code>* æ¨¡å¼ä¸‹, vimå·²ç»èµ‹äºˆæ¯ä¸€ä¸ªæŒ‰é”®åŠŸèƒ½, ä¹Ÿå°±æ˜¯è¯´, åœ¨*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¸‹, æ¯ä¸€ä¸ªé”®éƒ½æ˜¯åŠŸèƒ½é”®, è€Œä¸éœ€è¦ä½ æŒ‰ä¸‹&lt;code>Ctrl&lt;/code>å»ç»„åˆå…¶ä»–æŒ‰é”®å®ç°æŸé¡¹åŠŸèƒ½.&lt;/p>
&lt;p>&lt;strong>æç¤º&lt;/strong>&lt;/p>
&lt;ul>
&lt;li>ä¸ºäº†ä¾¿äºä¹¦å†™å’Œé˜…è¯», ä¸‹é¢çš„æ–‡ç« ä¸­, &lt;code>&amp;lt;C-Î»&amp;gt;&lt;/code> å°†ä»£è¡¨é”®å…¥ &lt;code>Ctrl-Î»&lt;/code>&lt;/li>
&lt;li>å‘½ä»¤éƒ½æ˜¯ä»¥&lt;code>:&lt;/code>å¼€å¤´, å¹¶ä¸”æœ€åè¦é”®å…¥&lt;code>&amp;lt;enter&amp;gt;&lt;/code>. å¦‚: å½“æˆ‘å†™&lt;code>:q&lt;/code>, å°†ä»£è¡¨&lt;code>:q&amp;lt;enter&amp;gt;&lt;/code>&lt;/li>
&lt;/ul>
&lt;h3 id="level-2---æ„Ÿè§‰é¡ºæ‰‹">Level 2 - æ„Ÿè§‰é¡ºæ‰‹&lt;/h3>
&lt;p>ä½ ç°åœ¨å·²ç»å¯ä»¥åœ¨vimä¸­å­˜æ´»äº†. ç°åœ¨æ˜¯æ—¶å€™å­¦ç‚¹å…¶ä»–çš„å‘½ä»¤äº†. ä¸‹é¢æ˜¯æˆ‘çš„å»ºè®®(ä»¥ä¸‹å‘½ä»¤éƒ½æ˜¯åœ¨*&lt;code>Normal&lt;/code>*æ¨¡å¼ä¸‹é”®å…¥):&lt;/p>
&lt;ol>
&lt;li>å„ç§æ’å…¥æ¨¡å¼&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>a&lt;/code> : åœ¨å½“å‰å…‰æ ‡åå¼€å§‹æ’å…¥, å¹¶ä¸”è¿›å…¥*&lt;code>Insert&lt;/code>*æ¨¡å¼&lt;/li>
&lt;li>&lt;code>o&lt;/code> : ä»å½“å‰è¡Œä¸‹é¢æ’å…¥æ–°è¡Œ, å¹¶ä¸”è¿›å…¥*&lt;code>Insert&lt;/code>*æ¨¡å¼&lt;/li>
&lt;li>&lt;code>O&lt;/code> : ä»å½“å‰è¡Œä¸Šé¢æ’å…¥æ–°è¡Œ, å¹¶ä¸”è¿›å…¥*&lt;code>Insert&lt;/code>*æ¨¡å¼&lt;/li>
&lt;li>&lt;code>cw&lt;/code> : åˆ é™¤å…‰æ ‡å¼€å§‹çš„å•è¯, å¹¶ä¸”è¿›å…¥*&lt;code>Insert&lt;/code>*æ¨¡å¼&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ol start="2">
&lt;li>åŸºæœ¬çš„ç§»åŠ¨&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>0&lt;/code> : åˆ°å…‰æ ‡æ‰€åœ¨è¡Œçš„æœ€å¼€å§‹&lt;/li>
&lt;li>&lt;code>^&lt;/code> : åˆ°å…‰æ ‡æ‰€åœ¨è¡Œç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦&lt;/li>
&lt;li>&lt;code>$&lt;/code> : åˆ°å…‰æ ‡æ‰€åœ¨è¡Œçš„æœ«å°¾&lt;/li>
&lt;li>&lt;code>g_&lt;/code> : åˆ°å…‰æ ‡æ‰€åœ¨è¡Œæœ€åä¸€ä¸ªéç©ºå­—ç¬¦&lt;/li>
&lt;li>&lt;code>/pattern&lt;/code> : å‘ä¸‹æœç´¢å­—ç¬¦ä¸²&lt;code>pattern&lt;/code>&lt;/li>
&lt;li>&lt;code>?pattern&lt;/code> : å‘ä¸Šæœç´¢å­—ç¬¦ä¸²&lt;code>pattern&lt;/code>&lt;/li>
&lt;/ul>
&lt;p>&lt;strong>æ³¨&lt;/strong>: æœç´¢æ—¶, é”®å…¥&lt;code>n&lt;/code>é”®å¯ä»¥æŸ¥çœ‹ä¸‹ä¸€é¡¹, é”®å…¥&lt;code>N&lt;/code>é”®å¯ä»¥æŸ¥çœ‹ä¸Šä¸€é¡¹&lt;/p>
&lt;/blockquote>
&lt;ol start="3">
&lt;li>å¤åˆ¶/ç²˜è´´&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>p&lt;/code> : åœ¨å½“å‰å…‰æ ‡åç²˜è´´&lt;/li>
&lt;li>&lt;code>P&lt;/code> : åœ¨å½“å‰å…‰æ ‡å‰ç²˜è´´&lt;/li>
&lt;li>&lt;code>yy&lt;/code>: å¤åˆ¶å…‰æ ‡æ‰€åœ¨æ•´è¡Œ&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ol start="4">
&lt;li>æ’¤é”€/æ¢å¤ (Undo/Redo)&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>u&lt;/code> : æ’¤é”€&lt;/li>
&lt;li>&lt;code>&amp;lt;C-r&amp;gt;&lt;/code> : æ¢å¤&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;ol start="5">
&lt;li>è½½å…¥/ä¿å­˜/é€€å‡º/ä¿®æ”¹æ–‡ä»¶(Buffer)&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;p>&lt;code>:e &amp;lt;path/to/file&amp;gt;&lt;/code> : æ‰“å¼€æ–‡ä»¶
&lt;code>:w&lt;/code> : ä¿å­˜æ–‡ä»¶ä¿®æ”¹
&lt;code>:saveas &amp;lt;path/to/file&amp;gt;&lt;/code> : å¦å­˜ä¸º&lt;code>&amp;lt;path/to/file&amp;gt;&lt;/code>
&lt;code>:x&lt;/code>, &lt;code>ZZ&lt;/code> or &lt;code>:wq&lt;/code> : ä¿å­˜å¹¶é€€å‡º. &lt;code>:wq&lt;/code>ç›¸å½“äºå…ˆ&lt;code>:w&lt;/code>å†&lt;code>:q&lt;/code>; &lt;code>:x&lt;/code>åªåœ¨éœ€è¦æ—¶ä¿å­˜; &lt;code>ZZ&lt;/code>ä¸éœ€è¦è¾“å…¥&lt;code>:&lt;/code>å’Œå›è½¦&lt;code>&amp;lt;enter&amp;gt;&lt;/code>
&lt;code>:q!&lt;/code> : å¼ºåˆ¶é€€å‡ºè€Œä¸ä¿å­˜ä¿®æ”¹. &lt;code>:qa!&lt;/code>, å¼ºåˆ¶é€€å‡ºæ‰€æœ‰æ­£åœ¨ç¼–è¾‘çš„æ–‡ä»¶, å³ä½¿å…¶ä»–æ–‡ä»¶æœ‰åšè¿‡ä¿®æ”¹è€Œæ²¡æœ‰ä¿å­˜
&lt;code>:bn&lt;/code>å’Œ&lt;code>:bp&lt;/code> : åˆ‡æ¢åˆ°ä¸‹/ä¸Šä¸€ä¸ªæ–‡ä»¶&lt;/p>
&lt;/blockquote>
&lt;p>èŠ±ä¸€ç‚¹æ—¶é—´å»ç†Ÿæ‚‰ä¸Šé¢çš„å‘½ä»¤. å½“ä½ ç†Ÿç»ƒæŒæ¡ä¹‹å, ä½ å¯ä»¥å®Œæˆä½ åœ¨æ™®é€šç¼–è¾‘å™¨å‡ ä¹æ‰€æœ‰åŠŸèƒ½. ä½ å¯èƒ½ä¼šè§‰å¾—ç”¨vimè¿˜æ˜¯æœ‰ç‚¹åˆ«æ‰­. ä½†æ˜¯è·Ÿç€æˆ‘è¿›å…¥ä¸‹ä¸€Level, æˆ–è®¸ä½ å¯ä»¥æ˜ç™½ä¸ºä»€ä¹ˆè¦èŠ±è´¹è¿™ä¹ˆå¤šåŠ›æ°”å»å­¦ä¹ å®ƒ.&lt;/p>
&lt;h3 id="level-3---æ›´å¥½-æ›´å¼º-æ›´å¿«">Level 3 - æ›´å¥½. æ›´å¼º. æ›´å¿«.&lt;/h3>
&lt;p>æ­å–œä½ å·²ç»åˆ°è¾¾äº†Level 3! æˆ‘ä»¬ç°åœ¨å¼€å§‹å­¦ä¹ ä¸€äº›æœ‰è¶£çš„ä¸œè¥¿. åœ¨Level 3, æˆ‘ä»¬åªè®¨è®ºå’Œviç¼–è¾‘å™¨å…¼å®¹çš„é‚£äº›å‘½ä»¤.&lt;/p>
&lt;h4 id="31-æ›´å¥½">3.1 æ›´å¥½&lt;/h4>
&lt;p>è®©æˆ‘ä»¬çœ‹çœ‹vimæ˜¯æ€ä¹ˆæ ·å¸®åŠ©ä½ åšé‡å¤çš„å‘½ä»¤çš„:&lt;/p>
&lt;ol>
&lt;li>&lt;code>.&lt;/code>(ç‚¹) : é‡å¤ä¸Šä¸€æ¬¡çš„å‘½ä»¤&lt;/li>
&lt;li>&lt;code>N&amp;lt;command&amp;gt;&lt;/code>: å°†ä¼šè¿è¡Œ&lt;code>&amp;lt;command&amp;gt;&lt;/code>Næ¬¡, è¿™é‡Œçš„Næ˜¯ä¸€ä¸ªæ•´æ•°&lt;/li>
&lt;/ol>
&lt;p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­. æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ç„¶åè¾“å…¥ä¸‹é¢çš„å‘½ä»¤:&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>2dd&lt;/code> : å°†ä¼šåˆ é™¤2è¡Œ&lt;/li>
&lt;li>&lt;code>3p&lt;/code> : å°†ä¼šæ‰§è¡Œç²˜è´´å‘½ä»¤3æ¬¡&lt;/li>
&lt;li>&lt;code>100idesu [ESC]&lt;/code> : å°†ä¼šè¾“å…¥ &amp;ldquo;desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu desu&amp;rdquo;&lt;/li>
&lt;li>&lt;code>.&lt;/code> : è·Ÿåœ¨ä¸Šä¸€ä¸ªå‘½ä»¤åé¢ä»£è¡¨å†æ¬¡è¾“å…¥100æ¬¡&amp;quot;desu&amp;quot;&lt;/li>
&lt;li>&lt;code>3.&lt;/code> : å°†ä¼šè¾“å…¥3æ¬¡&amp;quot;desu&amp;quot;(è€Œä¸æ˜¯300æ¬¡, ä½ çœ‹vimå¤šä¹ˆèªæ˜)&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;h4 id="32-æ›´å¼º">3.2 æ›´å¼º&lt;/h4>
&lt;p>çŸ¥é“å¦‚ä½•é«˜æ•ˆçš„åœ¨vimä¸­ç§»åŠ¨å…‰æ ‡ååˆ†é‡è¦. ä¸è¦è·³è¿‡è¿™ä¸€éƒ¨åˆ†.&lt;/p>
&lt;ol>
&lt;li>N&lt;code>G&lt;/code> : ç§»åŠ¨å…‰æ ‡åˆ°ç¬¬Nè¡Œ&lt;/li>
&lt;li>&lt;code>gg&lt;/code> : ç›¸å½“äº &lt;code>1G&lt;/code>, åˆ°æ–‡ä»¶çš„æœ€å¼€å§‹ä¸€è¡Œ&lt;/li>
&lt;li>&lt;code>G&lt;/code> : åˆ°æ–‡ä»¶çš„æœ€åä¸€è¡Œ&lt;/li>
&lt;li>æŒ‰ç…§å•è¯ç§»åŠ¨:&lt;/li>
&lt;/ol>
&lt;blockquote>
&lt;ol>
&lt;li>&lt;code>w&lt;/code> : åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„å¼€å§‹&lt;/li>
&lt;li>&lt;code>e&lt;/code> : åˆ°ä¸‹ä¸€ä¸ªå•è¯çš„ç»“å°¾
é»˜è®¤æƒ…å†µä¸‹, æˆ‘ä»¬è®¤ä¸ºå•è¯æ˜¯ç”±ä¸€ç³»åˆ—å­—ç¬¦å’Œä¸‹åˆ’çº¿ç»„æˆ. å¦‚æœä½ è®¤ä¸ºç”±ç©ºæ ¼åˆ†éš”å¼€çš„å­—ç¬¦ä¸²å³ä¸ºå•è¯, é‚£ä¹ˆä½ åªéœ€è¦ä½¿ç”¨&lt;code>W&lt;/code>å’Œ&lt;code>E&lt;/code>.&lt;/li>
&lt;/ol>
&lt;/blockquote>
&lt;blockquote>
&lt;p>&lt;img src="http://p3.qhimg.com/t01ba88a3a55faa8746.jpg" alt="å•è¯ç§»åŠ¨">&lt;/p>
&lt;/blockquote>
&lt;p>ç°åœ¨ä»‹ç»æ›´é«˜æ•ˆçš„ç§»åŠ¨æ–¹å¼:&lt;/p>
&lt;blockquote>
&lt;ul>
&lt;li>&lt;code>%&lt;/code> : åŒ¹é…æ‹¬å·ç§»åŠ¨å…‰æ ‡, å¦‚&lt;code>()&lt;/code>,&lt;code>[]&lt;/code>,&lt;code>{}&lt;/code>&lt;/li>
&lt;li>&lt;code>*&lt;/code>å’Œ&lt;code>#&lt;/code> : åŒ¹é…å…‰æ ‡å½“å‰æ‰€åœ¨å•è¯, å¹¶ä¸”å‘ä¸‹/ä¸ŠæŸ¥æ‰¾åŒ¹é…çš„å•è¯, å¹¶æŠŠå…‰æ ‡ç§»åˆ°æŸ¥æ‰¾åˆ°çš„å•è¯&lt;/li>
&lt;/ul>
&lt;/blockquote>
&lt;p>ç›¸ä¿¡æˆ‘, æœ€åçš„ä¸‰ä¸ªå‘½ä»¤æ˜¯ååˆ†é«˜æ•ˆçš„.&lt;/p>
&lt;h4 id="33-æ›´å¿«">3.3 æ›´å¿«&lt;/h4>
&lt;p>è®°ä½å¦‚ä½•ç§»åŠ¨å…‰æ ‡äº†å—, å› ä¸ºå¾ˆå¤šå‘½ä»¤éƒ½æ˜¯å¯ä»¥ç»„åˆä½¿ç”¨çš„. å¹¶ä¸”å¤§å¤šæ˜¯ä»¥ä»¥ä¸‹æ ¼å¼:&lt;/p>
&lt;p>&lt;code>&amp;lt;start position&amp;gt;&amp;lt;command&amp;gt;&amp;lt;end position&amp;gt;&lt;/code>&lt;/p>
&lt;p>ä¾‹å¦‚: &lt;code>0y$&lt;/code> æ„æ€æ˜¯&lt;/p>
&lt;ul>
&lt;li>&lt;code>0&lt;/code> : å°†å…‰æ ‡ç§»åŠ¨åˆ°è¡Œé¦–&lt;/li>
&lt;li>&lt;code>y&lt;/code> : å¼€å§‹å¤åˆ¶&lt;/li>
&lt;li>&lt;code>$&lt;/code> : å¤åˆ¶åˆ°è¡Œå°¾&lt;/li>
&lt;/ul>
&lt;p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>ye&lt;/code>, ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å¤åˆ¶åˆ°å•è¯ç»“æŸ.
ä¹Ÿå¯ä»¥ä½¿ç”¨&lt;code>y2/foo&lt;/code>, ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å¤åˆ¶åˆ°åŒ¹é…çš„ç¬¬äºŒä¸ª&lt;code>foo&lt;/code>&lt;/p>
&lt;p>å¯¹&lt;code>y&lt;/code>(å¤åˆ¶)æ¥è¯´æ˜¯è¿™æ ·çš„, é‚£ä¹ˆå¯¹&lt;code>d&lt;/code>(åˆ é™¤), &lt;code>v&lt;/code>(å¯è§†åŒ–é€‰æ‹©), &lt;code>gU&lt;/code>(è½¬å¤§å†™), &lt;code>gu&lt;/code>(è½¬å°å†™)ç­‰ç­‰å‘½ä»¤æ¥è¯´ä¹Ÿæ˜¯åŒæ ·é€‚ç”¨çš„&lt;/p>
&lt;h3 id="level-4---é€‚ç”¨vimçš„è¶…èƒ½åŠ›">Level 4 - é€‚ç”¨Vimçš„è¶…èƒ½åŠ›&lt;/h3>
&lt;p>&amp;laquo;æœªå®Œå¾…ç»­&amp;raquo;&lt;/p></description><category domain="https://h1z3y3.me/tags/vim/">vim</category></item><item><title>NSPredicate(è°“è¯) çš„ä½¿ç”¨</title><link>https://h1z3y3.me/posts/predicateuse/</link><guid isPermaLink="true">https://h1z3y3.me/posts/predicateuse/</guid><pubDate>Tue, 22 Mar 2016 17:41:22 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;blockquote>
&lt;p>è°“è¯ï¼ˆNSPredicateï¼‰æä¾›åœ¨Cocoaä¸­æŒ‡å®šæŸ¥è¯¢çš„æ™®é€šè§£å†³æ–¹æ¡ˆã€‚NSPredicateç±»ç”¨äºå®šä¹‰é€»è¾‘æ¡ä»¶ä»¥é™åˆ¶æˆ–ç­›é€‰è·å–ç»“æœã€‚&lt;/p>
&lt;/blockquote>
&lt;h3 id="nspredicate-çš„åŸºæœ¬ä½¿ç”¨">NSPredicate çš„åŸºæœ¬ä½¿ç”¨&lt;/h3>
&lt;h3 id="å®šä¹‰">å®šä¹‰ï¼š&lt;/h3>
&lt;pre>&lt;code>NSPredicate *predict = [NSPredicate predicateWithFormat: @&amp;quot;SELF CONTAINS[cd] %@&amp;quot;, SOMESTRING];
&lt;/code>&lt;/pre>
&lt;h3 id="å¸¸ç”¨æ–¹æ³•">å¸¸ç”¨æ–¹æ³•ï¼š&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th style="text-align:left">å…³é”®å­—&lt;/th>
&lt;th style="text-align:left">æ•ˆæœ&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>æ¯”è¾ƒè¿ç®—ç¬¦&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&amp;gt;,&amp;lt;,==,&amp;gt;=,&amp;lt;=,!=&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§æ»¡è¶³æ¯”è¾ƒè¿ç®—ç¬¦&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>å­—ç¬¦ç›¸å…³&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">BEGINSWITH&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼ ä»¥ å³ä¾§è¡¨è¾¾å¼ å¼€å§‹&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">ENDSWITH&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼ ä»¥ å³ä¾§è¡¨è¾¾å¼ ç»“æŸ&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">CONTAINS&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼åŒ…å«å³ä¾§è¡¨è¾¾å¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>èŒƒå›´ç›¸å…³&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">BETWEEN&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼åœ¨å³ä¾§è¡¨è¾¾å¼èŒƒå›´å†…&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">IN&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼åœ¨å³ä¾§è¡¨è¾¾å¼å†…&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>æ­£åˆ™è¡¨è¾¾å¼&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">MATCHES&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼æ»¡è¶³å³ä¾§è¡¨è¾¾å¼ï¼Œå³ä¾§ä¸ºæ­£åˆ™è¡¨è¾¾å¼&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">&lt;strong>é€šé…ç¬¦&lt;/strong>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td style="text-align:left">LIKE&lt;/td>
&lt;td style="text-align:left">å·¦ä¾§è¡¨è¾¾å¼ç­‰äºå³ä¾§è¡¨è¾¾å¼: å…è®¸å°† &lt;strong>?&lt;/strong> å’Œ &lt;strong>*&lt;/strong> ç”¨ä½œé€šé…ç¬¦,å…¶ä¸­ &lt;strong>?&lt;/strong> åŒ¹é…ä¸€ä¸ªå­—ç¬¦,è€Œ &lt;strong>*&lt;/strong> åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå­—ç¬¦&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="å­—ç¬¦ä¸²">å­—ç¬¦ä¸²&lt;/h3>
&lt;pre>&lt;code>NSString *originStr = @&amp;quot;I like shangha!&amp;quot;;
NSString *str = @&amp;quot;shanghai&amp;quot;;
NSPredicate *predict = [NSPredicate predicateWithFormat: @&amp;quot;SELF CONTAINS %@&amp;quot;, str];
if ([predict evaluateWithObject:originStr]) {
NSLog(@&amp;quot;å«æœ‰å­—ç¬¦ä¸²%@&amp;quot;, str);
}
&lt;/code>&lt;/pre>
&lt;p>å…¶ä¸­ &lt;code>CONTAINS&lt;/code> ä¹Ÿå¯ä»¥æ›¿æ¢ä¸º &lt;code>BEGINSWITH&lt;/code>,&lt;code>ENDSWITH&lt;/code>ã€‚
åœ¨å®ƒä»¬åé¢ï¼Œå¯ä»¥åœ¨æ–¹æ‹¬å·ä¸­æ·»åŠ &lt;code>c&lt;/code>ã€&lt;code>d&lt;/code> æˆ– &lt;code>cd&lt;/code>, å¦‚&lt;code>CONTAINS[cd]&lt;/code>,å…¶ä¸­&lt;code>c&lt;/code>ä»£è¡¨ä¸åŒºåˆ†å¤§å°å†™, &lt;code>d&lt;/code>ä»£è¡¨ä¸åŒºåˆ†éŸ³è°ƒç¬¦å·ã€‚&lt;/p>
&lt;h3 id="æ•°ç»„å’Œå­—å…¸">æ•°ç»„å’Œå­—å…¸&lt;/h3>
&lt;p>è°“è¯å¸¸ç”¨äºæ•°ç»„çš„ç­›é€‰:&lt;/p>
&lt;pre>&lt;code> NSArray *mArray = [NSArray arrayWithObjects:@&amp;quot;beijing&amp;quot;, @&amp;quot;shanghai&amp;quot;, @&amp;quot;shenzhen&amp;quot;, @&amp;quot;guangzhou&amp;quot;, nil];
//IN ç”¨æ³•
NSPredicate *predicate1 = [NSPredicate predicateWithFormat:@&amp;quot;SELF IN {'shanghai', 'guangzhou'}&amp;quot;];
NSArray *filteredArray1 = [mArray filteredArrayUsingPredicate: predicate1];
NSLog(@&amp;quot;ç­›é€‰åæ•°ç»„ä¸º:%@&amp;quot;, filteredArray1);
//LIKE ç”¨æ³•
NSPredicate *predicate2 = [NSPredicate predicateWithFormat:@&amp;quot;SELF LIKE '*h*'&amp;quot;];
NSArray *filteredArray2 = [mArray filteredArrayUsingPredicate: predicate2];
NSLog(@&amp;quot;ç­›é€‰åæ•°ç»„ä¸º:%@&amp;quot;, filteredArray2);
&lt;/code>&lt;/pre>
&lt;p>è°“è¯çš„æ¡ä»¶ä¹Ÿå¯ä»¥é€šè¿‡å­—å…¸çš„å ä½ç¬¦å®ç°:&lt;/p>
&lt;pre>&lt;code>NSPredicate *p1 = [NSPredicate predicateWithFormat:@&amp;quot;name==$NAME AND price==$PRICE&amp;quot;];
NSDictionary *dic = [NSDictionary dictionaryWithObjectsAndKeys:@&amp;quot;name5&amp;quot;, @&amp;quot;NAME&amp;quot;, @&amp;quot;5000&amp;quot;, @&amp;quot;PRICE&amp;quot;, nil];
NSPredicate *p2 = [p1 predicateWithSubstitutionVariables:dic];
//è¡¨ç¤ºä»carsæ•°ç»„ä¸­ç­›é€‰æ»¡è¶³ name='name5' AND price='5000' æ¡ä»¶çš„å…ƒç´ 
NSArray *filteredCars = [cars filteredArrayUsingPredicate:p2];
&lt;/code>&lt;/pre></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>HTML5 WebWorker ç®€å•ä½¿ç”¨</title><link>https://h1z3y3.me/posts/html5webworker/</link><guid isPermaLink="true">https://h1z3y3.me/posts/html5webworker/</guid><pubDate>Sun, 20 Mar 2016 15:18:33 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;ol>
&lt;li>
&lt;p>ä»€ä¹ˆæ˜¯WebWorker&lt;/p>
&lt;p>web worker æ˜¯è¿è¡Œåœ¨åå°çš„ JavaScriptï¼Œç‹¬ç«‹äºå…¶ä»–è„šæœ¬ï¼Œä¸ä¼šå½±å“é¡µé¢çš„æ€§èƒ½ã€‚æˆ‘ä»¬çŸ¥é“é¡µé¢çš„å±•ç¤ºæ”¾åœ¨ä¸»çº¿ç¨‹ï¼Œå¦‚æœè®©ä¸»çº¿ç¨‹è¿›è¡Œä¸€ç³»åˆ—å¤æ‚çš„æ“ä½œï¼Œé‚£ä¹ˆé¡µé¢å°±ä¼šå˜å¾—éå¸¸å¡ï¼Œç”¨æˆ·ä½“éªŒä¼šå¾ˆå·®ã€‚è¿™æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨web workerè¿›è¡Œå¤æ‚æ“ä½œçš„å®ç°ï¼Œç„¶åå°†å¤„ç†ç»“æœè¿”å›ç»™é¡µé¢ï¼Œé¡µé¢è¿›è¡Œæ›´æ–°å³å¯ï¼Œè¿™æ ·å°±ä¸ä¼šå½±å“ç”¨æˆ·ä¸»é¡µé¢å±•ç¤ºçš„æ‰§è¡Œã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–¹æ³•ï¼š
postMessage() : ç”¨äºå‘HTMLé¡µé¢è¿”å›æ¶ˆæ¯
terminate() : ç»ˆæ­¢web workerï¼Œ å¹¶ä¸”é‡Šæ”¾èµ„æº&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h4 id="å®ç°æ–¹æ³•">å®ç°æ–¹æ³•ï¼š&lt;/h4>
&lt;p>Demo: æ•°å­—ä»0å¼€å§‹ç´¯åŠ &lt;/p>
&lt;h4 id="indexhtml">index.html&lt;/h4>
&lt;pre>&lt;code>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot;&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
&amp;lt;script src=&amp;quot;index.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;div id=&amp;quot;numDiv&amp;quot;&amp;gt;0&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code>&lt;/pre>
&lt;h4 id="indexjs">index.js&lt;/h4>
&lt;pre>&lt;code>var numDiv;
window.onload = function() {
numDiv = document.getElementById(&amp;quot;numDiv&amp;quot;);
var worker = new Worker(&amp;quot;webWorker.js&amp;quot;);//åˆ›å»ºWorkerå¯¹è±¡
worker.onmessage = function (e) {
numDiv.innerHTML = e.data;
}
}
&lt;/code>&lt;/pre>
&lt;h4 id="webworkerjs">webWorker.js&lt;/h4>
&lt;pre>&lt;code>var countNum = 0;
function count () {
postMessage(countNum);//ç»™htmlé¡µé¢è¿”å›æ•°æ®
countNum ++;//æ•°å­—ç´¯åŠ 
setTimeout(count, 1000);//ä¸€ç§’æ‰§è¡Œä¸€æ¬¡
}
count();//è°ƒç”¨å‡½æ•°æ‰§è¡Œ
&lt;/code>&lt;/pre></description><category domain="https://h1z3y3.me/tags/html5/">HTML5</category><category domain="https://h1z3y3.me/tags/webworker/">WebWorker</category></item><item><title>HTML5åº”ç”¨ç¼“å­˜ç®€å•ä½¿ç”¨</title><link>https://h1z3y3.me/posts/html5webcache/</link><guid isPermaLink="true">https://h1z3y3.me/posts/html5webcache/</guid><pubDate>Sun, 20 Mar 2016 14:53:00 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;ol>
&lt;li>
&lt;p>ä»€ä¹ˆæ˜¯åº”ç”¨ç¼“å­˜ï¼Ÿ&lt;/p>
&lt;p>HTML5å¼•å…¥äº†åº”ç”¨ç¼“å­˜æ¦‚å¿µï¼Œæ„å‘³ç€åœ¨æ²¡æœ‰å› ç‰¹ç½‘è¿æ¥æ—¶ä¹Ÿå¯ä»¥è¿›è¡Œè®¿é—®ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨åº”ç”¨ç¼“å­˜å¥½å¤„ï¼š&lt;/p>
&lt;ul>
&lt;li>ç¦»çº¿æµè§ˆï¼Œæ²¡æœ‰å› ç‰¹ç½‘çš„æƒ…å†µä¸‹ä¾ç„¶å¯ä»¥è¿›è¡Œè®¿é—®&lt;/li>
&lt;li>è®¿é—®é€Ÿåº¦æå‡ï¼Œå·²ç»ç¼“å­˜çš„èµ„æºåŠ è½½æ›´å¿«&lt;/li>
&lt;li>å‡å°‘æœåŠ¡å™¨è´Ÿè½½ï¼Œæµè§ˆå™¨åªéœ€è¦ä¸‹è½½æ›´æ–°è¿‡çš„é¡µé¢èµ„æº&lt;/li>
&lt;/ul>
&lt;/li>
&lt;li>
&lt;p>å®ç°æ–¹æ³•ï¼š&lt;/p>
&lt;p>å¦‚æœéœ€è¦ä½¿ç”¨åº”ç”¨ç¼“å­˜ï¼Œéœ€è¦åœ¨é¡µé¢&lt;code>&amp;lt;html&amp;gt;&lt;/code>æ ‡ç­¾ä¸­åŒ…å« &lt;code>manifest&lt;/code> å±æ€§ï¼Œè€Œmanifestæ–‡ä»¶å»ºè®®ä½¿ç”¨æ–‡ä»¶æ‰©å±•å&lt;code>.appcache&lt;/code>ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>Manifestæ–‡ä»¶åŠŸèƒ½ï¼š&lt;/p>
&lt;ul>
&lt;li>CACHE: åœ¨æ­¤æ ‡é¢˜ä¸‹åˆ—å‡ºçš„æ–‡ä»¶ä¼šåœ¨é¦–æ¬¡è®¿é—®åŠ è½½ä¹‹åè¿›è¡Œç¼“å­˜ï¼›&lt;/li>
&lt;li>NETWORK: åœ¨æ­¤æ ‡é¢˜ä¸‹åˆ—å‡ºçš„æ–‡ä»¶éœ€è¦ä¸æœåŠ¡å™¨è¿æ¥ã€ä¸”ä¸ä¼šè¢«ç¼“å­˜ï¼›&lt;/li>
&lt;li>FALLBACK: åœ¨æ­¤æ ‡é¢˜ä¸‹åˆ—å‡ºçš„æ–‡ä»¶è§„å®šå½“é¡µé¢æ— æ³•è®¿é—®æ—¶çš„é€€å›é¡µé¢ï¼ˆå¦‚404é¡µé¢ï¼‰&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ol>
&lt;h3 id="åŠŸèƒ½å®ç°">åŠŸèƒ½å®ç°&lt;/h3>
&lt;h4 id="indexhtml--è¯·æ³¨æ„htmlæ ‡ç­¾">index.html è¯·æ³¨æ„&lt;code>&amp;lt;html&amp;gt;&lt;/code>æ ‡ç­¾&lt;/h4>
&lt;pre>&lt;code>&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html lang=&amp;quot;en&amp;quot; manifest=&amp;quot;index.appcache&amp;quot;&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;UTF-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
&amp;lt;link rel=&amp;quot;stylesheet&amp;quot; href=&amp;quot;style.css&amp;quot;&amp;gt;
&amp;lt;script src=&amp;quot;index.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
&amp;lt;h1 class=&amp;quot;h1&amp;quot;&amp;gt;HELLO HMTL5&amp;lt;/h1&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code>&lt;/pre>
&lt;h4 id="stylecss">style.css&lt;/h4>
&lt;pre>&lt;code>.h1 {
color: red;
background: blue;
}
&lt;/code>&lt;/pre>
&lt;h4 id="indexjs">index.js&lt;/h4>
&lt;pre>&lt;code>/*ç©ºæ–‡ä»¶*/
&lt;/code>&lt;/pre>
&lt;h4 id="indexappcache">index.appcache&lt;/h4>
&lt;pre>&lt;code>CACHE MANIFEST
CACHE:
index.html
style.css
index.js
NETWORK:
FALLBACK:
&lt;/code>&lt;/pre>
&lt;h4 id="æµ‹è¯•">æµ‹è¯•&lt;/h4>
&lt;ul>
&lt;li>
&lt;p>å¼€å¯æœ¬åœ°æœåŠ¡å™¨ï¼Œåœ¨Chromeè¾“å…¥&lt;code>localhost/webCache&lt;/code>&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ä½¿ç”¨Chromeå®¡æŸ¥å…ƒç´ åŠŸèƒ½ï¼Œåˆ‡æ¢åˆ°ResourcesåŠŸèƒ½æ ‡ç­¾ï¼Œç‚¹å‡»å·¦ä¾§&lt;code>Application Cache&lt;/code>åŠŸèƒ½æ ‡ç­¾ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æˆ‘ä»¬è®¾ç½®ç¼“å­˜çš„ä¸‰ä¸ªæ–‡ä»¶å·²ç»ç¼“å­˜æˆåŠŸ&lt;/p>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t01cc408c49a3c3052e.jpg" alt="ç¼“å­˜åˆ—è¡¨">&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ–­å¼€æœ¬åœ°æœåŠ¡å™¨ï¼Œé‡æ–°åˆ·æ–°é¡µé¢ï¼Œä¼šå‘ç°é¡µé¢æ ·å¼ä»ç„¶ä¿æŒï¼Œè¯´æ˜ç¼“å­˜èµ·ä½œç”¨äº†ã€‚&lt;/p>
&lt;/li>
&lt;/ul></description><category domain="https://h1z3y3.me/tags/html5/">HTML5</category><category domain="https://h1z3y3.me/tags/cache/">Cache</category></item><item><title>UITableViewä½¿ç”¨ç®€å•è¿›é˜¶(äºŒ):ç´¢å¼•æ¡</title><link>https://h1z3y3.me/posts/uitableviewadvance02/</link><guid isPermaLink="true">https://h1z3y3.me/posts/uitableviewadvance02/</guid><pubDate>Sat, 19 Mar 2016 21:32:22 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>å‰æ–‡å·²ç»ä»‹ç»äº†å¦‚ä½•ç»™UITableViewæ·»åŠ æœç´¢æ ï¼Œè¿™æ¬¡è¦ç»™UITableViewè¿›ä¸€æ­¥æ·»åŠ ç´¢å¼•æ¡ã€‚
åŸºæœ¬æ€è·¯ï¼š&lt;/p>
&lt;ol>
&lt;li>è·å–æ€»ç»Ÿåå­—çš„é¦–å­—æ¯ç»„æˆä¸€ä¸ªç´¢å¼•å­—æ¯è¡¨å‚¨å­˜åœ¨æ•°ç»„ä¸­ï¼›&lt;/li>
&lt;li>ä¿®æ”¹TableViewçš„ä»£ç†æ–¹æ³•å®ç°sectionçš„æ˜¾ç¤ºï¼Œsectionçš„æ•°é‡åº”ä¸ºç´¢å¼•å­—æ¯è¡¨çš„å…ƒç´ çš„ä¸ªæ•°ï¼›&lt;/li>
&lt;li>æŠŠç´¢å¼•æ¡æ·»åŠ åˆ°TableView ä¸­ï¼Œç”¨TableViewçš„ä»£ç†æ–¹æ³•å³å¯å®ç°ã€‚&lt;/li>
&lt;/ol>
&lt;p>ç”±äºæ¥ç€ä¸Šæ–‡ï¼Œæ‰€ä»¥æœ¬æ–‡ä¸­ä»£ç å°†ä¸ä¼šå…¨éƒ¨å±•ç¤ºï¼Œä»£ç çš„é‡å¤éƒ¨åˆ†å°†ç”¨çœç•¥å·ä»£æ›¿ã€‚&lt;/p>
&lt;h3 id="step1-æ·»åŠ å±æ€§">Step1. æ·»åŠ å±æ€§&lt;/h3>
&lt;p>åœ¨ViewController.hä¸­æ·»åŠ å±æ€§ï¼šNSMutableArray *alphabetArray;&lt;/p>
&lt;pre>&lt;code>#import &amp;lt;UIKit/UIKit.h&amp;gt;
@interface ViewController : UIViewController
...
@property (nonatomic, strong) NSMutableArray *alphabetArray;
...
@end
&lt;/code>&lt;/pre>
&lt;h3 id="step2-ä¿®æ”¹viewcontrollerm">Step2. ä¿®æ”¹ViewController.m&lt;/h3>
&lt;pre>&lt;code>//
// ViewController.m
// UITableViewAdvanced01
//
// Created by mungo on 19/03/16.
// Copyright Â© 2016 mungo. All rights reserved.
//
#import &amp;quot;ViewController.h&amp;quot;
#import &amp;quot;President.h&amp;quot;
@interface ViewController () &amp;lt;UITableViewDataSource, UITableViewDelegate, UISearchBarDelegate, UISearchResultsUpdating, UISearchDisplayDelegate&amp;gt;
@end
@implementation ViewController
- (void)viewDidLoad {
[super viewDidLoad];
//åˆå§‹åŒ–æ•°æ®
...
//åˆ›å»ºtableview
...
//åˆ›å»ºsearchController
...
//è®¾ç½®tableviewçš„æœç´¢æ 
...
//è®¾ç½®å­—æ¯è¡¨
self.alphabetArray = [self getAlphetSortedArray];
}
/**
* æ–°æ·»åŠ æ–¹æ³•ï¼š
* è·å–å­—æ¯è¡¨
* @return MSMutableArray* å·²ç»æ’åºçš„å­—æ¯è¡¨æ•°ç»„
*/
- (NSMutableArray *) getAlphetSortedArray {
self.alphabetArray = [[NSMutableArray alloc] init];
for (int i = 0; i &amp;lt; [self.presidents count]; i ++) {
//è·å–åå­—çš„ç¬¬ä¸€ä¸ªå­—æ¯
President *president = [self.presidents objectAtIndex:i];
char letter = [president.firstName characterAtIndex:0];
NSString *uniqueChar = [NSString stringWithFormat:@&amp;quot;%c&amp;quot;, letter];
//å°†å­—æ¯åŠ å…¥åˆ°å­—æ¯è¡¨ä¸­
if (![self.alphabetArray containsObject:uniqueChar]) {
[self.alphabetArray addObject:uniqueChar];
}
}
//å¯¹å­—æ¯è¡¨è¿›è¡Œæ’åº
NSSortDescriptor *sortDescriptor = [[NSSortDescriptor alloc] initWithKey:@&amp;quot;self&amp;quot; ascending:YES];
NSArray *sortDescirptors = [NSArray arrayWithObject:sortDescriptor];
NSArray *sortedArray;
sortedArray = [self.alphabetArray sortedArrayUsingDescriptors:sortDescirptors];
NSMutableArray *alphabetArray = [[NSMutableArray alloc] initWithArray:sortedArray copyItems:YES];
return alphabetArray;
}
#pragma mark - tableView Delegate
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
if (self.searchController.active) {
...
} else {
//æ ¹æ®sectionç­›é€‰ä»¥å½“å‰å­—æ¯å¼€å¤´çš„æ€»ç»Ÿæ•°ç»„
NSArray *tmpArray = [self getAlphabetArrayWithIndex:section];
return [tmpArray count];
}
}
#pragma mark - Indexing UITableView
//ç´¢å¼•æ¡çš„å­—æ¯è¡¨
- (NSArray&amp;lt;NSString *&amp;gt; *)sectionIndexTitlesForTableView:(UITableView *)tableView {
return self.alphabetArray;
}
- (NSInteger) tableView:(UITableView *)tableView sectionForSectionIndexTitle:(NSString *)title atIndex:(NSInteger)index {
return index;
}
#pragma mark - tableView Datasource
- (NSInteger) numberOfSectionsInTableView:(UITableView *)tableView {
if (self.searchController.active) {
self.alphabetArray = nil;//æœç´¢æ—¶ä¸æ˜¾ç¤ºsection
return 1;
} else {
self.alphabetArray = [self getAlphetSortedArray];//åœæ­¢æœç´¢æ¢å¤sectionæ˜¾ç¤º
return [self.alphabetArray count];
}
}
//tableView sectionçš„æ ‡é¢˜
- (NSString *) tableView:(UITableView *)tableView titleForHeaderInSection:(NSInteger)section {
return [self.alphabetArray objectAtIndex: section];
}
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
...
President *president;
if (self.searchController.active) {
...
} else {
//æ ¹æ®sectionç­›é€‰ä»¥å½“å‰å­—æ¯å¼€å¤´çš„æ€»ç»Ÿæ•°ç»„
NSArray *tmpArray = [self getAlphabetArrayWithIndex:indexPath.section];
if ([tmpArray count]) {
president = [tmpArray objectAtIndex:indexPath.row];
}
}
if (president) {
cell.textLabel.text = [NSString stringWithFormat:@&amp;quot;%@ %@&amp;quot;, president.firstName, president.lastName];
}
return cell;
}
/*
* æ–°æ·»åŠ æ–¹æ³•ï¼š
* æ ¹æ®é¦–å­—æ¯å¯¹æ‰€æœ‰æ€»ç»Ÿè¿›è¡Œç­›é€‰
* @return NSArray* äºå½“å‰é¦–å­—æ¯ç›¸åŒçš„æ€»ç»Ÿæ•°ç»„
*/
- (NSArray *) getAlphabetArrayWithIndex:(NSInteger)index{
NSString *alphabet = [self.alphabetArray objectAtIndex:index];
NSPredicate *president = [NSPredicate predicateWithFormat:@&amp;quot;firstName BEGINSWITH [cd] %@&amp;quot;, alphabet];
NSArray *tmpArray = [self.presidents filteredArrayUsingPredicate:president];
return tmpArray;
}
#pragma mark - SearchController delegate
- (void)updateSearchResultsForSearchController:(UISearchController *)searchController {
...
}
@end
&lt;/code>&lt;/pre>
&lt;h4 id="æ³¨æ„">æ³¨æ„ï¼š&lt;/h4>
&lt;p>numberOfSectionsInTableViewä¸­ï¼Œ å¼€å§‹æœç´¢çš„æ—¶å€™è¦å°†TableViewçš„sectionæ•°é‡è®¾ç½®ä¸º1ï¼Œå¹¶ä¸”è¦æŠŠå­—æ¯è¡¨è®¾ç½®ä¸ºç©ºï¼›ä¸æœç´¢æ—¶è¦æ¢å¤sectionçš„æ•°é‡ã€‚&lt;/p>
&lt;h3 id="å®ç°æ•ˆæœ">å®ç°æ•ˆæœ&lt;/h3>
&lt;p>&lt;img src="https://p4.ssl.qhimg.com/t0162f8e32897367e8f.gif" alt="å®ç°æ•ˆæœ">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category><category domain="https://h1z3y3.me/tags/uitableview/">UITableView</category></item><item><title>UITableViewä½¿ç”¨ç®€å•è¿›é˜¶(ä¸€):æœç´¢æ </title><link>https://h1z3y3.me/posts/uitableviewadvanced01/</link><guid isPermaLink="true">https://h1z3y3.me/posts/uitableviewadvanced01/</guid><pubDate>Sat, 19 Mar 2016 18:39:48 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>UITableView æ˜¯å¼€å‘ä¸­ä½¿ç”¨ååˆ†é¢‘ç¹çš„æ§ä»¶ï¼Œæœ¬ç³»åˆ—è®°å½•UITableViewçš„è¿›é˜¶ä½¿ç”¨ï¼šUITableViewçš„æœç´¢æ å’Œå­—æ¯ç´¢å¼•è¡¨ã€‚&lt;/p>
&lt;p>ä¸æƒ³çœ‹æˆ‘åºŸè¯çš„å¯ä»¥ç›´æ¥åˆ°gitHubä»“åº“ä¸‹è½½æºç ğŸ˜ã€‚
&lt;a href="https://github.com/Gitzhaoyang/iOSWithOC/tree/master/UITableViewAdvanced">UITableViewä½¿ç”¨è¿›é˜¶gitHubæºç &lt;/a>&lt;/p>
&lt;p>æœç´¢æ æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯é€šè¿‡UISearchBarå’ŒUISearchDisplayControllerå®ç°ï¼Œç¬¬äºŒç§æ˜¯é€šè¿‡UISearchControllerå®ç°ã€‚è€Œåœ¨iOS8.0ä¹‹åï¼Œè‹¹æœå®˜æ–¹æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹å¼ã€‚&lt;/p>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t014836c37890cb46c7.jpg" alt="ä½¿ç”¨UISearchController">&lt;/p>
&lt;p>æœ¬æ–‡ä½¿ç”¨çš„æ˜¯ç¬¬äºŒç§æ–¹å¼ï¼ˆUISearchControllerï¼‰ï¼Œä¸è¿‡æºç ä¸­ä¹Ÿå®ç°äº†ç¬¬ä¸€ç§(UISearchBar+UISearchDisplayController)ã€‚å…³äºUISearchBarå’ŒUISearchDisplayControllerçš„ä½¿ç”¨ï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š&lt;a href="http://mungo.space/2016/03/19/UISearchBar-UISearchDisplayController/">UISearchBarå’ŒUISearchDisplayControllerå®ç°æœç´¢æ &lt;/a>&lt;/p>
&lt;p>æœ¬æ–‡å…ˆä»‹ç»UITableViewçš„æœç´¢æ ï¼ˆUISearchControllerï¼‰ï¼Œæ˜¯ä¸€ä¸ªæ˜¾ç¤ºç¾å›½æ€»ç»Ÿçš„TableViewã€‚&lt;/p>
&lt;h3 id="step1-åˆ›å»ºpresidentç±»">Step1. åˆ›å»ºPresidentç±»&lt;/h3>
&lt;p>åˆ›å»ºä¸€ä¸ªåä¸ºPresidentçš„Objective-Cç±»ï¼Œå®ƒç»§æ‰¿äºNSObjectç±»ï¼Œç”¨äºä¿å­˜æ€»ç»Ÿçš„å§“æ°å’Œåå­—ã€‚å®šä¹‰ä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œç”¨æ¥åˆ›å»ºPresidentå¯¹è±¡ï¼Œå¹¶ä¸”å¯¹firstNameå’ŒlastNameèµ‹å€¼ã€‚&lt;/p>
&lt;h4 id="presidenth">President.h&lt;/h4>
&lt;pre>&lt;code>#import &amp;lt;Foundation/Foundation.h&amp;gt;
@interface President : NSObject
@property (nonatomic, retain) NSString *firstName;
@property (nonatomic, retain) NSString *lastName;
+ (President *) presidentWithFirstName: (NSString *)firstname lastName: (NSString *)lastname;
@end
&lt;/code>&lt;/pre>
&lt;h4 id="presidentm">President.m&lt;/h4>
&lt;pre>&lt;code>#import &amp;quot;President.h&amp;quot;
@implementation President
+ (President *) presidentWithFirstName:(NSString *)firstname lastName:(NSString *)lastname {
President *president = [[President alloc] init];
president.firstName = firstname;
president.lastName = lastname;
return president;
}
@end
&lt;/code>&lt;/pre>
&lt;h3 id="step2-ç¼–å†™viewcontroller">Step2. ç¼–å†™ViewController&lt;/h3>
&lt;h4 id="viewcontrollerh">viewController.h&lt;/h4>
&lt;pre>&lt;code>#import &amp;lt;UIKit/UIKit.h&amp;gt;
@interface ViewController : UIViewController
@property (nonatomic, strong) UITableView *mTableView;
@property (nonatomic, strong) NSArray *presidents;//æ‰€æœ‰æ€»ç»Ÿ
@property (nonatomic, strong) NSArray *filteredPresidents;//ä¿å­˜æœç´¢ç»“æœ
@property (nonatomic, retain) UISearchController *searchController;
@end
&lt;/code>&lt;/pre>
&lt;h4 id="viewcontrollerm">viewController.m&lt;/h4>
&lt;pre>&lt;code>#import &amp;quot;ViewController.h&amp;quot;
#import &amp;quot;President.h&amp;quot;
@interface ViewController () &amp;lt;UITableViewDataSource, UITableViewDelegate, UISearchBarDelegate, UISearchResultsUpdating, UISearchDisplayDelegate&amp;gt;
@end
@implementation ViewController
- (void)viewDidLoad {
[super viewDidLoad];
//åˆå§‹åŒ–æ•°æ®
self.presidents = [[NSArray alloc] initWithObjects:
[President presidentWithFirstName:@&amp;quot;George&amp;quot; lastName:@&amp;quot;Washington&amp;quot;],
[President presidentWithFirstName:@&amp;quot;John&amp;quot; lastName:@&amp;quot;Adams&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Thomas&amp;quot; lastName:@&amp;quot;Jeffeson&amp;quot;],
[President presidentWithFirstName:@&amp;quot;James&amp;quot; lastName:@&amp;quot;Madison&amp;quot;],
[President presidentWithFirstName:@&amp;quot;James&amp;quot; lastName:@&amp;quot;Monroe&amp;quot;],
[President presidentWithFirstName:@&amp;quot;John Quincy&amp;quot; lastName:@&amp;quot;Adams&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Andrew&amp;quot; lastName:@&amp;quot;Jackson&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Martin&amp;quot; lastName:@&amp;quot;van Buren&amp;quot;],
[President presidentWithFirstName:@&amp;quot;William Henry&amp;quot; lastName:@&amp;quot;Harrison&amp;quot;],
[President presidentWithFirstName:@&amp;quot;John&amp;quot; lastName:@&amp;quot;Tyler&amp;quot;],
[President presidentWithFirstName:@&amp;quot;James K&amp;quot; lastName:@&amp;quot;Polk&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Zachary&amp;quot; lastName:@&amp;quot;Taylor&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Millard&amp;quot; lastName:@&amp;quot;Fillmore&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Franklin&amp;quot; lastName:@&amp;quot;Pierce&amp;quot;],
[President presidentWithFirstName:@&amp;quot;James&amp;quot; lastName:@&amp;quot;Buchanan&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Abraham&amp;quot; lastName:@&amp;quot;Lincoln&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Andrew&amp;quot; lastName:@&amp;quot;Johnson&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Ulysses S&amp;quot; lastName:@&amp;quot;Grant&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Rutherford B&amp;quot; lastName:@&amp;quot;Hayes&amp;quot;],
[President presidentWithFirstName:@&amp;quot;James A&amp;quot; lastName:@&amp;quot;Garfield&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Chester A&amp;quot; lastName:@&amp;quot;Arthur&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Grover&amp;quot; lastName:@&amp;quot;Cleveland&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Bejamin&amp;quot; lastName:@&amp;quot;Harrison&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Grover&amp;quot; lastName:@&amp;quot;Cleveland&amp;quot;],
[President presidentWithFirstName:@&amp;quot;William&amp;quot; lastName:@&amp;quot;McKinley&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Theodore&amp;quot; lastName:@&amp;quot;Roosevelt&amp;quot;],
[President presidentWithFirstName:@&amp;quot;William Howard&amp;quot; lastName:@&amp;quot;Taft&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Woodrow&amp;quot; lastName:@&amp;quot;Wilson&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Warren G&amp;quot; lastName:@&amp;quot;Harding&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Calvin&amp;quot; lastName:@&amp;quot;Coolidge&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Herbert&amp;quot; lastName:@&amp;quot;Hoover&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Franklin D&amp;quot; lastName:@&amp;quot;Roosevelt&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Harry S&amp;quot; lastName:@&amp;quot;Truman&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Dwight D&amp;quot; lastName:@&amp;quot;Eisenhower&amp;quot;],
[President presidentWithFirstName:@&amp;quot;John F&amp;quot; lastName:@&amp;quot;Kennedy&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Lyndon B&amp;quot; lastName:@&amp;quot;Johnson&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Richard&amp;quot; lastName:@&amp;quot;Nixon&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Gerald&amp;quot; lastName:@&amp;quot;Ford&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Jimmy&amp;quot; lastName:@&amp;quot;Carter&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Ronald&amp;quot; lastName:@&amp;quot;Reagan&amp;quot;],
[President presidentWithFirstName:@&amp;quot;George H W&amp;quot; lastName:@&amp;quot;Bush&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Bill&amp;quot; lastName:@&amp;quot;Clinton&amp;quot;],
[President presidentWithFirstName:@&amp;quot;George W&amp;quot; lastName:@&amp;quot;Bush&amp;quot;],
[President presidentWithFirstName:@&amp;quot;Barack&amp;quot; lastName:@&amp;quot;Obama&amp;quot;],
nil];
CGRect appFrame = [[UIScreen mainScreen] bounds];
//åˆ›å»ºtableview
self.mTableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 20, appFrame.size.width, appFrame.size.height - 20) style:UITableViewStylePlain];
self.mTableView.delegate = self;
self.mTableView.dataSource = self;
[self.view addSubview:self.mTableView];
//åˆ›å»ºsearchController
self.searchController = [[UISearchController alloc] initWithSearchResultsController:nil];
self.searchController.searchResultsUpdater = self;
self.searchController.dimsBackgroundDuringPresentation = NO;
self.searchController.hidesNavigationBarDuringPresentation = NO;
//è®¾ç½®tableviewçš„æœç´¢æ 
self.mTableView.tableHeaderView = self.searchController.searchBar;
}
#pragma mark - tableView Delegate
- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
if (self.searchController.active) {
return [self.filteredPresidents count];
} else {
return [self.presidents count];
}
}
#pragma mark - tableView Datasource
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
static NSString *cellId = @&amp;quot;cellId&amp;quot;;
UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellId];
if (!cell) {
cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:cellId];
}
President *president;
if (self.searchController.active) {
president = [self.filteredPresidents objectAtIndex:indexPath.row];
} else {
president = [self.presidents objectAtIndex:indexPath.row];
}
cell.textLabel.text = [NSString stringWithFormat:@&amp;quot;%@ %@&amp;quot;, president.firstName, president.lastName];
return cell;
}
#pragma mark - SearchController delegate
- (void)updateSearchResultsForSearchController:(UISearchController *)searchController {
NSString *searchString = [self.searchController.searchBar text];
NSPredicate *predicate = [NSPredicate predicateWithFormat:@&amp;quot;firstName CONTAINS[cd] %@ OR lastName CONTAINS[cd] %@&amp;quot;, searchString, searchString];
self.filteredPresidents = [self.presidents filteredArrayUsingPredicate:predicate];
//åˆ·æ–°è¡¨æ ¼
[self.mTableView reloadData];
}
- (void)didReceiveMemoryWarning {
[super didReceiveMemoryWarning];
// Dispose of any resources that can be recreated.
}
@end
&lt;/code>&lt;/pre>
&lt;h3 id="å®ç°æ•ˆæœ">å®ç°æ•ˆæœ&lt;/h3>
&lt;p>&lt;img src="https://p5.ssl.qhimg.com/t011ce6e41ca1d6164b.gif" alt="å®ç°æ•ˆæœ">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category><category domain="https://h1z3y3.me/tags/uitableview/">UITableView</category><category domain="https://h1z3y3.me/tags/%E6%90%9C%E7%B4%A2%E6%A0%8F/">æœç´¢æ </category></item><item><title>UISearchBarå’ŒUISearchDisplayControllerå®ç°æœç´¢æ </title><link>https://h1z3y3.me/posts/uisearchbar-uisearchdisplaycontroller/</link><guid isPermaLink="true">https://h1z3y3.me/posts/uisearchbar-uisearchdisplaycontroller/</guid><pubDate>Sat, 19 Mar 2016 17:36:43 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è¦å®ç°tableviewçš„æœç´¢æ ï¼Œå®ç°æ–¹æ³•æœ‰ä¸¤ç§ï¼šç¬¬ä¸€ç§æ˜¯UISearchBarå’ŒUIDisplayControllerç»“åˆèµ·æ¥å®ç°ï¼Œå¦ä¸€ç§æ˜¯é€šè¿‡UISearchControllerå®ç°ã€‚è¿™é‡Œåªä»‹ç»ç¬¬ä¸€ç§ï¼š&lt;/p>
&lt;p>æ³¨æ„: UISearchBarå’ŒUISearchDisplayåªæ¨èiOS8.0ä¹‹å‰ä½¿ç”¨ã€‚
&lt;img src="https://p1.ssl.qhimg.com/t014836c37890cb46c7.jpg" alt="">&lt;/p>
&lt;p>å…³äºUISearchControllerçš„ä½¿ç”¨è¯·è·³è½¬è‡³ï¼š
&lt;a href="http://mungo.space/2016/03/19/UITableViewAdvanced01/">UITableViewä½¿ç”¨è¿›é˜¶(ä¸€):æœç´¢æ &lt;/a>&lt;/p>
&lt;h3 id="ä½¿ç”¨çš„åè®®">ä½¿ç”¨çš„åè®®&lt;/h3>
&lt;p>éœ€è¦ä½¿ç”¨å››ä¸ªåè®®ï¼Œåˆ†åˆ«æ˜¯&lt;/p>
&lt;p>&amp;lt;UITableViewDelegate, UITableViewDataSource, UISearchBarDelegate, UISearchDisplayDelegate&amp;gt;&lt;/p>
&lt;h3 id="å¤´æ–‡ä»¶-viewcontrollerh">å¤´æ–‡ä»¶ ViewController.h&lt;/h3>
&lt;pre>&lt;code>#import &amp;lt;UIKit/UIKit.h&amp;gt;
@interface ViewController : UIViewController
@property (nonatomic, strong) UITableView *mTableView;
//æœç´¢ç»“æœ
@property (nonatomic, strong) NSArray *filterData;
//å…¨éƒ¨æ•°æ®
@property (nonatomic, strong) NSMutableArray *allData;
@property (nonatomic, retain) UISearchDisplayController *searchDisplayController;
@end
&lt;/code>&lt;/pre>
&lt;h3 id="å®ç°æ–‡ä»¶-viewcontrollerm">å®ç°æ–‡ä»¶ ViewController.m&lt;/h3>
&lt;pre>&lt;code>#import &amp;quot;ViewController.h&amp;quot;
@interface ViewController () &amp;lt;UITableViewDelegate, UITableViewDataSource, UISearchBarDelegate, UISearchDisplayDelegate&amp;gt;
@end
@implementation ViewController
- (void)viewDidLoad {
[super viewDidLoad];
//åˆå§‹åŒ–æ•°æ®
int count = 100;
self.allData = [NSMutableArray arrayWithCapacity:count];
for (int i = 0; i &amp;lt; count; i ++) {
[self.allData addObject:[NSString stringWithFormat:@&amp;quot;ç¬¬%dè¡Œ&amp;quot;, i]];
}
//å®šä¹‰tableview
CGRect appFrame = [[UIScreen mainScreen] bounds];
self.mTableView = [[UITableView alloc] initWithFrame:CGRectMake(0, 20, appFrame.size.width, appFrame.size.height - 20) style:UITableViewStylePlain];
self.mTableView.delegate = self;
self.mTableView.dataSource = self;
[self.view addSubview:self.mTableView];
//å®šä¹‰UISearchBar
UISearchBar *mySearchBar = [[UISearchBar alloc] init];
mySearchBar.delegate = self;
[mySearchBar setAutocapitalizationType:UITextAutocapitalizationTypeNone];
[mySearchBar sizeToFit];
self.mTableView.tableHeaderView = mySearchBar;
//å®šä¹‰UISearchDisplayController
self.searchDisplayController = [[UISearchDisplayController alloc] initWithSearchBar:mySearchBar contentsController:self];
self.searchDisplayController.delegate = self;
[self.searchDisplayController setSearchResultsDataSource:self];
[self setSearchDisplayController:self.searchDisplayController];
}
#pragma mark - UITableView Delegate
- (NSInteger) numberOfSectionsInTableView:(UITableView *)tableView {
return 1;
}
- (NSInteger) tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section {
if (tableView == self.searchDisplayController.searchResultsTableView) {
return [self.filterData count];
} else {
return [self.allData count];
}
}
#pragma mark - UITableView DataSource
- (UITableViewCell *) tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath {
static NSString *cellid = @&amp;quot;cellid&amp;quot;;
UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:cellid];
if (!cell) {
cell = [[UITableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:cellid];
}
if (tableView == self.searchDisplayController.searchResultsTableView) {
cell.textLabel.text = [self.filterData objectAtIndex:indexPath.row];
} else {
cell.textLabel.text = [self.allData objectAtIndex:indexPath.row];
}
return cell;
}
#pragma mark - UISearchDisplayController
- (BOOL) searchDisplayController:(UISearchDisplayController *)controller shouldReloadTableForSearchString:(NSString *)searchString {
NSPredicate *predicate = [NSPredicate predicateWithFormat:@&amp;quot;SELF CONTAINS[cd] %@&amp;quot;, searchString];
self.filterData = [self.allData filteredArrayUsingPredicate:predicate];
return YES;
}
- (void)didReceiveMemoryWarning {
[super didReceiveMemoryWarning];
// Dispose of any resources that can be recreated.
}
@end
&lt;/code>&lt;/pre>
&lt;h3 id="å®ç°æ•ˆæœ">å®ç°æ•ˆæœ&lt;/h3>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t01136391b0c01f4d40.gif" alt="å®ç°æ•ˆæœ">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category><category domain="https://h1z3y3.me/tags/uitableview/">UITableView</category><category domain="https://h1z3y3.me/tags/%E6%90%9C%E7%B4%A2%E6%A0%8F/">æœç´¢æ </category></item><item><title>stretchableImageWithLeftCapWith:(NSInteger)leftCapWidth topCapHeight:(NSInteger)topCapHeight</title><link>https://h1z3y3.me/posts/stretchableimagewithleftcapwidth/</link><guid isPermaLink="true">https://h1z3y3.me/posts/stretchableimagewithleftcapwidth/</guid><pubDate>Sat, 19 Mar 2016 14:35:39 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;pre>&lt;code>- (UIImage *) stretchableImageWithLeftCapWidth:(NSInteger)leftCapWidth topCapHeight:(NSInteger)topCapHeight
&lt;/code>&lt;/pre>
&lt;p>è¿™ä¸ªå‡½æ•°æ˜¯UIImageçš„ä¸€ä¸ªç±»å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯åˆ›å»ºä¸€ä¸ªå†…å®¹å¯æ‹‰ä¼¸ï¼Œè€Œè¾¹è§’ä¸æ‹‰ä¼¸çš„å›¾ç‰‡ã€‚ä¸¤ä¸ªå‚æ•°çš„å«ä¹‰åˆ†åˆ«ä¸ºï¼šä¸æ‹‰ä¼¸åŒºåŸŸçš„å®½åº¦ã€ä¸æ‹‰ä¼¸åŒºåŸŸçš„é«˜åº¦ã€‚&lt;/p>
&lt;p>æ ¹æ®è®¾ç½®çš„å®½åº¦å’Œé«˜åº¦ï¼Œåœ¨åƒç´ ç‚¹&lt;code>((leftCapWidth+1), (topCapWidth+1))&lt;/code>å¼€å§‹å·¦å³æ‰©å±•å’Œä¸Šä¸‹æ‹‰ä¼¸ã€‚&lt;/p>
&lt;h3 id="æ³¨æ„">æ³¨æ„ï¼š&lt;/h3>
&lt;ul>
&lt;li>
&lt;p>å¯æ‹‰ä¼¸èŒƒå›´æ˜¯è·ç¦»leftCapWidth+1çš„é‚£ä¸€åˆ—åƒç´ å’ŒtopCapHeight+1çš„é‚£ä¸€æ¨ªæ’åƒç´ ã€‚
å¦‚æœè®¾ç½®å‚æ•°ä¸º10å’Œ5ï¼Œé‚£ä¹ˆï¼Œå›¾ç‰‡å·¦è¾¹10ä¸ªåƒç´ å’Œä¸Šè¾¹5ä¸ªåƒç´ åŒºåŸŸå†…ä¸ä¼šè¢«æ‹‰ä¼¸ã€‚è€Œä»(11, 5)å¼€å§‹æ‰©å±•å’Œæ‹‰ä¼¸ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>åªæ˜¯å¯¹ä¸€ä¸ªåƒç´ è¿›è¡Œå¤åˆ¶åˆ°ä¸€å®šå®½åº¦ï¼Œè€Œå›¾åƒåé¢çš„å‰©ä½™éƒ¨åˆ†ä¹Ÿä¸ä¼šè¢«æ‹‰ä¼¸ã€‚&lt;/p>
&lt;pre>&lt;code> //åŸå§‹å›¾ç‰‡
UIImage *image = [UIImage imageNamed:@&amp;quot;yoububble.png&amp;quot;] ;
UIImageView *imageView1 = [[UIImageView alloc] initWithImage:image];
[imageView1 setFrame:CGRectMake(10, 60, 40, 40)];
[self.view addSubview:imageView1];
//æ‹‰ä¼¸åå›¾ç‰‡
UIImage *strechImage = [image stretchableImageWithLeftCapWidth:10 topCapHeight:10];
UIImageView *imageView2 = [[UIImageView alloc] initWithImage:strechImage];
[imageView2 setFrame:CGRectMake(10, 120, 300, 100)];
[self.view addSubview:imageView2];
&lt;/code>&lt;/pre>
&lt;/li>
&lt;/ul>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t012520479c8ccb0d67.png" alt="å›¾ç‰‡æ•ˆæœ">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>æ ¹æ®å­—æ•°è‡ªé€‚åº”é«˜åº¦çš„UILabel</title><link>https://h1z3y3.me/posts/uilabel-with-height-fixed/</link><guid isPermaLink="true">https://h1z3y3.me/posts/uilabel-with-height-fixed/</guid><pubDate>Thu, 17 Mar 2016 15:36:59 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;pre>&lt;code>- (UILabel *) getLabelHeightFixedWithText: (NSString *) text {
UIFont *font = [UIFont boldSystemFontOfSize: 12.0f];
int width = 225, height = 10000;
NSMutableDictionary *attrs = [[NSMutableDictionary alloc] init];
[attrs setObject: font forKey: NSFontAttributeName];
CGRect size = [text boundingRectWithSize:CGSizeMake(width, height) options: NSStringDrawingUsesLineFragmentOrigin attributes: attrs context: nil];
UILabel *label = [[UILabel alloc] initWithFrame: CGRectMake(0, 0, size.size.width, size.size.height)];
label.numberOfLines = 0;//ä¸€å®šè¦è®¾ç½®è¡Œæ•°ä¸º0
label.font = font;
label.lineBreakMode = NSLineBreakByWordWrapping;
label.text = (text ? text : @&amp;quot;&amp;quot;);
label.backgroundColor = [UIColor clearColor];
label.textColor = [UIColor blackColor];
return label;
}
&lt;/code>&lt;/pre></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category><category domain="https://h1z3y3.me/tags/uilabel/">UILabel</category></item><item><title>JSå®ç°å¯†ç åŠ å¯†(base64, md5, sha1)</title><link>https://h1z3y3.me/posts/javascript-md5-base64-sha1/</link><guid isPermaLink="true">https://h1z3y3.me/posts/javascript-md5-base64-sha1/</guid><pubDate>Thu, 17 Mar 2016 12:32:54 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h3 id="ç®€ä»‹">ç®€ä»‹&lt;/h3>
&lt;p>åœ¨ç¼–å†™Webç¨‹åºæ—¶ï¼Œè¡¨å•çš„æäº¤è‹¥å¯†ç ä½¿ç”¨æ˜æ–‡æäº¤ä¼šååˆ†ä¸å®‰å…¨ï¼Œå› æ­¤åœ¨æµè§ˆå™¨ç«¯ä¹Ÿè¦å¯¹å¯†ç è¿›è¡ŒåŠ å¯†å¤„ç†ã€‚ä½†æ˜¯è‹¥åªæ˜¯åœ¨æµè§ˆå™¨ç«¯å¤„ç†äº†ï¼Œè€ŒæœåŠ¡å™¨æ²¡æœ‰å†ä¸€æ¬¡åŠ å¯†ï¼Œä¹Ÿæ˜¯ä¸å¦¥å½“çš„ï¼Œå› ä¸º&amp;quot;ä¸­é—´äºº&amp;quot;åªè¦è·å–äº†æµè§ˆå™¨ç«¯åŠ å¯†çš„å¯†ç ï¼Œä¸éœ€è¦è¿›è¡Œå¤„ç†ä¹Ÿèƒ½è¿›è¡Œç™»å½•ã€‚æ‰€ä»¥æˆ‘ä¸€èˆ¬çš„åšæ³•æ˜¯åœ¨å‰ç«¯åŠ å¯†ä¸€æ¬¡ï¼Œåœ¨æœåŠ¡å™¨å†åŠ å¯†ä¸€æ¬¡ã€‚å¯†ç åŠ ç›ï¼ˆsaltï¼‰çš„é—®é¢˜ç­‰æˆ‘å…ˆç ”ç©¶ä¸‹å†å†™ä¸€ä¸‹ã€‚è€Œæµè§ˆå™¨ç«¯åŠ å¯†ä¸€èˆ¬æˆ‘éƒ½ç”¨javascriptè¿›è¡ŒåŠ å¯†åå†æäº¤ã€‚ä¸‹é¢æ˜¯ç”¨javascriptç¼–å†™çš„base64åŠ å¯†ï¼Œmd5åŠ å¯†å’Œsha1åŠ å¯†ã€‚ä½¿ç”¨æ–¹æ³•ä¹Ÿæå…¶ç®€å•ï¼Œåªè¦åœ¨é¡µé¢å†…å¼•å…¥ç›¸åº”jsæ–‡ä»¶å³å¯ã€‚&lt;/p>
&lt;h3 id="base64åŠ è§£å¯†">base64åŠ è§£å¯†&lt;/h3>
&lt;pre>&lt;code>&amp;lt;!DOCTYPE HTML&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;utf-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;base64åŠ è§£å¯†&amp;lt;/title&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;base64.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
var base64 = new Base64();
//åŠ å¯†
var base64encodeStg = base64.encode(&amp;quot;hello world!&amp;quot;);
alert(&amp;quot;base64encode:&amp;quot; + base64encodeStg);
//è§£å¯†
var base64decodeStg = base64.decode(base64encodeStg);
alert(&amp;quot;base64decode:&amp;quot; + base64decodeStg);
&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code>&lt;/pre>
&lt;h3 id="md5åŠ å¯†">md5åŠ å¯†&lt;/h3>
&lt;pre>&lt;code>&amp;lt;!DOCTYPE HTML&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;utf-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;md5åŠ å¯†&amp;lt;/title&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;md5.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
var hash = hex_md5(&amp;quot;hello world!&amp;quot;);
alert(hash);
&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code>&lt;/pre>
&lt;h3 id="sha1åŠ å¯†">sha1åŠ å¯†&lt;/h3>
&lt;p>ç›¸å¯¹äºå‰ä¸¤ä¸ªï¼Œsha1åŠ å¯†å¯èƒ½æ›´å®‰å…¨&lt;/p>
&lt;pre>&lt;code>&amp;lt;!DOCTYPE HTML&amp;gt;
&amp;lt;html&amp;gt;
&amp;lt;head&amp;gt;
&amp;lt;meta charset=&amp;quot;utf-8&amp;quot;&amp;gt;
&amp;lt;title&amp;gt;sha1åŠ å¯†&amp;lt;/title&amp;gt;
&amp;lt;script type=&amp;quot;text/javascript&amp;quot; src=&amp;quot;sha1.js&amp;quot;&amp;gt;&amp;lt;/script&amp;gt;
&amp;lt;script&amp;gt;
var sha1 = hex_sha1(&amp;quot;hello world!&amp;quot;);
alert(sha1);
&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/code>&lt;/pre>
&lt;h3 id="ç›¸å…³æ–‡ä»¶ä¸‹è½½">ç›¸å…³æ–‡ä»¶ä¸‹è½½&lt;/h3>
&lt;p>&lt;a href="http://pan.baidu.com/s/1i3TPnCx">base64.js | md5.js | sha1.js ç™¾åº¦ç½‘ç›˜åˆ†äº«&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/md5/">MD5</category><category domain="https://h1z3y3.me/tags/base64/">base64</category><category domain="https://h1z3y3.me/tags/sha1/">sha1</category><category domain="https://h1z3y3.me/tags/javascript/">javascript</category><category domain="https://h1z3y3.me/tags/%E5%8A%A0%E5%AF%86/">åŠ å¯†</category></item><item><title>è´´å›¾åº“è¢«ç½‘ä¿¡åŠå…³é—­ å®˜æ–¹ï¼šè§£å†³éœ€è¦æ—¶é—´</title><link>https://h1z3y3.me/posts/tietuku-clienthold/</link><guid isPermaLink="true">https://h1z3y3.me/posts/tietuku-clienthold/</guid><pubDate>Sun, 13 Mar 2016 20:58:52 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>&lt;strong>&lt;a href="CHinaZ.com">ç«™é•¿ä¹‹å®¶&lt;/a>ï¼ˆChinaZ.comï¼‰&lt;/strong> 3æœˆ4æ—¥æ¶ˆæ¯ï¼Œæ˜¨æ—¥å¼€å§‹ï¼Œå›½å†…çŸ¥åå›¾åºŠæœåŠ¡ç½‘ç«™è´´å›¾åº“é¦–é¡µå’ŒæœåŠ¡å™¨éƒ¨åˆ†åœ°åŒºå‡ºç°äº†æ— æ³•è®¿é—®çš„æƒ…å†µã€‚æ®ç«™é•¿ä¹‹å®¶äº†è§£ï¼Œè´´å›¾åº“å› è¢«æ£€æµ‹åˆ°éæ³•å†…å®¹ï¼Œé­åˆ°ç½‘ä¿¡åŠä¸‹ä»¤è¦æ±‚åŸŸåæœåŠ¡å•†æ˜“åä¸­å›½å°†åŸŸå**clientHoldï¼ˆé”å®šï¼‰**å¤„ç†ã€‚&lt;/p>
&lt;p>æˆ‘åšå®¢ä¸Šé¢çš„å›¾ç‰‡ä¹Ÿå…¨éƒ½æ”¾åœ¨è´´å›¾åº“ä¸Šé¢çš„ï¼Œä»Šå¤©åˆšå›å½’åšå®¢å°±å‘ç°å›¾ç‰‡ä¸èƒ½è®¿é—®äº†ã€‚æŸ¥è¿‡ä¹‹åæ‰è´´å›¾åº“è¢«å…³é—­äº†ï¼Œä¸è¿‡æˆ‘è§‰å¾—å®˜æ–¹åº”è¯¥èƒ½è§£å†³å¥½è¿™ä¸ªäº‹æƒ…ï¼Œæ¯•ç«Ÿæ˜¯å›½å†…çŸ¥åå›¾åºŠæœåŠ¡ç½‘ç«™ï¼Œç”¨æˆ·æ•°é‡åº”è¯¥å¾ˆå¤šã€‚æˆ‘è§‰å¾—ä¼šç»™ç”¨æˆ·ä¸€ä¸ªæ»¡æ„çš„ç­”å¤çš„ã€‚è¦ä¸ç„¶æˆ‘åšå®¢é‡Œé¢çš„å›¾ç‰‡æ€ä¹ˆåŠå•Šã€‚æ‘”ï¼&lt;/p></description><category domain="https://h1z3y3.me/tags/%E8%B4%B4%E5%9B%BE%E5%BA%93/">è´´å›¾åº“</category><category domain="https://h1z3y3.me/tags/%E7%BD%91%E4%BF%A1%E5%8A%9E/">ç½‘ä¿¡åŠ</category><category domain="https://h1z3y3.me/tags/%E8%AE%B0%E5%BD%95/">è®°å½•</category></item><item><title>iOS NSStringå­—ç¬¦ä¸²MD5åŠ å¯†</title><link>https://h1z3y3.me/posts/ios-md5/</link><guid isPermaLink="true">https://h1z3y3.me/posts/ios-md5/</guid><pubDate>Sun, 13 Mar 2016 18:59:02 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä¸ºäº†ä½¿ä¿å­˜çš„å¯†ç æ›´å®‰å…¨ï¼Œ æˆ‘ä»¬åº”è¯¥å®ç°ä¸€ä¸ªNSStringçš„åˆ†ç±»ï¼Œä¸ºå¯†ç åˆ›å»ºä¸€ä¸ªMD5çš„å“ˆå¸Œå€¼ï¼Œè€Œä¸”å¹¶æŠŠå®ƒä¿å­˜åœ¨keychainä¸­ï¼›keychainæ˜¯åœ¨è®¾å¤‡ä¸­ä¿å­˜å…³é”®æ•°æ®çš„å”¯ä¸€å®‰å…¨çš„åœ°æ–¹ã€‚&lt;/p>
&lt;h3 id="step1--æ–°å»ºæ–‡ä»¶">step1. æ–°å»ºæ–‡ä»¶&lt;/h3>
&lt;p>æ–°å»ºæ–‡ä»¶ï¼Œåœ¨æ¨¡æ¿åˆ—è¡¨ä¸­é€‰æ‹©Objective-C Categoryé¡¹ã€‚å•å‡»NextæŒ‰é’®ï¼Œè¾“å…¥â€œMD5â€ä½œä¸ºè¿™ä¸ªåˆ›å»ºçš„åˆ†ç±»çš„åå­—ï¼Œç„¶ååœ¨CategoryOnä¸‹æ‹‰èœå•ä¸­é€‰æ‹©NSStringï¼Œè¡¨æ˜æ˜¯NSStringçš„Categoryã€‚&lt;/p>
&lt;h3 id="step2--å¤´æ–‡ä»¶">step2. å¤´æ–‡ä»¶&lt;/h3>
&lt;pre>&lt;code>#import &amp;lt;Foundation/Foundation.h&amp;gt;
@interface NSString (MD5)
- (NSString *) MD5;
@end
&lt;/code>&lt;/pre>
&lt;h3 id="step3--æºæ–‡ä»¶">step3. æºæ–‡ä»¶&lt;/h3>
&lt;pre>&lt;code>#import &amp;quot;NSString+MD5.h&amp;quot;
#import &amp;lt;CommonCrypto/CommonDigest.h&amp;gt;
@implementation NSString (MD5)
- (NSString *) MD5{
//è½¬åŒ–ä¸ºUTF8æ ¼å¼å­—ç¬¦ä¸²
const char *ptr = [self UTF8String];
//å¼€è¾Ÿä¸€ä¸ª16å­—èŠ‚æ•°ç»„
unsigned char md5Buffer[CC_MD5_DIGEST_LENGTH];
//è°ƒç”¨å®˜æ–¹å°è£…çš„åŠ å¯†æ–¹æ³•, å°†ptrå¼€å§‹çš„å­—ç¬¦ä¸²å­˜å‚¨åˆ°md5Buffer[]ä¸­
CC_MD5(ptr, strlen(ptr), md5Buffer);
//è½¬æ¢ä½NSStringå¹¶è¿”å›
NSMutableString *output = [NSMutableString stringWithCapacity: CC_MD5_DIGEST_LENGTH * 2];
for (int i = 0; i &amp;lt; CC_MD5_DIGEST_LENGTH; i ++) {
[output appendFormat: @&amp;quot;%02x&amp;quot;, md5Buffer[i]];
}
/*
* `x`è¡¨ç¤ºåå…­è¿›åˆ¶ï¼Œ%02 æ„æ€æ˜¯ä¸è¶³ä¸¤ä½ç”¨0è¡¥é½ï¼Œå¦‚æœå¤šäº2ä½åˆ™ä¸å½±å“
* NSLog(&amp;quot;%02x&amp;quot;, 0x666); //è¾“å‡º `666`
* NSLog(&amp;quot;%02x&amp;quot;, 0x3); //è¾“å‡º `03`
*/
return output;
}
@end&lt;/code>&lt;/pre></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category><category domain="https://h1z3y3.me/tags/%E5%8A%A0%E5%AF%86/">åŠ å¯†</category><category domain="https://h1z3y3.me/tags/md5/">MD5</category></item><item><title>NSDictionaryå«æœ‰nullå¯¼è‡´å†™æ–‡ä»¶(writeToFile)å¤±è´¥(è±†ç“£ç”µå½±Apiè¿”å›Jsonæ•°æ®ä¸­å«æœ‰null)</title><link>https://h1z3y3.me/posts/nsdictionarywritetofilefailedbecauseofcontainsnull/</link><guid isPermaLink="true">https://h1z3y3.me/posts/nsdictionarywritetofilefailedbecauseofcontainsnull/</guid><pubDate>Tue, 10 Nov 2015 22:43:40 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä¹‹å‰ä»æ¥å£è·å–æ•°æ®åè½¬æ¢ä¸ºNSDictionaryç„¶åæ‰§è¡ŒwriteToFileå°±å¯ä»¥å†™å…¥æ–‡ä»¶æˆåŠŸï¼Œæ˜¨å¤©åœ¨ä½¿ç”¨&lt;a href="http://developers.douban.com/wiki/?title=api_v2">è±†ç“£ç”µå½±Api&lt;/a>æ—¶ï¼Œå‡ºç°äº†å‰å‡ æ¡è¯·æ±‚çš„æ•°æ®å†™å…¥ç¼“å­˜æˆåŠŸï¼Œä»æŸä¸€æ¬¡è¯·æ±‚å¼€å§‹å°±æ€»æ˜¯å†™å…¥ä¸æˆåŠŸã€‚å› ä¸ºæˆ‘æ˜¯ç”¨gcdæ–¹å¼è¯·æ±‚æ•°æ®çš„ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯å› ä¸ºçº¿ç¨‹ç«äº‰çš„é—®é¢˜ï¼Œä½†æ˜¯å†™æ–‡ä»¶çš„åŸå­æ“ä½œæˆ‘è®¾ç½®çš„YESå•Šã€‚ç„¶åå†™è¿›ç¨‹é”è¯•ä¸€ä¸‹ï¼Œç„¶è€Œä»ç„¶å†™å…¥å¤±è´¥ï¼Œåæ¥æˆ‘ä¸ç”¨gcdä»¥ä¸ºèƒ½å¥½ï¼Œç»“æœè¿˜æ˜¯å†™å…¥å¤±è´¥ã€‚åæ¥ç¿»èµ„æ–™ï¼Œè¯´å¥½åƒå¦‚æœNSDictionaryä¸­æœ‰è‡ªå®šä¹‰çš„objectç±»å‹æ˜¯ä¸èƒ½å†™å…¥æ–‡ä»¶çš„ï¼Œæ¯”å¦‚åƒ&lt;strong>null&lt;/strong>ï¼Œå‘µå‘µã€‚ä½†æ˜¯æˆ‘æ‰¾äº†åŠå¤©ä¹Ÿæ²¡æ‰¾åˆ°é”™è¯¯æ‰€åœ¨ï¼Œç„¶åä¹Ÿä¸å¤ªå½±å“æ­£å¸¸ä½¿ç”¨ï¼Œå°±æš‚æ—¶æ”¾åœ¨ä¸€è¾¹äº†ã€‚&lt;/p>
&lt;p>ç»“æœä»Šå¤©å‡ºé—®é¢˜äº†ï¼Œä¹‹å‰è·å–çš„æ˜¯ç”µå½±çš„åˆ—è¡¨ä¿¡æ¯ï¼Œä»Šå¤©è¦å†™ç”µå½±çš„è¯¦æƒ…é¡µä¿¡æ¯ã€‚å†™å¥½åä¸æ–­æµ‹è¯•ï¼Œç»“æœæœ‰ä¸€æ¡ç”µå½±ï¼Œä¸€ç‚¹è¿›å…¥è¯¦æƒ…å°±ä¼šå´©æºƒã€‚å¥½äº†ï¼Œè®¾ç½®å¥½æ–­ç‚¹ï¼Œä¸€æ­¥æ­¥æ’æŸ¥ï¼Œæœ€åNSLogå¯¼æ¼”å¤´åƒçš„urlStringæ—¶ï¼Œæ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ï¼Œå¯¼æ¼”çš„å¤´åƒå›¾ç‰‡çš„urlä¸º&lt;strong>null&lt;/strong>ï¼ç»ˆäºæ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ã€‚é‚£ä¹ˆå¯ä»¥è§£å†³äº†&amp;hellip;&lt;/p>
&lt;p>æˆ‘è·å–äº†è¯¥æ¡ç›®ç”µå½±çš„idå·ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è·å–äº†ä»–çš„jsonæ•°æ®ï¼Œæœä¸å…¶ç„¶ï¼Œå°±æ˜¯è¿™ä¸ªç”µå½±!ã€Šç«äº‘ç«¯ã€‹!&lt;/p>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t01e3e13585b1cbbbe5.jpg" alt="å«æœ‰null">&lt;/p>
&lt;p>ç„¶è€Œæˆ‘å¹¶æ²¡æœ‰æƒ³åˆ°æœ‰è¿™ä¹ˆå¤š&lt;strong>null&lt;/strong>ã€‚&lt;/p>
&lt;p>ç»è¿‡ç™¾åº¦ï¼Œå¥½åƒè¦å†™æ–‡ä»¶ï¼ŒNSDictionaryé‡Œé¢çš„objectå¿…é¡»æ˜¯NSStringï¼ŒNSDataï¼ŒNSNumberï¼ŒNSDateï¼ŒNSArrayï¼ŒNSDictionaryä¸­çš„æ•°æ®ç±»å‹ã€‚ä¸è¿‡æˆ‘çŸ¥é“ï¼Œå«æœ‰&lt;strong>null&lt;/strong>æ˜¯ä¸‡ä¸‡ä¸èƒ½çš„ï¼Œæ··è›‹ã€‚&lt;/p>
&lt;h2 id="è§£å†³æ–¹æ¡ˆnsdictionary---nsdate">è§£å†³æ–¹æ¡ˆï¼šNSDictionary -&amp;gt; NSDate&lt;/h2>
&lt;p>NSDictionaryå†™æ–‡ä»¶ä¹‹å‰ï¼Œå¯ä»¥æŠŠå®ƒè½¬æ¢æˆNSDataç±»å‹çš„æ•°æ®ï¼Œå†æ‰§è¡Œå†™æ–‡ä»¶æ“ä½œã€‚
ä»æ–‡ä»¶è¯»å–æ—¶æŠŠè¯»å–å‡ºçš„NSDataè½¬æ¢ä¸ºNSDictionaryå°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;h3 id="ç”¨åˆ°çš„æ–¹æ³•">ç”¨åˆ°çš„æ–¹æ³•&lt;/h3>
&lt;p>NSDictionary -&amp;gt; NSData:&lt;/p>
&lt;pre>&lt;code>NSData *data = [NSKeyedArchiver archivedDataWithRootObject:dictionary];
&lt;/code>&lt;/pre>
&lt;p>NSData -&amp;gt; NSDictionary:&lt;/p>
&lt;pre>&lt;code>NSDictionary *dictionary = (NSDictionary *)[NSKeyedUnarchiver unarchiveObjectWithData:data];
&lt;/code>&lt;/pre>
&lt;p>æ˜¨å¤©çš„é—®é¢˜è§£å†³äº†ï¼Œè¿™æ ·å†™æ—¶å€™ï¼Œæ¯ä¸€æ¬¡éƒ½èƒ½å†™å…¥ç¼“å­˜æ–‡ä»¶æˆåŠŸã€‚&lt;/p>
&lt;p>ä»Šå¤©çš„æ¶‰åŠåˆ°NSDictionaryå€¼çš„è·å–çš„éƒ¨åˆ†ï¼Œæˆ‘éƒ½åŠ äº†ä¸€ä¸ªåˆ¤æ–­ &lt;code>if([theValue isKindOfClass:[NSNull class]])&lt;/code>ï¼Œç„¶åè¿›è¡Œç›¸åº”å¤„ç†å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ—¶iOSçš„ä¸€ä¸ªå½’æ¡£æ–¹æ³•ï¼Œä¸ä»…ä»…èƒ½å½’æ¡£&lt;code>null&lt;/code>ï¼Œ&lt;code>è‡ªå®šä¹‰çš„ç±»å‹&lt;/code>ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚å…·ä½“å¯ä»¥å‚è§&lt;a href="http://www.cnblogs.com/xiaobaizhu/p/4011332.html">å°ç™½çŒªjianjiançš„åšå®¢-ä½¿ç”¨NSKeyedArchiverå½’æ¡£&lt;/a>&lt;/p>
&lt;h2 id="æ„Ÿæƒ³">æ„Ÿæƒ³&lt;/h2>
&lt;p>ç”Ÿæ´»ä¸­æˆ–è€…ç¨‹åºå¼€å‘ä¸­ï¼Œé‡åˆ°äº†é—®é¢˜ä¸ä¸€å®šéè¦ç«‹é©¬è§£å†³ï¼Œå¦‚æœæ­»é’»ç‰›è§’å°–å„¿å¯èƒ½ä¸€ç›´éƒ½è§£å†³ä¸äº†ï¼Œé‚£æ—¶åªèƒ½æµªè´¹æ—¶é—´ã€‚å¦‚æœæš‚æ—¶æ”¾æ”¾ï¼Œä¼‘æ¯ä¸€ä¼šï¼Œå†å›æ¥æƒ³è§£å†³åŠæ³•å¯èƒ½å°±èƒ½æƒ³åˆ°è§£å†³æ–¹æ¡ˆã€‚å°±åƒä»Šå¤©æˆ‘è§£å†³æˆ‘çš„é—®é¢˜ä¸€æ ·ï¼Œå®Œå…¨æ˜¯æœºç¼˜å·§åˆã€‚åŒæ—¶æˆ‘ä»¬ä¹Ÿåº”è¯¥å‘ç°ï¼Œå¦‚æœæƒ³åšå‡ºå¥½çš„è½¯ä»¶ï¼Œå‰æœŸå¼€å‘çš„æŠ•å…¥å¾ˆé‡è¦ï¼Œä½†æ˜¯åæœŸçš„æµ‹è¯•ä¹Ÿå¾ˆé‡è¦ã€‚åŠŸèƒ½åšå®Œä¹‹åæˆ‘ä¹Ÿæ˜¯ç‚¹å‡»æµ‹è¯•äº†ä¸è¯´å‡ ç™¾æ¬¡ï¼Œå‡ åæ¬¡ä¹Ÿæ˜¯æœ‰äº†æ‰å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚&lt;/p>
&lt;p>æœ€åç»™å¤§å®¶çœ‹ä¸‹æˆ‘åšçš„&lt;strong>ç”µå½±å½±è®¯&lt;/strong>ï¼Œå˜¿å˜¿ï¼Œä½¿ç”¨äº†&lt;a href="http://developers.douban.com/wiki/?title=api_v2">è±†ç“£ç”µå½±Api&lt;/a>ã€‚&lt;/p>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t010921a0625be5aab8.gif" alt="å¨æµ·å½±è®¯åˆ—è¡¨">
&lt;img src="https://p4.ssl.qhimg.com/t018dd1c22d5ce572a7.gif" alt="ç”µå½±è¯¦æƒ…é¡µ">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>çº¯ä»£ç é«˜ä»¿ç½‘æ˜“æ–°é—»å®¢æˆ·ç«¯ä¸¤ä¸ªscrollViewè”åŠ¨ï¼ˆäºŒï¼‰ï¼šå®ç°ç•Œé¢é€»è¾‘å˜æ¢</title><link>https://h1z3y3.me/posts/twoscrollviewlinkage-2-businesslogic/</link><guid isPermaLink="true">https://h1z3y3.me/posts/twoscrollviewlinkage-2-businesslogic/</guid><pubDate>Sun, 08 Nov 2015 11:37:09 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä¸Šä¸€ç¯‡å·²ç»å®ç°äº†é¡µé¢çš„å¸ƒå±€ï¼Œè¿™ä¸€ç¯‡æˆ‘ä»¬æ¥å®ç°ç•Œé¢çš„é€»è¾‘å˜æ¢ã€‚ä¸»è¦ç”¨åˆ°çš„æ˜¯scollViewçš„ä¸¤ä¸ªä»£ç†æ–¹æ³•ã€‚æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æ•ˆæœã€‚&lt;/p>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t015616f03de7b014b5.gif" alt="æ•ˆæœé¢„è§ˆå›¾">&lt;/p>
&lt;h2 id="1å®ç°ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®åˆ‡æ¢åº•éƒ¨è¯¦æƒ…é¡µé¢">1.å®ç°ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®åˆ‡æ¢åº•éƒ¨è¯¦æƒ…é¡µé¢&lt;/h2>
&lt;h3 id="ç»™é¡¶éƒ¨itemsçš„æŒ‰é’®æ·»åŠ target">ç»™é¡¶éƒ¨itemsçš„æŒ‰é’®æ·»åŠ target&lt;/h3>
&lt;p>åœ¨&lt;code>- (void) addFirstScrollViewOnView &lt;/code>æ–¹æ³•ä¸­çš„&lt;code>forå¾ªç¯&lt;/code>ä¸­ï¼Œä¸ºæ¯ä¸ªbuttonæ·»åŠ ä¸€ä¸ªtargetï¼Œç”¨äºç›‘å¬ç‚¹å‡»æŒ‰é’®çš„äº‹ä»¶ã€‚&lt;/p>
&lt;pre>&lt;code> [itemButton addTarget:self action:@selector(itemButtonClicked:) forControlEvents:UIControlEventTouchUpInside];
&lt;/code>&lt;/pre>
&lt;h3 id="æ·»åŠ ç›‘å¬æ–¹æ³•">æ·»åŠ ç›‘å¬æ–¹æ³•&lt;/h3>
&lt;p>æˆ‘ä»¬åº”è¯¥çŸ¥é“å½“ç‚¹å‡»é¡¶éƒ¨itemæŒ‰é’®æ—¶ï¼Œåº•éƒ¨è¯¦æƒ…é¡µåº”è¯¥åšç›¸åº”çš„åˆ‡æ¢ï¼ŒåŒæ—¶æŒ‰é’®æ ·å¼ä¹Ÿæ”¹å˜ã€‚
å¤§å®¶å¯èƒ½æ³¨æ„åˆ°äº†éœ€è¦ç”¨åˆ°æŒ‰é’®çš„tagå€¼ï¼Œæ‰€ä»¥æˆ‘ä»¬åŒæ ·åœ¨&lt;code>ä¸Šä¸€æ­¥çš„æ–¹æ³•&lt;/code>çš„&lt;code>forå¾ªç¯&lt;/code>ä¸­ä¸ºæ¯ä¸ªæŒ‰é’®è®¾ç½®tagå€¼ã€‚&lt;/p>
&lt;pre>&lt;code>itemButton.tag = 100 + i;//è®¾ç½®buttonçš„tagå€¼
&lt;/code>&lt;/pre>
&lt;p>åŒæ—¶ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªå®ä¾‹å˜é‡ï¼š&lt;/p>
&lt;pre>&lt;code> //è®°å½•å½“å‰è¢«ç‚¹å‡»çš„æŒ‰é’®tag
@property (nonatomic, assign) NSInteger currentButtonTag;
&lt;/code>&lt;/pre>
&lt;p>**(é‡è¦)**å¹¶åœ¨&lt;code>ä¸Šä¸€æ­¥æ–¹æ³•çš„æœ€å&lt;/code>ä¸ºå®ƒè®¾ç½®åˆå§‹å€¼ä¸º&lt;code>100&lt;/code>ï¼Œä¹Ÿå°±æ˜¯å½“å‰ç‚¹å‡»çš„æŒ‰é’®ä¸ºç¬¬ä¸€ä¸ªã€‚&lt;/p>
&lt;h4 id="tipsä¸ä»1å¼€å§‹è®¾ç½®tagå€¼çš„åŸå› æ˜¯å› ä¸ºå‰100å¯èƒ½æœ‰ç³»ç»Ÿçš„æ§ä»¶å ç”¨">tipsï¼šä¸ä»1å¼€å§‹è®¾ç½®tagå€¼çš„åŸå› æ˜¯å› ä¸ºå‰100å¯èƒ½æœ‰ç³»ç»Ÿçš„æ§ä»¶å ç”¨&lt;/h4>
&lt;p>scrollViewè¯¦æƒ…é¡µåˆ‡æ¢ï¼šè·å–å½“å‰æŒ‰é’®çš„tagå€¼ï¼Œè®¡ç®—åç§»é‡&lt;/p>
&lt;pre>&lt;code>- (void) itemButtonClicked:(UIButton *)button {
//**1.åç§»åº•éƒ¨è¯¦æƒ…scrollView
NSInteger buttonTag = button.tag - 100;//è·å–ç‚¹å‡»æŒ‰é’®çš„tag
self.secondScrollView.contentOffset = CGPointMake(buttonTag * KSCREEN_WIDTH, 0);//è®¾ç½®åº•éƒ¨scrollviewçš„å†…å®¹åç§»é‡
//**2.æ¢å¤å‰ä¸€ä¸ªè¢«ç‚¹å‡»çš„æŒ‰é’®çš„æ ·å¼
UIButton *preClickedButton = (UIButton *)[self.view viewWithTag:self.currentButtonTag];
preClickedButton.titleLabel.font = [UIFont systemFontOfSize:14.0f];
[preClickedButton setTitleColor:[UIColor colorWithRed:0.4 green:0.4 blue:0.4 alpha:1.0] forState:UIControlStateNormal];//æ ‡é¢˜é¢œè‰²
//**3.è®¾ç½®å½“å‰ç‚¹å‡»æŒ‰é’®æ ·å¼
button.titleLabel.font = [UIFont systemFontOfSize:18.0f];
[button setTitleColor:[UIColor colorWithRed:1.0 green:0.3 blue:0.3 alpha:1.0f] forState:UIControlStateNormal];
//**4.æ”¹å˜å½“å‰ç‚¹å‡»æŒ‰é’®çš„tagå€¼
self.currentButtonTag = buttonTag + 100;
}
&lt;/code>&lt;/pre>
&lt;p>å®Œæˆè¿™ä¸€æ­¥ï¼Œå½“ä½ ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®çš„æ—¶å€™ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°é¡¶éƒ¨æŒ‰é’®æ ·å¼çš„æ”¹å˜å’Œåº•éƒ¨è¯¦æƒ…é¡µé¢çš„åˆ‡æ¢ã€‚&lt;/p>
&lt;h2 id="2å®ç°æ»šåŠ¨åº•éƒ¨è¯¦æƒ…é¡µé¡¶éƒ¨æŒ‰é’®å­—ä½“åˆ‡æ¢">2.å®ç°æ»šåŠ¨åº•éƒ¨è¯¦æƒ…é¡µé¡¶éƒ¨æŒ‰é’®å­—ä½“åˆ‡æ¢&lt;/h2>
&lt;h3 id="æ·»åŠ scrollviewçš„ä»£ç†">æ·»åŠ scrollViewçš„ä»£ç†&lt;/h3>
&lt;p>æ·»åŠ ä»£ç†&lt;/p>
&lt;pre>&lt;code>@interface ViewController () &amp;lt;UIScrollViewDelegate&amp;gt;
&lt;/code>&lt;/pre>
&lt;p>åœ¨&lt;code>- (void) addSecondScrollViewOnView &lt;/code>æ–¹æ³•ä¸­è®¾ç½®&lt;code>secondScrollView&lt;/code>çš„ä»£ç†ä¸ºselfã€‚è¿™æ­¥ä¸è¦å¿˜è®°äº†ã€‚&lt;/p>
&lt;pre>&lt;code>secondScrollView.delegate = self;
&lt;/code>&lt;/pre>
&lt;h3 id="å®ç°scrollview-çš„ä»£ç†æ–¹æ³•---void-scrollviewdidscrolluiscrollview-scrollview">å®ç°scrollView çš„ä»£ç†æ–¹æ³• - (void) scrollViewDidScroll:(UIScrollView *)scrollViewï¼›&lt;/h3>
&lt;p>åœ¨è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬è¦å®ç°æ»šåŠ¨æ—¶ï¼Œé¡¶éƒ¨itemsçš„æŒ‰é’®å­—ä½“å¤§å°å’Œé¢œè‰²çš„æ”¹å˜ã€‚&lt;/p>
&lt;pre>&lt;code> //æ­£åœ¨æ»‘åŠ¨è°ƒç”¨çš„ä»£ç†æ–¹æ³•
- (void) scrollViewDidScroll:(UIScrollView *)scrollView {
//è·å–å½“å‰ç¬¬äºŒä¸ªscrollViewçš„åç§»é‡
CGFloat secondScrollViewContentOffsetX = scrollView.contentOffset.x;
//è·å–é€‰ä¸­æŒ‰é’®çš„åºå·
int buttonTag = (secondScrollViewContentOffsetX) / KSCREEN_WIDTH;
//è®¡ç®—æ‰‹æŒ‡æ»‘åŠ¨äº†å¤šå°‘è·ç¦»
CGFloat fingerDistance = secondScrollViewContentOffsetX - KSCREEN_WIDTH * buttonTag;
//è·å–åˆ°ä¸‹ä¸€ä¸ªæŒ‰é’®ï¼Œå¹¶æ”¹å˜å…¶å­—ä½“å¤§å°å’Œé¢œè‰²ï¼Œé€æ¸æ”¾å¤§ï¼ˆæ ¹æ®æ‰‹æŒ‡æ»‘åŠ¨çš„è·ç¦»åŠ¨æ€æ”¹å˜ï¼‰
UIButton *buttonNext = (UIButton *)[self.view viewWithTag:(buttonTag + 100 + 1)];
buttonNext.titleLabel.font = [UIFont systemFontOfSize:(14.0 + fingerDistance * 4 / (KSCREEN_WIDTH))];
[buttonNext setTitleColor:[UIColor colorWithRed:(0.4f + 3 * fingerDistance / (KSCREEN_WIDTH * 5)) green:0.3 blue:0.3 alpha:1.0] forState:UIControlStateNormal];
//åŒæ ·æ–¹æ³•è·å–åˆ°å½“å‰æŒ‰é’®ï¼Œå¹¶æ”¹å˜å…¶å­—ä½“å¤§å°å’Œé¢œè‰²æ¢å¤å›åŸæ¥æ ·å¼ï¼Œé€æ¸ç¼©å°ï¼ˆæ ¹æ®æ‰‹æŒ‡æ»‘åŠ¨çš„è·ç¦»åŠ¨æ€æ”¹å˜ï¼‰
UIButton *buttonCurr = (UIButton *)[self.view viewWithTag:(buttonTag + 100)];
buttonCurr.titleLabel.font = [UIFont systemFontOfSize:(18.0 - fingerDistance * 4 / (KSCREEN_WIDTH))];
[buttonCurr setTitleColor:[UIColor colorWithRed:(1.0f - 3 * fingerDistance / (KSCREEN_WIDTH * 5)) green:0.3 blue:0.3 alpha:1.0] forState:UIControlStateNormal];
}
&lt;/code>&lt;/pre>
&lt;p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ä¸‹ä¸€ä¸ªæŒ‰é’®çš„å­—ä½“åŠ¨æ€æ”¹å˜ï¼Œè®¡ç®—æ–¹æ³•å…¶å®éå¸¸ç®€å•ã€‚
è®¾æ‰‹æŒ‡æ»‘åŠ¨è·ç¦»ä¸ºxï¼Œå­—ä½“å¤§å°ä¸ºyã€‚é‚£ä¹ˆæˆ‘ä»¬æœ‰ä¸¤ä¸ªå€¼ &lt;em>(0,14)&lt;/em>, &lt;em>(KSCREEN_WIDTH, 18)&lt;/em>ã€‚
ç„¶ååˆ—äºŒå…ƒä¸€æ¬¡æ–¹ç¨‹ç»„ï¼Œå°±å¯ä»¥å¾—åˆ° &lt;em>a&lt;/em> å’Œ &lt;em>b&lt;/em>ã€‚
æˆ‘è¿™é‡Œè§£å¾— &lt;em>a = 4/KSCREEN_WIDTD&lt;/em> , &lt;em>b = 14&lt;/em>&lt;/p>
&lt;p>å½“å‰æŒ‰é’®çš„æ”¹å˜äº¦ç„¶ã€‚åªæ˜¯ä¸¤ä¸ªç‚¹å˜ä¸º &lt;em>(KSCREEN_WIDTH, 14)&lt;/em>, &lt;em>(0, 18)&lt;/em>
è®¡ç®—å¾—åˆ° &lt;em>a = ï¼(4/KSCREEN_WIDTH)&lt;/em>, &lt;em>b = 18&lt;/em>&lt;/p>
&lt;p>é¢œè‰²å¤§å®¶è®¡ç®—æ–¹å¼ç›¸ä¼¼ï¼Œä¸å†èµ˜è¿°ã€‚&lt;/p>
&lt;h2 id="3ä½¿é¡¶éƒ¨scrollviewéšåº•éƒ¨scrollviewæ»‘åŠ¨è€Œæ»šåŠ¨">3.ä½¿é¡¶éƒ¨scrollViewéšåº•éƒ¨scrollViewæ»‘åŠ¨è€Œæ»šåŠ¨&lt;/h2>
&lt;p>æˆ‘ä»¬æ³¨æ„çœ‹ç½‘æ˜“æ–°é—»å®¢æˆ·ç«¯ï¼Œå®ƒåº•éƒ¨scrollViewæ»šåŠ¨ä¹‹åï¼Œé¡¶éƒ¨çš„scrollViewä¹Ÿä¼šéšä¹‹æ»šåŠ¨ï¼Œå¹¶ä¸”é™¤äº†å¼€å¤´æˆ–è€…æœ«å°¾çš„å‡ ä¸ªæŒ‰é’®ï¼Œå®ƒå½“å‰æ‰€åœ¨çš„æ–°é—»ç±»å‹å§‹ç»ˆåœ¨å±å¹•ä¸­é—´ã€‚å¹¶ä¸”é¡¶éƒ¨çš„æ»šåŠ¨æ€»æ˜¯åœ¨åº•éƒ¨æ»‘åŠ¨ç»“æŸä¹‹åï¼Œæ‰€ä»¥æˆ‘ä»¬å®ç°scrollViewçš„ä»£ç†æ–¹æ³• &lt;code>- (void) scrollViewDidEndDecelerating:(UIScrollView *)scrollView &lt;/code>&lt;/p>
&lt;pre>&lt;code>//æ»‘åŠ¨ç»“æŸè°ƒç”¨çš„ä»£ç†æ–¹æ³•
- (void) scrollViewDidEndDecelerating:(UIScrollView *)scrollView {
//**1.è·å–é€‰ä¸­è¯¦æƒ…é¡µå¯¹åº”çš„é¡¶éƒ¨button
//ç§»åŠ¨é¡¶éƒ¨é€‰ä¸­çš„æŒ‰é’®
CGFloat secondScrollViewContentOffsetX = scrollView.contentOffset.x;
//è·å–é€‰ä¸­æŒ‰é’®çš„åºå·
int buttonTag = (secondScrollViewContentOffsetX) / KSCREEN_WIDTH;
//æ ¹æ®æŒ‰é’®å·ç è·å–åˆ°é¡¶éƒ¨çš„æŒ‰é’®
UIButton *buttonCurr = (UIButton *)[self.view viewWithTag:(buttonTag + 100)];
//**2.(é‡è¦)è®¾ç½®å½“å‰é€‰ä¸­çš„æŒ‰é’®å·ã€‚å¦‚è‹¥ä¸å†™ï¼Œå°†å¯¼è‡´æ»‘åŠ¨åå†ç‚¹å‡»é¡¶éƒ¨æŒ‰é’®ï¼Œä¸Šä¸€ä¸ªæŒ‰é’®é¢œè‰²ï¼Œå­—ä½“ä¸ä¼šæ”¹å˜
self.currentButtonTag = buttonTag + 100;
//**3.å§‹ç»ˆä¿æŒé¡¶éƒ¨é€‰ä¸­æŒ‰é’®åœ¨ä¸­é—´ä½ç½®
//æ³¨æ„ä¸€ï¼šå¼€å§‹çš„å‡ ä¸ªæŒ‰é’®ï¼Œå’Œæœ«å°¾çš„å‡ ä¸ªæŒ‰é’®å¹¶ä¸éœ€è¦ä¸€ç›´ä¿æŒä¸­é—´ã€‚
//æ³¨æ„äºŒï¼šå¯¹äºå·²ç»æ”¾ç½®åœ¨firstScrollViewä¸­çš„æŒ‰é’®ï¼Œå®ƒçš„centeræ˜¯ç›¸å¯¹äºscrollViewçš„contentè€Œè¨€çš„ï¼Œæ³¨æ„å¹¶ä¸æ˜¯ç›¸å¯¹äºself.viewçš„boundsè€Œè¨€çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ”¾ç½®å¥½æŒ‰é’®ï¼Œå®ƒçš„centerå°±ä¸ä¼šå†æ”¹å˜
//å¦‚æœæ˜¯é¡¶éƒ¨scrollViewå³å°†åˆ°æœ«å°¾çš„å‡ ä¸ªæŒ‰é’®ï¼Œè®¾ç½®åç§»é‡ï¼Œç›´æ¥return
if (buttonCurr.center.x + KSCREEN_WIDTH * 0.5 &amp;gt; self.firstScrollView.contentSize.width) {
[UIView animateWithDuration:0.3 animations:^{
self.firstScrollView.contentOffset = CGPointMake(self.firstScrollView.contentSize.width - KSCREEN_WIDTH, 0);
}];
return;
}
//å¦‚æœæ˜¯é¡¶éƒ¨scrollViewå¼€å¤´çš„å‡ ä¸ªæŒ‰é’®ï¼Œè®¾ç½®åç§»é‡ï¼Œç›´æ¥return
if (buttonCurr.center.x &amp;lt; KSCREEN_WIDTH * 0.5) {
[UIView animateWithDuration:0.3 animations:^{
self.firstScrollView.contentOffset = CGPointMake(0, 0);
}];
return;
}
//å¦‚æœæ˜¯ä¸­é—´å‡ ä¸ªæŒ‰é’®çš„æƒ…å†µ
if (buttonCurr.center.x &amp;gt; (KSCREEN_WIDTH * 0.5)) {
[UIView animateWithDuration:0.3 animations:^{
self.firstScrollView.contentOffset = CGPointMake(buttonCurr.center.x - self.view.center.x, 0);
}];
}
}
&lt;/code>&lt;/pre>
&lt;p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯æˆ‘æ³¨é‡Šé‡Œé¢çš„&lt;strong>ç¬¬2æ­¥&lt;/strong>å’Œ&lt;strong>ç¬¬3æ­¥&lt;/strong>ã€‚
ç¬¬2æ­¥ä¸€å®šè¦å†™ï¼Œå¦åˆ™å¯¼è‡´å…ˆæ»‘åŠ¨åº•éƒ¨scrollViewï¼Œå†ç‚¹å‡»é¡¶éƒ¨scrollViewçš„buttonï¼Œå‡ºç°ä¹‹å‰çš„é‚£ä¸ªbuttonæ ·å¼ä¸æ¢å¤çš„æƒ…å†µã€‚
ç¬¬3æ­¥ï¼Œæ³¨æ„å‰å‡ ä¸ªæŒ‰é’®å’Œåå‡ ä¸ªæŒ‰é’®ä½ç½®çš„åˆ¤æ–­ï¼Œå¦‚æœä¸€å‘³ä¿æŒæŒ‰é’®åœ¨ä¸­é—´ï¼Œå°±ä¼šå‡ºç°é¡¶éƒ¨çš„offsetè¿‡å¤šï¼Œè€Œåé¢å‡ºç°ç©ºç™½ï¼Œå¤§å®¶å¯ä»¥ç®€å•å°è¯•ä¸€ä¸‹ã€‚&lt;/p>
&lt;p>æ•´ä¸ªæ•ˆæœå°±å·²ç»å®Œæˆäº†ï½â˜ºï¸&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>çº¯ä»£ç é«˜ä»¿ç½‘æ˜“æ–°é—»å®¢æˆ·ç«¯ä¸¤ä¸ªscrollViewè”åŠ¨ï¼ˆä¸€ï¼‰ï¼šè®¾ç½®åŸºæœ¬çš„ç•Œé¢å¸ƒå±€</title><link>https://h1z3y3.me/posts/twoscrollviewlinkage-1-baseview/</link><guid isPermaLink="true">https://h1z3y3.me/posts/twoscrollviewlinkage-1-baseview/</guid><pubDate>Sat, 07 Nov 2015 23:31:46 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è‡ªå·±å†å¼€å‘appè¿‡ç¨‹ä¸­é‡åˆ°äº†è¿™æ ·é‚£æ ·çš„éœ€æ±‚ï¼Œå…¶ä¸­æœ‰ä¸€é¡¹æ˜¯æ–°é—»é¡µé¢ï¼Œéœ€è¦ä¸¤ä¸ªscrollViewè”åŠ¨ï¼Œä¸Šé¢çš„scrollViewæ˜¯æ–°é—»ç±»å‹ï¼Œä¸‹é¢scrollViewæ˜¯tableViewæ–°é—»æ ‡é¢˜ã€‚å¼€å‘è¿‡ç¨‹ä¸­æˆ‘å…¨éƒ¨éƒ½æ˜¯ç”¨ä»£ç å¸ƒå±€çš„ï¼Œå› ä¸ºè‡ªå·±æ˜¯æ–°æ‰‹ï¼Œä¸çŸ¥é“åˆ°åº•æ˜¯ç”¨ä»£ç å†™æ¯”è¾ƒæ–¹ä¾¿è¿˜æ˜¯ç”¨storyBoardæ›´æ–¹ä¾¿ï¼Œä½†æ˜¯æ„Ÿè§‰æ‰‹å†™ä»£ç é€‚åº”å±å¹•ä¸Šæ›´å®¹æ˜“ä¸Šæ‰‹å§ã€‚éœ€æ±‚å®ç°ä¹‹åç°åœ¨æ‹¿å‡ºæ¥ç®€å•æ•´ç†ä¸€ä¸‹ï¼Œæ–¹ä¾¿è‡ªå·±æ—¥åæŸ¥çœ‹ï¼Œä¹Ÿç»™åæ¥è€…ä»¥å‚è€ƒã€‚å› ä¸ºåˆšåˆšå¼€å§‹å­¦ï¼Œç”¨åˆ°çš„éƒ½æ˜¯äº›ç®€å•çš„æ–¹æ³•ï¼Œä¹Ÿå¯èƒ½ä¼šå‡ºé”™ï¼Œå¦‚æœæœ‰ä»€ä¹ˆä¸è¶³ï¼Œè¯·ç•™è¨€ç»™æˆ‘æŒ‡å‡ºã€‚è°¢è°¢ï½&lt;/p>
&lt;p>ç°åœ¨å¼€å§‹æ­£é¢˜ï¼š
æœ¬æ–‡æ˜¯ç¬¬ä¸€ç¯‡ï¼Œå…ˆæ˜¯ç®€å•çš„é¡µé¢å¸ƒå±€ï¼Œé¦–å…ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹å¸ƒå±€ä¹‹åçš„æ•ˆæœï¼š&lt;/p>
&lt;p>&lt;img src="https://p4.ssl.qhimg.com/t010500cb2fa4fe823f.gif" alt="twoScrollViewLinkage_baseViewLayout">&lt;/p>
&lt;h3 id="1å®å®šä¹‰">1.å®å®šä¹‰&lt;/h3>
&lt;pre>&lt;code>//å±å¹•çš„å®½å’Œé«˜
#define KSCREEN_HEIGHT [UIScreen mainScreen].bounds.size.height
#define KSCREEN_WIDTH [UIScreen mainScreen].bounds.size.width
//æœ€é¡¶éƒ¨çŠ¶æ€æ çš„é«˜åº¦
#define KSTATUS_HEIGHT 20
//é¡¶éƒ¨itemsçš„scrollViewçš„é«˜åº¦
#define KFIRST_SCROLLVIEW_HEIGHT 30
//æ ¹æ®è®¡ç®—ï¼Œå¾—åˆ°åº•éƒ¨è¯¦æƒ…scrollViewçš„é«˜åº¦
#define KSECOND_SCROLLVIEW_HEIGHT (KSCREEN_HEIGHT - KSTATUS_HEIGHT - KFIRST_SCROLLVIEW_HEIGHT)
//é¡¶éƒ¨scrollViewæ¯ä¸ªitemæŒ‰é’®çš„å®½åº¦
#define KFIRST_SCROLLVIEW_ITEM_WIDTH 55
&lt;/code>&lt;/pre>
&lt;h3 id="2é¦–å…ˆå®šä¹‰éœ€è¦ç”¨åˆ°çš„å˜é‡">2.é¦–å…ˆå®šä¹‰éœ€è¦ç”¨åˆ°çš„å˜é‡&lt;/h3>
&lt;pre>&lt;code>@interface ViewController ()
//é¡¶éƒ¨itemsçš„scrollView
@property (nonatomic, weak) UIScrollView *firstScrollView;
//åº•éƒ¨è¯¦æƒ…scrollView
@property (nonatomic, weak) UIScrollView *secondScrollView;
//itemç±»å‹çš„æ•°ç»„
@property (nonatomic, strong) NSArray *itemsTitlesArray;
//ä¸ºäº†æ–¹ä¾¿ï¼Œå®šä¹‰ä¸€ä¸ªåŒ…å«é¢œè‰²çš„NSArrayï¼ˆè‡ªè¡Œå–èˆï¼‰
@property (nonatomic, strong) NSArray *colorArray;
@end
&lt;/code>&lt;/pre>
&lt;h3 id="3æ‡’åŠ è½½">3.æ‡’åŠ è½½&lt;/h3>
&lt;pre>&lt;code>#pragma mark - lazy load
//å®šä¹‰itemsçš„æ ‡é¢˜
- (NSArray *) itemsTitlesArray {
if (!_itemsTitlesArray) {
_itemsTitlesArray = [NSArray arrayWithObjects:@&amp;quot;çƒ­ç‚¹æ–°é—»&amp;quot;, @&amp;quot;æ–°é—»å¿«è®¯&amp;quot;, @&amp;quot;é€šçŸ¥å…¬å‘Š&amp;quot;, @&amp;quot;é™¢ç³»é€šçŸ¥&amp;quot;, @&amp;quot;äººç‰©é£é‡‡&amp;quot;, nil];
}
return _itemsTitlesArray;
}
//é¢œè‰²æ•°ç»„
- (NSArray *) colorArray {
if (!_colorArray) {
_colorArray = [NSArray arrayWithObjects:
[UIColor colorWithRed:240.0/255.0 green:89.0/255.0 blue:136.0/255.0 alpha:1.0],
[UIColor colorWithRed:0.0/255.0 green:179.0/255.0 blue:155.0/255.0 alpha:1.0],
[UIColor colorWithRed:244.0/255.0 green:131.0/255.0 blue:69.0/255.0 alpha:1.0],
[UIColor colorWithRed:241.0/255.0 green:90.0/255.0 blue:102.0/255.0 alpha:1.0],
[UIColor colorWithRed:0.0/255.0 green:179.0/255.0 blue:155.0/255.0 alpha:1.0],
[UIColor colorWithRed:255.0/255.0 green:223.0/255.0 blue:104.0/255.0 alpha:1.0],
nil];
}
return _colorArray;
}
&lt;/code>&lt;/pre>
&lt;h3 id="4æ·»åŠ é¡¶éƒ¨itemsçš„scrollview">4.æ·»åŠ é¡¶éƒ¨itemsçš„scrollView&lt;/h3>
&lt;pre>&lt;code>//æ·»åŠ ç¬¬ä¸€ä¸ªscrollview
- (void) addFirstScrollViewOnView {
//**1.è®¾ç½®é¡¶éƒ¨ç±»å‹scrollView
UIScrollView *firstScrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(0, KSTATUS_HEIGHT, KSCREEN_WIDTH, KFIRST_SCROLLVIEW_HEIGHT)];
firstScrollView.bounces = NO;//ç¦æ­¢åå¼¹
firstScrollView.showsHorizontalScrollIndicator = NO;//ç¦æ­¢æ˜¾ç¤ºæ°´å¹³æ»šåŠ¨æ¡
//è®¾ç½®scrollViewçš„å†…å®¹å¤§å°ï¼Œå®½åº¦ä¸º å®å®šä¹‰é¡¶éƒ¨æŒ‰é’®çš„å®½åº¦ ï¼Š itemsæ•°ç»„çš„æ•°é‡
firstScrollView.contentSize = CGSizeMake(self.itemsTitlesArray.count * KFIRST_SCROLLVIEW_ITEM_WIDTH, KFIRST_SCROLLVIEW_HEIGHT);
self.firstScrollView = firstScrollView;
[self.view addSubview:firstScrollView];//æ·»åŠ åˆ°self.view
//**2.ä¸ºç¬¬ä¸€ä¸ªscrollViewæ·»åŠ buttons
for (int i = 0; i &amp;lt; self.itemsTitlesArray.count; i ++) {
UIButton *itemButton = [[UIButton alloc] initWithFrame:CGRectMake(i * KFIRST_SCROLLVIEW_ITEM_WIDTH, 0, KFIRST_SCROLLVIEW_ITEM_WIDTH, KFIRST_SCROLLVIEW_HEIGHT)];//æ³¨æ„å·¦è¾¹è·çš„å†™æ³•
[itemButton setTitle:[self.itemsTitlesArray objectAtIndex:i] forState:UIControlStateNormal];//æ ‡é¢˜
itemButton.backgroundColor = [UIColor colorWithRed:0.97 green:0.97 blue:0.97 alpha:1.0];//èƒŒæ™¯é¢œè‰²
[itemButton setTitleColor:[UIColor colorWithRed:0.4 green:0.4 blue:0.4 alpha:1.0] forState:UIControlStateNormal];//æ ‡é¢˜é¢œè‰²
itemButton.titleLabel.font = [UIFont systemFontOfSize:14.0];
[firstScrollView addSubview:itemButton];//æ·»åŠ åˆ°ç¬¬ä¸€ä¸ªscrollView
//å®šä¹‰ç¬¬ä¸€ä¸ªé¡¶éƒ¨itemçš„æŒ‰é’®æ ·å¼
if (i == 0) {
itemButton.titleLabel.font = [UIFont systemFontOfSize:18.0f];
[itemButton setTitleColor:[UIColor colorWithRed:1.0 green:0.3 blue:0.3 alpha:1.0f] forState:UIControlStateNormal];
}
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="5æ·»åŠ åº•éƒ¨è¯¦æƒ…scrollview">5.æ·»åŠ åº•éƒ¨è¯¦æƒ…scrollView&lt;/h3>
&lt;pre>&lt;code>//æ·»åŠ ç¬¬äºŒä¸ªscrollview
- (void) addSecondScrollViewOnView {
//**1.è®¾ç½®åº•éƒ¨è¯¦æƒ…scrollView
UIScrollView *secondScrollView = [[UIScrollView alloc] initWithFrame:CGRectMake(0, KSTATUS_HEIGHT + KFIRST_SCROLLVIEW_HEIGHT, KSCREEN_WIDTH, KSECOND_SCROLLVIEW_HEIGHT)];
secondScrollView.pagingEnabled = YES;//åˆ†é¡µ
secondScrollView.bounces = NO;//ç¦æ­¢åå¼¹
secondScrollView.delegate = self;
//è®¾ç½®å†…å®¹å¤§å°ï¼Œå®½åº¦ä¸º å±å¹•çš„å®½åº¦ * itemsæ•°ç»„çš„æ•°é‡
secondScrollView.contentSize = CGSizeMake(self.itemsTitlesArray.count * KSCREEN_WIDTH, KSECOND_SCROLLVIEW_HEIGHT);
self.secondScrollView = secondScrollView;
[self.view addSubview:secondScrollView];
//**2.æ·»åŠ Views
for (int i = 0; i &amp;lt; self.itemsTitlesArray.count; i ++) {
UIView *bottomView = [[UIView alloc] initWithFrame:CGRectMake(i * KSCREEN_WIDTH, 0, KSCREEN_WIDTH, KSECOND_SCROLLVIEW_HEIGHT)];
bottomView.backgroundColor = [self.colorArray objectAtIndex:(i % 6)];//é¢œè‰²æ•°ç»„å–ä½™
//ä¸ºäº†æ–¹ä¾¿è§‚å¯Ÿï¼Œæ”¾ç½®ä¸€ä¸ªlabelï¼Œå¦‚æœéœ€è¦å…¶å®ƒæ§ä»¶è‡ªè¡Œæ›¿æ¢ï¼ˆå¦‚è‹¥æ–°é—»ï¼Œç”¨tableViewï¼‰
UILabel *flagLabel = [[UILabel alloc] initWithFrame:bottomView.bounds];
flagLabel.font = [UIFont systemFontOfSize:50.0f];
flagLabel.textColor = [UIColor whiteColor];
flagLabel.textAlignment = NSTextAlignmentCenter;
flagLabel.text = [NSString stringWithFormat:@&amp;quot;%@&amp;quot;, [self.itemsTitlesArray objectAtIndex:i]];
[bottomView addSubview:flagLabel];
[secondScrollView addSubview:bottomView];
}
}
&lt;/code>&lt;/pre>
&lt;h3 id="6åœ¨-voidviewdidloadæ–¹æ³•ä¸­è°ƒç”¨ä¸¤ä¸ªæ·»åŠ scrollviewçš„æ–¹æ³•">6.åœ¨-(void)viewDidLoadæ–¹æ³•ä¸­è°ƒç”¨ä¸¤ä¸ªæ·»åŠ scrollViewçš„æ–¹æ³•&lt;/h3>
&lt;pre>&lt;code>- (void)viewDidLoad {
[super viewDidLoad];
[self addFirstScrollViewOnView];//æ·»åŠ é¡¶éƒ¨itemsçš„scrollView
[self addSecondScrollViewOnView];//æ·»åŠ åº•éƒ¨è¯¦æƒ…çš„scrollView
}
&lt;/code>&lt;/pre>
&lt;h3 id="7å£°æ˜">7.å£°æ˜&lt;/h3>
&lt;p>æœ¬æ–‡æ¶‰åŠçš„ä¸€åˆ‡ä»£ç ï¼Œéƒ½å°†ä¸Šä¼ åˆ°æˆ‘çš„githubä»“åº“:&lt;a href="https://github.com/Gitzhaoyang/iOSWithOC/tree/master/twoScrollViewLinkage">https://github.com/Gitzhaoyang/iOSWithOC/tree/master/twoScrollViewLinkage&lt;/a>ï¼Œè¯·è‡ªè¡ŒæŸ¥çœ‹ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>UIImageViewæ›´æ¢å›¾ç‰‡æ—¶æ¸éšæ¸ç°</title><link>https://h1z3y3.me/posts/uiimageview-image-fade-out/</link><guid isPermaLink="true">https://h1z3y3.me/posts/uiimageview-image-fade-out/</guid><pubDate>Mon, 02 Nov 2015 11:47:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>å®ç°åŸç†ååˆ†ç®€å•ï¼Œä½¿ç”¨UIImageViewçš„é€æ˜åº¦å³å¯ã€‚ç„¶ååœ¨åŠ¨ç”»ä¸­å®Œæˆã€‚
alpha = 1 ä¸ºå…¨é€æ˜ã€‚
è¿è¡Œå›¾ä¾‹ï¼š&lt;/p>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t0150836f31829840e4.gif" alt="UIImageView-image-fade-out">&lt;/p>
&lt;p>å®ç°ä»£ç :&lt;/p>
&lt;pre>&lt;code>//å›¾ç‰‡æ¸éšæ¸ç°
self.backgroundView.alpha = 0.7;
[UIView animateWithDuration:0.5 animations:^{
self.backgroundView.alpha = 1;
self.backgroundView.image = [UIImage imageNamed:@&amp;quot;weather_bg_02.jpg&amp;quot;];
}];
&lt;/code>&lt;/pre>
&lt;hr>
&lt;p>åæ¥æˆ‘çŸ¥é“äº†å¯ä»¥ç”¨æ›´å¥½çš„æ–¹æ³•å®ç°ï¼Œ åç»­ä¼šæœ‰æ›´æ–°&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>UITabBarControlleråµŒå¥—UINavigationControlleråï¼Œå…³äºtabBarçš„é—®é¢˜ä»¥åŠè§£å†³æ–¹æ³•</title><link>https://h1z3y3.me/posts/how-to-use-sethidebottombarwhenpushed/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-use-sethidebottombarwhenpushed/</guid><pubDate>Sat, 24 Oct 2015 20:03:13 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä¸€å¼€å§‹è‡ªå·±å°†tabBarå…¨éƒ¨è‡ªå®šä¹‰ï¼Œå°†ç³»ç»Ÿtabbarè®¾ç½®ä¸º&lt;code>self.tabBar.hidden=YES&lt;/code>ï¼Œéšè—ç³»ç»Ÿçš„tabbarã€‚ä½†æ˜¯è‡ªå®šä¹‰çš„tabbaråœ¨pushå‡ºæ–°é¡µé¢çš„æ—¶å€™ï¼Œtabbarå¹¶ä¸ä¼šè‡ªåŠ¨éšè—ã€‚ä¹‹ååœ¨æ–°é¡µé¢&lt;code>viewWillAppear&lt;/code>ä¸­è®¾ç½®è‡ªåŠ¨éšè—ï¼Œä½†æ˜¯popå›ä¹‹å‰é¡µé¢ï¼ˆåœ¨&lt;code>viewDidAppear&lt;/code>ä¸­è®¾ç½®tabbaræ˜¾ç¤ºï¼‰åˆå‡ºç°ä¸èƒ½åŠæ—¶å‡ºç°ï¼Œä¼šæœ‰æ—¶é—´å»¶è¿Ÿï¼Œçœ‹ä¸Šå»ç‰¹åˆ«ä¸èˆ’æœã€‚è€Œä¸”ï¼Œè¾¹ç¼˜è¿”å›æ—§é¡µé¢çš„æ—¶å€™ä¸èƒ½åŠæ—¶æ˜¾ç¤ºtabbarä¹Ÿï¼Œæ‰€ä»¥æ‰“ç®—ç”¨ç³»ç»Ÿé»˜è®¤çš„tabbarã€‚è®°å½•ä¸‹&lt;strong>ç³»ç»ŸtabBar&lt;/strong>æ ·å¼çš„ç®€å•å®šä¹‰ã€‚&lt;/p>
&lt;h2 id="ç®€å•è‡ªå®šä¹‰ç³»ç»Ÿçš„tabbar">ç®€å•è‡ªå®šä¹‰ç³»ç»Ÿçš„tabBar&lt;/h2>
&lt;pre>&lt;code>- (void) initTabBarView {
NSArray *titles = @[@&amp;quot;å·¥å¤§å¨æµ·&amp;quot;, @&amp;quot;æ ¡å›­åº”ç”¨&amp;quot;, @&amp;quot;æ ¡å›­ç”Ÿæ´»&amp;quot;, @&amp;quot;æ›´å¤šåŠŸèƒ½&amp;quot;];
//tabBarItemé€‰ä¸­å›¾ç‰‡ç®€å•é¢œè‰²å˜åŒ–æ—¶ï¼Œè‡ªå®šä¹‰é€‰ä¸­åçš„é¢œè‰²
[self.tabBar setTintColor:[UIColor redColor]];
int i = 0;
for (UITabBarItem *item in self.tabBar.items) {
//è‡ªå®šä¹‰tabBarItemçš„å›¾ç‰‡
item.image = [[UIImage imageNamed:
[NSString stringWithFormat:@&amp;quot;home_tab_icon_%d&amp;quot;, i + 1]] imageWithRenderingMode:UIImageRenderingModeAutomatic];
//å®šä¹‰é€‰ä¸­å›¾ç‰‡,ä¸Šé¢imageWithRederingModeè®¾ç½®ä¸ºAutomaticï¼Œåªæ˜¯ç®€å•é¢œè‰²å˜æ¢ï¼Œä¸éœ€è¦è®¾ç½®,ä¸å†èµ˜è¿°
//item.selectedImage = ....
//è®¾ç½®tabBarItemçš„æ ‡é¢˜
item.title = titles[i];
i ++;
}
}
&lt;/code>&lt;/pre>
&lt;p>è¿™æ˜¯è¿è¡Œåçš„æ ·å¼ï¼š&lt;/p>
&lt;p>&lt;img src="https://p0.ssl.qhimg.com/t01dc370efcf696663c.jpg" alt="æ ·å¼">&lt;/p>
&lt;h2 id="pushæ–°é¡µé¢tabbarè‡ªåŠ¨éšè—popå›æ˜¾ç¤ºtabbar">pushæ–°é¡µé¢tabBarè‡ªåŠ¨éšè—ï¼Œpopå›æ˜¾ç¤ºtabBar&lt;/h2>
&lt;p>ä¸Šé¢è¯´å¦‚æœç”¨å®Œå…¨è‡ªå®šä¹‰çš„tabbarï¼Œæˆ‘åªèƒ½è®¾ç½®åˆ°ç­‰popå›çš„é¡µé¢å…¨éƒ¨å‡ºç°ä¹‹åå†è®©tabBaræ˜¾ç¤ºå‡ºæ¥ï¼Œè¿™æ ·ååˆ†ä¸å‹å¥½ï¼Œæˆ‘ä»¬å¦‚æœå®ç°æ‰‹æœºå¾®ä¿¡ç±»ä¼¼è¿™æ ·çš„æ•ˆæœæˆ‘ä»¬åº”è¯¥å¦‚ä½•è®¾ç½®å‘¢ï¼Ÿæ³¨æ„çº¢æ¡†éƒ¨åˆ†&lt;/p>
&lt;p>&lt;img src="https://p5.ssl.qhimg.com/t01b76fc70985541e13.jpg" alt="å¾®ä¿¡è¾¹ç¼˜æ‹–åŠ¨è¿”å›æ—¶é¡µé¢æ¼”ç¤º">&lt;/p>
&lt;p>æˆ‘ä»¬åº”è¯¥åœ¨&lt;strong>è¦pushå‡ºæ–°é¡µé¢çš„é‚£ä¸ªé¡µé¢&lt;/strong>è®¾ç½®&lt;code>viewDidAppear&lt;/code>å’Œ&lt;code>viewWillDisappear&lt;/code>æ–¹æ³•ï¼š&lt;/p>
&lt;pre>&lt;code>- (void) viewDidAppear:(BOOL)animated {
[super viewWillAppear:animated];
[self setHidesBottomBarWhenPushed:YES];
}
- (void) viewWillDisappear:(BOOL)animated {
[self setHidesBottomBarWhenPushed:NO];
[super viewDidDisappear:animated];
}
&lt;/code>&lt;/pre>
&lt;p>è¾¹ç¼˜æ‹–åŠ¨è¿”å›çš„æ—¶å€™ï¼Œå³å¯å®ç°å¦‚ä¸‹æ•ˆæœï¼š&lt;/p>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t01485a1ce59a7eb0e7.jpg" alt="æˆ‘æƒ³è¦çš„æ•ˆæœ">&lt;/p>
&lt;p>å®Œæˆ~ ğŸ˜ğŸ˜ğŸ˜&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>UIImageView ä¸­å›¾ç‰‡çš„å‡ ç§å¸¸ç”¨é€‚åº”æ–¹å¼</title><link>https://h1z3y3.me/posts/some-uiimageview-fit-way/</link><guid isPermaLink="true">https://h1z3y3.me/posts/some-uiimageview-fit-way/</guid><pubDate>Thu, 22 Oct 2015 22:17:46 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>UIImageViewä¸‰ç§contentModeåŒºåˆ«ï¼šUIViewContentModeScaleToFillã€UIViewContentModeScaleAspectFitã€UIViewContentModeScaleAspectFill&lt;/p>
&lt;h4 id="åŸå›¾ç‰‡">åŸå›¾ç‰‡ï¼š&lt;/h4>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t01c8ac21fc4f18715d.jpg" alt="åŸå›¾ç‰‡">&lt;/p>
&lt;h4 id="uiviewcontentmodescaletofill">UIViewContentModeScaleToFillï¼š&lt;/h4>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t0157f3fc5b7fd29c70.jpg" alt="UIViewContentModeScaleToFill">&lt;/p>
&lt;h4 id="uiviewcontentmodescaleaspectfit">UIViewContentModeScaleAspectFit&lt;/h4>
&lt;p>&lt;img src="https://p5.ssl.qhimg.com/t012f3e198e9b2c975b.jpg" alt="UIViewContentModeScaleAspectFit">&lt;/p>
&lt;h4 id="uiviewcontentmodescaleaspectfill">UIViewContentModeScaleAspectFill&lt;/h4>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t01aa70bb092dd21b14.jpg" alt="UIViewContentModeScaleAspectFill">&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>tableView ä¸¤ç§é‡ç”¨cellçš„æ–¹æ³•åŒºåˆ«</title><link>https://h1z3y3.me/posts/two-methods-to-reuse-cell/</link><guid isPermaLink="true">https://h1z3y3.me/posts/two-methods-to-reuse-cell/</guid><pubDate>Sun, 18 Oct 2015 16:21:04 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ä»Šå¤©åœ¨å­¦ä¹ iOSå¼€å‘çš„æ—¶å€™ï¼Œå¶ç„¶å‘ç°tableViewæœ‰ä¸¤ç§é‡ç”¨cellçš„æ–¹æ³•ã€‚å…ˆæ•´ç†ä¸€ä¸‹æ–¹ä¾¿æ—¥åæŸ¥é˜…ã€‚&lt;/p>
&lt;p>ç¬¬ä¸€ç§ï¼š&lt;code>[tableView dequeueReusableCellWithIdentifier:identifier]&lt;/code> ï¼ˆSDK 6.0ä¹‹å‰ï¼‰&lt;br>
ç¬¬äºŒç§ï¼š&lt;code>[tableView dequeueReusableCellWithIdentifier:identifier forIndexPath:indexPath]]&lt;/code> ï¼ˆSDK 6.0ä¹‹åï¼‰&lt;/p>
&lt;p>åŒºåˆ«ï¼š
ç¬¬ä¸€ç§ï¼šå¿…é¡»åˆ¤æ–­cellæ˜¯å¦å®šä¹‰ï¼Œæœªå®šä¹‰åˆ™æ‰‹åŠ¨åˆ›å»ºï¼Œä»£ç å¦‚ä¸‹ï¼š&lt;/p>
&lt;pre>&lt;code>const NSString *identifier = @&amp;quot;cell&amp;quot;;
UITableView *cell = [tableView dequeueReusableCellWithIndetifier:identifier];
if(!cell) {
cell = [[UITableView alloc] initWithStyle:UITableViewCellStyleDefault];
}
/*
è®¾ç½®cell
cell.textLable.text = @&amp;quot;ç¬¬...è¡Œ&amp;quot;;
*/
return cell;
&lt;/code>&lt;/pre>
&lt;p>ç¬¬äºŒç§æ˜¯SDK 6.0å¼€å§‹æ–°æ·»åŠ çš„æ–¹æ³•ã€‚ç”¨äºä½ &lt;strong>å·²ç»ç”¨Nibå®šä¹‰äº†ä¸€ä¸ªCell&lt;/strong>ï¼Œç„¶åå°±å¯ä»¥çœä¸‹ä¸Šé¢é‚£äº›ä»£ç ï¼Œåªç”¨ä¸€è¡Œå°±å¯ä»¥è§£å†³ï¼š&lt;/p>
&lt;pre>&lt;code> UITableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:@&amp;quot;cell&amp;quot; forIndexPath:indexPath];
/*
è®¾ç½®cell
cell.textLable.text = @&amp;quot;ç¬¬...è¡Œ&amp;quot;;
*/
&lt;/code>&lt;/pre>
&lt;p>æ‰€ä»¥å¦‚æœæœ‰è¿™ä¸ªé”™è¯¯ï¼š&lt;/p>
&lt;pre>&lt;code>reason: 'unable to dequeue a cell with identifier friendCell - must register a nib or a class for the identifier or connect a prototype cell in a storyboard'
&lt;/code>&lt;/pre>
&lt;p>åº”è¯¥æƒ³ä¸€ä¸‹è‡ªå·±&lt;strong>æ˜¯ä¸æ˜¯ä¸ºcellåˆ›å»ºçš„Nib&lt;/strong>ã€‚&lt;/p></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>MarkDownåŸºæœ¬ä½¿ç”¨æ–¹æ³•</title><link>https://h1z3y3.me/posts/markdown-base-use/</link><guid isPermaLink="true">https://h1z3y3.me/posts/markdown-base-use/</guid><pubDate>Sat, 17 Oct 2015 18:31:15 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h2 id="markdown-ä»‹ç»">Markdown ä»‹ç»&lt;/h2>
&lt;blockquote>
&lt;p>Markdownæ˜¯ä¸€ç§å¯ä»¥ä½¿ç”¨æ™®é€šæ–‡æœ¬ç¼–è¾‘å™¨ç¼–å†™çš„&lt;strong>æ ‡è®°è¯­è¨€&lt;/strong>ï¼Œé€šè¿‡ç®€å•çš„æ ‡è®°è¯­æ³•ï¼Œå®ƒå¯ä»¥ä½¿æ™®é€šæ–‡æœ¬å†…å®¹å…·æœ‰ä¸€å®šçš„æ ¼å¼ã€‚Markdownçš„ä½¿ç”¨ååˆ†ç®€å•ï¼Œå¸¸ç”¨çš„&lt;strong>æ ‡è®°&lt;/strong>å…¶å®å°±åå‡ ä¸ªï¼Œæ‰€ä»¥ç›¸å¯¹äºHTMLè¿™ç§å¤æ‚çš„æ ‡è®°è¯­è¨€æ¥è¯´ï¼ŒMarkdownæ˜¯ååˆ†è½»é‡çš„æ ‡è®°è¯­è¨€ã€‚&lt;/p>
&lt;/blockquote>
&lt;h2 id="markdownçš„åŸºæœ¬ä½¿ç”¨">Markdownçš„åŸºæœ¬ä½¿ç”¨&lt;/h2>
&lt;ol>
&lt;li>
&lt;h3 id="åŠ ç²—å’Œæ–œä½“">åŠ ç²—å’Œæ–œä½“&lt;/h3>
&lt;p>&lt;code>*æ–œä½“* _æ–œä½“_&lt;/code>&lt;/p>
&lt;p>åªè¦ç”¨ä¸€ä¸ª&lt;code>_&lt;/code>æˆ–è€…ä¸€ä¸ª&lt;code>#&lt;/code>åŒ…è£¹æ–‡å­—ï¼Œå³å¯å®ç°æ–‡å­—æ–œä½“ã€‚&lt;/p>
&lt;p>&lt;code>**åŠ ç²—æ–‡å­—** __åŠ ç²—æ–‡å­—__&lt;/code>&lt;/p>
&lt;p>åªè¦ç”¨ä¸¤ä¸ª&lt;code>_&lt;/code>æˆ–è€…ä¸¤ä¸ª&lt;code>#&lt;/code>åŒ…è£¹æ–‡å­—ï¼Œå³å¯å®ç°æ–‡å­—ç²—ä½“ã€‚&lt;/p>
&lt;p>&lt;img src="https://p5.ssl.qhimg.com/t014be129baf06de9da.jpg" alt="ç²—ä½“å’Œæ–œä½“">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="é“¾æ¥ä¸å›¾ç‰‡">é“¾æ¥ä¸å›¾ç‰‡&lt;/h3>
&lt;p>æ’å…¥é“¾æ¥å’Œå›¾ç‰‡çš„æ ¼å¼å¾ˆç›¸ä¼¼ï¼Œåªæœ‰ä¸€ä¸ª&lt;code>!&lt;/code>çš„åŒºåˆ«&lt;/p>
&lt;p>é“¾æ¥æ ¼å¼ä¸ºï¼š&lt;code>[é“¾æ¥æ–‡å­—](é“¾æ¥åœ°å€)&lt;/code>&lt;/p>
&lt;p>å›¾ç‰‡æ ¼å¼ä¸ºï¼š&lt;code>![å›¾ç‰‡åå­—](å›¾ç‰‡åœ°å€)&lt;/code>&lt;/p>
&lt;p>åœ¨Markdownä¸­æ’å…¥å›¾ç‰‡åœ°å€è¦ç”¨åˆ°å›¾åºŠï¼Œæˆ‘ç”¨åˆ°çš„æ˜¯&lt;a href="http://weibotuchuang.sinaapp.com">å›´è„–å›¾åºŠä¿®å¤è®¡åˆ’&lt;/a>å’Œ&lt;a href="http://www.pic100.net">äº‘å›¾å›¾åºŠ&lt;/a>ï¼Œä¸Šä¼ å›¾ç‰‡å°±å¯ä»¥ç”ŸæˆURL&lt;/p>
&lt;p>&lt;img src="https://p0.ssl.qhimg.com/t01846fd89958a14640.jpg" alt="é“¾æ¥å’Œå›¾ç‰‡">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="æ ‡é¢˜">æ ‡é¢˜&lt;/h3>
&lt;p>æ ‡é¢˜æ˜¯æ–‡ç« ä¸­æœ€å¸¸ç”¨çš„æ–‡æœ¬æ ¼å¼ï¼Œåœ¨Markdownä¸­åªè¦åœ¨ä¸€è¡Œæ–‡å­—å‰æ·»åŠ &lt;code>#&lt;/code>ï¼Œå³å¯æ ‡è®°ä¸ºæ ‡é¢˜æ ¼å¼ã€‚&lt;/p>
&lt;p>&lt;code>ï¼ƒ ä¸€çº§æ ‡é¢˜&lt;/code>&lt;/p>
&lt;p>&lt;code>## äºŒçº§æ ‡é¢˜&lt;/code>&lt;/p>
&lt;p>&lt;code>### ä¸‰çº§æ ‡é¢˜&lt;/code>&lt;/p>
&lt;p>ä»¥æ­¤ç±»æ¨ï¼ŒMarkdownä¸€å…±æœ‰å…­çº§æ ‡é¢˜ï¼Œå…­çº§æ ‡é¢˜åªéœ€è¦åŠ ä¸Šå…­ä¸ª&lt;code>######&lt;/code>å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://p0.ssl.qhimg.com/t013492ed250532d583.jpg" alt="æ ‡é¢˜">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="åˆ—è¡¨">åˆ—è¡¨&lt;/h3>
&lt;p>åˆ—è¡¨æœ‰&lt;strong>æœ‰åºåˆ—è¡¨&lt;/strong>å’Œ&lt;strong>æ— åºåˆ—è¡¨&lt;/strong>&lt;/p>
&lt;p>æœ‰åºåˆ—è¡¨æ ¼å¼ï¼š&lt;/p>
&lt;pre>&lt;code> 1. çº¢è‰²
2. è“è‰²
3. é»‘è‰²
&lt;/code>&lt;/pre>
&lt;p>æ— åºåˆ—è¡¨æ ¼å¼ï¼š&lt;/p>
&lt;pre>&lt;code> * çº¢è‰²
* è“è‰²
* é»‘è‰²
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://p4.ssl.qhimg.com/t012e847b97fdfde44f.jpg" alt="åˆ—è¡¨">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="å¼•ç”¨">å¼•ç”¨&lt;/h3>
&lt;p>å¼•ç”¨åªéœ€è¦åœ¨æ–‡å­—å‰é¢åŠ ä¸Š &lt;code>&amp;gt;&lt;/code> å°±å¯ä»¥äº†ã€‚ä½ å¯ä»¥è”åˆå…¶å®ƒçš„æ ‡è®°ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚&lt;/p>
&lt;pre>&lt;code> &amp;gt; * å¼•ç”¨ä¸­åˆ—è¡¨
&amp;gt; * åˆ—è¡¨
&amp;gt; ### å¼•ç”¨ä¸­ä¸‰çº§æ ‡é¢˜
&amp;gt;&amp;gt; äºŒçº§å¼•ç”¨
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t0163d79fe042bb581a.jpg" alt="å¼•ç”¨">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="è¡Œå†…ä»£ç å’Œä»£ç å—">è¡Œå†…ä»£ç å’Œä»£ç å—&lt;/h3>
&lt;p>è¡Œå†…ä»£ç æ ¼å¼ï¼š &lt;code>ï½€è¿™é‡Œå†™ä»£ç ï½€&lt;/code>&lt;br>
ä»£ç å—æ ¼å¼ï¼š åªè¦æ¯”ä¸Šä¸€è¡Œè¿›è¡Œå³ç¼©è¿›å³å¯ã€‚æŒ‰é”®ç›˜&lt;code>tab&lt;/code>é”®å¯ä»¥å®ç°ç¼©è¿›&lt;/p>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t013a7cbc965a07325f.jpg" alt="è¡Œå†…ä»£ç å’Œä»£ç å—">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="è¡¨æ ¼">è¡¨æ ¼&lt;/h3>
&lt;p>è¡¨æ ¼åº”è¯¥æ˜¯Markdownä¸­æœ€éš¾çš„æ ‡è®°äº†&lt;/p>
&lt;p>æœ€ç®€å•çš„è¡¨æ ¼ï¼š&lt;/p>
&lt;pre>&lt;code> | First Header | Second Header | Third Header |
| ------------ | ------------- | ------------ |
| Content Cell | Content Cell | Content Cell |
| Content Cell | Content Cell | Content Cell |
&lt;/code>&lt;/pre>
&lt;p>ä½ ä¹Ÿå¯ä»¥è®¾ç½®æ–‡å­—çš„å¯¹é½æ–¹å¼&lt;/p>
&lt;pre>&lt;code> First Header | Second Header | Third Header
:----------- | :-----------: | -----------:
Left | Center | Right
Left | Center | Right
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://p1.ssl.qhimg.com/t017070396e44e5c1ef.jpg" alt="è¡¨æ ¼">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="æ°´å¹³åˆ†éš”çº¿">æ°´å¹³åˆ†éš”çº¿&lt;/h3>
&lt;p>ä½¿ç”¨ &lt;code>---&lt;/code> æˆ–è€… &lt;code>***&lt;/code>å³å¯ã€‚&lt;/p>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t0192d850b3c0576e4e.jpg" alt="æ°´å¹³çº¿">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="åˆ é™¤çº¿">åˆ é™¤çº¿&lt;/h3>
&lt;p>åˆ é™¤çº¿æ ¼å¼ï¼š&lt;/p>
&lt;pre>&lt;code> ~~åˆ é™¤çº¿~~
&lt;/code>&lt;/pre>
&lt;p>&lt;img src="https://p0.ssl.qhimg.com/t012a8f4294c4d33c0b.jpg" alt="åˆ é™¤çº¿">&lt;/p>
&lt;/li>
&lt;li>
&lt;h3 id="æ¢è¡Œ">æ¢è¡Œ&lt;/h3>
&lt;p>åªè¦åœ¨æ–‡å­—æ¯è¡Œæ–‡å­—åé¢åŠ ä¸Šä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„&lt;code>ç©ºæ ¼&lt;/code>å³å¯å®ç°æ¢è¡Œ&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h2 id="æ³¨æ„">æ³¨æ„&lt;/h2>
&lt;ol>
&lt;li>æ ‡è®°ç¬¦å·åé¢ä¸€å®šåŠ ä¸Š&lt;strong>ç©ºæ ¼&lt;/strong>&lt;/li>
&lt;li>æ ‡è®°è¯­è¨€å¿…é¡»ä½¿ç”¨è‹±æ–‡ç¬¦å·&lt;/li>
&lt;li>å¦‚æœä½¿ç”¨æ­£ç¡®è€Œä¸èµ·ä½œç”¨ï¼Œæ¢ä¸€è¡Œå†è¯•ä¸€æ¬¡&lt;/li>
&lt;/ol>
&lt;h2 id="markdownç¼–è¾‘å·¥å…·">Markdownç¼–è¾‘å·¥å…·&lt;/h2>
&lt;p>æœ¬äººä½¿ç”¨çš„å·¥å…·æ˜¯Mac OSä¸‹çš„&lt;strong>Mou&lt;/strong>,æ”¯æŒ&lt;strong>å®æ—¶é¢„è§ˆ&lt;/strong>ï¼Œæ–‡ç« ä¸­çš„æˆªå›¾å³ä¸ºMouçš„æˆªå›¾ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨Githubä¸Šæœç´¢å…¶å®ƒä¸»é¢˜æ ·å¼è¿›è¡Œå®‰è£…ã€‚&lt;br>
Macä¸‹Markdownç¼–è¾‘å™¨ï¼š&lt;a href="http://25.io/mou/">Mou Â¥0&lt;/a>ã€&lt;a href="http://itunes.apple.com/cn/app/byword/id482063361?mt=8">Byword Â¥40&lt;/a>ã€&lt;a href="https://itunes.apple.com/cn/app/ia-writer-pro/id775737590?mt=12">iA Writer Â¥128&lt;/a>ã€&lt;a href="https://itunes.apple.com/cn/app/ulysses-iii/id623795237?mt=12">Ulysses Â¥283&lt;/a> etc.&lt;br>
Windowsä¸‹Markdownç¼–è¾‘å™¨ï¼š&lt;a href="http://markdownpad.com/">MarkdownPad&lt;/a>ã€&lt;a href="http://markpad.fluid.impa.br/">MarkPad&lt;/a> etc.&lt;/p>
&lt;h2 id="å®˜æ–¹æ–‡æ¡£">å®˜æ–¹æ–‡æ¡£&lt;/h2>
&lt;p>&lt;a href="http://daringfireball.net/projects/markdown/syntax">è‹±æ–‡Markdownæ–‡æ¡£&lt;/a>&lt;br>
&lt;a href="http://wowubuntu.com/markdown/">ä¸­æ–‡Markdownæ–‡æ¡£&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/markdown/">Markdown</category><category domain="https://h1z3y3.me/tags/hexo/">Hexo</category></item><item><title>UIScrollViewçš„åŸºæœ¬å±æ€§è®¾ç½®å’Œå¸¸ç”¨ä»£ç†æ–¹æ³•</title><link>https://h1z3y3.me/posts/how-to-use-uiscrollviewdelegate/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-use-uiscrollviewdelegate/</guid><pubDate>Sat, 17 Oct 2015 17:54:31 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>ç½—åˆ—äº†UIscrollViewçš„ä¸€äº›åŸºæœ¬è®¾ç½®å’Œå¸¸ç”¨æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>
&lt;p>(void)viewDidLoad {
[super viewDidLoad];
// [self initScrollView];
// [self initPageCtrl];
// [self addTimer];
self.scrollView = [[UIScrollView alloc]initWithFrame:CGRectMake(10, 20, 320, 460)];
self.scrollView.backgroundColor = [UIColor blueColor];
//æ˜¯å¦æ”¯æŒæ»‘åŠ¨åˆ°æœ€é¡¶ç«¯
self.scrollView.scrollsToTop = NO;
//è®¾ç½®UIScrollViewçš„ä»£ç†
self.scrollView.delegate = self;
//è®¾ç½®å†…å®¹å¤§å°
self.scrollView.contentSize = CGSizeMake(320 * 10, 460);
//æ˜¯å¦åå¼¹
self.scrollView.bounces = NO;
//æ˜¯å¦æ»šåŠ¨
self.scrollView.scrollEnabled = YES;
//æ˜¯å¦åˆ†é¡µ
self.scrollView.pagingEnabled = NO;
//è®¾ç½®indecatoré£æ ¼
self.scrollView.indicatorStyle = UIScrollViewIndicatorStyleWhite;
//è®¾ç½®å†…å®¹è¾¹ç¼˜å’ŒIndicatorè¾¹ç¼˜
self.scrollView.contentInset = UIEdgeInsetsMake(0, 50, 50, 0);
self.scrollView.scrollIndicatorInsets = UIEdgeInsetsMake(0, 50, 0, 0);
//æ˜¯å¦åŒæ—¶è¿åŠ¨
self.scrollView.directionalLockEnabled = NO;&lt;/p>
&lt;pre>&lt;code> [self.view addSubview:self.scrollView];
&lt;/code>&lt;/pre>
&lt;p>}&lt;/p>
&lt;p>//æ˜¯å¦æ”¯æŒæ»‘åŠ¨åˆ°é¡¶éƒ¨&lt;/p>
&lt;ul>
&lt;li>(BOOL) scrollViewShouldScrollToTop:(UIScrollView *)scrollView {
return YES;
}&lt;/li>
&lt;/ul>
&lt;p>//æ»‘åŠ¨åˆ°é¡¶éƒ¨æ—¶è°ƒç”¨è¯¥æ–¹æ³•&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewDidScrollToTop:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;æ»‘åŠ¨åˆ°é¡¶éƒ¨äº†&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//å·²ç»æ»‘åŠ¨(æ­£åœ¨æ»‘åŠ¨ä¹Ÿä¼šè°ƒç”¨è¯¥æ–¹æ³•)&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewDidScroll:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;å·²ç»å¼€å§‹æ»‘åŠ¨&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//å¼€å§‹æ‹–åŠ¨&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewWillBeginDragging:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;å¼€å§‹æ‹–åŠ¨&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//ç»“æŸæ‹–åŠ¨&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate {
NSLog(@&amp;ldquo;ç»“æŸæ‹–åŠ¨&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//å¼€å§‹å‡é€Ÿ&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewWillBeginDecelerating:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;å¼€å§‹å‡é€Ÿ&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//å‡é€Ÿåœæ­¢&lt;/p>
&lt;ul>
&lt;li>(void) scrollViewDidEndDecelerating:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;å‡é€Ÿåœæ­¢&amp;rdquo;);
}&lt;/li>
&lt;/ul>
&lt;p>//ç»“æŸæ»šåŠ¨åŠ¨ç”»&lt;/p>
&lt;ul>
&lt;li>
&lt;p>(void) scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView {
NSLog(@&amp;ldquo;ç»“æŸæ»šåŠ¨åŠ¨ç”»&amp;rdquo;);
}&lt;/p>
&lt;/li>
&lt;li>
&lt;p>(void)didReceiveMemoryWarning {
[super didReceiveMemoryWarning];
// Dispose of any resources that can be recreated.
}&lt;/p>
&lt;/li>
&lt;/ul>
&lt;/li>
&lt;/ul></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>å‡½æ•°respondsToSelectorçš„ä½¿ç”¨</title><link>https://h1z3y3.me/posts/how-to-use-founction-respondstoselector/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-use-founction-respondstoselector/</guid><pubDate>Thu, 15 Oct 2015 00:44:48 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>-(BOOL)respondsToSelector: selector
//ç”¨æ¥åˆ¤æ–­æ˜¯å¦æœ‰ä»¥æŸä¸ªåå­—å‘½åçš„æ–¹æ³•ï¼ˆè¢«å°è£…åœ¨ä¸€ä¸ªselectorçš„å¯¹è±¡é‡Œä¼ é€’ï¼‰&lt;/p>
&lt;hr>
&lt;pre>&lt;code>@protocol appViewDelegate &amp;lt;NSObject&amp;gt;
@optional
- (void) theButtonOnClicked:(UIButton *)button;
@end
&lt;/code>&lt;/pre>
&lt;hr>
&lt;pre>&lt;code>if([self.delegate respondsToSelector:@selector(theButtonOnClicked:)]) {
self.delegate theButtonOnClicked:sender;
}
&lt;/code>&lt;/pre>
&lt;hr>
&lt;pre>&lt;code>#pragma mark - appViewDelegate
- (void) theButtonOnClicked:(UIButton *)button {
button.enabled = NO;
[]button setTitle:@&amp;quot;å·²ä¸‹è½½&amp;quot; ForState:UIControlStateDisabled];
}
&lt;/code>&lt;/pre>
&lt;hr></description><category domain="https://h1z3y3.me/tags/ios/">IOS</category></item><item><title>åœ¨Githubä¸Šé¢æ­å»ºHexoåšå®¢ï¼ˆå››ï¼‰:ä½¿ç”¨ä¸åŒç”µè„‘ç»´æŠ¤</title><link>https://h1z3y3.me/posts/create-hexo-on-github-4/</link><guid isPermaLink="true">https://h1z3y3.me/posts/create-hexo-on-github-4/</guid><pubDate>Wed, 14 Oct 2015 12:13:01 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>è¿™ä¸€ç¯‡æ˜¯æœ¬ç³»åˆ—çš„æœ€åä¸€ç¯‡ï¼Œåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æ­å»ºçš„Hexoåšå®¢å·²ç»èƒ½æ»¡è¶³æˆ‘ä»¬æ—¥å¸¸çš„éœ€æ±‚ã€‚å¯æ˜¯æœ‰æ²¡æœ‰æƒ³è¿‡æˆ‘ä»¬å…¶å®åªèƒ½åœ¨è¿™ä¸€å°ç”µè„‘ä¸Šæ›´æ–°æˆ‘ä»¬çš„åšå®¢ï¼Ÿå¦‚æœæœ‰ä¸€å¤©æˆ‘æ¢äº†ä¸€å°ç”µè„‘ï¼Œæˆ–è€…å…¬å¸å’Œå®¶é‡Œä¸åŒçš„ç”µè„‘éƒ½æƒ³æ›´æ–°åšå®¢ï¼Œåº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ&lt;/p>
&lt;p>è¿™é‡Œåªç»™ç±»ä¼¼æˆ‘è¿™æ ·çš„gitæ–°äººåšå‚è€ƒï¼Œgitçš„å¾ˆå¤šç”¨æ³•æˆ‘ä¹Ÿä¸å¤ªç†Ÿç»ƒã€‚å¦‚æœæœ‰é”™è¯¯è¿˜è¯·å„ä½æŒ‡æ­£ã€‚&lt;/p>
&lt;p>Note: &lt;strong>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå½“æˆ‘ä»¬æ‰§è¡Œ&lt;code>$ hexo deploy&lt;/code>ï¼Œéƒ¨ç½²åˆ°&lt;a href="https://github.com">Github&lt;/a>
ä¸Šé¢çš„æ˜¯hexoç»™æˆ‘ä»¬ç”Ÿæˆçš„é™æ€é¡µé¢ï¼Œå¹¶ä¸æ˜¯æ•´ä¸ªhexoåšå®¢å·¥ç¨‹æ–‡ä»¶ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç®€å•çš„åœ¨ä¸åŒPCçš„æ›´æ–°åšå®¢ã€‚&lt;/strong>&lt;/p>
&lt;p>å…¶å®æœ‰ä¸¤ç§åŠæ³•ï¼Œç¬¬ä¸€å°±æ˜¯**_æŠŠæ•´ä¸ªç›®å½•å¤‡ä»½åˆ°äº‘ç›˜_**ï¼Œç„¶åå¼€å¯äº‘ç›˜åŒæ­¥è¯¥æ–‡ä»¶å¤¹ï¼Œè™½ç„¶æ“ä½œç®€å•ï¼Œä½†æ˜¯åŒæ­¥å¾ˆéº»çƒ¦ï¼Œéœ€è¦æ‰‹åŠ¨å°†æ–‡ä»¶å¤¹è¿›è¡Œè¦†ç›–ã€‚ç¬¬äºŒç§å°±æ˜¯**_ä½¿ç”¨Gitçš„ç¬¬ä¸‰æ–¹æœåŠ¡_**
ï¼Œåªè¦é…ç½®å®Œæˆï¼Œä¸ç®¡åˆ°å“ªé‡Œï¼Œç”¨å“ªå°ç”µè„‘éƒ½èƒ½ç®€å•å®ç°æ›´æ–°åšå®¢ï¼ˆå½“ç„¶éœ€è¦Node.jså’ŒGitè¿è¡Œç¯å¢ƒï¼Œåœ¨æˆ‘ä»¬&lt;a href="https://h1z3y3.me/2015/10/12/create-hexo-on-github-1/">æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡&lt;/a>æœ‰è®²è§£ï¼‰ã€‚&lt;/p>
&lt;p>åœ¨æœ¬æ–‡ä¸­è¯¦ç»†è®²è§£å¦‚ä½•ä½¿ç”¨ç¬¬ä¸‰æ–¹gitæœåŠ¡è¿›è¡Œåšå®¢çš„å¤‡ä»½ã€‚å¯ä»¥&lt;a href="https://github.com">Github&lt;/a>æ”¾åœ¨å…±æœ‰ä»“åº“ï¼Œå¦‚æœä½ æ‹…å¿ƒæ³„å¯†ï¼Œå¯ä»¥ç”¨&lt;a href="https://github.com">Github&lt;/a>
çš„ç§æœ‰ä»“åº“ï¼ˆæ”¶è´¹ï¼‰ï¼Œå›½å†…é™¤äº†&lt;a href="https://github.com">Github&lt;/a>
è¿˜æœ‰è®¸å¤šçŸ¥åçš„gitæœåŠ¡å•†ï¼Œå¦‚ï¼šgitcafeï¼Œbitbucketï¼Œoschinaï¼Œcodingç­‰ï¼Œæ®æˆ‘äº†è§£ï¼Œoschinaçš„ç§æœ‰ä»“åº“æ˜¯å…è´¹çš„ï¼Œè€Œä¸”å¯ä»¥å’Œ&lt;a href="https://github.com">Github&lt;/a>
è¿›è¡ŒåŒæ­¥ã€‚å› ä¸ºæˆ‘ä»¬çš„åšå®¢æ”¾åœ¨äº†&lt;a href="https://github.com">Github&lt;/a>ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¦¨å°±æŠŠæˆ‘ä»¬åšå®¢ç¨‹åºä¹ŸåŒæ­¥åˆ°&lt;a href="https://github.com">Github&lt;/a>çš„ä»“åº“ä¸­ã€‚&lt;/p>
&lt;p>ä¸‹é¢æˆ‘ä»¬å°±æ¥è®²è§£å¦‚ä½•å®ç°ä¸åŒç”µè„‘åŒæ—¶æ›´æ–°åšå®¢ã€‚&lt;/p>
&lt;!-- more -->
&lt;h1 id="å°†æˆ‘ä»¬çš„åšå®¢ç›®å½•å¤‡ä»½åˆ°githubhttpsgithubcomå®ç°å¤špcç»´æŠ¤">å°†æˆ‘ä»¬çš„åšå®¢ç›®å½•å¤‡ä»½åˆ°&lt;a href="https://github.com">Github&lt;/a>ï¼Œå®ç°å¤šPCç»´æŠ¤&lt;/h1>
&lt;h2 id="åœ¨githubhttpsgithubcomç½‘ç«™åˆ›å»ºä¸€ä¸ªæ–°çš„repository">åœ¨&lt;a href="https://github.com">Github&lt;/a>ç½‘ç«™åˆ›å»ºä¸€ä¸ªæ–°çš„repository&lt;/h2>
&lt;p>æˆ‘ä»¬åœ¨è¿™é‡Œç»™æ–°åˆ›å»ºçš„repositoryå‘½åä¸ºblogï¼›&lt;/p>
&lt;p>ä¸ä¼šåˆ›å»ºæ–¹æ³•çš„æœ‹å‹å¯ä»¥å‚è€ƒ&lt;a href="https://h1z3y3.me/2015/10/12/create-hexo-on-github-1/">åœ¨Githubä¸Šé¢æ­å»ºHexoåšå®¢ï¼ˆä¸€ï¼‰&lt;/a>ä¸­çš„åˆ›å»ºæ–¹æ³•ã€‚&lt;/p>
&lt;h2 id="åœ¨aç”µè„‘ä¸­ä»æœ¬åœ°ä¸Šä¼ hexoåˆ°githubhttpsgithubcomä»“åº“">åœ¨Aç”µè„‘ä¸­ä»æœ¬åœ°ä¸Šä¼ Hexoåˆ°&lt;a href="https://github.com">Github&lt;/a>ä»“åº“&lt;/h2>
&lt;p>Note: &lt;strong>Aç”µè„‘æŒ‡çš„æ˜¯å»ºç«‹Hexoåšå®¢çš„ç”µè„‘ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="åˆå§‹åŒ–ä»“åº“">åˆå§‹åŒ–ä»“åº“&lt;/h2>
&lt;p>åœ¨Hexoåšå®¢çš„æ ¹ç›®å½•è¿è¡ŒGit Bashå¹¶è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git init
&amp;gt; git remote add origin &amp;lt;server address&amp;gt;
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œ&lt;code>&amp;lt;server&amp;gt;&lt;/code>æŒ‡çš„æ˜¯åœ¨çº¿ä»“åº“çš„åœ°å€ï¼Œæ¯”å¦‚åœ¨è¿™é‡Œæˆ‘çš„å°±åº”è¯¥æ˜¯&lt;code>https://github.com/Gitzhaoyang/blog.git&lt;/code>ï¼Œå¦‚æœä½ ç”¨å…¶å®ƒgitä»“åº“æœåŠ¡ï¼Œå¡«å†™å¯¹åº”ä»“åº“åœ°å€å³å¯ã€‚
&lt;code>origin&lt;/code>æ˜¯æœ¬åœ°åˆ†æ”¯,&lt;code>remote add&lt;/code>ä¼šå°†æœ¬åœ°ä»“åº“æ˜ å°„åˆ°&lt;a href="https://github.com">Github&lt;/a>ä»“åº“&lt;/p>
&lt;h2 id="æŠŠæœ¬åœ°æ–‡ä»¶åŒæ­¥åˆ°githubhttpsgithubcomä¸Šé¢">æŠŠæœ¬åœ°æ–‡ä»¶åŒæ­¥åˆ°&lt;a href="https://github.com">Github&lt;/a>ä¸Šé¢&lt;/h2>
&lt;p>åˆ†åˆ«è¾“å…¥æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git add . #æ·»åŠ æ‰€æœ‰ç›®å½•ï¼Œæ³¨æ„addåé¢æœ‰ä¸ªç‚¹`.`
&amp;gt; git commit -m &amp;quot;add to Github&amp;quot; #æ·»åŠ æäº¤è¯´æ˜ï¼Œæ¯æ¬¡æäº¤éƒ½éœ€è¦
&amp;gt; git push -u origin master #æŠŠæ›´æ–°æ¨é€åˆ°äº‘ç«¯
&lt;/code>&lt;/pre>&lt;p>è¿™æ—¶å¯ä»¥ç™»å½•&lt;a href="https://github.com">Github&lt;/a>è´¦æˆ·æŸ¥çœ‹åˆšåˆ›å»ºçš„&lt;code>blogä»“åº“&lt;/code>ä¸­æ˜¯å¦ä¸Šä¼ æˆåŠŸ&lt;/p>
&lt;p>windowså¹³å°å¯èƒ½pushè¿‡ç¨‹ä¸­ä¼šæç¤ºè¾“å…¥&lt;a href="https://github.com">Github&lt;/a>çš„ç”¨æˆ·åå’Œ&lt;a href="https://github.com">Github&lt;/a>çš„å¯†ç ï¼Œè¾“å…¥æ­£ç¡®ä¾¿æ˜¯ã€‚&lt;/p>
&lt;h3 id="æ³¨æ„">æ³¨æ„&lt;/h3>
&lt;p>ä¸ºäº†åœ¨å¦ä¸€å°ç”µè„‘ä¸Šé…ç½®æ›´åŠ æ–¹ä¾¿ï¼Œä¸¥é‡å»ºè®®æŠŠHexoåšå®¢ç›®å½•ä¸‹&lt;code>_config.yml&lt;/code>æ–‡ä»¶å¤åˆ¶ç²˜è´´ä¸€ä»½ï¼Œå¹¶é‡å‘½åä¸º&lt;code>hexo_config.yml&lt;/code>ï¼›æŠŠthemesç›®å½•ä¸‹ä½ ç”¨åˆ°ä¸»é¢˜ç›®å½•ä¸‹çš„&lt;code>_config.yml&lt;/code>
æ–‡ä»¶ä¹Ÿå¤åˆ¶ä¸€ä»½ï¼Œå¹¶ç²˜è´´åˆ°&lt;strong>åšå®¢æ ¹ç›®å½•ï¼Œæ³¨æ„ï¼Œæ˜¯&amp;rsquo;åšå®¢æ ¹ç›®å½•'&lt;/strong>ï¼Œå¹¶å‘½åä¸º&lt;code>theme_config.yml&lt;/code>ã€‚åŸå› æ˜¯æˆ‘ä»¬ä¸Šä¼ çš„æ—¶å€™ï¼Œæˆ‘ä»¬è‡ªå·±å®‰è£…çš„&lt;code>themes&lt;/code>
å¦‚ï¼š&lt;code>[NexT](http://theme-next.iissnan.com)&lt;/code>ï¼Œå®ƒçš„&lt;code>'next'&lt;/code>ç›®å½•å¹¶&lt;strong>ä¸èƒ½ä¸Šä¼ &lt;/strong>ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æŠŠè¿™ä¸¤ä¸ªé…ç½®æ–‡ä»¶éƒ½ä¿å­˜ä¸‹æ¥åœ¨è¿›è¡ŒåŒæ­¥å·¥ä½œã€‚&lt;/p>
&lt;h2 id="åœ¨bç”µè„‘ä¸­ä»githubhttpsgithubcomä»“åº“å–å›hexoåˆ°æœ¬åœ°">åœ¨Bç”µè„‘ä¸­ä»&lt;a href="https://github.com">Github&lt;/a>ä»“åº“å–å›Hexoåˆ°æœ¬åœ°&lt;/h2>
&lt;p>Note: &lt;strong>Bç”µè„‘æŒ‡çš„æ˜¯å¦ä¸€å°ç”µè„‘ï¼Œå¦‚æœæ²¡æœ‰å¦ä¸€å°ç”µè„‘ä¹Ÿå¯ä»¥æ‰¾åœ°æ–¹æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹å°è¯•ã€‚&lt;/strong>&lt;/p>
&lt;h2 id="å®‰è£…gitå’Œnodejs">å®‰è£…Gitå’ŒNode.js&lt;/h2>
&lt;p>å€¼å¾—æ³¨æ„çš„æ˜¯æ–°ç”µè„‘ä¹Ÿéœ€è¦å®‰è£…Gitå’ŒNode.jsç¯å¢ƒï¼Œå‚è€ƒ&lt;a href="https://h1z3y3.me/2015/10/12/create-hexo-on-github-1/">æœ¬ç³»åˆ—çš„ç¬¬ä¸€ç¯‡&lt;/a>ä¸­å®‰è£…æ–¹æ³•ã€‚&lt;/p>
&lt;h2 id="æŠŠæ–‡ä»¶å–å›æœ¬åœ°">æŠŠæ–‡ä»¶å–å›æœ¬åœ°&lt;/h2>
&lt;p>å®‰è£…ç¯å¢ƒå®Œæˆåï¼Œåœ¨æ–°æ–‡ä»¶å¤¹ä¸‹è¿è¡ŒGit Bashå¹¶åˆ†åˆ«æ‰§è¡Œä»¥ä¸‹å‡ æ¡å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git init $ git remote add origin &amp;lt;server&amp;gt;
&amp;gt; git fetch --all $ git reset --hard origin/master
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œ&lt;code>&amp;lt;server&amp;gt;&lt;/code>ä»ç„¶æ˜¯ä½ çš„Giuhubåœ°å€ã€‚&lt;code>fetch&lt;/code>æ˜¯å°†ä»“åº“ä¸­çš„å†…å®¹å–å‡ºæ¥ã€‚&lt;code>reset&lt;/code>åˆ™æ˜¯ä¸åšä»»ä½•åˆå¹¶ï¼ˆmergeï¼‰å¤„ç†ï¼Œç›´æ¥æŠŠå–å‡ºçš„å†…å®¹ä¿å­˜ã€‚&lt;/p>
&lt;p>è¿è¡Œå®Œ&lt;code>reset&lt;/code>åä½ ä¼šå‘ç°æ–‡ä»¶å¤¹ä¸­å°±ä¼šå‡ºç°åˆšåˆšä¸Šä¼ çš„å†…å®¹ã€‚ä½†æ˜¯é…ç½®å¹¶æ²¡æœ‰å®Œæˆï¼Œè¯·ç»§ç»­å¾€ä¸‹çœ‹ã€‚&lt;/p>
&lt;h2 id="é…ç½®æ–°çš„hexo">é…ç½®æ–°çš„Hexo&lt;/h2>
&lt;p>Note: &lt;strong>å¦‚æœæ˜¯æ–°PCï¼Œä¸è¦å¿˜è®°æˆ‘ä»¬æœ¬æœºå¹¶æ²¡æœ‰å®‰è£…Hexoåšå®¢&lt;/strong>&lt;/p>
&lt;p>é¦–å…ˆï¼Œåœ¨åˆšæ‰çš„ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ä»¥åœ¨æ–°æœºå™¨ä¸­å®‰è£…Hexo&lt;/p>
&lt;pre>&lt;code> $ npm install hexo --save
&lt;/code>&lt;/pre>&lt;p>åˆå§‹åŒ–Hexoå¹¶å®‰è£…ç›¸åº”ä¾èµ–åŒ…&lt;/p>
&lt;pre>&lt;code>&amp;gt; hexo init
&amp;gt; npm intall
&lt;/code>&lt;/pre>&lt;p>è®°å¾—åœ¨ç¬¬ä¸€ç¯‡ä¸­è®²è¿‡ï¼Œæ–°å®‰è£…çš„Hexoæ˜¯æ²¡æœ‰&lt;code>hexo-deployer-git&lt;/code>ä¾èµ–åŒ…çš„ï¼Œéœ€è¦æ‰‹åŠ¨å®‰è£…&lt;/p>
&lt;pre>&lt;code>&amp;gt; npm install hexo-deployer-git --save
&lt;/code>&lt;/pre>&lt;p>å¦‚æœä½ åœ¨Aæœºå™¨ä¸Šè®¾ç½®äº†&lt;code>è®¢é˜…ï¼ˆfeedï¼‰&lt;/code>ï¼Œé‚£ä¹ˆä½ éœ€è¦é‡æ–°çƒ§åˆ¶feedï¼Œéœ€è¦é‡æ–°å®‰è£…ä¾èµ–åŒ…ï¼Œæ²¡æœ‰è®¾ç½®feedçš„å¯ä»¥ç•¥è¿‡&lt;/p>
&lt;pre>&lt;code>&amp;gt; npm install hexo-generation-feed --save
&lt;/code>&lt;/pre>&lt;p>å®‰è£…ä¸»é¢˜ï¼Œæˆ‘åœ¨ä¸Šæ–‡ä¸­æåˆ°æ–°å®‰è£…çš„ä¸»é¢˜å¹¶ä¸èƒ½è¢«ä¸Šä¼ ï¼Œæ‰€ä»¥ä¹Ÿéœ€è¦é‡æ–°æ‰‹åŠ¨å®‰è£…(ä»¥&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>ä¸»é¢˜ä¸ºä¾‹)&lt;/p>
&lt;pre>&lt;code>&amp;gt; git clone https://github.com/iissnan/hexo-theme-next themes/next
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼š&lt;code>themes/next&lt;/code>æ˜¯&lt;strong>ä¸»é¢˜ä¿å­˜ç›®å½•&lt;/strong>ã€‚&lt;/p>
&lt;p>æˆ‘ä»¬ä¹‹å‰å¤‡ä»½çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶&lt;code>hexo_config.yml&lt;/code>å’Œ&lt;code>theme_config.yml&lt;/code>æœ‰ç”¨äº†,&lt;code>hexo_config.yml&lt;/code>é‡å‘½åä¸º&lt;code>_config.yml&lt;/code>
è¦†ç›–æ ¹ç›®å½•ä¸‹çš„åŒåæ–‡ä»¶ï¼Œè€Œ&lt;code>theme_config.yml&lt;/code>ä¹Ÿé‡å‘½åä¸º&lt;code>_config.yml&lt;/code>è¦†ç›–ä¸»é¢˜ç›®å½•ä¸‹çš„&lt;code>config.yml&lt;/code>æ–‡ä»¶ã€‚æ³¨æ„æ–‡ä»¶åå‰é¢çš„ä¸‹åˆ’çº¿'_'ã€‚&lt;/p>
&lt;p>è¾“å…¥å‘½ä»¤ &lt;code>$ hexo generate&lt;/code> å’Œå‘½ä»¤ &lt;code>$ hexo server&lt;/code> ï¼Œ
ç„¶ååœ¨æµè§ˆå™¨è¾“å…¥ &lt;code>localhost:4000&lt;/code> ä¸­è¿›è¡Œé¢„è§ˆã€‚
å¦‚æœæ²¡æœ‰é—®é¢˜é‚£ä¹ˆæˆ‘ä»¬åœ¨Bç”µè„‘ä¸Šå°±é…ç½®æˆåŠŸäº†ã€‚&lt;/p>
&lt;h2 id="åœ¨bç”µè„‘ä¸Šæ›´æ–°åšå®¢">åœ¨Bç”µè„‘ä¸Šæ›´æ–°åšå®¢&lt;/h2>
&lt;p>ç°åœ¨åœ¨Bç”µè„‘ä¸Šä¹Ÿå¯ä»¥åƒåœ¨Aç”µè„‘ä¸Šä¸€æ ·æ›´æ–°åšå®¢äº†ï¼ŒåŒæ ·æ˜¯&lt;code>$ hexo new post &amp;quot;my_new_post&amp;quot;&lt;/code>
ç¼–è¾‘å®Œæ–‡ç« ï¼Œç„¶åæ‰§è¡Œ&lt;code>$ hexo generate&lt;/code>å’Œ&lt;code>$ hexo deploy&lt;/code>å°±å¯ä»¥æˆåŠŸå‘è¡¨äº†ã€‚
è¿™é‡Œ&lt;code>$ hexo deploy&lt;/code>å‘½ä»¤æ˜¯å°†æˆ‘ä»¬çš„åšå®¢æ–‡ç« å‘è¡¨åˆ°æˆ‘ä»¬çš„&lt;a href="https://github.com">Github&lt;/a>
ä¸Šçš„Hexoåšå®¢ï¼Œå¹¶ä¸æ˜¯å‰æ–‡æ–°å»ºçš„&lt;code>blogä»“åº“&lt;/code>ï¼Œæ–°å»ºçš„&lt;code>blogä»“åº“&lt;/code>ç”¨æ¥ä¿å­˜æˆ‘ä»¬çš„Hexoç¨‹åºã€‚&lt;/p>
&lt;h2 id="æŠŠbç”µè„‘ä¸Šçš„hexoä»æœ¬åœ°åŒæ­¥åˆ°githubhttpsgithubcomä»“åº“">æŠŠBç”µè„‘ä¸Šçš„Hexoä»æœ¬åœ°åŒæ­¥åˆ°&lt;a href="https://github.com">Github&lt;/a>ä»“åº“&lt;/h2>
&lt;p>å½“å‘è¡¨å®Œæ–‡ç« ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æŠŠHexoç¨‹åºåŒæ­¥åˆ°æˆ‘ä»¬&lt;a href="https://github.com">Github&lt;/a>çš„&lt;code>blogä»“åº“&lt;/code>ã€‚æ‰§è¡Œä¸‹é¢æŒ‡ä»¤ï¼š&lt;/p>
&lt;p>$ git add .&lt;/p>
&lt;p>è¿™æ˜¯å¯ä»¥è¾“å…¥å‘½ä»¤&lt;code>$ git status&lt;/code>æŸ¥çœ‹çŠ¶æ€ï¼Œå›æ˜¾ç¤ºåˆšæ‰ç¼–è¾‘è¿‡çš„æ–‡ä»¶çš„ä¿¡æ¯ã€‚&lt;/p>
&lt;p>ä¹‹ååˆ†åˆ«è¾“å…¥ä¸‹é¢æŒ‡ä»¤å®Œæˆä¸Šä¼ ï¼š&lt;/p>
&lt;p>$ git commit -m &amp;ldquo;commit from PC_B&amp;rdquo;
$ git push -u origin master&lt;/p>
&lt;p>æˆåŠŸåï¼Œæˆ‘ä»¬å†æ¬¡æŠŠç¨‹åºåŒæ­¥æ›´æ–°åˆ°äº†æˆ‘ä»¬çš„&lt;a href="https://github.com">Github&lt;/a>ä»“åº“&lt;code>blog&lt;/code>ã€‚ å¦‚æœå†æƒ³ç”¨Aç”µè„‘æ›´æ–°æˆ‘ä»¬çš„åšå®¢ï¼Œåªéœ€è¦åœ¨æ‰§è¡Œæ·»åŠ æ–‡ç« ä¹‹å‰å…ˆæŠŠç¨‹åºä»&lt;code>blogä»“åº“&lt;/code>æ‹‰å–ä¸‹æ¥ä¾¿å¯ã€‚è¾“å…¥å‘½ä»¤ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git pull https://github.com/Gitzhaoyang/blog.git
&lt;/code>&lt;/pre>&lt;p>å³å¯å®Œæˆã€‚&lt;/p>
&lt;h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h2>
&lt;p>æˆ‘ä»¬æ¯æ¬¡æ›´æ–°åšå®¢æ—¶ï¼Œä¸ºäº†ä¿æŒæˆ‘ä»¬æ¯æ¬¡ç”¨åˆ°çš„ç¨‹åºéƒ½æ˜¯æœ€æ–°çš„ã€‚&lt;/p>
&lt;p>æ¯æ¬¡æ›´æ–°åšå®¢ä¹‹å‰éƒ½éœ€è¦æ‰§è¡Œ&lt;code>$ git pull https://github.com/xxxx/xxx.git&lt;/code>ä¿æŒæœ¬åœ°æœ€æ–°ï¼›&lt;/p>
&lt;p>æ¯æ¬¡æ›´æ–°åšå®¢ä¹‹åéƒ½éœ€è¦æ‰§è¡Œ
&lt;code>$ git add .&lt;/code> , &lt;code>$ git commit -m &amp;quot;message&amp;quot;&lt;/code> , &lt;code>$ git push -u origin master&lt;/code>
ä»¥ä¿æŒ &lt;a href="https://github.com">Github&lt;/a> ä»“åº“ç¨‹åºæœ€æ–°ã€‚&lt;/p>
&lt;p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±èƒ½å®ç°åœ¨ä¸åŒç”µè„‘éƒ½èƒ½å¯¹æˆ‘ä»¬çš„Hexoåšå®¢è¿›è¡Œç»´æŠ¤äº†ã€‚ğŸ˜ğŸ˜˜&lt;/p></description><category domain="https://h1z3y3.me/tags/hexo/">Hexo</category><category domain="https://h1z3y3.me/tags/github/">Github</category></item><item><title>åœ¨Githubä¸Šé¢æ­å»ºHexoåšå®¢ï¼ˆä¸‰ï¼‰ï¼šæ›´æ¢Hexoä¸»é¢˜</title><link>https://h1z3y3.me/posts/create-hexo-on-github-3/</link><guid isPermaLink="true">https://h1z3y3.me/posts/create-hexo-on-github-3/</guid><pubDate>Wed, 14 Oct 2015 11:18:22 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;p>æ›´æ¢ä¸»é¢˜å¾ˆç®€å•ï¼Œé¦–å…ˆæ„Ÿè°¢&lt;a href="https://github.com/iissnan">@iissnan&lt;/a>ï¼Œå› ä¸ºåšä¸»ç”¨çš„æ˜¯&lt;a href="https://github.com/iissnan">@iissnan&lt;/a>çš„&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>ä¸»é¢˜ï¼Œæ‰€ä»¥æœ¬æ–‡å°±ä»¥&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>ä¸»é¢˜ä¸ºä¾‹è®²è§£å¦‚ä½•æ›´æ¢åšå®¢ä¸»é¢˜ã€‚åœ¨æ–‡æœ«æˆ‘ä¼šç»™å‡ºæ›´å¤šä¼˜ç§€ä¸»é¢˜çš„Githubåœ°å€ã€‚&lt;/p>
&lt;!-- more -->
&lt;h1 id="ä¸ºè‡ªå·±çš„hexoåšå®¢æ›´æ¢ä¸»é¢˜">ä¸ºè‡ªå·±çš„Hexoåšå®¢æ›´æ¢ä¸»é¢˜&lt;/h1>
&lt;p>æˆ‘è¿™é‡Œè®²åˆ°çš„ä¹Ÿæ˜¯å‚è€ƒäº†&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>ä¸»é¢˜ä½œè€…çš„&lt;a href="http://theme-next.iissnan.com">ä½¿ç”¨æ–‡æ¡£&lt;/a>ï¼Œæ›´è¯¦ç»†çš„è®¾ç½®è¯»è€…ä»¬å¯ä»¥ç›´æ¥å»å‚è€ƒè¯¥&lt;a href="http://theme-next.iissnan.com">ä½¿ç”¨æ–‡æ¡£&lt;/a>ã€‚&lt;/p>
&lt;h2 id="ä¸‹è½½nexthttptheme-nextiissnancomä¸»é¢˜åŒ…">ä¸‹è½½&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>ä¸»é¢˜åŒ…&lt;/h2>
&lt;p>ä»ç„¶åœ¨åšå®¢æ ¹ç›®å½•ä¸‹è¿è¡ŒGit bashå‘½ä»¤è¡Œå·¥å…·ï¼Œè¾“å…¥ä¸‹é¢ä¸€æ¡æŒ‡ä»¤ç”¨ä»¥å…‹éš†æœ€æ–°ç‰ˆæœ¬ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; git clone https://github.com/iissnan/hexo-theme-next theme/next
&lt;/code>&lt;/pre>&lt;h2 id="å¯ç”¨ä¸»é¢˜">å¯ç”¨ä¸»é¢˜&lt;/h2>
&lt;p>ä¸‹è½½å®Œæˆåï¼Œæ‰“å¼€åšå®¢é…ç½®æ–‡ä»¶&lt;code>_config.theme&lt;/code>ï¼Œä¿®æ”¹é‡Œé¢çš„&lt;code>theme&lt;/code>å­—æ®µï¼Œå°†å…¶å€¼è®¾ç½®ä¸º&lt;code>next&lt;/code>&lt;/p>
&lt;h2 id="éªŒè¯ä¸»é¢˜æ˜¯å¦å¯ç”¨æˆåŠŸ">éªŒè¯ä¸»é¢˜æ˜¯å¦å¯ç”¨æˆåŠŸ&lt;/h2>
&lt;p>åœ¨Git Bashä¸­è¾“å…¥&lt;code>$ npm server&lt;/code>å¯ç”¨æœ¬åœ°æœåŠ¡ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥&lt;code>localhost:4000&lt;/code>è¿›è¡Œé¢„è§ˆå³å¯&lt;/p>
&lt;p>æ›´å¤šè¯¦ç»†çš„è®¾ç½®ï¼Œä¸å†èµ˜è¿°ï¼Œå¯ä»¥å‚è€ƒ&lt;a href="http://theme-next.iissnan.com">NexT&lt;/a>çš„&lt;a href="http://theme-next.iissnan.com">ä½¿ç”¨æ–‡æ¡£&lt;/a>&lt;/p>
&lt;h1 id="å…¶ä»–ä¼˜ç§€çš„ä¸»é¢˜æ¨è">å…¶ä»–ä¼˜ç§€çš„ä¸»é¢˜æ¨èï¼š&lt;/h1>
&lt;ul>
&lt;li>&lt;a href="https://github.com/iissnan/hexo-theme-next.git">iissnan/hexo-theme-next&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/TryGhost">TryGhost/Casper&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/daleanthony">daleanthony/uno&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/orderedlist">orderedlist/modernist&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/litten/hexo-theme-yilia">litten/hexo-theme-yilia&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/A-limon">A-limon/pacman&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/AlxMedia">AlxMedia/hueman&lt;/a>&lt;/li>
&lt;li>&lt;a href="https://github.com/kathyqian">kathyqian/crisp-ghost-theme&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>æ›´å¤šä¼˜ç§€çš„ä¸»é¢˜å¯ä»¥å‚è€ƒçŸ¥ä¹å›ç­”ï¼š&lt;a href="http://www.zhihu.com/question/24422335">æœ‰å“ªäº›å¥½çœ‹çš„hexoä¸»é¢˜?ï¼å®¶é¡ºå¼ çš„å›ç­”&lt;/a>&lt;/p></description><category domain="https://h1z3y3.me/tags/hexo/">Hexo</category><category domain="https://h1z3y3.me/tags/github/">Github</category></item><item><title>åœ¨Githubä¸Šé¢æ­å»ºHexoåšå®¢ï¼ˆäºŒï¼‰ï¼šé…ç½®å’Œå‘è¡¨æ–‡ç« </title><link>https://h1z3y3.me/posts/create-hexo-on-github-2/</link><guid isPermaLink="true">https://h1z3y3.me/posts/create-hexo-on-github-2/</guid><pubDate>Tue, 13 Oct 2015 23:42:28 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="å¦‚ä½•é…ç½®hexo">å¦‚ä½•é…ç½®Hexo&lt;/h1>
&lt;p>ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å·²ç»åœ¨æœ¬åœ°å’ŒGithubä¸Šæ­å»ºèµ·äº†è‡ªå·±çš„åšå®¢ï¼Œä½†æ˜¯åšå®¢çš„é…ç½®éƒ½æ˜¯é»˜è®¤å€¼ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¸ªæ€§åŒ–è‡ªå·±çš„åšå®¢ï¼Œæˆ‘ä»¬åº”è¯¥åšä»€ä¹ˆå‘¢ã€‚è¿™ä¸€èŠ‚ä¸­æˆ‘ä»¬ä¸€èµ·æ¥é…ç½®è‡ªå·±çš„åšå®¢çš„åŸºæœ¬ä¿¡æ¯å’Œä»‹ç»å¦‚ä½•å†™åšå®¢å’Œå‘è¡¨åšå®¢ã€‚ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†ä¸€èµ·ä¸ºè‡ªå·±çš„åšå®¢å®‰è£…æ–°çš„ä¸»é¢˜ã€‚&lt;/p>
&lt;p>åšå®¢çš„ä¸»è¦é…ç½®ç”¨åˆ°æ ¹ç›®å½•ä¸‹çš„&lt;code>_config.yml&lt;/code>æ–‡ä»¶ï¼Œæˆ‘åœ¨ä¸‹é¢ç»™å‡ºæ–‡ä»¶å’Œè§£é‡Šï¼Œä½ åªéœ€è¦æ ¹æ®è‡ªå·±éœ€æ±‚ä½œå‡ºç®€å•æ›´æ”¹å³å¯ï¼š&lt;/p>
&lt;pre>&lt;code># Hexo Configuration
## Docs: http://hexo.io/docs/configuration.html
## Source: https://github.com/hexojs/hexo/
# Site
title: Mungo's Note##ç«™ç‚¹çš„åå­—
subtitle:##ç«™ç‚¹çš„å‰¯æ ‡é¢˜
description: æ—¥å¸¸æŠ€æœ¯åˆ†äº« ##ç«™ç‚¹ä»‹ç»ï¼Œå¯¹ç«™ç‚¹è¿›è¡Œæè¿°
author: Mungo##ç«™ç‚¹æ–‡ç« çš„ä½œè€…
email: gmzhaoyang@gmail.com##ä½ çš„é‚®ç®±åœ°å€
language:##è¯­è¨€ï¼Œé»˜è®¤ä¸­æ–‡ï¼Œä¸å¡«å†™å³å¯
timezone:##æ—¶åŒºï¼Œé»˜è®¤å³å¯
# URL
## If your site is put in a subdirectory,
## set url as 'http://yoursite.com/child' and root as '/child/'
url: http://mungo.space##ç«™ç‚¹çš„åŸŸåï¼Œå¦‚æœå¥‡æ€ªæˆ‘ä¸ºä»€ä¹ˆå¯ä»¥ç”¨è‡ªå·±çš„åŸŸåï¼Œå¯ä»¥çœ‹åç»­æ›´æ–°
root: /
permalink: :year/:month/:day/:title/
permalink_defaults:
## å¯¹èµ„æºæ–‡ä»¶å¤¹çš„é…ç½®ï¼Œå¦‚èµ„æºæ–‡ä»¶å¤¹åç§°ï¼Œæ ‡ç­¾äº‘åç§°ï¼Œåˆ†ç±»é¡µé¢åç§°
# Directory
source_dir: source##èµ„æºæ–‡ä»¶å¤¹,å½“æ‰§è¡Œ`$ hexo deloy`å‘½ä»¤ï¼Œä¸Šä¼ çš„å³æ˜¯è¯¥æ–‡ä»¶å¤¹é‡Œé¢çš„å†…å®¹
public_dir: public##å…¬å…±æ–‡ä»¶å¤¹ï¼Œå½“æ‰§è¡Œ`$ hexo generate`å‘½ä»¤ï¼Œç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨é‡Œé¢
tag_dir: tags##æ ‡ç­¾äº‘æ–‡ä»¶å¤¹ï¼Œéœ€è¦è‡ªå·±ç”Ÿæˆï¼Œè¯¦æƒ…è§ä¸‹ä¸€èŠ‚å¦‚ä½•é…ç½®ä¸»é¢˜
archive_dir: archives##å½’æ¡£æ–‡ä»¶å¤¹ï¼Œéœ€è¦è‡ªå·±ç”Ÿæˆ
category_dir: categories##åˆ†ç±»æ–‡ä»¶å¤¹ï¼Œéœ€è¦è‡ªå·±ç”Ÿæˆ
code_dir: downloads/code##ä»£ç å­˜æ”¾åŒº
i18n_dir: :lang
skip_render:
##æ­¤å¤„æ—¶é…ç½®åšå®¢æ–‡ç« å†…å®¹æ ¼å¼çš„ï¼Œå¯ä»¥ä¿æŒé»˜è®¤ï¼Œä¸åšä¿®æ”¹
# Writing
new_post_name: :title.md # File name of new posts
default_layout: post
titlecase: false # Transform title into titlecase
external_link: true # Open external links in new tab
filename_case: 0
render_drafts: false
post_asset_folder: false
relative_link: false
future: true
highlight:
enable: true
line_number: true
auto_detect: true
tab_replace:
#åˆ†ç±»å’Œæ ‡ç­¾äº‘çš„é…ç½®ï¼Œå¯ä»¥ä¸åšä¿®æ”¹ï¼Œé»˜è®¤å³å¯
# Category &amp;amp; Tag
default_category: uncategorized
category_map:
tag_map:
#æ—¥æœŸå’Œæ—¶é—´æ ¼å¼çš„é…ç½®ï¼Œå¯ä»¥ä¸åšä¿®æ”¹ï¼Œé»˜è®¤å³å¯
# Date / Time format
## Hexo uses Moment.js to parse and display date
## You can customize the date format as defined in
## http://momentjs.com/docs/#/displaying/format/
date_format: YYYY-MM-DD
time_format: HH:mm:ss
#ç”¨æ¥é…ç½®æ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« æ•°ç›®ï¼Œå¯ä»¥æ ¹æ®è‡ªå·±éœ€æ±‚è‡ªè¡Œä¿®æ”¹
# Pagination
## Set per_page to 0 to disable pagination
per_page: 10
pagination_dir: page
#æ’ä»¶å’Œä¸»é¢˜é…ç½®ï¼Œåœ¨è¿™é‡Œå¯ä»¥ä¿®æ”¹è‡ªå·±çš„ä¸»é¢˜
# Extensions
## Plugins: http://hexo.io/plugins/
## Themes: http://hexo.io/themes/
theme: next
#ä¸Šä¼ é…ç½®ï¼Œä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬å·²ç»é…ç½®å®Œæˆäº†ï¼Œåœ¨è¿™é‡Œä¸éœ€è¦å†æ¬¡ä¿®æ”¹
# Deployment
## Docs: http://hexo.io/docs/deployment.html
deploy:
type: git
repository: https://github.com/Gitzhaoyang/gitzhaoyang.github.io.git
branch: master
&lt;/code>&lt;/pre>&lt;p>å½“é…ç½®å®Œæˆå¹¶ä¿å­˜åï¼Œå°±å¯ä»¥æ‰§è¡Œ&lt;code>$ hexo generate&lt;/code>ç”Ÿæˆé™æ€æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ&lt;code>$ hexo server&lt;/code>åå°±å¯ä»¥æ‰“å¼€æµè§ˆå™¨è¾“å…¥&lt;code>localhost:4000&lt;/code>è¿›è¡Œæœ¬åœ°é¢„è§ˆäº†&lt;/p>
&lt;h2 id="tips">tips&lt;/h2>
&lt;p>å¦‚æœ&lt;code>_config.yml&lt;/code>æ–‡ä»¶æ‰“å¼€æœ‰ä¹±ç åº”è¯¥æ˜¯ç”¨åˆ°çš„ç¼–è¾‘å™¨çš„åŸå› ï¼Œæˆ‘ç”¨çš„æ˜¯Sublime2ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¸ä¼šå‡ºç°ä¹±ç ã€‚å¦‚æœä¹±ç ï¼Œé‚£ä¹ˆéœ€è¦æŠŠæ–‡ä»¶æ ¼å¼è½¬æ¢ä¸ºUTF-8ï¼Œè½¬åŒ–æ–¹æ³•æˆ‘åœ¨è¿™é‡Œå°±ä¸å†èµ˜è¿°äº†ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•æ·»åŠ å’Œå‘è¡¨æ–‡ç« ">å¦‚ä½•æ·»åŠ å’Œå‘è¡¨æ–‡ç« &lt;/h2>
&lt;h3 id="æ–°å»ºæ–‡ç« ">æ–°å»ºæ–‡ç« &lt;/h3>
&lt;p>åœ¨Git Bashä¸­è¾“å…¥&lt;/p>
&lt;p>$ hexo new post &amp;ldquo;my_first_post&amp;rdquo;&lt;/p>
&lt;h3 id="ç¼–è¾‘æ–‡ç« ">ç¼–è¾‘æ–‡ç« &lt;/h3>
&lt;p>ç¬¬ä¸€æ­¥çš„å‘½ä»¤ä¼šåœ¨&lt;code>\Hexo\source\_posts&lt;/code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»ºä¸€ä¸ªåç¼€&lt;code>.md&lt;/code>æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨é‡Œé¢æ·»åŠ ä»»ä½•å­—ç¬¦ä¸²ã€‚&lt;/p>
&lt;p>è¿™å…¶å®æ˜¯ä¸€ä¸ª&lt;code>markdown&lt;/code>ç±»å‹çš„æ–‡ä»¶ï¼Œä½¿ç”¨&lt;code>markdown&lt;/code>è¯­è¨€ç¼–å†™ï¼Œæˆ‘è¿™ç¯‡åšæ–‡å°±æ˜¯ç”¨&lt;code>markdown&lt;/code>ç¼–å†™çš„ï¼Œå¦‚æœä¸äº†è§£çš„ï¼Œå¯ä»¥çœ‹æˆ‘çš„åç»­æ›´æ–°ï¼Œæˆ‘ä¼šæŠŠ&lt;code>markdown&lt;/code>çš„åŸºæœ¬ä½¿ç”¨æ–¹æ³•è¿›è¡Œæ•´ç†ã€‚&lt;/p>
&lt;h3 id="ç”Ÿæˆå’Œä¸Šä¼ ">ç”Ÿæˆå’Œä¸Šä¼ &lt;/h3>
&lt;ul>
&lt;li>
&lt;p>åœ¨GitBashä¸­è¾“å…¥&lt;code>$ hexo generate&lt;/code>å¯¹æ–‡ä»¶è¿›è¡Œç”Ÿæˆï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç”Ÿæˆå®Œæˆåï¼Œå¯ä»¥è¾“å…¥&lt;code>$ hexo server&lt;/code>ï¼Œç„¶ååœ¨æµè§ˆå™¨è¾“å…¥&lt;code>localhost:4000&lt;/code>è¿›è¡Œé¢„è§ˆï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>é¢„è§ˆæ²¡æœ‰é—®é¢˜åï¼Œæ¥ç€è¾“å…¥&lt;code>$ hexo deploy&lt;/code>ï¼Œwindowså¹³å°ä¸‹ä¼šæç¤ºè¾“å…¥Githubçš„ç”¨æˆ·åï¼Œç„¶åæç¤ºè¾“å…¥Githubçš„ç™»å½•å¯†ç ã€‚å¦‚æœè¾“å…¥æ­£ç¡®ï¼Œç­‰å¾…å‡ ç§’ä¾¿èƒ½ä¸Šä¼ æˆåŠŸï¼›&lt;/p>
&lt;/li>
&lt;li>
&lt;p>ç°åœ¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¾“å…¥&lt;code>xxxx.github.io&lt;/code>è¿›è¡Œè®¿é—®äº†ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;h3 id="æ³¨æ„">æ³¨æ„&lt;/h3>
&lt;p>å¯èƒ½ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œåªè¦ç­‰å¾…å‡ åˆ†é’Ÿæˆ–è€…æ¸…ç©ºä¸€ä¸‹æµè§ˆå™¨ç¼“å­˜åŸºæœ¬å°±èƒ½è§£å†³ã€‚å¦‚æœä»ç„¶çœ‹ä¸åˆ°ï¼Œè¯´æ˜å‰é¢æ­¥éª¤æ“ä½œæœ‰é”™è¯¯ï¼Œé‡æ–°ç”Ÿæˆå’Œä¸Šä¼ å°±å¯ä»¥äº†ã€‚&lt;/p>
&lt;p>å¦‚æœå®åœ¨ä¸è¡Œï¼Œå¯ä»¥åœ¨Git Bashä¸­è¾“å…¥&lt;code>$ hexo clean&lt;/code>æˆ–è€…æ‰‹åŠ¨åˆ é™¤&lt;code>.deploy_git&lt;/code>æ–‡ä»¶å¤¹å’Œ&lt;code>db.json&lt;/code>æ–‡ä»¶å†é‡æ–°ç”Ÿæˆå’Œä¸Šä¼ ã€‚&lt;/p>
&lt;p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»æ­å»ºèµ·è‡ªå·±çš„åšå®¢ï¼Œå¯ä»¥è¿›è¡ŒåŸºæœ¬çš„é…ç½®ï¼Œä¹Ÿå¯ä»¥å‘è¡¨æ–‡ç« ï¼Œåé¢ä¼šæœ‰æ›´é«˜é˜¶çš„è®¾ç½®ï¼Œå¦‚ï¼šå¦‚ä½•é…ç½®ä¸»é¢˜ï¼Œå¦‚ä½•åœ¨ä¸åŒç”µè„‘ä¸Šéƒ½å¯ä»¥æ›´æ–°è‡ªå·±çš„åšå®¢ etc.æ„Ÿå…´è¶£çš„äººå¯ä»¥å…³æ³¨ã€‚ğŸ˜˜&lt;/p></description><category domain="https://h1z3y3.me/tags/hexo/">Hexo</category><category domain="https://h1z3y3.me/tags/github/">Github</category></item><item><title>å¦‚ä½•é…ç½®Githubçš„SSH key</title><link>https://h1z3y3.me/posts/how-to-config-ssh-on-github/</link><guid isPermaLink="true">https://h1z3y3.me/posts/how-to-config-ssh-on-github/</guid><pubDate>Tue, 13 Oct 2015 16:02:34 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h2 id="ä»€ä¹ˆæ˜¯ssh">ä»€ä¹ˆæ˜¯SSH&lt;/h2>
&lt;p>SSHä¸ºSecure Shellçš„ç¼©å†™ï¼Œæ˜¯å»ºç«‹åœ¨åº”ç”¨å±‚å’Œä¼ è¾“å±‚åŸºç¡€ä¸Šçš„åè®®ã€‚SSHæ˜¯ç›®å‰è¾ƒå¯é ï¼Œä¸“ä¸ºè¿œç¨‹ç™»å½•ä¼šè¯å’Œå…¶ä»–ç½‘ç»œæœåŠ¡æä¾›å®‰å…¨æ€§çš„åè®®ã€‚åˆ©ç”¨SSHåè®®å¯ä»¥æœ‰æ•ˆé˜²æ­¢è¿œç¨‹ç®¡ç†ä¸­é¢ä¿¡æ¯æ³„æ¼é—®é¢˜ã€‚æˆ‘ç†è§£çš„å°±æ˜¯ç»™æ•°æ®è¿›è¡ŒåŠ å¯†ï¼Œç„¶åé˜²æ­¢ä¸­é—´äººè¿›è¡Œç›—å–ï¼Œèƒ½ä½¿ä½ çš„æ•°æ®å®‰å…¨å¯é çš„ä¼ è¾“åˆ°ç›®çš„æ–¹ã€‚åœ¨è¿™é‡Œå°±æ˜¯ä¸ºäº†ä¿è¯ä½ ç”µè„‘å’Œ&lt;a href="https://github.com">Github&lt;/a>ä»“åº“ä¹‹é—´é€šä¿¡çš„å®‰å…¨ã€‚&lt;/p>
&lt;h2 id="å¦‚ä½•é…ç½®githubhttpsgithubcomçš„ssh">å¦‚ä½•é…ç½®&lt;a href="https://github.com">Github&lt;/a>çš„SSH&lt;/h2>
&lt;!-- more -->
&lt;p>é¢˜ä¸»è¿™é‡Œç”¨çš„ä¾ç„¶æ˜¯windowså¹³å°ã€‚&lt;/p>
&lt;h3 id="step-1-æ£€æŸ¥ssh-keys">Step 1: æ£€æŸ¥SSH keys&lt;/h3>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦æŸ¥çœ‹åœ¨ä½ ç”µè„‘ä¸Šå·²ç»å­˜åœ¨çš„SSH keysã€‚è¿è¡ŒGit Bash ç„¶åè¾“å…¥ï¼š&lt;/p>
&lt;pre>&lt;code>$ ls -al ~/.ssh
&lt;/code>&lt;/pre>
&lt;p>å¦‚æœä½ å·²ç»æœ‰SSHå…¬é’¥äº†ã€‚é‚£ä¹ˆä½ å°†ä¼šçœ‹åˆ°ä¸‹é¢æ ¼å¼çš„æ–‡ä»¶åå­—ï¼š&lt;/p>
&lt;pre>&lt;code>id_dsa.pub
id_esdsa.pub
id_ed25519.pub
id_rsa.pub
&lt;/code>&lt;/pre>
&lt;p>å¦‚æœä½ å·²ç»å­˜åœ¨å…¬é’¥äº†ï¼Œé‚£ä¹ˆå¯ä»¥è·³è¿‡&lt;strong>Step 2&lt;/strong>ç›´æ¥å»&lt;strong>Step 3&lt;/strong>äº†ã€‚å¦‚æœæ²¡æœ‰ä¹Ÿä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬å°†åœ¨&lt;strong>Step 2&lt;/strong> ä¼šåˆ›å»ºå…¬é’¥ã€‚&lt;/p>
&lt;h3 id="step-2-ç”Ÿæˆssh-key">Step 2: ç”ŸæˆSSH key&lt;/h3>
&lt;ol>
&lt;li>
&lt;h4 id="åœ¨git-bashä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤å¼•å·å†…ä¸€å®šæ˜¯ä½ çš„githubhttpsgithubcomæ³¨å†Œé‚®ç®±åœ°å€">åœ¨Git Bashä¸­è¾“å…¥ä¸‹é¢å‘½ä»¤ï¼Œå¼•å·å†…ä¸€å®šæ˜¯ä½ çš„&lt;a href="https://github.com">Github&lt;/a>æ³¨å†Œé‚®ç®±åœ°å€&lt;/h4>
&lt;pre>&lt;code> $ ssh-keygen -t rsa -b 4096 -C &amp;quot;your_github_email@example.com&amp;quot;
#è¿™å¥ä½œç”¨æ˜¯ç”Ÿæˆä¸€ä¸ªæ–°çš„SSH key
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="ç­‰å¾…å‡ ç§’å½“æç¤ºè®©ä½ è¾“å…¥ä¿å­˜åœ°å€æ—¶å®˜æ–¹ç‰¹åˆ«æ¨èæ”¾åœ¨é»˜è®¤ä½ç½®å°±å¯ä»¥äº†æ‰€ä»¥è¿™é‡Œç›´æ¥è¾“å…¥å›è½¦æç¤ºå¦‚ä¸‹">ç­‰å¾…å‡ ç§’ï¼Œå½“æç¤ºè®©ä½ è¾“å…¥ä¿å­˜åœ°å€æ—¶ï¼Œå®˜æ–¹ç‰¹åˆ«æ¨èæ”¾åœ¨é»˜è®¤ä½ç½®å°±å¯ä»¥äº†ã€‚æ‰€ä»¥è¿™é‡Œç›´æ¥è¾“å…¥&lt;strong>å›è½¦&lt;/strong>ï¼Œæç¤ºå¦‚ä¸‹ï¼š&lt;/h4>
&lt;pre>&lt;code> Enter file in which to save the key (/Users/you/.ssh/id_rsa):[ç›´æ¥è¾“å…¥å›è½¦]
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="å°†ä¼šæç¤ºä½ è¾“å…¥ä¸€ä¸ªå¯†ç ä¸²è¿™é‡Œè¾“å…¥å¯†ç æ—¶ä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„åªè¦è¾“å…¥æ­£ç¡®æŒ‰å›è½¦å°±å¥½">å°†ä¼šæç¤ºä½ è¾“å…¥ä¸€ä¸ªå¯†ç ä¸²**(è¿™é‡Œè¾“å…¥å¯†ç æ—¶ä¸ä¼šæ˜¾ç¤ºåœ¨å±å¹•ä¸Šçš„ï¼Œåªè¦è¾“å…¥æ­£ç¡®æŒ‰å›è½¦å°±å¥½)**:&lt;/h4>
&lt;pre>&lt;code> Enter passphrase ï¼ˆempty for no passphraseï¼‰: [è¾“å…¥ä½ æƒ³è®¾ç½®çš„å¯†ç ]
Enter same passphrase againï¼š[åœ¨è¾“å…¥ä¸€éå¯†ç ]
ï¼ƒè™½ç„¶è¯´è¿™é‡Œå¯ä»¥è®¾ç½®ä¸ºç©ºï¼Œä½†æ˜¯æ¨èç”¨ä¸€ä¸ªæ›´åŠ å®‰å…¨çš„å¯†ç 
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="è¾“å®Œå¯†ç ä¹‹åä½ å°†ä¼šå¾—åˆ°ä½ çš„sshçš„æŒ‡çº¹fingerprintæˆ–è€…idä»–çœ‹èµ·æ¥å¦‚ä¸‹å›¾">è¾“å®Œå¯†ç ä¹‹åï¼Œä½ å°†ä¼šå¾—åˆ°ä½ çš„SSHçš„æŒ‡çº¹(fingerprint)æˆ–è€…idã€‚ä»–çœ‹èµ·æ¥å¦‚ä¸‹å›¾ï¼š&lt;/h4>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t0161534b42efa8b260.jpg" alt="fingerprint">&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="step-3-æŠŠä½ çš„ssh-keyæ·»åŠ åˆ°ssh-agent">Step 3: æŠŠä½ çš„SSH keyæ·»åŠ åˆ°ssh-agent&lt;/h3>
&lt;ol>
&lt;li>
&lt;h4 id="è¾“å…¥å¦‚ä¸‹å‘½ä»¤">è¾“å…¥å¦‚ä¸‹å‘½ä»¤&lt;/h4>
&lt;pre>&lt;code> $ ssh-agent -s
&lt;/code>&lt;/pre>
&lt;p>ä¼šå“åº”ï¼š&lt;/p>
&lt;pre>&lt;code> echo Agent pid [ç«¯å£å·]
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="åŠ ä¸‹æ¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤æŠŠä½ çš„ssh-keyæ·»åŠ åˆ°ssh-agent">åŠ ä¸‹æ¥è¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼ŒæŠŠä½ çš„SSH keyæ·»åŠ åˆ°ssh-agent&lt;/h4>
&lt;pre>&lt;code> $ ssh-add ~/.ssh/id_rsa
&lt;/code>&lt;/pre>
&lt;p>å¦‚æœä»–æç¤ºå¦‚ä¸‹ï¼Œè¯´æ˜ä¸èƒ½æ‰“å¼€æ‚¨èº«ä»½éªŒè¯çš„ä»£ç†&lt;/p>
&lt;pre>&lt;code> Could not open a connection to your authentication agent.
&lt;/code>&lt;/pre>
&lt;p>åªéœ€è¦è¾“å…¥å¦‚ä¸‹å‘½ä»¤å³å¯è§£å†³ï¼š&lt;/p>
&lt;pre>&lt;code> ssh-agnet bash
&lt;/code>&lt;/pre>
&lt;p>æ›´å¤šå…³äºssh-agentçš„ç»†èŠ‚ï¼Œå¯ä»¥ç”¨man ssh-agent æ¥æŸ¥çœ‹&lt;/p>
&lt;/li>
&lt;/ol>
&lt;h3 id="step-4-æŠŠä½ çš„ssh-keyæ·»åŠ åˆ°ä½ çš„githubhttpsgithubcomè´¦æˆ·">Step 4: æŠŠä½ çš„SSH keyæ·»åŠ åˆ°ä½ çš„&lt;a href="https://github.com">Github&lt;/a>è´¦æˆ·&lt;/h3>
&lt;p>é¦–å…ˆä½ åº”è¯¥æŠŠä½ çš„ SSH key å¤åˆ¶åˆ°ä½ çš„å‰ªè´´æ¿ï¼Œè¾“å…¥å‘½ä»¤å³å¯å®ŒæˆæŠŠ SSH key å¤åˆ¶åˆ°ä½ çš„å‰ªè´´æ¿ï¼š&lt;/p>
&lt;pre>&lt;code>$ clip &amp;lt; ~/.ssh/id_ras.pub
&lt;/code>&lt;/pre>
&lt;p>æ·»åŠ åˆ°ä½ çš„&lt;a href="https://github.com">Github&lt;/a>è´¦æˆ·ï¼š&lt;/p>
&lt;ol>
&lt;li>
&lt;h4 id="æµè§ˆå™¨ç™»é™†ä½ çš„githubhttpsgithubcomè´¦æˆ·ç‚¹å‡»å³ä¸Šè§’ä½ çš„å¤´åƒç„¶åç‚¹å‡»settings">æµè§ˆå™¨ç™»é™†ä½ çš„&lt;a href="https://github.com">Github&lt;/a>è´¦æˆ·ï¼Œç‚¹å‡»å³ä¸Šè§’ä½ çš„å¤´åƒï¼Œç„¶åç‚¹å‡»&lt;strong>Settings&lt;/strong>&lt;/h4>
&lt;p>&lt;img src="https://p4.ssl.qhimg.com/t012de386332fd4275a.jpg" alt="ç‚¹å‡»Settings">&lt;/p>
&lt;/li>
&lt;li>
&lt;h4 id="è¿›å…¥settingsç‚¹å‡»ä¾§æ é€‰é¡¹ssh-key">è¿›å…¥&lt;strong>Settings&lt;/strong>ï¼Œç‚¹å‡»ä¾§æ é€‰é¡¹&lt;strong>SSH key&lt;/strong>&lt;/h4>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t0139f709bd2e05334f.jpg" alt="ç‚¹å‡»SSH key">&lt;/p>
&lt;/li>
&lt;li>
&lt;h4 id="å•å‡»å³è¾¹-add-ssh-key-æŒ‰é’®">å•å‡»å³è¾¹ Add SSH key æŒ‰é’®&lt;/h4>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t01b1d4cf5d05ee2de6.jpg" alt="ç‚¹å‡»Add key">&lt;/p>
&lt;/li>
&lt;li>
&lt;h4 id="åœ¨ä¸‹é¢è¾“å…¥æ ‡é¢˜titleè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰å’Œshh-keyç›´æ¥-ctrlv-ç²˜è´´å°±å¯ä»¥">åœ¨ä¸‹é¢è¾“å…¥æ ‡é¢˜ï¼ˆTitleï¼Œè¿™ä¸ªå¯ä»¥è‡ªå®šä¹‰ï¼‰å’ŒSHH Keyï¼ˆç›´æ¥ Ctrlï¼‹V ç²˜è´´å°±å¯ä»¥ï¼‰&lt;/h4>
&lt;/li>
&lt;li>
&lt;h4 id="ç‚¹å‡»ä¸‹é¢çš„add-keyæŒ‰é’®ä¾¿å¯ä»¥æ·»åŠ æˆåŠŸäº†">ç‚¹å‡»ä¸‹é¢çš„&lt;code>Add key&lt;/code>æŒ‰é’®ä¾¿å¯ä»¥æ·»åŠ æˆåŠŸäº†&lt;/h4>
&lt;/li>
&lt;/ol>
&lt;h3 id="step-5-æµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸ">Step 5: æµ‹è¯•æ˜¯å¦è¿æ¥æˆåŠŸ&lt;/h3>
&lt;ol>
&lt;li>
&lt;h4 id="åœ¨git-bashä¸­è¾“å…¥">åœ¨Git Bashä¸­è¾“å…¥ï¼š&lt;/h4>
&lt;pre>&lt;code> $ ssh -T git@github.com
# sshå°è¯•è¿æ¥åˆ°GitHub
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="ä½ å¯èƒ½çœ‹åˆ°ä¸‹é¢çš„è­¦å‘Š">ä½ å¯èƒ½çœ‹åˆ°ä¸‹é¢çš„è­¦å‘Šï¼š&lt;/h4>
&lt;pre>&lt;code> The authenticity of host 'github.com(207.97.227.239)' can't be established.
RSA key fingerprint is SHA256:nJKJFKDnDLFJDndndnfkdfldjfldldfjld.
Are you sure you want to continue connecting (yes/no)?
&lt;/code>&lt;/pre>
&lt;p>ç¡®å®šæç¤ºä¿¡æ¯é‡Œçš„æŒ‡çº¹ï¼ˆfingerprintï¼‰æ˜¯å¦åŒ¹é…ï¼Œå¦‚æœåŒ¹é…å°±é”®å…¥ï½€yesï½€ï¼Œå°†å¾—åˆ°ï¼š&lt;/p>
&lt;pre>&lt;code> Hi [ä½ çš„ç”¨æˆ·å]! You've successfully authenticated, but GitHub does not provide shell access.
&lt;/code>&lt;/pre>
&lt;/li>
&lt;li>
&lt;h4 id="å¦‚æœæç¤ºä¿¡æ¯ä¸­ä½ çš„ç”¨æˆ·åæ˜¯ä½ çš„é‚£ä¹ˆä½ å°±æˆåŠŸå»ºç«‹äº†ssh-key">å¦‚æœæç¤ºä¿¡æ¯ä¸­ä½ çš„ç”¨æˆ·åæ˜¯ä½ çš„ï¼Œé‚£ä¹ˆä½ å°±æˆåŠŸå»ºç«‹äº†SSH keyï¼ğŸ˜ğŸ˜&lt;/h4>
&lt;/li>
&lt;/ol>
&lt;h3 id="tipså¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£httpshelpgithubcomarticlesgenerating-ssh-keysä¹Ÿå¯ä»¥ç»™æˆ‘ç•™è¨€">TIPSï¼šå¦‚æœé‡åˆ°å…¶ä»–é—®é¢˜ï¼Œå¯ä»¥å‚è€ƒ&lt;a href="https://help.github.com/articles/generating-ssh-keys/">å®˜æ–¹æ–‡æ¡£&lt;/a>ï¼Œä¹Ÿå¯ä»¥ç»™æˆ‘ç•™è¨€&lt;/h3></description><category domain="https://h1z3y3.me/tags/github/">Github</category><category domain="https://h1z3y3.me/tags/ssh/">SSH</category></item><item><title>åœ¨Githubä¸Šé¢æ­å»ºHexoåšå®¢ï¼ˆä¸€ï¼‰ï¼šéƒ¨ç½²åˆ°Github</title><link>https://h1z3y3.me/posts/create-hexo-on-github-1/</link><guid isPermaLink="true">https://h1z3y3.me/posts/create-hexo-on-github-1/</guid><pubDate>Mon, 12 Oct 2015 18:57:44 +0000</pubDate><author>gmzhaoyang@gmail.com (h1z3y3)</author><copyright>[CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en)</copyright><description>&lt;h1 id="ä»€ä¹ˆæ˜¯hexohttpshexoio">ä»€ä¹ˆæ˜¯&lt;a href="https://hexo.io/">Hexo&lt;/a>&lt;/h1>
&lt;p>&lt;a href="https://hexo.io/">Hexo&lt;/a>æ˜¯ä¸€ä¸ªåŸºäºNode.jsçš„é™æ€åšå®¢ç¨‹åºï¼Œå¯ä»¥æ–¹ä¾¿çš„ç”Ÿæˆé™æ€ç½‘é¡µæ‰˜ç®¡åœ¨&lt;a href="https://github.com/">Github&lt;/a>å’ŒHerokuä¸Šã€‚å¹¶ä¸”æœ‰å¾ˆå¤šäººä¸ºå…¶åˆ¶ä½œäº†å¾ˆå¤šä¼˜ç§€çš„ä¸»é¢˜ï¼ˆthemeï¼‰ï¼Œä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½è¿›è¡Œè®¾ç½®ã€‚ä¸»é¢˜çš„è®¾ç½®å°†åœ¨åé¢çš„ç« èŠ‚ä¸­ä»‹ç»ã€‚&lt;/p>
&lt;p>è¿™ä¸ªæ˜¯&lt;a href="https://hexo.io/">Hexo&lt;/a>å®˜æ–¹ç½‘ç«™ä»‹ç»ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Hexo is a fast, simple and powerful blog framework.
You write posts in &lt;a href="http://daringfireball.net/projects/markdown/">Markdown&lt;/a>
(or other languages) and Hexo generates
static files with a beautiful theme in seconds.&lt;/p>
&lt;/blockquote>
&lt;p>ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼š&lt;/p>
&lt;blockquote>
&lt;p>Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdownï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œ
åœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚&lt;/p>
&lt;/blockquote>
&lt;h1 id="æ€ä¹ˆåœ¨githubhttpsgithubcomä¸Šæ­å»ºä¸€ä¸ªhexoåšå®¢">æ€ä¹ˆåœ¨&lt;a href="https://github.com/">Github&lt;/a>ä¸Šæ­å»ºä¸€ä¸ªhexoåšå®¢&lt;/h1>
&lt;!-- more -->
&lt;p>æˆ‘ç”¨äº†ä¸€å¤©æ—¶é—´ç ”ç©¶å’Œæ­å»ºäº†ä¸€ä¸ª&lt;a href="https://github.com/">Github&lt;/a>åšå®¢(GitHub Pages site)ï¼Œè¿‡ç¨‹ä¸­é‡åˆ°ä¸€äº›å°é—®é¢˜ï¼Œç°åœ¨å†™ä¸€ç¯‡æ•™ç¨‹ï¼Œæ–¹ä¾¿å’Œæˆ‘ä¸€æ ·çˆ±æŠ˜è…¾ä½†æ˜¯æ˜¯æ–°æ‰‹çš„äººã€‚&lt;/p>
&lt;h2 id="æ³¨æ„">æ³¨æ„&lt;/h2>
&lt;p>å› ä¸ºé¢˜ä¸»åœ¨æ­å»ºæ—¶åœ¨Windowså¹³å°ï¼Œæ‰€ä»¥è®²è§£ä¸ºWindowsç‰ˆæœ¬ï¼Œä½†æ˜¯å„ä¸ªå¹³å°å¤§åŒå°å¼‚ï¼Œæ‰€ä»¥å®è·µèµ·æ¥å¹¶æ²¡æœ‰å¾ˆå¤§çš„å·®åˆ«ã€‚&lt;/p>
&lt;p>ä»¥ä¸‹ä¸ºæ•™ç¨‹æ­£æ–‡ï¼š&lt;/p>
&lt;h2 id="å®‰è£…git">å®‰è£…Git&lt;/h2>
&lt;p>å‰å¾€&lt;a href="http://git-scm.com/">Gitå®˜ç½‘&lt;/a>ä¸‹è½½Windowsç‰ˆæœ¬å‹ç¼©åŒ…ï¼Œä¸‹è½½å®Œæˆåè§£å‹å®‰è£…ã€‚&lt;/p>
&lt;h2 id="å®‰è£…nodejs">å®‰è£…Node.js&lt;/h2>
&lt;p>å‰å¾€&lt;a href="https://nodejs.org/en/">Node.js&lt;/a>å®˜æ–¹ä¸‹è½½ç½‘ç«™ï¼Œä¸‹è½½Node.jså®˜æ–¹å®‰è£…åŒ…ï¼Œä¸‹è½½å®ŒæˆååŒæ ·è§£å‹å®‰è£…ã€‚&lt;/p>
&lt;h2 id="å®‰è£…hexohttpshexoio">å®‰è£…&lt;a href="https://hexo.io/">Hexo&lt;/a>&lt;/h2>
&lt;p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå®‰è£…&lt;a href="https://hexo.io/">Hexo&lt;/a>æ‰€éœ€è¦çš„ç¯å¢ƒå·²å°†å®‰è£…å®Œæˆï¼Œä¸‹ä¸€æ­¥åªéœ€è¦å®‰è£…&lt;a href="https://hexo.io/">Hexo&lt;/a>ä¾¿å¯ä»¥äº†ã€‚
ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œçœ‹æ˜¯å¦æœ‰&lt;strong>Git bash Here&lt;/strong>é€‰é¡¹ã€‚å¦‚æœæ²¡æœ‰å¯ä»¥å‰å¾€Gitå®‰è£…æ ¹ç›®å½•ï¼Œå¯åŠ¨&lt;strong>git-base.exe&lt;/strong>ä¹Ÿå¯ä»¥ã€‚ åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ï¼š&lt;/p>
&lt;p>$ npm install -g hexo-cli&lt;/p>
&lt;p>&lt;a href="https://hexo.io/">Hexo&lt;/a> ä¾¿å®‰è£…å®Œæˆäº†&lt;/p>
&lt;h2 id="åˆ›å»ºhexohttpshexoioæ–‡ä»¶å¤¹">åˆ›å»º&lt;a href="https://hexo.io/">Hexo&lt;/a>æ–‡ä»¶å¤¹&lt;/h2>
&lt;p>æ‰¾åˆ°æƒ³è¦æ”¾ç½®åšå®¢çš„æ–‡ä»¶å¤¹ï¼Œæ¯”å¦‚ï¼ˆ&lt;code>F:\Hexo&lt;/code>ï¼‰ï¼Œåœ¨è¯¥ç›®å½•ä¸‹é¼ æ ‡å³å‡»æ‰“å¼€Gitbashå·¥å…·ï¼Œï¼ˆå³é”®èœå•ä¸­æ²¡æœ‰è¯¥é€‰é¡¹çš„å¯ä»¥ç”¨cmdå‘½ä»¤&lt;code>cd&lt;/code>ç­‰è¿›å…¥è¯¥æ–‡ä»¶å¤¹ï¼‰ã€‚æ‰§è¡Œä¸‹é¢çš„è¯­å¥ï¼Œä¼šåœ¨&lt;code>F:\Hexo&lt;/code>æ–‡ä»¶å¤¹ä¸‹åˆ›å»º&lt;code>node_modules&lt;/code>
æ–‡ä»¶å¤¹ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; hexo init
&lt;/code>&lt;/pre>&lt;p>è¿™é‡Œ &lt;strong>init&lt;/strong> åé¢å¯ä»¥è·Ÿæ–‡ä»¶ç›®å½•ï¼Œæ¯”å¦‚æˆ‘æƒ³åœ¨&lt;code>F:\Hexo&lt;/code>ä¸‹åˆ›å»ºåšå®¢æ–‡ä»¶å¤¹ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤ï¼š&lt;/p>
&lt;p>$ hexo init F:\Hexo&lt;/p>
&lt;h2 id="å®‰è£…ä¾èµ–åŒ…">å®‰è£…ä¾èµ–åŒ…&lt;/h2>
&lt;p>åœ¨&lt;a href="https://hexo.io/">Hexo&lt;/a>ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œä½ ä¼šå‘ç°&lt;code>F:\Hexo\node_modules&lt;/code>ç›®å½•ä¸‹å¤šäº†å¥½å¤šæ–‡ä»¶å¤¹&lt;/p>
&lt;pre>&lt;code>&amp;gt; npm install
&lt;/code>&lt;/pre>&lt;h2 id="æœ¬åœ°è°ƒè¯•">æœ¬åœ°è°ƒè¯•&lt;/h2>
&lt;p>ç›®å‰ä¸ºæ­¢ï¼Œå·²ç»æ­å»ºå¥½è‡ªå·±çš„&lt;a href="https://hexo.io/">Hexo&lt;/a>åšå®¢äº†ï¼Œä½†æ˜¯åªèƒ½åœ¨æœ¬æœºä¸ŠæŸ¥çœ‹ã€‚
æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªå‘½ä»¤ï¼ˆåœ¨&lt;code>F:\Hexo&lt;/code>ç›®å½•ä¸‹ï¼‰ï¼Œç„¶ååœ¨æµè§ˆå™¨ä¸­è¾“å…¥ &lt;code>localhost:4000&lt;/code> å°±å¯ä»¥çœ‹åˆ°è‡ªå·±çš„åšå®¢äº†&lt;/p>
&lt;pre>&lt;code>&amp;gt; hexo generate
&amp;gt; hexo serrver
&lt;/code>&lt;/pre>&lt;p>ä½†æ˜¯åªèƒ½åœ¨æœ¬åœ°æŸ¥çœ‹ï¼Œå¦‚æœæƒ³è®©åˆ«äººä¹Ÿèƒ½è®¿é—®ï¼Œé‚£ä¹ˆå°±éœ€è¦éƒ¨ç½²åˆ°&lt;a href="https://github.com/">Github&lt;/a> ä¸Šé¢ï¼Œä¸‹é¢ï¼Œæˆ‘ä»¬å°±éƒ¨ç½²ä¸Šå»ã€‚&lt;/p>
&lt;h2 id="æ³¨å†Œgithubhttpsgithubcomè´¦æˆ·">æ³¨å†Œ&lt;a href="https://github.com/">Github&lt;/a>è´¦æˆ·&lt;/h2>
&lt;p>å‰å¾€&lt;a href="https://github.com/">Github&lt;/a>ç½‘ç«™ï¼Œæ³¨å†Œä¸€ä¸ªæ–°ç”¨æˆ·ã€‚ç”¨é‚®ç®±æ³¨å†Œçš„ä¸€å®šå‰å¾€é‚®ç®±å»éªŒè¯é‚®ä»¶ã€‚è¦ä¸ç„¶ä¹‹åå¯èƒ½ä¼šæœ‰å°é—®é¢˜ã€‚&lt;/p>
&lt;h2 id="åˆ›å»ºä¸€ä¸ªæ–°çš„repository">åˆ›å»ºä¸€ä¸ªæ–°çš„repository&lt;/h2>
&lt;p>åœ¨è‡ªå·±çš„&lt;a href="https://github.com/">Github&lt;/a>ä¸»é¡µå³ä¸‹è§’,åˆ›å»ºä¸€ä¸ªæ–°çš„&lt;code>repository&lt;/code>ã€‚
æ¯”å¦‚æˆ‘çš„Githubç”¨æˆ·åä¸º&lt;code>Gitzhaoyang&lt;/code>ï¼Œé‚£ä¹ˆæˆ‘åˆ›å»ºçš„repositoryçš„åå­—åº”è¯¥æ˜¯ &lt;code>gitzhaoyang.github.io&lt;/code> ã€‚&lt;/p>
&lt;p>&lt;img src="https://p3.ssl.qhimg.com/t01eb3bf66c3bc3ad0e.jpg" alt="æ·»åŠ reponsitories">&lt;/p>
&lt;h2 id="è¿™é‡Œä¸¥é‡æ³¨æ„">è¿™é‡Œä¸¥é‡æ³¨æ„&lt;/h2>
&lt;p>ä¸€å®šè¦ä»¥&lt;code>ä½ çš„Githubç”¨æˆ·å.github.io&lt;/code>åˆ›å»ºã€‚å‡å¦‚æˆ‘æ²¡æœ‰ç”¨&lt;code>gitzhaoyang.github.io&lt;/code>è€Œæ˜¯ç”¨äº†&lt;code>mungo.github.io&lt;/code>
ï¼Œé‚£ä¹ˆå½“æˆ‘æµè§ˆå™¨è®¿é—®åšå®¢çš„æ—¶å€™ä¼šå‡ºç°404é”™è¯¯ã€‚è¿™é‡Œå¹¶ä¸æ˜¯æ²¡æœ‰éƒ¨ç½²æˆåŠŸï¼Œè€Œæ˜¯æŠŠå®ƒéƒ¨ç½²åœ¨äº†è¿™é‡Œ:&lt;code>http://gitzhaoyang.github.io/mungo.github.io&lt;/code>ã€‚æ‰€ä»¥ï¼Œå¦‚æœæƒ³ç›´æ¥&lt;code>gitzhaoyang.github.io&lt;/code>è®¿é—®ï¼Œé‚£ä¹ˆå°±éœ€è¦å’Œç”¨æˆ·åä¿æŒä¸€è‡´ã€‚é¢˜ä¸»åœ¨è¿™é‡Œåƒäº†ä¸å°çš„è‹¦å¤´ï¼Œæœ€åç»™Githubå®¢æœå‘é‚®ä»¶æ‰çŸ¥é“åŸå› ã€‚&lt;/p>
&lt;p>åˆ›å»ºå¥½å¦‚ä¸‹å›¾ï¼š&lt;/p>
&lt;p>&lt;img src="https://p2.ssl.qhimg.com/t010ca5a2c0a78b950e.jpg" alt="ä¸€å®šè¦ä¿æŒä¸€è‡´">&lt;/p>
&lt;h2 id="å°†æœ¬åœ°çš„æ–‡ä»¶éƒ¨ç½²ä¸Šä¼ åˆ°githubhttpsgithubcomè´¦æˆ·ä¸­">å°†æœ¬åœ°çš„æ–‡ä»¶éƒ¨ç½²ï¼ˆä¸Šä¼ ï¼‰åˆ°&lt;a href="https://github.com/">Github&lt;/a>è´¦æˆ·ä¸­&lt;/h2>
&lt;p>ç¼–è¾‘æœ¬åœ°&lt;a href="https://hexo.io/">Hexo&lt;/a>ç›®å½•ä¸‹æ–‡ä»¶&lt;code>_comfig.yml&lt;/code>ï¼Œåœ¨æœ€åæ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆåœ¨ä½ ä¿®æ”¹æ—¶ï¼ŒæŠŠ &lt;code>gitzhaoyang&lt;/code> è¦æ›¿æ¢æˆä½ è‡ªå·±çš„ç”¨æˆ·åï¼‰&lt;/p>
&lt;pre>&lt;code>deploy:
type: git
repository: http://github.com/Gitzhaoyang/gitzhaoyang.github.io.git
branch: master
&lt;/code>&lt;/pre>&lt;p>.ymlæ–‡ä»¶å¯¹æ ¼å¼è§„èŒƒè¦æ±‚å¾ˆä¸¥æ ¼ï¼Œ&lt;code>type:&lt;/code> &lt;code>repository:&lt;/code> &lt;code>branch:&lt;/code> å‰é¢æœ‰ä¸¤ä¸ªç©ºæ ¼ï¼Œå†’å·åé¢éƒ½æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚&lt;/p>
&lt;p>æ‰§è¡Œä»¥ä¸‹æŒ‡ä»¤å³å¯å®Œæˆéƒ¨ç½²ï¼ˆå¦‚æœæç¤ºé”™è¯¯ï¼Œå¯ä»¥çœ‹ä¸‹é¢&lt;strong>æ³¨æ„&lt;/strong>ï¼‰ï¼š&lt;/p>
&lt;pre>&lt;code>&amp;gt; hexo generate
&amp;gt; hexo deploy
&lt;/code>&lt;/pre>&lt;h2 id="æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹&lt;/h2>
&lt;ul>
&lt;li>
&lt;p>æœ‰äº›ç”¨æˆ·æ²¡æœ‰è®¾ç½®Githubçš„SSHï¼Œä¼šå¯¼è‡´ä¸Šé¢ä¸¤å¥å¤±è´¥ã€‚SSHçš„ä»‹ç»å’Œè®¾ç½®æ–¹æ³•å¯ä»¥æŸ¥çœ‹
&lt;a href="https://help.github.com/articles/generating-ssh-keys">å®˜æ–¹æ•™ç¨‹&lt;/a>,é…ç½®èµ·æ¥å¾ˆç®€å•ã€‚
å¦‚æœè‹±æ–‡çœ‹ä¸æ˜ç™½æˆ–è€…è¿‡ç¨‹ä¸­å‡ºç°å°é—®é¢˜ï¼Œ å¯ä»¥æŸ¥çœ‹æˆ‘å†™çš„
&lt;a href="https://h1z3y3.me/2015/10/13/how-to-config-ssh-on-github/index.html">SSHè®¾ç½®æ•™ç¨‹&lt;/a> ï¼Œæ˜¯å¯¹å®˜æ–¹æ•™ç¨‹çš„è§£é‡Šå’Œæ‰©å±•ï¼Œ
é’ˆå¯¹é…ç½®è¿‡ç¨‹ä¸­çš„å°é—®é¢˜éƒ½æœ‰è§£å†³åŠæ³•ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>æ¯æ¬¡ä¿®æ”¹æœ¬åœ°æ–‡ä»¶ï¼Œéƒ½éœ€è¦å‘½ä»¤&lt;code>$ hexo generate&lt;/code>æ‰èƒ½ä¿å­˜ã€‚è€Œä¸”æ¯æ¬¡ä½¿ç”¨å‘½ä»¤éƒ½å¿…é¡»åœ¨ &lt;a href="https://hexo.io/">Hexo&lt;/a> æ ¹ç›®å½•ä¸‹ä½¿ç”¨ã€‚&lt;/p>
&lt;/li>
&lt;li>
&lt;p>å¦‚æœä½ åœ¨æ‰§è¡Œ&lt;code>$ hexo deloy&lt;/code>,å¦‚æœæç¤º &lt;code>ERROR Deployer not found: git&lt;/code>ï¼Œé‚£è¯´æ˜ä½ æ²¡æœ‰å®‰è£…&lt;code>hexo-deployer-git&lt;/code>ä¾èµ–åŒ…ï¼Œè¿›å…¥&lt;code>F:\Hexo\node_modules&lt;/code>
å‘ç°çœŸçš„æ²¡æœ‰&lt;code>hexo-deployer-git&lt;/code>ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œåªéœ€è¦è¾“å…¥ä¸‹é¢å‘½ä»¤åˆ›å»º&lt;code>hexo-deployer-git&lt;/code>ä¾èµ–åŒ…ï¼Œç„¶åå†æ‰§è¡Œ&lt;code>hexo deploy&lt;/code>å°±èƒ½ä¸Šä¼ æˆåŠŸäº†&lt;/p>
&lt;pre>&lt;code>&amp;gt; npm install hexo-deployer-git --save
&lt;/code>&lt;/pre>&lt;/li>
&lt;li>
&lt;p>å¦‚æœä½ æ˜¯windowsç”¨æˆ·ï¼Œé‚£ä¹ˆå½“ä½ æ‰§è¡Œ&lt;code>$ hexo deploy&lt;/code>å‘½ä»¤çš„æ—¶å€™ï¼Œ
å¯èƒ½ä¼šå…ˆåå‡ºç°æç¤ºæ¡†è®©ä½ è¾“å…¥ä½ çš„&lt;strong>Githubç”¨æˆ·å&lt;/strong>å’Œ&lt;strong>Githubå¯†ç &lt;/strong>ï¼Œåªè¦è¾“å…¥æ­£ç¡®ï¼Œä¸Šä¼ å°±æ²¡æœ‰é—®é¢˜ã€‚&lt;/p>
&lt;/li>
&lt;/ul>
&lt;p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çš„åšå®¢å·²ç»åœ¨Githubä¸Šé¢éƒ¨ç½²æˆåŠŸäº†ï¼Œå¯ä»¥åœ¨æµè§ˆå™¨è®¿é—®&lt;code>gitzhaoyang.github.io&lt;/code>è¯•è¯•äº†ã€‚&lt;/p>
&lt;h2 id="æç¤º">æç¤º&lt;/h2>
&lt;p>ç°åœ¨Hexoæ”¯æŒæ›´åŠ ç®€å•çš„å‘½ä»¤æ ¼å¼äº†ï¼Œæ¯”å¦‚ï¼š&lt;/p>
&lt;pre>&lt;code>hexo s == hexo server
hexo g == hexo generate
hexo d == hexo deploy
hexo n == hexo new
&lt;/code>&lt;/pre>&lt;p>åç»­æˆ‘ä¼šæŠŠå¦‚ä½•é…ç½®åšå®¢ä¿¡æ¯ï¼Œå‘è¡¨æ–‡ç« ï¼Œè®¾ç½®åšå®¢ä¸»é¢˜ï¼Œä¸åŒç”µè„‘é—´è¿›è¡ŒåŒæ—¶æ›´æ–°è‡ªå·±çš„Blogçš„æ–¹æ³•ç­‰æ›´æ–°ä¸Šæ¥,æ„Ÿå…´è¶£çš„äººå¯ä»¥å…³æ³¨&lt;/p></description><category domain="https://h1z3y3.me/tags/hexo/">Hexo</category><category domain="https://h1z3y3.me/tags/github/">Github</category></item></channel></rss>